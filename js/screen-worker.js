(()=>{"use strict";var e={50:(e,t)=>{var s,i,r,a,h,c;Object.defineProperty(t,"__esModule",{value:!0}),t.CpuError=t.CpuExCode=t.CpuReg=t.Access=t.CpuMode=t.Repeat=t.Direction=t.CpuType=void 0,(h=t.CpuType||(t.CpuType={}))[h.Cpu186=0]="Cpu186",h[h.Cpu386=1]="Cpu386",(a=t.Direction||(t.Direction={}))[a.RegToRm=0]="RegToRm",a[a.RmToReg=1]="RmToReg",(r=t.Repeat||(t.Repeat={}))[r.None=0]="None",r[r.RepZ=1]="RepZ",r[r.RepNz=2]="RepNz",(i=t.CpuMode||(t.CpuMode={}))[i.Real=0]="Real",i[i.Protected=1]="Protected",i[i.Virtual8086=2]="Virtual8086",(s=t.Access||(t.Access={}))[s.Read=0]="Read",s[s.Write=1]="Write",t.CpuReg=class{getLoWord(){return 65535&this.value}setLoWord(e){this.value=(4294901760&this.value)+(65535&e)}getLoByte(){return 255&this.value}setLoByte(e){this.value=(4294967040&this.value)+(255&e)}getHiByte(){return this.value>>8&255}setHiByte(e){this.value=(4294902015&this.value)+((255&e)<<8)}},(c=t.CpuExCode||(t.CpuExCode={}))[c.DE=0]="DE",c[c.DB=1]="DB",c[c.BP=3]="BP",c[c.OF=4]="OF",c[c.BR=5]="BR",c[c.UD=6]="UD",c[c.NM=7]="NM",c[c.DF=8]="DF",c[c.TS=10]="TS",c[c.NP=11]="NP",c[c.SS=12]="SS",c[c.GP=13]="GP",c[c.PF=14]="PF",c[c.MF=16]="MF",c[c.AC=17]="AC",c[c.MC=18]="MC",c[c.XF=19]="XF",c[c.VE=20]="VE",c[c.SX=30]="SX",t.CpuError=class{constructor(e,t=null){this.exCode=e,this.errorCode=t}}},523:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ATColorGraphicsCard=void 0;const i=s(868),r=s(740);var a;!function(e){e[e.Unmodified=0]="Unmodified",e[e.And=1]="And",e[e.Or=2]="Or",e[e.Xor=3]="Xor"}(a||(a={}));class h extends i.ColorGraphicsCard{constructor(){super(),this.planeCount=4,this.planes=new Array(this.planeCount),this.latches=new Array(this.planeCount),this.mapMask=new Array(this.planeCount),this.enableSetReset=new Array(this.planeCount),this.setReset=new Array(this.planeCount),this.modeControlRegister=0,this.colorSelectRegister=0,this.miscOutputRegister=0,this.sequencerIndex=0,this.sequencerRegisters=new Array(5),this.gdcIndex=0,this.gdcRegisters=new Array(9),this.attributeFlipFlop=!1,this.attributeIndex=0,this.attributeRegisters=new Array(21),this.graphicsMode=!1,this.colorPlaneEnabled=new Array(4),this.readMapSelect=0,this.rotateCount=0,this.bitMask=0,this.oddEven=!1,this.colorDontCare=new Array(4),this.mapMaskRegister=0,this.colorCompareRegister=0,this.featureControlRegister=0,this.gdcGraphicsMode=!1,this.monochrome=!1,this.memoryModeRegister=0,this.characterMapSelectRegister=0,this.characterMapA=0,this.characterMapB=0,this.clockMode=0,this.writeMode=0,this.readMode=0,this.chain4=!1,this.egaPalette=new Array(16),this.cgaPalette=new Array(16),this.memStart=0,this.memSize=0,this.crtBasePort=0,this.charBoxWidth=0,this.startAddr=655360,this.setRamSize(262144),this.memStart=720896,this.memSize=65536,this.crtBasePort=976,this.miscOutputRegister=3,this.bitMask=255;for(let e=0;e<16;e++)this.egaPalette[e]=this.cgaColors[e],this.cgaPalette[e]=this.cgaColors[e];for(let e=0;e<this.planeCount;e++)this.planes[e]=new Uint8Array(65536),this.mapMask[e]=!0}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB}getCrtStartAddr(){return(this.crtRegisters[12]<<8)+this.crtRegisters[13]}getUnderlineLocation(){return 31&this.crtRegisters[20]}getMaximumCharScanLine(){return 31&this.crtRegisters[9]}getCrtOffset(){return this.crtRegisters[19]}getPresetRowScan(){return this.crtRegisters[8]}getHorizontalPixelPanning(){return 15&this.attributeRegisters[19]}getEnableLineGraphicsCharacterCode(){return(4&this.attributeRegisters[16])>0}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("planes")}getMemoryData(){const e=new Array(this.planeCount);for(let t=0;t<this.planeCount;t++)e[t]=this.planes[t].buffer;return e}updateMemory(e){for(let t=0;t<this.planeCount;t++)this.planes[t]=new Uint8Array(e[t])}in(e){if(e==this.crtBasePort+5)return this.getDataRegister();switch(e){case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister}return 65535}out(e,t,s){if(e==this.crtBasePort+4)return this.setIndexRegister(255&t),void(s&&this.out(981,t>>8,!1));if(e!=this.crtBasePort+5)if(e!=this.crtBasePort+10)switch(e){case 962:this.miscOutputRegister=255&t,this.crtBasePort=0==(1&t)?944:976;break;case 964:this.sequencerIndex=7&t,s&&this.out(965,t>>8&255,!1);break;case 974:this.gdcIndex=15&t,s&&this.out(975,t>>8,!1);break;case 975:switch(this.gdcIndex){case 0:this.setReset[0]=(1&t)>0,this.setReset[1]=(2&t)>0,this.setReset[2]=(4&t)>0,this.setReset[3]=(8&t)>0;break;case 1:this.enableSetReset[0]=(1&t)>0,this.enableSetReset[1]=(2&t)>0,this.enableSetReset[2]=(4&t)>0,this.enableSetReset[3]=(8&t)>0;break;case 2:this.colorCompareRegister=255&t;break;case 3:switch(this.rotateCount=7&t,t>>3&3){case 0:this.currentDataFunction=a.Unmodified;break;case 1:this.currentDataFunction=a.And;break;case 2:this.currentDataFunction=a.Or;break;case 3:this.currentDataFunction=a.Xor}break;case 4:this.readMapSelect=3&t;break;case 5:this.writeMode=3&t,this.readMode=t>>3&1;break;case 6:switch(this.gdcGraphicsMode=(1&t)>0,t>>2&3){case 0:this.memStart=655360,this.memSize=131072;break;case 1:this.memStart=655360,this.memSize=65536;break;case 2:this.memStart=720896,this.memSize=32768;break;case 3:this.memStart=753664,this.memSize=32768}break;case 7:for(let e=0;e<this.planeCount;e++)this.colorDontCare[e]=(t&1<<e)>0;break;case 8:this.bitMask=t}this.gdcIndex<this.gdcRegisters.length&&(this.gdcRegisters[this.gdcIndex]=255&t);break;case 984:this.modeControlRegister=255&t;break;case 985:this.colorSelectRegister=255&t}else this.featureControlRegister=255&t;else this.setDataRegister(255&t)}peek(e){if(e<this.memStart||e>=this.memStart+this.memSize)return 0;let t=e-this.memStart;if(this.chain4)return this.planes[3&t][t>>2];const s=0==(1&t);this.oddEven&&(t>>=1);for(let e=0;e<this.planeCount;e++)this.latches[e]=this.planes[e][t];if(0==this.readMode)return this.oddEven?s?this.planes[0][t]:this.planes[1][t]:this.planes[this.readMapSelect][t];{const e=15&this.colorCompareRegister;let s=255;for(let i=0;i<this.planeCount;i++){if(!this.colorDontCare[i])continue;const r=this.planes[i][t],a=(e&1<<i)>0;let h=1;for(let e=0;e<8;e++)(r&h)>0!=a&&(s&=~h),h<<=1}return 255&s}}poke(e,t){if(e<this.memStart||e>=this.memStart+this.memSize)return;let s=e-this.memStart;if(this.chain4)return void(this.planes[3&s][s>>2]=t);const i=0==(1&s);this.oddEven&&(s>>=1),this.internalPoke(t,i,s)}internalPoke(e,t,s){if(0==this.writeMode){let i=e;this.rotateCount>0&&(i=255&(i>>this.rotateCount|i<<8-this.rotateCount));for(let e=0;e<this.planeCount;e++){if(!this.mapMask[e])continue;if(this.oddEven&&(t&&0!=e&&2!=e||!t&&1!=e&&3!=e))continue;const r=this.latches[e];let h=this.enableSetReset[e]?this.setReset[e]?255:0:i;switch(this.currentDataFunction){case a.And:h&=r;break;case a.Or:h|=r;break;case a.Xor:h^=r}this.planes[e][s]=255&(h&this.bitMask|r&~this.bitMask)}}else if(1==this.writeMode)for(let e=0;e<this.planeCount;e++)this.planes[e][s]=this.latches[e];else if(2==this.writeMode)for(let i=0;i<this.planeCount;i++){if(!this.mapMask[i])continue;if(this.oddEven&&(t&&0!=i&&2!=i||!t&&1!=i&&3!=i))continue;const r=this.latches[i];let h=(e&1<<i)>0?255:0;switch(this.currentDataFunction){case a.And:h&=r;break;case a.Or:h|=r;break;case a.Xor:h^=r}this.planes[i][s]=255&(h&this.bitMask|r&~this.bitMask)}}waitForScreenDraw(){if(0==this.screenUpdateClocks)return;const e=this.horAreaEndClocks-this.horAreaStartClocks;this.eventTimer.clockCount%this.screenUpdateClocks>=this.horAreaStartClocks&&Math.trunc(this.horAreaStartClocks+e/2)}calcRetraceEnable(){if(0==this.screenUpdateClocks)return{vertRetrace:!1,enable:!1};const e=this.eventTimer.clockCount%this.screenUpdateClocks,t=e<this.vertRetraceClocks;let s=!1;return e>=this.horAreaStartClocks&&e<this.horAreaEndClocks&&(s=(e-this.horAreaStartClocks)%this.lineClocks<this.horRetraceClocks),{vertRetrace:t,enable:s||t&&e>this.horRetraceClocks}}genColor(e){const t=((4&e)>0?170:0)+((32&e)>0?85:0),s=((2&e)>0?170:0)+((16&e)>0?85:0),i=((1&e)>0?170:0)+((8&e)>0?85:0);return r.Col.fromRgb(t,s,i)}genCgaColor(e){return this.cgaColors[(7&e)+((16&e)>0?8:0)]}updateTextScreen(e,t,s){this.charHeight=this.getMaximumCharScanLine()+1;const i=Math.trunc(this.colCount/this.charBoxWidth),a=Math.trunc(this.lineCount/this.charHeight),h=new Array(a*i);this.internalUpdateTextScreen(h,0,a,i,s);let c=0;for(let s=0;s<a;s++)for(let a=0;a<i;a++){const i=h[c],n=new r.IntRect(a*this.charBoxWidth,s*this.charHeight,this.charBoxWidth,this.charHeight);this.writePixels(e,t,i,n),c++}}internalUpdateTextScreen(e,t,s,i,r){let a=this.getCrtStartAddr()+t*i,h=t*i;const c=this.getAllowSwitchCharSets(),n=this.charBoxWidth>this.charWidth,o=8192*this.characterMapA,d=8192*this.characterMapB;let l=0;for(let u=t;u<t+s;u++)for(let t=0;t<i;t++){const t=this.planes[1][a];let s;c?(l=(8&t)>0?o:d,s=r[7&t]):s=r[15&t];const i=this.blink&&(128&t)>0,u=this.blink?r[t>>4&7]:r[t>>4];i&&!this.cursorOn&&(s=u),e[h]=this.drawEgaVgaChar(this.planes[0][a],s,u,l,!1,a==this.getCursorPos()&&this.cursorOn,n),a++,h++}}drawEgaVgaChar(e,t,s,i,a,h,c){const n=new Uint32Array(this.charBoxWidth*this.charHeight);let o=0,d=!1;const l=this.planes[2],u=i+(e<<5),g=e>=192&&e<=223&&this.getEnableLineGraphicsCharacterCode();let C=r.Col.fromRgb(0,0,0);for(let e=0;e<this.charHeight;e++){const i=l[u+e];let r=128;const p=this.getCursorStart(),m=this.getCursorEnd();if(h&&p<this.charHeight&&m<this.charHeight){const t=0==m?this.charHeight-1:m;d=e>=p&&e<=t}const M=a&&e==this.getUnderlineLocation()||d;for(let e=0;e<this.charWidth;e++)C=M||(i&r)>0?t:s,r>>=1,n[o++]=C.value;c&&(n[o++]=g?C.value:s.value)}return n}updateScreenCgaLo(e){const t=this.getCgaGraphicsColors(this.colorSelectRegister),s=new Uint32Array(e.buffer);let i=0,r=0,a=8192;for(let e=0;e<200;e++){let h=0==(1&e)?r:a;for(let e=0;e<320;e+=4){const e=0==(1&h)?this.planes[0][h>>1]:this.planes[1][h>>1];let r;r=t[e>>6],s[i++]=r.value,r=t[e>>4&3],s[i++]=r.value,r=t[e>>2&3],s[i++]=r.value,r=t[3&e],s[i++]=r.value,h++}e%2==0?r=h:a=h}}updateScreenCgaMono(e,t,s){const i=r.Col.fromRgb(255,255,255),a=this.overscanColor,h=new Uint32Array(e.buffer);let c=0,n=0,o=8192;for(let e=0;e<s;e++){let s=0==(1&e)?n:o;for(let e=0;e<t;e+=8){let e=this.planes[0][s];for(let t=0;t<8;t++)h[c++]=(128&e)>0?i.value:a.value,e<<=1;s++}e%2==0?n=s:o=s}}updateScreen16Col(e,t,s,i){const r=new Uint32Array(e.buffer),a=0==this.getCrtOffset()?t/8:this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),c=0;const n=this.getHorizontalPixelPanning(),o=0==n?t:t+8;for(let e=0;e<s;e++){let e=h;for(let t=0;t<o;t+=8,e++){const s=65535&e;let a=this.planes[0][s],h=this.planes[1][s],d=this.planes[2][s],l=this.planes[3][s];for(let e=0;e<8;e++){const s=i[((128&a)>>7)+((128&h)>>6)+((128&d)>>5)+((128&l)>>4)];(0==n||t+e>=n&&t+e<o-8+n)&&(r[c++]=s.value),a<<=1,h<<=1,d<<=1,l<<=1}}h+=a}}}t.ATColorGraphicsCard=h},763:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseComponent=void 0,t.BaseComponent=class{reset(){}}},441:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CgaGraphics=void 0;const i=s(868),r=s(740);var a;!function(e){e[e.None=0]="None",e[e.Text40x25=1]="Text40x25",e[e.Text80x25=2]="Text80x25",e[e.GraphicsLo=3]="GraphicsLo",e[e.GraphicsHi=4]="GraphicsHi"}(a||(a={}));class h extends i.ColorGraphicsCard{constructor(){super(),this.charsetFile1="Fonts/cga1.dat",this.charsetFile2="Fonts/cga2.dat",this.charsetWidth=32,this.charsetHeight=8,this.horRetrace=0,this.colorSelectRegister=0,this.modeControlRegister=0,this.charset1=new Array(256),this.charset2=new Array(256),this.activeCharsetNo=0,this.startAddr=753664,this.setRamSize(16384),this.charWidth=8,this.charHeight=8,this.activeCharsetNo=1,this.lineCount=200}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile1"),this.ignoredFields.add("charsetFile2"),this.ignoredFieldsUpdate.add("charset1"),this.ignoredFieldsUpdate.add("charset2")}modeChanged(){super.modeChanged(),this.calcRetraceValues(),this.charCache.clear()}getCharset(){return 0==this.activeCharsetNo?this.charset1:this.charset2}updateScreenGraphicsLo(e){const t=this.getCgaGraphicsColors(this.colorSelectRegister),s=new Uint32Array(e.buffer);let i=0,r=0,a=8192;for(let e=0;e<200;e++){let h=0==(1&e)?r:a;for(let e=0;e<320;e+=4){const e=this.ram[h];let r;r=t[e>>6],s[i++]=r.value,r=t[e>>4&3],s[i++]=r.value,r=t[e>>2&3],s[i++]=r.value,r=t[3&e],s[i++]=r.value,h++}e%2==0?r=h:a=h}}updateScreenGraphicsHi(e){const t=this.cgaColors[15&this.colorSelectRegister],s=new Uint32Array(e.buffer);let i=0,r=0,a=8192;for(let e=0;e<200;e++){let h=0==(1&e)?r:a;for(let e=0;e<640;e+=8){let e=this.ram[h];for(let r=0;r<8;r++)(128&e)>0&&(s[i]=t.value),i++,e<<=1;h++}e%2==0?r=h:a=h}}updateTextScreen(e,t,s,i,a,h){const c=new r.IntRect(0,0,this.charWidth,this.charHeight),n=2*this.getCursorPos();let o=0;for(let r=0;r<a;r++,c.y+=this.charHeight){c.x=0;for(let r=0;r<i;r++,c.x+=this.charWidth){const i=this.ram[o+1],r=this.blink&&(128&i)>0,a=this.blink?h[i>>4&7]:h[i>>4];let d=h[15&i];r&&!this.cursorOn&&(d=a);const l=this.ram[o],u=s[l],g=this.drawChar(l,u,d,a,!1,o==n&&this.cursorOn);this.writePixels(e,t,g,c),o+=2}}}async loadCharSet(){await this.loadCharSetInternal(this.charset1,this.charsetFile1,this.charsetWidth,this.charsetHeight),await this.loadCharSetInternal(this.charset2,this.charsetFile2,this.charsetWidth,this.charsetHeight)}updateScreen(e,t){switch(super.updateScreen(e,t),this.mode){case a.Text40x25:this.updateTextScreen(e,t,this.getCharset(),40,25,this.cgaColors);break;case a.Text80x25:this.updateTextScreen(e,t,this.getCharset(),80,25,this.cgaColors);break;case a.GraphicsLo:this.updateScreenGraphicsLo(e);break;case a.GraphicsHi:this.updateScreenGraphicsHi(e)}}in(e){switch(e){case 977:case 979:case 981:case 983:return this.getDataRegister();case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister;case 986:{0==this.horRetrace&&(this.horRetrace=2),this.horRetrace--;let e=this.calcVertRetrace()?8:0;return e+=0==this.horRetrace?0:1,255&e}}return 0}out(e,t,s){switch(e){case 976:case 978:case 980:case 982:this.setIndexRegister(t);break;case 977:case 979:case 981:case 983:this.setDataRegister(t);break;case 984:{this.modeControlRegister=255&t,this.blink=(32&t)>0,this.blackWhite=(4&t)>0;const e=this.mode;switch(27&t){case 8:this.mode=a.Text40x25,this.screenWidth=320,this.screenHeight=200;break;case 9:this.mode=a.Text80x25,this.screenWidth=640,this.screenHeight=200;break;case 10:this.mode=a.GraphicsLo,this.screenWidth=320,this.screenHeight=200;break;case 26:this.mode=a.GraphicsHi,this.screenWidth=640,this.screenHeight=200}this.mode!=e&&this.modeChanged()}break;case 985:this.colorSelectRegister=255&t}}}t.CgaGraphics=h},868:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorGraphicsCard=void 0;const i=s(740),r=s(915);class a extends i.GraphicsCard{constructor(){super(),this.screenFrequency=60,this.screenUpdateClocks=0,this.lineClocks=0,this.vertRetraceClocks=0,this.vertBlankClocks=0,this.horRetraceClocks=0,this.horAreaStartClocks=0,this.horAreaEndClocks=0,this.blink=!1,this.colCount=0,this.lineCount=0,this.cgaColors=new Array(16),this.initCgaColors()}modeChanged(){}calcRetraceValues(){0!=this.lineCount&&(this.screenUpdateClocks=Math.trunc(1e3*r.Settings.cpuFrequency/this.screenFrequency),this.vertRetraceClocks=Math.trunc(this.screenUpdateClocks/50),this.vertBlankClocks=Math.trunc(this.screenUpdateClocks/100),this.lineClocks=Math.trunc((this.screenUpdateClocks-this.vertRetraceClocks-this.vertBlankClocks)/this.lineCount),this.horRetraceClocks=Math.trunc(this.lineClocks/5),this.horAreaStartClocks=this.vertRetraceClocks+Math.trunc(this.vertBlankClocks/2),this.horAreaEndClocks=this.horAreaStartClocks+this.lineClocks*this.lineCount)}calcVertRetrace(){return 0!=this.screenUpdateClocks&&this.eventTimer.clockCount%this.screenUpdateClocks<this.vertRetraceClocks}initCgaColors(){this.cgaColors[0]=i.Col.fromRgb(0,0,0),this.cgaColors[1]=i.Col.fromRgb(0,0,170),this.cgaColors[2]=i.Col.fromRgb(0,170,0),this.cgaColors[3]=i.Col.fromRgb(0,170,170),this.cgaColors[4]=i.Col.fromRgb(170,0,0),this.cgaColors[5]=i.Col.fromRgb(170,0,170),this.cgaColors[6]=i.Col.fromRgb(170,85,0),this.cgaColors[7]=i.Col.fromRgb(170,170,170),this.cgaColors[8]=i.Col.fromRgb(85,85,85),this.cgaColors[9]=i.Col.fromRgb(85,85,255),this.cgaColors[10]=i.Col.fromRgb(85,255,85),this.cgaColors[11]=i.Col.fromRgb(85,255,255),this.cgaColors[12]=i.Col.fromRgb(255,85,85),this.cgaColors[13]=i.Col.fromRgb(255,85,255),this.cgaColors[14]=i.Col.fromRgb(255,255,85),this.cgaColors[15]=i.Col.fromRgb(255,255,255)}getCgaGraphicsColors(e){const t=(16&e)>0?8:0,s=e>>5&1,i=new Array(4);return i[0]=this.cgaColors[15&e],0==s?(i[1]=this.cgaColors[2+t],i[2]=this.cgaColors[4+t],i[3]=this.cgaColors[6+t]):(i[1]=this.cgaColors[3+t],i[2]=this.cgaColors[5+t],i[3]=this.cgaColors[7+t]),i}}t.ColorGraphicsCard=a,a.dataBuffer=new Array},6:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EgaGraphics=void 0;const i=s(523),r=s(915);var a;!function(e){e[e.None=0]="None",e[e.M00_CGA=1]="M00_CGA",e[e.M00_EGA=2]="M00_EGA",e[e.M02_CGA=3]="M02_CGA",e[e.M02_EGA=4]="M02_EGA",e[e.M04=5]="M04",e[e.M06=6]="M06",e[e.M07=7]="M07",e[e.M0D=8]="M0D",e[e.M0E=9]="M0E",e[e.M0F=10]="M0F",e[e.M10=11]="M10"}(a||(a={}));class h extends i.ATColorGraphicsCard{constructor(){super(),this.diagnosticCount=0,this.egaSwitches=[!1,!0,!0,!1],this.charWidth9Bits=!1,this.mode=a.None,this.screenWidth=640,this.screenHeight=350,this.charBoxWidth=this.charWidth=8}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("egaSwitches")}in(e){switch(e){case 962:{let e=this.calcVertRetrace()?0:128;const t=this.miscOutputRegister>>2&3;return e+=this.egaSwitches[t]?0:16,e+=0,255&e}case 968:return 0;case 986:{this.attributeFlipFlop=!1;const e=this.calcRetraceEnable();let t=(e.vertRetrace?8:0)+(e.enable?0:1);return 4==++this.diagnosticCount&&(this.diagnosticCount=0),t+=this.diagnosticCount>1?48:0,255&t}default:return super.in(e)}}out(e,t,s){switch(e){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&t,this.attributeIndex){case 16:this.graphicsMode=(1&t)>0,this.monochrome=(2&t)>0,this.charWidth9Bits=(4&t)>0,this.blink=(8&t)>0;break;case 17:this.overscanColor=this.genColor(255&t);break;case 18:for(let e=0;e<this.colorPlaneEnabled.length;e++)this.colorPlaneEnabled[e]=(t&1<<e)>0;break;default:this.attributeIndex>=0&&this.attributeIndex<=15&&(this.egaPalette[this.attributeIndex]=this.genColor(255&t),this.cgaPalette[this.attributeIndex]=this.genCgaColor(255&t))}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&t,this.attributeFlipFlop=!this.attributeFlipFlop,s&&this.out(e,t>>8,!1);break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&t;break;case 2:this.mapMaskRegister=255&t,this.mapMask[0]=(1&t)>0,this.mapMask[1]=(2&t)>0,this.mapMask[2]=(4&t)>0,this.mapMask[3]=(8&t)>0;break;case 3:this.characterMapSelectRegister=255&t,this.characterMapA=t>>2&3,this.characterMapB=3&t;break;case 4:this.memoryModeRegister=255&t,this.oddEven=0==(4&t)}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&t);break;case 970:case 972:break;default:super.out(e,t,s)}}calcMode(){const e=this.mode,t=this.sequencerRegisters[1],s=this.sequencerRegisters[2],i=this.sequencerRegisters[4];11==t&&3==i?(35==this.miscOutputRegister&&(this.mode=a.M00_CGA),167==this.miscOutputRegister&&(this.mode=a.M00_EGA)):1==t&&3==i?(35==this.miscOutputRegister&&(this.mode=a.M02_CGA),167==this.miscOutputRegister&&(this.mode=a.M02_EGA)):11==t&&2==i?this.mode=a.M04:1==t&&6==i?35==this.miscOutputRegister?1==s?this.mode=a.M06:15==s&&(this.mode=a.M0E):162==this.miscOutputRegister?this.mode=a.M0F:167==this.miscOutputRegister&&(this.mode=a.M10):0==t&&3==i?this.mode=a.M07:1==t&&6==i?this.mode=a.M04:11==t&&6==i&&(this.mode=a.M0D),this.mode!=e&&this.modeChanged()}modeChanged(){super.modeChanged(),0==(this.miscOutputRegister>>2&3)?this.lineCount=200:this.lineCount=350,(8&this.clockMode)>0?this.colCount=320:this.colCount=640,this.calcRetraceValues()}updateDimensions(){switch(this.calcMode(),this.mode){case a.M00_CGA:this.screenWidth=320,this.screenHeight=200;break;case a.M00_EGA:this.screenWidth=320,this.screenHeight=350;break;case a.M02_CGA:this.screenWidth=640,this.screenHeight=200;break;case a.M02_EGA:this.screenWidth=640,this.screenHeight=350;break;case a.M04:this.screenWidth=320,this.screenHeight=200;break;case a.M06:this.screenWidth=640,this.screenHeight=200;break;case a.M07:this.screenWidth=720,this.screenHeight=350;break;case a.M0D:this.screenWidth=320,this.screenHeight=200;break;case a.M0E:this.screenWidth=640,this.screenHeight=200;break;case a.M0F:case a.M10:this.screenWidth=640,this.screenHeight=350}}updateScreen(e,t){switch(super.updateScreen(e,t),r.Settings.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.mode){case a.M00_CGA:case a.M00_EGA:case a.M02_CGA:case a.M02_EGA:this.updateTextScreen(e,t,this.egaPalette);break;case a.M04:this.updateScreenCgaLo(e);break;case a.M06:this.updateScreenCgaMono(e,640,200);break;case a.M07:break;case a.M0D:this.updateScreen16Col(e,320,200,this.cgaPalette);break;case a.M0E:this.updateScreen16Col(e,640,200,this.cgaPalette);break;case a.M0F:break;case a.M10:this.updateScreen16Col(e,640,350,this.egaPalette)}}}t.EgaGraphics=h},740:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsCard=t.IntRect=t.Col=void 0;const i=s(763),r=s(915);class a{constructor(){this.r=0,this.g=0,this.b=0,this.value=0}static fromRgb(e,t,s){const i=new a;return i.r=255&e,i.g=255&t,i.b=255&s,i.value=i.r+(i.g<<8)+(i.b<<16)+4278190080&4294967295,i}}t.Col=a,t.IntRect=class{constructor(e,t,s,i){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e,this.y=t,this.width=s,this.height=i}};class h extends i.BaseComponent{constructor(){super(),this.cursorBlinkDelay=250,this.ignoredFields=new Set,this.ignoredFieldsUpdate=new Set,this.cursorSwitchCountdown=0,this.cursorSwitchStartValue=0,this.charCache=new Map,this.crtIndexReg=0,this.crtRegisters=new Uint8Array(25),this.startAddr=0,this.ramSize=0,this.screenWidth=0,this.screenHeight=0,this.charWidth=0,this.charHeight=0,this.supportWrite=!0,this.supportRead=!0,this.cursorOn=!0,this.fillIgnoredFields(),this.ignoredFields.forEach((e=>this.ignoredFieldsUpdate.add(e)))}fillIgnoredFields(){this.ignoredFields.add("ignoredFields"),this.ignoredFields.add("ignoredFieldsUpdate"),this.ignoredFields.add("ram"),this.ignoredFields.add("charCache"),this.ignoredFieldsUpdate.add("cursorOn"),this.ignoredFieldsUpdate.add("cursorSwitchStartValue"),this.ignoredFieldsUpdate.add("cursorSwitchCountdown")}setRamSize(e){this.ramSize=e,this.ram=new Uint8Array(this.ramSize)}getCursorStart(){return this.crtRegisters[10]}getCursorEnd(){return this.crtRegisters[11]}getCursorPos(){return(this.crtRegisters[14]<<8)+this.crtRegisters[15]}setScreenUpdateRate(e){this.cursorSwitchStartValue=Math.trunc(this.cursorBlinkDelay*e/1e3)}loadCharSet(){}peek(e){return e>=this.startAddr&&e<this.startAddr+this.ramSize?this.ram[e-this.startAddr]:0}poke(e,t){e>=this.startAddr&&e<this.startAddr+this.ramSize&&(this.ram[e-this.startAddr]=t)}loadCharSetInternal(e,t,s,i){return new Promise(((s,i)=>{const a=new XMLHttpRequest;a.responseType="text",a.open("GET",r.Settings.baseDir+t,!0),a.onload=()=>{if(200!=a.status)return void i();const t=a.response.split(/\r?\n/);if(t.length>=256)for(let s=0;s<256;s++){const i=t[s].split(","),r=new Array(i.length);for(let e=0;e<i.length;e++)r[e]="1"==i[e];e[s]=r}s()},a.onerror=()=>{i()},a.send()}))}drawChar(e,t,s,i,r=!1,a=!1){const h=this.calcTextCharHash(s,i,e);if(!r&&!a){const e=this.charCache.get(h);if(e)return e}const c=new Uint32Array(this.charWidth*this.charHeight);let n=0,o=0,d=!1;const l=this.getCursorStart(),u=this.getCursorEnd();for(let e=0;e<this.charHeight;e++){a&&l<this.charHeight&&u<this.charHeight&&(d=l<=u?e>=l&&e<=u:e<=u||e>=l);const h=r&&e==this.charHeight-1||d;for(let e=0;e<this.charWidth;e++){const e=h||t[n]?s:i;n++,c[o++]=e.value}}return r||a||this.charCache.set(h,c),c}writePixels(e,t,s,i){const r=new Uint8Array(s.buffer);let a=4*(i.x+i.y*t),h=0;for(let s=0;s<i.height;s++)e.set(r.subarray(h,h+4*i.width),a),h+=4*i.width,a+=4*t}setIndexRegister(e){this.crtIndexReg=31&e}setDataRegister(e){this.crtIndexReg<this.crtRegisters.length&&(this.crtRegisters[this.crtIndexReg]=e)}getDataRegister(){return this.crtIndexReg>=12&&this.crtIndexReg<=15?this.crtRegisters[this.crtIndexReg]:0}updateDimensions(){}getJsonInitial(){return JSON.stringify(this,((e,t)=>{if(!this.ignoredFields.has(e))return"eventTimer"==e?{clockCount:this.eventTimer.clockCount}:t}))}getJsonUpdate(){return JSON.stringify(this,((e,t)=>{if(!this.ignoredFieldsUpdate.has(e))return"eventTimer"==e?{clockCount:this.eventTimer.clockCount}:t}))}applyJson(e){const t=JSON.parse(e);Object.assign(this,t)}getMemoryData(){return[this.ram.buffer]}updateMemory(e){this.ram=new Uint8Array(e[0])}updateScreen(e,t){this.cursorSwitchStartValue>0&&(0==this.cursorSwitchCountdown&&(this.cursorOn=!this.cursorOn,this.cursorSwitchCountdown=this.cursorSwitchStartValue),this.cursorSwitchCountdown--)}calcTextCharHash(e,t,s){return e.r+256*e.g+65536*e.b+t.r*2**24+t.g*2**32+t.b*2**40+s*2**48}}t.GraphicsCard=h},696:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MdaGraphics=void 0;const i=s(740);class r extends i.GraphicsCard{constructor(){super(),this.charsetFile="Fonts/mda.dat",this.charsetWidth=32,this.charsetHeight=8,this.charset=new Array(256),this.horRetrace=0,this.startAddr=720896,this.setRamSize(4096),this.charWidth=9,this.charHeight=14,this.screenWidth=80*this.charWidth,this.screenHeight=25*this.charHeight,this.textColor=i.Col.fromRgb(50,205,50),this.textHiColor=i.Col.fromRgb(0,255,0),this.backgroundColor=i.Col.fromRgb(0,0,0)}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile"),this.ignoredFieldsUpdate.add("charset")}async loadCharSet(){await this.loadCharSetInternal(this.charset,this.charsetFile,this.charsetWidth,this.charsetHeight)}updateScreen(e,t){super.updateScreen(e,t);const s=this.screenWidth/this.charWidth,r=this.screenHeight/this.charHeight,a=new i.IntRect(0,0,this.charWidth,this.charHeight),h=2*this.getCursorPos();let c=0;for(let i=0;i<r;i++)for(let r=0;r<s;r++){const s=this.ram[c+1],n=7&s,o=s>>4&7;let d=(8&s)>0?this.textHiColor:this.textColor,l=this.backgroundColor;if(0==n&&7==o){const e=d;d=l,l=e}const u=this.ram[c],g=this.charset[u],C=this.drawChar(u,g,d,l,1==n&&0==o,c==h&&this.cursorOn);a.x=r*this.charWidth,a.y=i*this.charHeight,this.writePixels(e,t,C,a),c+=2}}in(e){switch(e){case 954:return this.horRetrace=1-this.horRetrace,255&(this.horRetrace|this.horRetrace<<3)}return 0}out(e,t,s){switch(e){case 948:this.setIndexRegister(255&t);break;case 949:this.setDataRegister(255&t)}}}t.MdaGraphics=r},991:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VgaGraphics=void 0;const i=s(523),r=s(740),a=s(915);var h,c;!function(e){e[e.None=0]="None",e[e.M01_CGA=1]="M01_CGA",e[e.M01_EGA=2]="M01_EGA",e[e.M01_VGA=3]="M01_VGA",e[e.M03_CGA=4]="M03_CGA",e[e.M03_EGA=5]="M03_EGA",e[e.M03_VGA=6]="M03_VGA",e[e.M04=7]="M04",e[e.M06=8]="M06",e[e.M07_EGA=9]="M07_EGA",e[e.M07_VGA=10]="M07_VGA",e[e.M0D=11]="M0D",e[e.M0E=12]="M0E",e[e.M0F=13]="M0F",e[e.M10=14]="M10",e[e.M11=15]="M11",e[e.M12=16]="M12",e[e.M13=17]="M13",e[e.MX_320x240=18]="MX_320x240"}(h||(h={})),function(e){e[e.Read=0]="Read",e[e.Write=1]="Write"}(c||(c={}));class n extends i.ATColorGraphicsCard{constructor(){super(),this.vgaSwitches=[!1,!0,!0,!1],this.paletteRam=new Array(16),this.dacMask=0,this.videoSubsystemEnableRegister1=0,this.videoSubsystemEnableRegister2=0,this.dacEntries=new Array(256),this.dacWriteColIndex=0,this.dacReadColIndex=0,this.dacMemR=0,this.dacMemG=0,this.charWidth9Bits=!1,this.mode=h.None,this.charBoxWidth=this.charWidth=8,this.colCount=this.screenWidth=640,this.lineCount=this.screenHeight=480,this.dacMask=255,this.sequencerRegisters[4]=2,this.calcRetraceValues()}getModeC256(){return(64&this.gdcRegisters[5])>0}getNineDotMode(){return 0==(1&this.sequencerRegisters[1])}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB&&(2&this.sequencerRegisters[4])>0}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("vgaSwitches"),this.ignoredFields.add("egaPalette"),this.ignoredFields.add("cgaPalette")}in(e){if(e==this.crtBasePort+10){this.attributeFlipFlop=!1;const e=this.calcRetraceEnable();return 255&(e.vertRetrace?8:0)+(e.enable?0:1)}switch(e){case 962:{let e=this.calcVertRetrace()?0:128;const t=this.miscOutputRegister>>2&3;return e+=this.vgaSwitches[t]?0:16,255&e}case 963:return this.videoSubsystemEnableRegister1;case 964:return 65535&this.sequencerIndex;case 965:return this.sequencerIndex<this.sequencerRegisters.length?this.sequencerRegisters[this.sequencerIndex]:0;case 966:return this.dacMask;case 967:return 65535&(this.dacMode==c.Read?0:3);case 969:{if(this.dacMode!=c.Read)return 0;const e=Math.trunc(this.dacReadColIndex/3);let t=0;switch(this.dacReadColIndex%3){case 0:t=this.dacEntries[e].r;break;case 1:t=this.dacEntries[e].g;break;case 2:t=this.dacEntries[e].b}return 768==++this.dacReadColIndex&&(this.dacReadColIndex=0),t>>2&65535}case 970:return this.featureControlRegister;case 972:return 207&this.miscOutputRegister;case 974:return 65535&this.gdcIndex;case 975:return 65535&(this.gdcIndex<this.gdcRegisters.length?this.gdcRegisters[this.gdcIndex]:0);case 18152:return this.videoSubsystemEnableRegister2}return super.in(e)}out(e,t,s){switch(e){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&t,this.attributeIndex){case 16:this.graphicsMode=(1&t)>0,this.monochrome=(2&t)>0,this.charWidth9Bits=(4&t)>0,this.blink=(8&t)>0;break;case 17:this.overscanColor=this.genColor(255&t);break;case 18:for(let e=0;e<this.colorPlaneEnabled.length;e++)this.colorPlaneEnabled[e]=(t&1<<e)>0;break;default:this.attributeIndex<=15&&(this.paletteRam[this.attributeIndex]=63&t)}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&t,this.attributeFlipFlop=!this.attributeFlipFlop,s&&this.out(e,t>>8&65535,!1);break;case 963:this.videoSubsystemEnableRegister1=255&t;break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&t;break;case 2:this.mapMaskRegister=255&t,this.mapMask[0]=(1&t)>0,this.mapMask[1]=(2&t)>0,this.mapMask[2]=(4&t)>0,this.mapMask[3]=(8&t)>0;break;case 3:this.characterMapSelectRegister=255&t,this.characterMapA=((32&t)>>5)+(t>>1&6),this.characterMapB=((16&t)>>4)+(t<<1&6);break;case 4:t|=2,this.memoryModeRegister=255&t,this.oddEven=0==(4&t),this.chain4=(8&t)>0}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&t);break;case 966:this.dacMask=255&t;break;case 967:this.dacReadColIndex=3*(255&t),this.dacMode=c.Read;break;case 968:this.dacWriteColIndex=3*(255&t),this.dacMode=c.Write;break;case 969:{if(this.dacMode!=c.Write)return;const e=Math.trunc(this.dacWriteColIndex/3),s=t<<2&255;switch(this.dacWriteColIndex%3){case 0:this.dacMemR=s;break;case 1:this.dacMemG=s;break;case 2:this.dacEntries[e]=r.Col.fromRgb(this.dacMemR,this.dacMemG,s)}768==++this.dacWriteColIndex&&(this.dacWriteColIndex=0);break}case 18152:this.videoSubsystemEnableRegister2=255&t;break;default:super.out(e,t,s)}}internalPoke(e,t,s){3==this.writeMode||super.internalPoke(e,t,s)}setDataRegister(e){(0==(128&this.crtRegisters[17])||this.crtIndexReg>7)&&super.setDataRegister(e)}GetDataRegister(){return this.crtIndexReg<this.crtRegisters.length?this.crtRegisters[this.crtIndexReg]:0}calcMode(){const e=this.mode,t=254&this.sequencerRegisters[1],s=this.sequencerRegisters[2],i=this.sequencerRegisters[4],r=204&this.miscOutputRegister,a=this.crtRegisters[23];this.getModeC256()?this.mode=h.M13:8==t&&3==i?64==r?this.mode=h.M01_CGA:128==r?this.mode=h.M01_EGA:68==r&&(this.mode=h.M01_VGA):0==t&&3==i?64==r?this.mode=h.M03_CGA:128==r?this.mode=h.M03_EGA:68==r&&(this.mode=h.M03_VGA):8==t&&2==i?this.mode=h.M04:0==t&&6==i?64==r?1==s?this.mode=h.M06:15==s&&(this.mode=h.M0E):128==r?this.mode=h.M10:192==r&&(195==a?this.mode=h.M11:227==a&&(this.mode=h.M12)):0==t&&3==i?this.mode=this.getNineDotMode()?h.M07_VGA:h.M07_EGA:8==t&&6==i&&(this.mode=h.M0D),this.mode!=e&&this.modeChanged()}modeChanged(){switch(super.modeChanged(),this.miscOutputRegister>>6&3){case 1:this.lineCount=400;break;case 2:this.lineCount=350;break;case 3:this.lineCount=480}const e=0==(this.miscOutputRegister>>2&3)?640:720;(8&this.clockMode)>0?this.colCount=e>>1:this.colCount=e,this.calcRetraceValues()}gen16ColPalette(){const e=(128&this.attributeRegisters[16])>0,t=this.attributeRegisters[20],s=new Array(16);for(let i=0;i<16;i++){const r=63&this.paletteRam[i],a=e?15&r|(15&t)<<4:r|(12&t)<<4;s[i]=this.dacEntries[a&this.dacMask]}return s}updateDimensions(){switch(this.calcMode(),this.mode){case h.M01_CGA:this.screenWidth=320,this.screenHeight=200;break;case h.M01_EGA:this.screenWidth=320,this.screenHeight=350;break;case h.M01_VGA:this.screenWidth=360,this.screenHeight=400;break;case h.M03_CGA:this.screenWidth=640,this.screenHeight=200;break;case h.M03_EGA:this.screenWidth=640,this.screenHeight=350;break;case h.M03_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M04:this.screenWidth=320,this.screenHeight=200;break;case h.M06:this.screenWidth=640,this.screenHeight=200;break;case h.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case h.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M0D:this.screenWidth=320,this.screenHeight=200;break;case h.M0E:this.screenWidth=640,this.screenHeight=200;break;case h.M0F:case h.M10:this.screenWidth=640,this.screenHeight=350;break;case h.M11:case h.M12:this.screenWidth=640,this.screenHeight=480;break;case h.M13:this.screenWidth=320,this.screenHeight=200;break;case h.MX_320x240:this.screenWidth=320,this.screenHeight=240}}updateScreen(e,t){switch(super.updateScreen(e,t),a.Settings.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.charBoxWidth=this.getNineDotMode()?9:8,this.mode){case h.M01_CGA:case h.M01_EGA:case h.M01_VGA:case h.M03_CGA:case h.M03_EGA:case h.M03_VGA:this.updateTextScreen(e,t,this.egaPalette);break;case h.M04:this.updateScreenCgaLo(e);break;case h.M06:this.screenWidth=640,this.screenHeight=200,this.updateScreenCgaMono(e,640,200);break;case h.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case h.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M0D:this.screenWidth=320,this.screenHeight=200,this.updateScreen16Col(e,320,200,this.cgaPalette);break;case h.M0E:this.screenWidth=640,this.screenHeight=200,this.updateScreen16Col(e,640,200,this.cgaPalette);break;case h.M0F:this.screenWidth=640,this.screenHeight=350;break;case h.M10:this.screenWidth=640,this.screenHeight=350,this.updateScreen16Col(e,640,350,this.gen16ColPalette());break;case h.M11:this.screenWidth=640,this.screenHeight=480,this.updateScreenVgaMono(e,640,480);break;case h.M12:this.screenWidth=640,this.screenHeight=480,this.updateScreen16Col(e,640,480,this.gen16ColPalette());break;case h.M13:this.screenWidth=320,this.screenHeight=200,this.updateScreen256ColChain4(e,320,200);break;case h.MX_320x240:this.screenWidth=640,this.screenHeight=480}}updateScreen256ColChain4(e,t,s){const i=new Uint32Array(e.buffer),r=this.dacEntries,a=0==this.getCrtOffset()?Math.trunc(t/4):this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),c=0;const n=this.getHorizontalPixelPanning(),o=0==n?t:t+4;for(let e=0;e<s;e++){let e=65535&h;for(let t=0;t<o;t+=4,e++)for(let s=0;s<4;s++)(0==n||t+s>=n&&t+s<o-8+n)&&(i[c++]=r[this.planes[s][e]].value);h+=a}}updateScreenVgaMono(e,t,s){const i=new Uint32Array(e.buffer),a=r.Col.fromRgb(255,255,255),h=this.overscanColor;let c=0,n=0;for(let e=0;e<s;e++)for(let e=0;e<t;e+=8){let e=this.planes[0][c];for(let t=0;t<8;t++)i[n++]=(128&e)>0?a.value:h.value,e<<=1;c++}}}t.VgaGraphics=n},915:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=t.ComDevice=t.GraphicsType=void 0;const i=s(50);var r,a;!function(e){e[e.MDA=0]="MDA",e[e.Hercules=1]="Hercules",e[e.CGA=2]="CGA",e[e.EGA=3]="EGA",e[e.VGA=4]="VGA"}(r=t.GraphicsType||(t.GraphicsType={})),function(e){e[e.None=0]="None",e[e.NotConnected=1]="NotConnected",e[e.EmulatedMouse=2]="EmulatedMouse"}(a=t.ComDevice||(t.ComDevice={}));class h{static get monochromeGraphics(){return this.graphicsAdapterType==r.MDA||this.graphicsAdapterType==r.Hercules}}t.Settings=h,h.cpuType=i.CpuType.Cpu186,h.cpuFrequency=4770,h.ramAmount=640,h.floppyCount=2,h.graphicsAdapterType=r.CGA,h.enableHdController=!0,h.enableUma=!0,h.enableRtc=!0,h.com1Device=a.EmulatedMouse,h.com1PortName="",h.com2Device=a.None,h.com2PortName="",h.hdImageDir="HdImages/",h.baseDir="",h.noScreenUpdateWhileRetrace=!0},892:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenHelperAsync=t.AsyncScreenData=t.ScreenHelperSync=t.Dimensions=void 0,t.Dimensions=class{constructor(){this.width=0,this.height=0}};class s{constructor(e){this.frameCount=0,this.screenContainer=document.getElementById("screen-container"),this.screen=document.getElementById("screen"),this.updateFrame=60/e}updateCanvasIfNeeded(e){if((!this.canvas||this.canvas.width!=e.width||this.canvas.height!=e.height)&&0!=e.width&&0!=e.height){const t=this.screenContainer.clientWidth/e.width,s=this.screenContainer.clientHeight/e.height;this.screen.style.transform=`scaleX(${t}) scaleY(${s})`,this.screen.innerHTML="",this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.screen.appendChild(this.canvas),this.renderingContext=this.canvas.getContext("2d"),this.imagedata=this.renderingContext.createImageData(e.width,e.height)}}}t.ScreenHelperSync=class extends s{constructor(e){super(e.screenUpdateRate),this.emulator=e}animationFrame(){if(0==this.frameCount){this.emulator.updateGraphicDimensions();const e={width:this.emulator.getScreenWidth(),height:this.emulator.getScreenHeight()};this.updateCanvasIfNeeded(e),this.renderingContext&&(this.emulator.updateScreen(this.imagedata.data,this.imagedata.width),this.renderingContext.putImageData(this.imagedata,0,0))}++this.frameCount>=this.updateFrame&&(this.frameCount=0),window.requestAnimationFrame((()=>this.animationFrame()))}},t.AsyncScreenData=class{},t.ScreenHelperAsync=class extends s{constructor(e){super(e),this.updateFrame=60/e}animationFrame(){this.screenData&&(this.updateCanvasIfNeeded(this.screenData.dim),this.renderingContext&&(this.imagedata.data.set(new Uint8ClampedArray(this.screenData.buffer),0),this.renderingContext.putImageData(this.imagedata,0,0),this.screenData=null)),window.requestAnimationFrame((()=>this.animationFrame()))}}},545:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenWorker=void 0;const i=s(915),r=s(696),a=s(441),h=s(6),c=s(991),n=s(892);t.ScreenWorker=class{constructor(e){this.context=e,this.context.onmessage=e=>{switch(e.data[0]){case"initialize":this.emuWorkerPort=e.data[1],this.emuWorkerPort.onmessage=e=>{switch(e.data[0]){case"initialize":this.initialize(e.data[1],e.data[2]),this.context.postMessage(["initialized"]);break;case"updatescreen":{const t=new n.AsyncScreenData;if(t.dim={width:e.data[2],height:e.data[3]},0===t.dim.width||0===t.dim.height)return;this.graphicsCard.applyJson(e.data[1]),this.graphicsCard.updateMemory(e.data.slice(4));const s=new Uint8ClampedArray(t.dim.width*t.dim.height*4);t.buffer=s.buffer,this.graphicsCard.updateScreen(s,t.dim.width),this.context.postMessage(["screenupdated",t.dim,t.buffer],[t.buffer])}}}}}}initialize(e,t){switch(e){case i.GraphicsType.MDA:this.graphicsCard=new r.MdaGraphics;break;case i.GraphicsType.CGA:this.graphicsCard=new a.CgaGraphics;break;case i.GraphicsType.EGA:this.graphicsCard=new h.EgaGraphics;break;case i.GraphicsType.VGA:this.graphicsCard=new c.VgaGraphics}this.graphicsCard.applyJson(t)}}}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}(()=>{const e=s(545),t=self;new e.ScreenWorker(t)})()})();
//# sourceMappingURL=screen-worker.js.map