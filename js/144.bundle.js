(()=>{"use strict";var e,t,r={830:(e,t,r)=>{var i,s,a,n,o,c;r.d(t,{K4:()=>h,Nm:()=>s,VQ:()=>i,gZ:()=>c,wA:()=>a}),function(e){e.Cpu186="Cpu186",e.Cpu386="Cpu386"}(i||(i={})),function(e){e[e.RegToRm=0]="RegToRm",e[e.RmToReg=1]="RmToReg"}(s||(s={})),function(e){e[e.None=0]="None",e[e.RepZ=1]="RepZ",e[e.RepNz=2]="RepNz"}(a||(a={})),function(e){e[e.Real=0]="Real",e[e.Protected=1]="Protected",e[e.Virtual8086=2]="Virtual8086"}(n||(n={})),function(e){e[e.Read=0]="Read",e[e.Write=1]="Write"}(o||(o={})),function(e){e[e.DE=0]="DE",e[e.DB=1]="DB",e[e.BP=3]="BP",e[e.OF=4]="OF",e[e.BR=5]="BR",e[e.UD=6]="UD",e[e.NM=7]="NM",e[e.DF=8]="DF",e[e.TS=10]="TS",e[e.NP=11]="NP",e[e.SS=12]="SS",e[e.GP=13]="GP",e[e.PF=14]="PF",e[e.MF=16]="MF",e[e.AC=17]="AC",e[e.MC=18]="MC",e[e.XF=19]="XF",e[e.VE=20]="VE",e[e.SX=30]="SX"}(c||(c={}));class h{constructor(e,t=null){Object.defineProperty(this,"exCode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"errorCode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exCode=e,this.errorCode=t}}},22:(e,t,r)=>{r.d(t,{V8:()=>s,Zr:()=>n,wf:()=>i});var i,s,a=r(830);!function(e){e.MDA="MDA",e.Hercules="Hercules",e.CGA="CGA",e.EGA="EGA",e.VGA="VGA"}(i||(i={})),function(e){e.None="None",e.NotConnected="NotConnected",e.EmulatedMouse="EmulatedMouse"}(s||(s={}));class n{static get monochromeGraphics(){return this.graphicsAdapterType==i.MDA||this.graphicsAdapterType==i.Hercules}}Object.defineProperty(n,"cpuType",{enumerable:!0,configurable:!0,writable:!0,value:a.VQ.Cpu186}),Object.defineProperty(n,"cpuFrequency",{enumerable:!0,configurable:!0,writable:!0,value:4770}),Object.defineProperty(n,"ramAmount",{enumerable:!0,configurable:!0,writable:!0,value:640}),Object.defineProperty(n,"floppyCount",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(n,"graphicsAdapterType",{enumerable:!0,configurable:!0,writable:!0,value:i.CGA}),Object.defineProperty(n,"enableHdController",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(n,"enableUma",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(n,"enableRtc",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(n,"com1Device",{enumerable:!0,configurable:!0,writable:!0,value:s.EmulatedMouse}),Object.defineProperty(n,"com1PortName",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(n,"com2Device",{enumerable:!0,configurable:!0,writable:!0,value:s.None}),Object.defineProperty(n,"com2PortName",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(n,"hdImageDir",{enumerable:!0,configurable:!0,writable:!0,value:"HdImages/"}),Object.defineProperty(n,"baseDir",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(n,"noScreenUpdateWhileRetrace",{enumerable:!0,configurable:!0,writable:!0,value:!0})},144:(e,t,r)=>{var i=r(22);class s{constructor(e){Object.defineProperty(this,"extRamStart",{enumerable:!0,configurable:!0,writable:!0,value:65536}),Object.defineProperty(this,"memoryMappings",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"readMappings",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"writeMappings",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"ram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extRam",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extRamLimit",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"supportRead",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"supportWrite",{enumerable:!0,configurable:!0,writable:!0,value:!0});const t=e>1024?e-1024:0;this.ram=new Uint8Array(1024*Math.min(e,640)),this.extRam=new Uint8Array(1024*t),this.extRamLimit=this.extRamStart+t}peek(e){if(e<this.ram.length)return this.ram[e];if(e>=this.extRamStart&&e<this.extRamLimit)return this.extRam[e-this.extRamStart];for(let t=0;t<this.readMappings.length;t++){const r=this.readMappings[t];if(r.addrLo<=e&&r.addrHi>=e)return r.provider.peek(e)}return 0}poke(e,t){if(e<this.ram.length)this.ram[e]=255&t;else if(e>=this.extRamStart&&e<this.extRamLimit)this.extRam[e-this.extRamStart]=255&t;else for(let r=0;r<this.readMappings.length;r++){const i=this.readMappings[r];if(i.addrLo<=e&&i.addrHi>=e)return void i.provider.poke(e,255&t)}}peekW(e){if(e<this.ram.length-1)return this.ram[e]+(this.ram[e+1]<<8);if(e>=this.extRamStart&&e<this.extRamLimit){const t=e-this.extRamStart;return this.extRam[t]+(this.extRam[t+1]<<8)}for(let t=0;t<this.readMappings.length;t++){const r=this.readMappings[t];if(r.addrLo<=e&&r.addrHi>=e)return r.provider.peek(e)+(r.provider.peek(e+1)<<8)}return 0}pokeW(e,t){if(e<this.ram.length-1)return this.ram[e]=255&t,void(this.ram[e+1]=t>>8&255);if(e>=this.extRamStart&&e<this.extRamLimit){const r=e-this.extRamStart;this.extRam[r]=255&t,this.extRam[r+1]=t>>8&255}for(let r=0;r<this.readMappings.length;r++){const i=this.readMappings[r];if(i.addrLo<=e&&i.addrHi>=e)return i.provider.poke(e,255&t),void i.provider.poke(e+1,t>>8&255)}}peekD(e){if(e<this.ram.length-1)return this.ram[e]+(this.ram[e+1]<<8)+(this.ram[e+2]<<16)+(this.ram[e+3]<<24);if(e>=this.extRamStart&&e<this.extRamLimit){const t=e-this.extRamStart;return this.extRam[t]+(this.extRam[t+1]<<8)+(this.extRam[t+2]<<16)+(this.extRam[t+3]<<24)}for(let t=0;t<this.readMappings.length;t++){const r=this.readMappings[t];if(r.addrLo<=e&&r.addrHi>=e)return r.provider.peek(e)+(r.provider.peek(e+1)<<8)+(r.provider.peek(e+2)<<16)+(r.provider.peek(e+3)<<24)}return 0}pokeD(e,t){if(e<this.ram.length-1)return this.ram[e]=255&t,this.ram[e+1]=t>>8&255,this.ram[e+2]=t>>16&255,void(this.ram[e+3]=t>>24&255);if(e>=this.extRamStart&&e<this.extRamLimit){const r=e-this.extRamStart;this.extRam[r]=255&t,this.extRam[r+1]=t>>8&255,this.extRam[r+2]=t>>16&255,this.extRam[r+3]=t>>24&255}for(let r=0;r<this.readMappings.length;r++){const i=this.readMappings[r];if(i.addrLo<=e&&i.addrHi>=e)return i.provider.poke(e,255&t),i.provider.poke(e+1,t>>8&255),i.provider.poke(e+2,t>>16&255),void i.provider.poke(e+3,t>>24&255)}}register(e,t,r){this.memoryMappings.push({addrLo:e,addrHi:t,provider:r,supportRead:r.supportRead,supportWrite:r.supportWrite})}FinishRegistration(){for(const e of this.memoryMappings)e.supportRead&&this.readMappings.push(e),e.supportWrite&&this.writeMappings.push(e)}}class a{constructor(){Object.defineProperty(this,"portMappings",{enumerable:!0,configurable:!0,writable:!0,value:new Array})}in(e){for(let t=0;t<this.portMappings.length;t++){const r=this.portMappings[t];if(r.portLo<=e&&r.portHi>=e)return 65535&r.provider.in(e)}return 65535}out(e,t,r){for(let i=0;i<this.portMappings.length;i++){const s=this.portMappings[i];if(s.portLo<=e&&s.portHi>=e)return void s.provider.out(e,t,r)}}register(e,t,r){this.portMappings.push({provider:r,portLo:e,portHi:t})}}var n,o,c,h,l,d,u=r(830),b=r(821);!function(e){e[e.Demand=0]="Demand",e[e.Single=1]="Single",e[e.Block=2]="Block",e[e.Cascade=3]="Cascade"}(n||(n={})),function(e){e[e.Inc=0]="Inc",e[e.Dec=1]="Dec"}(o||(o={})),function(e){e[e.Verify=0]="Verify",e[e.WriteMem=1]="WriteMem",e[e.ReadMem=2]="ReadMem",e[e.Undefined=3]="Undefined"}(c||(c={}));class m extends b.H{constructor(e,t){super(),Object.defineProperty(this,"channelCount",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"memRefreshChannel",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"memoryProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkMemRefreshActiveFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockSize",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"blockSizeByteNo",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"offset",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"offsetByteNo",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"inc",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"autoInit",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"transferType",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"channelEnabled",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),Object.defineProperty(this,"terminalCount",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.channelCount)}),this.memoryProvider=e,this.checkMemRefreshActiveFunc=t;for(let e=0;e<this.channelCount;e++)this.channelEnabled[e]=!0}readByte(e,t,r){let i;return i=0==t[r]?255&e[r]:(65280&e[r])>>8&255,t[r]=1-t[r],i}writeByte(e,t,r,i){0==t[r]?e[r]=65535&(65280&e[r]|i):e[r]=65535&(255&e[r]|i<<8),t[r]=1-t[r]}memRefreshActive(){return this.autoInit[this.memRefreshChannel]&&this.checkMemRefreshActiveFunc()}in(e){if(e>=0&&e<=7){const t=Math.trunc(e/2);return e%2==0?(t==this.memRefreshChannel&&this.memRefreshActive()&&(this.offset[t]+=17),this.readByte(this.offset,this.offsetByteNo,t)):this.readByte(this.blockSize,this.blockSizeByteNo,t)}if(e>=192&&e<=207){const t=4+Math.trunc((e-192)/4);if(e%4==0)return this.readByte(this.offset,this.offsetByteNo,t);if(e%4==2)return this.readByte(this.blockSize,this.blockSizeByteNo,t)}return 8==e?(this.memRefreshActive()&&(this.terminalCount[this.memRefreshChannel]=!0),255&((this.terminalCount[0]?1:0)|(this.terminalCount[1]?2:0)|(this.terminalCount[2]?4:0)|(this.terminalCount[3]?8:0))):0}out(e,t,r){if(e>=0&&e<=7){const r=Math.trunc(e/2);return e%2==0?this.writeByte(this.offset,this.offsetByteNo,r,t):this.writeByte(this.blockSize,this.blockSizeByteNo,r,t),void(this.terminalCount[r]=!1)}if(e>=192&&e<=207){const r=4+Math.trunc((e-192)/4);return e%4==0?this.writeByte(this.offset,this.offsetByteNo,r,t):e%4==2&&this.writeByte(this.blockSize,this.blockSizeByteNo,r,t),void(this.terminalCount[r]=!1)}switch(e){case 135:this.page[0]=255&t;break;case 131:this.page[1]=255&t;break;case 129:this.page[2]=255&t;break;case 130:this.page[3]=255&t;break;case 143:this.page[4]=255&t;break;case 139:this.page[5]=255&t;break;case 137:this.page[6]=255&t;break;case 138:this.page[7]=255&t;break;case 8:case 9:case 14:case 15:break;case 10:{const e=3&t;this.channelEnabled[e]=0==(4&t)}break;case 11:{const e=3&t;switch(t>>2&3){case 0:this.transferType[e]=c.Verify;break;case 1:this.transferType[e]=c.WriteMem;break;case 2:this.transferType[e]=c.ReadMem;break;case 3:this.transferType[e]=c.Undefined}switch(this.autoInit[e]=(16&t)>0,this.inc[e]=(32&t)>0?o.Dec:o.Inc,t>>6&3){case 0:this.mode[e]=n.Demand;break;case 1:this.mode[e]=n.Single;break;case 2:this.mode[e]=n.Block;break;case 3:this.mode[e]=n.Cascade}this.terminalCount[e]=!1}break;case 12:for(let e=0;e<this.channelCount;e++)this.blockSizeByteNo[e]=0,this.offsetByteNo[e]=0;break;case 13:for(let e=0;e<this.channelCount;e++)this.blockSize[e]=0,this.blockSizeByteNo[e]=0,this.page[e]=0,this.offset[e]=0,this.offsetByteNo[e]=0,this.mode[e]=0,this.inc[e]=o.Inc,this.autoInit[e]=!1,this.channelEnabled[e]=!0,this.terminalCount[e]=!1}}triggerDmaDeviceToMem(e,t,r){if(this.mode[e]==n.Single||this.mode[e]==n.Block){let i=(this.page[e]<<16)+this.offset[e],s=this.blockSize[e]+1;const a=this.inc[e]==o.Inc?1:-1,n={endOfData:!1};for(;s>0&&!n.endOfData;)this.memoryProvider.poke(i,t.getNextByte(n)),i+=a,s--;this.terminalCount[e]=!0,r&&r()}}triggerDmaMemToDevice(e,t,r){if(this.mode[e]==n.Single||this.mode[e]==n.Block){let i=(this.page[e]<<16)+this.offset[e],s=this.blockSize[e]+1;const a=this.inc[e]==o.Inc?1:-1,n={endOfData:!1};for(;s>0&&!n.endOfData;)t.setNextByte(this.memoryProvider.peek(i),n),i+=a,s--;this.terminalCount[e]=!0,r&&r()}}}!function(e){e[e.Timer=0]="Timer",e[e.Keyboard=1]="Keyboard",e[e.Reserved=2]="Reserved",e[e.Serial3=3]="Serial3",e[e.Serial4=4]="Serial4",e[e.Harddisk=5]="Harddisk",e[e.Diskette=6]="Diskette",e[e.Printer=7]="Printer"}(h||(h={}));class g extends b.H{constructor(){super(),Object.defineProperty(this,"defaultOffset",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"currentInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pendingInterrupts",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"intMaskReg",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"inServiceReg",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"intRequestReg",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"initCommandWords",{enumerable:!0,configurable:!0,writable:!0,value:new Array(4)}),Object.defineProperty(this,"opControlWord2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"opControlWord3",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"initializationMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writeByteNo",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.reset()}reset(){super.reset(),this.currentInterrupt=null,this.pendingInterrupts.length=0,this.writeByteNo=1,this.intMaskReg=0,this.inServiceReg=0,this.intRequestReg=0,this.initCommandWords[1]=this.defaultOffset}in(e){switch(e){case 32:{const e=3&this.opControlWord3;if(2==e)return this.intRequestReg;if(3==e)return this.inServiceReg}break;case 33:if(!this.initializationMode)return this.intMaskReg}return 0}out(e,t,r){switch(e){case 32:if((16&t)>0)this.initializationMode=!0,this.initCommandWords[0]=255&t,this.reset();else{this.initializationMode=!1;const e=t>>3&3;if(0==e)switch(this.opControlWord2=255&t,this.opControlWord2>>5){case 1:case 3:this.endOfInterrupt()}else 1==e&&0==(128&t)&&(this.opControlWord3=255&t)}break;case 33:this.initializationMode?(this.initCommandWords[this.writeByteNo++]=255&t,(4==this.writeByteNo||3==this.writeByteNo&&0==(1&this.initCommandWords[0]))&&(3==this.writeByteNo&&(this.initCommandWords[3]=0),this.initializationMode=!1)):this.intMaskReg=255&t}}endOfInterrupt(){null!=this.currentInterrupt&&(this.inServiceReg&=255&~(1<<this.currentInterrupt),this.pendingInterrupts.length>0?this.internalDoInterrupt(this.pendingInterrupts.shift()):this.currentInterrupt=null)}internalDoInterrupt(e){const t=1<<e&255;0==(this.intMaskReg&t)&&(this.doCpuInterrupt(e+(248&this.initCommandWords[1])),this.inServiceReg|=t,this.currentInterrupt=e)}doInterrupt(e){const t=e;null==this.currentInterrupt?this.internalDoInterrupt(t):(e!=h.Timer||this.currentInterrupt!=t&&!this.pendingInterrupts.includes(t))&&this.pendingInterrupts.push(t)}}class p extends b.H{constructor(e,t){super(),Object.defineProperty(this,"emptyKey",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"keyDelay",{enumerable:!0,configurable:!0,writable:!0,value:500}),Object.defineProperty(this,"pic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"currentKey",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_speakerEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"speakerGate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"speakerData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kbClockLow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kbClockLowClockCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"keyEventActive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"readHighSwitches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kbRefreshToggle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onSpeaker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pic=e,this.onSpeaker=t}get speakerEnabled(){return this._speakerEnabled}addScanCode(e){this.kbClockLow||(this.keyEventActive?this.keyQueue.push(e):(this.keyEventActive=!0,this.keyQueue.push(e),this.eventTimer.setEvent(this.keyDelay,(()=>this.doKeyEvent()))))}in(e){switch(e){case 96:return this.currentKey;case 97:{this.kbRefreshToggle=!this.kbRefreshToggle;let e=0;return this.kbClockLow||(e|=64),this.kbRefreshToggle&&(e|=16),this.readHighSwitches&&(e|=8),this.speakerData&&(e|=2),this.speakerGate&&(e|=1),e}case 98:return this.readHighSwitches?(i.Zr.graphicsAdapterType==i.wf.EGA||i.Zr.graphicsAdapterType==i.wf.VGA?0:i.Zr.monochromeGraphics?3:2)+(i.Zr.floppyCount-1<<2)&65535:13;case 99:return 0}return 0}out(e,t,r){switch(e){case 96:case 98:break;case 97:{(128&t)>0&&(this.currentKey=this.emptyKey);const e=0==(64&t);e!=this.kbClockLow&&(e?this.kbClockLowClockCount=this.eventTimer.clockCount:this.eventTimer.clockCount-this.kbClockLowClockCount>=12*i.Zr.cpuFrequency&&this.eventTimer.setEvent(100,(()=>{this.keyQueue.length=0,this.addScanCode(170)})),this.kbClockLow=e),this.speakerGate=(1&t)>0,this.speakerData=(2&t)>0;const r=this.speakerGate&&this.speakerData,s=this.speakerEnabled!=r;this._speakerEnabled=r,s&&this.onSpeaker(),this.readHighSwitches=(8&t)>0}}}doKeyEvent(){this.keyQueue.length>0?(this.internalAddScanCode(this.keyQueue.shift()),this.eventTimer.setEvent(this.keyDelay,(()=>this.doKeyEvent()))):this.keyEventActive=!1}internalAddScanCode(e){this.kbClockLow||(this.currentKey=e,this.pic.doInterrupt(h.Keyboard))}}!function(e){e[e.LowNibble=0]="LowNibble",e[e.HighNibble=1]="HighNibble",e[e.LowAndHigh=2]="LowAndHigh"}(l||(l={})),function(e){e[e.M16Bit=0]="M16Bit",e[e.Bcd=1]="Bcd"}(d||(d={}));class f{constructor(e,t,r){Object.defineProperty(this,"countsPerSec",{enumerable:!0,configurable:!0,writable:!0,value:1193180}),Object.defineProperty(this,"countsPerMs",{enumerable:!0,configurable:!0,writable:!0,value:Math.trunc(this.countsPerSec/1e3)}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"counterNo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"byteNo",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_accessMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isLatched",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"latchValue",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_mode",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isRunning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startValue",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"startClockCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"onChangeFrequency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"countMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generateTimerInt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.timer=e,this.pic=t,this.counterNo=r}get accessMode(){return this._accessMode}set accessMode(e){this._accessMode=e,this.byteNo=0}get frequency(){return Math.trunc(this.countsPerSec/this.startValue)}get mode(){return this._mode}set mode(e){switch(this._mode=e,this.eventId>0&&this.timer.eventTimer.deleteEvent(this.eventId),this.mode){case 0:case 2:case 3:break;case 1:case 4:case 5:throw new Error("Method not implemented.")}}calcValue(){if(this.isRunning){const e=Math.trunc(1e3*(this.timer.eventTimer.clockCount-this.startClockCount)/i.Zr.cpuFrequency);return this.startValue-Math.trunc(e*this.countsPerMs/1e3)&65535}return 0}writeFinished(){this.isRunning=!0,0==this.startValue&&(this.startValue=65536),3!=this.mode&&2!=this.mode&&0!=this.mode||(this.eventId>0&&this.timer.eventTimer.deleteEvent(this.eventId),this.startClockCount=this.timer.eventTimer.clockCount,this.eventId=this.timer.eventTimer.setEvent(Math.trunc(1e3*this.startValue/this.countsPerMs),(()=>this.onCountZero())),this.onChangeFrequency&&this.onChangeFrequency())}onCountZero(){switch(this.generateTimerInt&&this.pic.doInterrupt(h.Timer),this.mode){case 0:this.isRunning=!1;break;case 2:case 3:this.startClockCount=this.timer.eventTimer.clockCount,this.eventId=this.timer.eventTimer.setEvent(Math.trunc(1e3*this.startValue/this.countsPerMs),(()=>this.onCountZero()))}}reset(){this.mode=0,this.eventId=0,this.isRunning=!1,this.byteNo=0}write(e){switch(this.accessMode){case l.LowNibble:this.startValue=65535&(65280&this.startValue|e),this.writeFinished();break;case l.HighNibble:this.startValue=65535&(255&this.startValue|e<<8),this.writeFinished();break;case l.LowAndHigh:0==this.byteNo?this.startValue=65535&(65280&this.startValue|e):(this.startValue=65535&(255&this.startValue|e<<8),this.writeFinished()),this.byteNo=1-this.byteNo}}read(){let e=0;const t=this.isLatched?this.latchValue:this.calcValue();switch(this.accessMode){case l.LowNibble:e=255&t,this.isLatched=!1;break;case l.HighNibble:e=t>>8&255,this.isLatched=!1;break;case l.LowAndHigh:0==this.byteNo?e=255&t:(e=t>>8&255,this.isLatched=!1),this.byteNo=1-this.byteNo}return e}doLatch(){this.latchValue=this.calcValue(),this.isLatched=!0}}class y extends b.H{constructor(e,t){super(),Object.defineProperty(this,"counters",{enumerable:!0,configurable:!0,writable:!0,value:new Array(3)}),Object.defineProperty(this,"memRefreshActive",{enumerable:!0,configurable:!0,writable:!0,value:!0});for(let t=0;t<this.counters.length;t++)this.counters[t]=new f(this,e,t);this.counters[0].generateTimerInt=!0,null!=t&&(this.counters[2].onChangeFrequency=t)}get speakerFrequency(){return 3==this.counters[2].mode?this.counters[2].frequency:0}reset(){super.reset();for(const e of this.counters)e.reset()}in(e){return e>=64&&e<=66?this.counters[e-64].read():0}out(e,t,r){if(e>=64&&e<=66&&this.counters[e-64].write(255&t),67==e){const e=t>>6&3;if(e>2)return;const r=this.counters[e],i=t>>4&3,s=t>>1&7;switch(i){case 0:r.doLatch();break;case 1:r.accessMode=l.LowNibble;break;case 2:r.accessMode=l.HighNibble;break;case 3:r.accessMode=l.LowAndHigh}0!=i&&(r.countMode=(1&t)>0?d.Bcd:d.M16Bit,r.mode=s)}}}var v,S,k,R,O,P,w,C=r(885);class A{constructor(e){Object.defineProperty(this,"objStoreName",{enumerable:!0,configurable:!0,writable:!0,value:"data"}),Object.defineProperty(this,"dbName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"database",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dbName=e}async initialize(){return new Promise((e=>{const t=indexedDB.open(this.dbName,1);t.onerror=()=>{alert("Database error")},t.onsuccess=()=>{this.database=t.result,this.ready=!0,e()},t.onupgradeneeded=t=>{const r=t.target;this.database=r.result,this.database.createObjectStore(this.objStoreName,{keyPath:"key"}).createIndex("primary","key"),r.transaction.oncomplete=()=>{this.ready=!0,e()}}}))}async setData(e,t){if(this.ready)return new Promise(((r,i)=>{const s=this.database.transaction(this.objStoreName,"readwrite").objectStore(this.objStoreName).put({key:e,data:t});s.onsuccess=()=>{r()},s.onerror=()=>{i()}}))}async getData(e){if(this.ready)return new Promise((t=>{const r=this.database.transaction(this.objStoreName,"readonly").objectStore(this.objStoreName).index("primary").get(e);r.onsuccess=e=>{t(e.target.result?.data)},r.onerror=()=>{t(void 0)}}))}}class I{constructor(e,t,r,i,s){Object.defineProperty(this,"biosType",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"cylinders",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"heads",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sectors",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"switchCode",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.biosType=e,this.cylinders=t,this.heads=r,this.sectors=i,this.switchCode=s}get diskSize(){return this.heads*this.cylinders*this.sectors*I.sectorSize}calcLba(e,t,r){return e<this.cylinders||t<this.heads||r<this.sectors?(e*this.heads+t)*this.sectors+r:null}}Object.defineProperty(I,"sectorSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),function(e){e[e.None=0]="None",e[e.NoIndexSignal=1]="NoIndexSignal",e[e.NoSeekCompleteSignal=2]="NoSeekCompleteSignal",e[e.WriteFault=3]="WriteFault",e[e.NoReadyAfterDriveSelect=4]="NoReadyAfterDriveSelect",e[e.NoTrack00Signal=6]="NoTrack00Signal",e[e.SeekNotComplete=8]="SeekNotComplete",e[e.IdReadError=16]="IdReadError",e[e.DataError=17]="DataError",e[e.NoAddressMark=18]="NoAddressMark",e[e.SectorNotFound=20]="SectorNotFound",e[e.SeekError=21]="SeekError",e[e.CorrectableDataError=24]="CorrectableDataError",e[e.BadTrack=25]="BadTrack",e[e.InvalidCommand=32]="InvalidCommand",e[e.IllegalDiskAddress=33]="IllegalDiskAddress",e[e.RamError=48]="RamError",e[e.ProgramChecksumError=49]="ProgramChecksumError",e[e.EccError=50]="EccError"}(v||(v={}));class B extends b.H{constructor(e,t){super(),Object.defineProperty(this,"driveCount",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"commandDelay",{enumerable:!0,configurable:!0,writable:!0,value:500}),Object.defineProperty(this,"readWriteDelay",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"pic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmaController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allDriveSpecs",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"driveSpecs",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.driveCount)}),Object.defineProperty(this,"diskImages",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.driveCount)}),Object.defineProperty(this,"diskImagePath",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.driveCount)}),Object.defineProperty(this,"imageChanged",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.driveCount)}),Object.defineProperty(this,"selectedDrive",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"head",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"cylinder",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sector",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"interlBlockCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"controlField",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"command",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"statusByte",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataPointer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"busyBit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"commandDataBit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modeBit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requestBit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmaInterruptMask",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"interruptEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isBusy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"driveCharacteristics",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.driveCount)}),Object.defineProperty(this,"dcbByteNo",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"currentCommandError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"errorBytes",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"outputBytes",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"addressValid",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pic=e,this.dmaController=t,this.initDriveSpecs(),this.setDriveType(0,2),this.setDriveType(1,2);for(let e=0;e<this.driveCount;e++)this.driveCharacteristics[e]=new Uint8Array(8),this.diskImagePath[e]=i.Zr.hdImageDir+"HD"+e+".ima.gz"}async loadImages(){for(let e=0;e<this.driveCount;e++){if(null==this.driveSpecs[e])return;await this.loadImage(e)}}async saveImages(){for(let e=0;e<this.driveCount;e++)await this.saveImage(e)}async loadImage(e){const t=i.Zr.baseDir+this.diskImagePath[e];this.storage||(this.storage=new A("HDD"),await this.storage.initialize());const r=await this.storage.getData(`image${e}`);if(void 0!==r){const t=new Uint8Array(r);if(t.length==this.driveSpecs[e].diskSize)return this.diskImages[e]=t,void(this.imageChanged[e]=!1)}return new Promise(((r,i)=>{const s=new XMLHttpRequest;s.responseType="arraybuffer",s.open("GET",t,!0),s.onload=()=>{if(200!=s.status)return void i();const t=s.response,a=C.ec(new Uint8Array(t));a.length==this.driveSpecs[e].diskSize&&(this.diskImages[e]=a,this.imageChanged[e]=!1),r()},s.onerror=()=>{i()},s.send()}))}async saveImage(e){this.storage&&await this.storage.setData(`image${e}`,this.diskImages[e].buffer)}generateError(e){this.errorBytes.length=0,this.errorBytes.push(255&(this.addressValid?128:0+e)),this.errorBytes.push((this.selectedDrive<<5)+this.head&255),this.errorBytes.push(((1792&this.cylinder)>>3)+this.sector&255),this.errorBytes.push(this.cylinder),this.currentCommandError=!0}in(e){switch(e){case 800:if(null!=this.statusByte){const e=this.statusByte;return this.statusByte=null,this.requestBit=!1,this.modeBit=!1,this.commandDataBit=!1,this.busyBit=!1,e}if(this.outputBytes.length>0)return this.outputBytes.shift();break;case 801:return(this.requestBit?1:0)+(this.modeBit?2:0)+(this.commandDataBit?4:0)+(this.busyBit?8:0)+(null!=this.statusByte?32:0)&65535;case 802:return 65535&(this.driveSpecs[0]?.switchCode<<2??0)+(this.driveSpecs[1]?.switchCode??0)}return 0}out(e,t,r){switch(e){case 800:this.commandDataBit=!1,this.writeDataByte(255&t);break;case 801:(64&t)>0&&this.reset();break;case 802:this.requestBit=!0,this.commandDataBit=!0,this.busyBit=!0;break;case 803:this.interruptEnabled=(2&t)>0,this.dmaInterruptMask=t}}setDriveType(e,t){const r=this.allDriveSpecs.find((e=>e.biosType==t));if(null==r)throw new Error("Harddisk drive type "+t+" not found.");this.driveSpecs[e]=r,this.diskImages[e]=new Uint8Array(r.diskSize)}initDriveSpecs(){this.allDriveSpecs.push(new I(1,306,4,17,0)),this.allDriveSpecs.push(new I(2,615,4,17,1)),this.allDriveSpecs.push(new I(13,306,8,17,3)),this.allDriveSpecs.push(new I(16,612,4,17,2))}reset(){super.reset(),this.selectedDrive=0,this.dcbByteNo=0,this.requestBit=!1,this.commandDataBit=!1,this.busyBit=!1,this.requestBit=!1,this.errorBytes.length=0,this.currentCommandError=!1,this.outputBytes.length=0}writeDataByte(e){switch(this.dcbByteNo){case 0:this.command=e;break;case 1:this.head=31&e,this.selectedDrive=(32&e)>0?1:0;break;case 2:this.sector=63&e,this.cylinder=(192&e)<<2;break;case 3:this.cylinder=this.cylinder+e;break;case 4:this.interlBlockCount=e;break;case 5:this.controlField=e}this.dcbByteNo<5?this.dcbByteNo++:12==this.command&&this.dcbByteNo<13?(this.driveCharacteristics[this.selectedDrive][this.dcbByteNo-5]=e,this.dcbByteNo++):(this.dcbByteNo=0,this.executeCommand())}getStatusByte(){let e=0;return 1==this.selectedDrive&&(e|=32),this.currentCommandError&&(e|=2),e}commandFinished(){this.command=0,this.eventTimer.setEvent(this.commandDelay,(()=>{this.commandDataBit=!0,this.modeBit=!0,this.statusByte=this.getStatusByte(),this.currentCommandError=!1,this.isBusy=!1,this.interruptEnabled&&this.pic.doInterrupt(h.Harddisk)}))}executeCommand(){if(!this.isBusy){if(this.isBusy=!0,this.currentCommandError=!1,this.errorBytes.length=0,null==this.driveSpecs[this.selectedDrive]);else switch(this.command){case 0:case 1:case 4:case 5:case 6:case 7:case 11:case 12:case 13:case 15:case 224:case 227:case 228:break;case 3:for(;this.errorBytes.length>0;)this.outputBytes.push(this.errorBytes.shift());break;case 8:this.dataPointer=this.calcLba(this.cylinder,this.head,this.sector)*I.sectorSize,this.currentCommandError||this.eventTimer.setEvent(this.readWriteDelay,(()=>this.dmaController.triggerDmaDeviceToMem(3,this,null)));break;case 10:this.dataPointer=this.calcLba(this.cylinder,this.head,this.sector)*I.sectorSize,this.currentCommandError||this.eventTimer.setEvent(this.readWriteDelay,(()=>{this.dmaController.triggerDmaMemToDevice(3,this,null),this.imageChanged[this.selectedDrive]=!0}));break;case 14:case 229:case 230:throw new Error("Method not implemented.");default:this.generateError(v.InvalidCommand)}this.commandFinished()}}calcLba(e,t,r){const i=this.driveSpecs[this.selectedDrive].calcLba(e,t,r);return null==i?(this.generateError(v.IllegalDiskAddress),0):i}getNextByte(e){const t=this.diskImages[this.selectedDrive];return this.dataPointer<t.length?(e.endOfData=!1,t[this.dataPointer++]):(e.endOfData=!0,0)}setNextByte(e,t){t.endOfData=!1,this.diskImages[this.selectedDrive][this.dataPointer++]=e}}!function(e){e[e.F360=0]="F360",e[e.F720=1]="F720"}(S||(S={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(k||(k={}));class D{constructor(){Object.defineProperty(this,"seekEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"noData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endOfCylinder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deleteAddressMark",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}reset(){this.seekEnd=!1,this.noData=!1,this.timeout=!1,this.endOfCylinder=!1,this.deleteAddressMark=!1}}class M{constructor(){Object.defineProperty(this,"head",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"track",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sector",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sectorSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"trackLength",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"gap3Length",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dataLength",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"fillByte",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"multiTrack",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}}class j{constructor(e,t,r){Object.defineProperty(this,"heads",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tracks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sectors",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.heads=e,this.sectors=t,this.tracks=r}get diskSize(){return this.heads*this.tracks*this.sectors*j.sectorSize}calcLba(e,t,r){return(e*this.heads+t)*this.sectors+r-1}}Object.defineProperty(j,"sectorSize",{enumerable:!0,configurable:!0,writable:!0,value:512});class N extends b.H{constructor(e,t){super(),Object.defineProperty(this,"commandDelay",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"maxDriveCount",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"driveSpecsByFloppyType",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"pic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmaController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmaIrqEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"motor",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"selectedDrive",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dataRegisterReady",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"busy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataDirection",{enumerable:!0,configurable:!0,writable:!0,value:k.Input}),Object.defineProperty(this,"resetCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"driveInfo",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"commandInfo",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"driveSpecs",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"interruptCode",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"diskImages",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"diskImagePath",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"imageChanged",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"outputQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"currDataPosition",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"currDataLength",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"currentCommand",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"cmdByteNo",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"headLoadTime",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"headUnloadTime",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),Object.defineProperty(this,"stepRate",{enumerable:!0,configurable:!0,writable:!0,value:new Array(this.maxDriveCount)}),this.pic=e,this.dmaController=t;for(let e=0;e<this.maxDriveCount;e++)this.driveInfo[e]=new D,this.commandInfo[e]=new M;this.initDriveSpecs()}*getFloppyTypes(){yield S.F360,yield S.F720}initDriveSpecs(){this.driveSpecsByFloppyType=new Array(Object.keys(S).length),this.driveSpecsByFloppyType[S.F360]=new j(2,9,40),this.driveSpecsByFloppyType[S.F720]=new j(2,9,80)}internalLoadImage(e,t){for(const r of this.getFloppyTypes()){const i=this.driveSpecsByFloppyType[r];if(i&&i.diskSize==t.byteLength)return this.resetImage(e,i),this.diskImages[e]=new Uint8Array(t),!0}return!1}resetImage(e,t){this.driveInfo[e].reset(),this.active[e]=!1,this.motor[e]=!1,this.driveSpecs[e]=t,this.diskImages[e]=new Uint8Array(t.diskSize)}async loadImageFromFile(e,t){return new Promise(((r,s)=>{const a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("GET",i.Zr.baseDir+e,!0),a.onload=async()=>{if(200!=a.status)return void s();const i=a.response,n=C.ec(new Uint8Array(i));if(this.internalLoadImage(t,n.buffer))return this.diskImagePath[t]=e,void r(!0);this.diskImages[t]=null,r(!1)},a.onerror=()=>{this.diskImages[t]=null,s()},a.send()}))}loadImageFromBuffer(e,t){this.internalLoadImage(t,e)}async newImage(e){await this.loadImageFromFile("Floppy/empty.ima.gz",e)}getDiskImage(e){const t=this.diskImages[e];return null!=t&&t.length>0?this.diskImages[e].buffer:null}async saveImage(e){this.diskImagePath[e]&&this.imageChanged[e]&&(this.imageChanged[e]=!1)}async saveImages(){for(let e=0;e<this.maxDriveCount;e++)await this.saveImage(e)}async ejectImage(e){await this.saveImage(e),this.diskImages[e]=null}internalReset(){for(let e=0;e<this.maxDriveCount;e++)this.motor[e]=!1;this.selectedDrive=0,this.dmaIrqEnabled=!1,this.dataDirection=k.Input,this.outputQueue.length=0,this.resetCount=0,this.doInterrupt(100,3)}doInterrupt(e,t){this.busy=this.outputQueue.length>0,this.interruptCode=t,0==e?this.pic.doInterrupt(h.Diskette):this.eventTimer.setEvent(e,(()=>{this.pic.doInterrupt(h.Diskette)}))}newCommand(){this.driveInfo[this.selectedDrive].reset(),this.dataDirection=k.Input,this.outputQueue.length=0}getStatus0(){let e;return null!=this.resetCount?(e=this.resetCount,this.resetCount<3?this.resetCount++:this.resetCount=null,e|=192):(e=this.selectedDrive,e|=this.interruptCode<<6),1==this.commandInfo[this.selectedDrive].head&&(e|=4),this.driveInfo[this.selectedDrive].seekEnd&&(e|=32),e|=this.interruptCode<<6,e}getStatus1(){let e=0;return this.driveInfo[this.selectedDrive].noData&&(e|=4),this.driveInfo[this.selectedDrive].timeout&&(e|=16),this.driveInfo[this.selectedDrive].endOfCylinder&&(e|=128),e}getStatus2(){let e=0;return this.driveInfo[this.selectedDrive].deleteAddressMark&&(e|=64),e}getStatus3(){let e=this.selectedDrive;return 1==this.commandInfo[this.selectedDrive].head&&(e|=4),e|=8,0==this.commandInfo[this.selectedDrive].track&&(e|=16),e|=32,e}initOutput(){this.outputQueue.length=0,this.dataDirection=k.Output}in(e){switch(e){case 1012:{let e=0;for(let t=0;t<this.maxDriveCount;t++)this.active[t]&&(e|=1<<t&255);return this.busy&&(e|=16),this.dmaIrqEnabled||(e|=32),this.dataDirection==k.Output&&(e|=64),this.dataRegisterReady&&(e|=128),e}case 1013:if(this.dataDirection==k.Output&&this.outputQueue.length>0){const e=this.outputQueue.shift();return 0==this.outputQueue.length&&(this.dataDirection=k.Input,this.busy=!1),e}}return 255}out(e,t,r){this.busy&&(this.busy=!1,this.outputQueue.length=0);const i=255&t;switch(e){case 1010:if(0==(4&i))return void this.internalReset();this.selectedDrive=3&i,this.dmaIrqEnabled=(8&i)>0;for(let e=0;e<this.maxDriveCount;e++)this.motor[e]=(i&16<<e)>0;break;case 1013:switch(0==this.cmdByteNo&&(this.currentCommand=31&i,this.commandInfo[this.selectedDrive].multiTrack=(128&i)>0,this.newCommand()),this.currentCommand){case 2:this.cmdReadTrack(i);break;case 5:this.cmdWriteSector(i);break;case 6:this.cmdReadSector(i);break;case 9:this.cmdWriteDeletedSector(i);break;case 12:this.cmdReadDeletedSector(i);break;case 13:this.cmdFormatTrack(i);break;case 3:this.cmdFixDriveData(i);break;case 4:this.cmdCheckDriveStatus();break;case 7:this.cmdCalibrateDrive();break;case 8:this.cmdCheckInterruptStatus();break;case 10:this.cmdReadSectorId(i);break;case 15:this.cmdSeekParkHead(i);break;default:this.cmdInvalid()}}}cmdReadTrack(e){if(this.resetCount=null,this.setAccessValues(e),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdWriteSector(e){if(this.resetCount=null,this.setAccessValues(e),8==this.cmdByteNo)if(this.cmdByteNo=0,this.busy=!0,null==this.diskImages[this.selectedDrive])this.doInterrupt(10,1);else{const e=this.commandInfo[this.selectedDrive],t=this.driveSpecs[this.selectedDrive].calcLba(e.track,e.head,e.sector)*j.sectorSize;let r=e.trackLength*j.sectorSize;r<0&&(r=j.sectorSize),this.currDataPosition[this.selectedDrive]=t,this.currDataLength[this.selectedDrive]=r;const i=()=>{this.driveInfo[this.selectedDrive].seekEnd=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.getStatus1()),this.outputQueue.push(this.getStatus2()),this.outputQueue.push(e.track),this.outputQueue.push(e.head),this.outputQueue.push(e.sector),this.outputQueue.push(e.sectorSize),this.doInterrupt(10,0)};this.eventTimer.setEvent(this.commandDelay,(()=>{this.dmaController.triggerDmaMemToDevice(2,this,i),this.imageChanged[this.selectedDrive]=!0}))}else this.cmdByteNo++}cmdReadSector(e){if(this.resetCount=null,this.setAccessValues(e),8==this.cmdByteNo)if(this.cmdByteNo=0,this.busy=!0,null==this.diskImages[this.selectedDrive])this.doInterrupt(10,1);else{const e=this.commandInfo[this.selectedDrive],t=this.driveSpecs[this.selectedDrive];this.currDataPosition[this.selectedDrive]=0;const r=t.calcLba(e.track,e.head,e.sector)*j.sectorSize;let i=e.trackLength*j.sectorSize;i<0&&(i=j.sectorSize),this.currDataPosition[this.selectedDrive]=r,this.currDataLength[this.selectedDrive]=i;const s=()=>{this.driveInfo[this.selectedDrive].seekEnd=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.getStatus1()),this.outputQueue.push(this.getStatus2()),this.outputQueue.push(e.track),this.outputQueue.push(e.head),this.outputQueue.push(e.sector),this.outputQueue.push(e.sectorSize),this.doInterrupt(10,0)};this.eventTimer.setEvent(this.commandDelay,(()=>this.dmaController.triggerDmaDeviceToMem(2,this,(()=>s()))))}else this.cmdByteNo++}cmdWriteDeletedSector(e){if(this.resetCount=null,this.setAccessValues(e),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdReadDeletedSector(e){if(this.resetCount=null,this.setAccessValues(e),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdFormatTrack(e){switch(this.resetCount=null,this.cmdByteNo){case 1:this.commandInfo[this.selectedDrive].head=e>>2&1;break;case 2:this.commandInfo[this.selectedDrive].sectorSize=e;break;case 3:this.commandInfo[this.selectedDrive].trackLength=e;break;case 4:this.commandInfo[this.selectedDrive].gap3Length=e;break;case 5:this.commandInfo[this.selectedDrive].fillByte=e}5==this.cmdByteNo?(this.cmdByteNo=0,this.busy=!0,this.eventTimer.setEvent(1e3,(()=>this.doInterrupt(10,0)))):this.cmdByteNo++}cmdFixDriveData(e){switch(this.resetCount=null,this.cmdByteNo){case 1:this.headUnloadTime[this.selectedDrive]=3&e,this.stepRate[this.selectedDrive]=e>>4&3;break;case 2:this.dmaIrqEnabled=(1&e)>0,this.headLoadTime[this.selectedDrive]=e>>1&127}2==this.cmdByteNo?this.cmdByteNo=0:this.cmdByteNo++}cmdCheckDriveStatus(){this.resetCount=null,1==this.cmdByteNo?(this.cmdByteNo=0,this.busy=!0,this.initOutput(),this.outputQueue.push(this.getStatus3())):this.cmdByteNo++}cmdCalibrateDrive(){this.resetCount=null,1==this.cmdByteNo?(this.cmdByteNo=0,this.active[this.selectedDrive]=!0,this.eventTimer.setEvent(1e4,(()=>{this.commandInfo[this.selectedDrive].track=0,this.driveInfo[this.selectedDrive].seekEnd=!0,this.active[this.selectedDrive]=!1,this.doInterrupt(0,0)}))):this.cmdByteNo++}cmdCheckInterruptStatus(){this.busy=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.commandInfo[this.selectedDrive].track)}cmdReadSectorId(e){if(this.resetCount=null,1==this.cmdByteNo)throw this.cmdByteNo=0,this.commandInfo[this.selectedDrive].head=e>>2&1,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdSeekParkHead(e){this.resetCount=null,2==this.cmdByteNo?(this.cmdByteNo=0,this.active[this.selectedDrive]=!0,this.eventTimer.setEvent(1e4,(()=>{this.commandInfo[this.selectedDrive].track=e,this.driveInfo[this.selectedDrive].seekEnd=!0,this.active[this.selectedDrive]=!1,this.doInterrupt(0,0)}))):this.cmdByteNo++}cmdInvalid(){this.resetCount=null,this.busy=!0,this.interruptCode=2,this.initOutput(),this.outputQueue.push(this.getStatus0())}setAccessValues(e){switch(this.cmdByteNo){case 1:break;case 2:this.commandInfo[this.selectedDrive].track=e;break;case 3:this.commandInfo[this.selectedDrive].head=e;break;case 4:this.commandInfo[this.selectedDrive].sector=e;break;case 5:this.commandInfo[this.selectedDrive].sectorSize=e;break;case 6:this.commandInfo[this.selectedDrive].trackLength=e;break;case 7:this.commandInfo[this.selectedDrive].gap3Length=e;break;case 8:this.commandInfo[this.selectedDrive].dataLength=e}}getNextByte(e){return this.currDataLength[this.selectedDrive]>0?(e.endOfData=!1,this.currDataLength[this.selectedDrive]--,this.diskImages[this.selectedDrive][this.currDataPosition[this.selectedDrive]++]):(e.endOfData=!0,0)}setNextByte(e,t){this.currDataLength[this.selectedDrive]>0?(t.endOfData=!1,this.currDataLength[this.selectedDrive]--,this.diskImages[this.selectedDrive][this.currDataPosition[this.selectedDrive]++]=e):t.endOfData=!0}}!function(e){e[e.One=0]="One",e[e.OnePointFive=1]="OnePointFive",e[e.Two=2]="Two"}(R||(R={})),function(e){e[e.None=0]="None",e[e.Odd=1]="Odd",e[e.Even=2]="Even",e[e.Mark=3]="Mark",e[e.Space=4]="Space"}(O||(O={})),function(e){e[e.None=0]="None",e[e.ModemStatusChange=1]="ModemStatusChange",e[e.TransmitterHoldingRegEmpty=2]="TransmitterHoldingRegEmpty",e[e.ReceivedDataAvailable=3]="ReceivedDataAvailable",e[e.LineStatusChange=4]="LineStatusChange",e[e.CharacterTimeout=5]="CharacterTimeout"}(P||(P={}));class x extends b.H{constructor(e,t,r){super(),Object.defineProperty(this,"pic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"port",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"irq",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveIrqDelay",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"serialDevice",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveBuffer",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"divisorLatch",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"interruptEnableRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"lineControlRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"scratchRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"fifosEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmaMode",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"uartInterruptPending",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptCause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptPending",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"breakSignalEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dlab",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dataTerminalReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requestToSend",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auxOutput1",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auxOutput2",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loopbackMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastModemStatus",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"trailingEdgeRingIndicator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataWordLen",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"stopBits",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receivedBytesThreshold",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"onBeforeReadReceiveBuffer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onTransmit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onSerialParamsChanged",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.port=e,this.irq=t,this.pic=r,this.receivedBytesThreshold=1}getModemStatus(){return this.loopbackMode?(this.requestToSend?1:0)+(this.dataTerminalReady?2:0)+(this.auxOutput1?4:0)+(this.auxOutput2?8:0):null!=this.serialDevice?(this.serialDevice.clearToSend?1:0)+(this.serialDevice.dataSetReady?2:0)+(this.serialDevice.ringIndicator?4:0)+(this.serialDevice.dataCarrierDetect?8:0):0}in(e){switch(e-this.port){case 0:if(0==this.dlab){let e=0;return this.onBeforeReadReceiveBuffer&&this.onBeforeReadReceiveBuffer(),this.receiveBuffer.length>0&&(e=this.receiveBuffer.shift()),this.clearInterrupt(P.ReceivedDataAvailable),this.clearInterrupt(P.CharacterTimeout),(1&this.interruptEnableRegister)>0&&this.receiveBuffer.length>=this.receivedBytesThreshold&&this.doInterruptWithDelay(P.ReceivedDataAvailable,this.receiveIrqDelay),e}return 255&this.divisorLatch;case 1:return 0==this.dlab?this.interruptEnableRegister:this.divisorLatch>>8&65535;case 2:{let e=0;switch(this.uartInterruptPending||(e=1),this.interruptCause){case P.ModemStatusChange:break;case P.TransmitterHoldingRegEmpty:e|=2,this.interruptCause=P.None,this.uartInterruptPending=!1;break;case P.ReceivedDataAvailable:e|=4;break;case P.LineStatusChange:e|=6;break;case P.CharacterTimeout:e|=12}return this.fifosEnabled&&(e|=192),255&e}case 3:return this.lineControlRegister;case 4:return 255&(this.dataTerminalReady?1:0)+(this.requestToSend?2:0)+(this.auxOutput1?4:0)+(this.auxOutput2?8:0)+(this.loopbackMode?16:0);case 5:{let e=0;return this.receiveBuffer.length>0&&(e+=1),(null==this.serialDevice||this.serialDevice.transmitBufferEmpty)&&(e|=96),this.clearInterrupt(P.LineStatusChange),255&e}case 6:{const e=this.getModemStatus();let t=(11&(this.lastModemStatus^e))+(e<<4);return t+=this.trailingEdgeRingIndicator?4:0,this.trailingEdgeRingIndicator=!1,this.lastModemStatus=e,this.clearInterrupt(P.ModemStatusChange),255&t}case 7:return this.scratchRegister}return 0}out(e,t,r){switch(e-this.port){case 0:0==this.dlab?(this.clearInterrupt(P.TransmitterHoldingRegEmpty),this.loopbackMode?(this.transmitBufferEmpty(),this.writeData(255&t)):this.onTransmit&&this.onTransmit(255&t)):(this.divisorLatch=(65280&this.divisorLatch)+(255&t)&65535,this.serialParamsChanged());break;case 1:0==this.dlab?this.interruptEnableRegister=15&t:(this.divisorLatch=(255&this.divisorLatch)+(t<<8)&65535,this.serialParamsChanged());break;case 2:switch(this.fifosEnabled=(1&t)>0,(2&t)>0&&(this.receiveBuffer.length=0),(4&t)>0&&this.serialDevice?.clearTransmitBuffer(),this.dmaMode=t>>3&1,t>>6){case 0:this.receivedBytesThreshold=1;break;case 1:this.receivedBytesThreshold=4;break;case 2:this.receivedBytesThreshold=8;break;case 3:this.receivedBytesThreshold=14}break;case 3:switch(this.lineControlRegister=255&t,3&t){case 0:this.dataWordLen=5;break;case 1:this.dataWordLen=6;break;case 2:this.dataWordLen=7;break;case 3:this.dataWordLen=8}if(this.stopBits=(4&t)>0?this.dataWordLen<=5?R.OnePointFive:R.Two:R.One,0==(8&t))this.parity=O.None;else switch(t>>4&3){case 0:this.parity=O.Odd;break;case 1:this.parity=O.Even;break;case 2:this.parity=O.Mark;break;case 3:this.parity=O.Space}this.breakSignalEnabled=(64&t)>0,this.dlab=t>>7&1,this.serialParamsChanged();break;case 4:{const e=this.loopbackMode;this.dataTerminalReady=(1&t)>0,this.requestToSend=(2&t)>0,this.auxOutput1=(4&t)>0,this.auxOutput2=(8&t)>0,this.loopbackMode=(16&t)>0,this.loopbackMode&&!e&&(this.lastModemStatus=this.getModemStatus()),this.loopbackMode&&this.modemStatusChanged(),null!=this.serialDevice&&(this.serialDevice.dataTerminalReady=this.dataTerminalReady,this.serialDevice.requestToSend=this.requestToSend)}break;case 5:break;case 6:this.trailingEdgeRingIndicator=(4&t)>0;break;case 7:this.scratchRegister=255&t}}get baudRate(){return this.divisorLatch>0?Math.trunc(1843200/(this.divisorLatch<<4)):0}connect(e){this.serialDevice=e,this.serialDevice.uartPort=this,this.serialDevice.onTransmitBufferEmpty=this.transmitBufferEmpty}disconnect(){this.serialDevice.uartPort=null,this.serialDevice=null}writeData(e){this.receiveBuffer.push(e),(1&this.interruptEnableRegister)>0&&this.receiveBuffer.length>=this.receivedBytesThreshold&&this.doInterrupt(P.ReceivedDataAvailable)}modemStatusChanged(){(8&this.interruptEnableRegister)>0&&this.doInterrupt(P.ModemStatusChange)}doInterruptWithDelay(e,t){this.interruptPending||(this.interruptPending=!0,this.eventTimer.setEvent(t,(()=>this.doInterrupt(e))))}doInterrupt(e){this.uartInterruptPending||(this.interruptCause=e,this.uartInterruptPending=!0,this.pic.doInterrupt(this.irq),this.interruptPending=!1)}clearInterrupt(e){this.interruptCause==e&&(this.interruptCause=P.None,this.uartInterruptPending=!1)}serialParamsChanged(){this.onSerialParamsChanged&&this.onSerialParamsChanged(),this.receiveBuffer.length=0,this.baudRate>0&&(this.receiveIrqDelay=Math.trunc(1e6/this.baudRate))}transmitBufferEmpty(){(2&this.interruptEnableRegister)>0&&this.doInterrupt(P.TransmitterHoldingRegEmpty)}}class W extends b.H{get dataTerminalReady(){return this._dataTerminalReady}set dataTerminalReady(e){this._dataTerminalReady!=e&&(this._dataTerminalReady=e,this.paramsChanged())}get requestToSend(){return this._requestToSend}set requestToSend(e){this._requestToSend!=e&&(this._requestToSend=e,this.paramsChanged())}get uartPort(){return this._uartPort}set uartPort(e){null!=this._uartPort&&(this._uartPort.onSerialParamsChanged=null),this._uartPort=e,null!=this._uartPort&&(this._uartPort.onSerialParamsChanged=this.paramsChanged)}get checkParamsOk(){return 1200==this.uartPort.baudRate&&7==this.uartPort.dataWordLen&&this.uartPort.stopBits==R.One&&this.uartPort.parity==O.None&&this.requestToSend&&this.dataTerminalReady}get transmitBufferEmpty(){return!0}constructor(e){super(),Object.defineProperty(this,"_uartPort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastPosition",{enumerable:!0,configurable:!0,writable:!0,value:{x:0,y:0}}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"paramsOk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_dataTerminalReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_requestToSend",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataCarrierDetect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataSetReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ringIndicator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clearToSend",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onTransmitBufferEmpty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.eventTimer=e}paramsChanged(){this.checkParamsOk?(null!=this.eventId&&this.eventTimer.deleteEvent(this.eventId),this.eventId=this.eventTimer.setEvent(2500,(()=>{this.uartPort.writeData(77),this.paramsOk=!0,this.eventId=null}))):this.paramsOk=!1}sendMouseData(e,t,r,i){if(this.paramsOk){let s=e;s<-128&&(s=-128),s>127&&(s=127),s<0&&(s+=256);let a=t;a<-128&&(a=-128),a>127&&(a=127),a<0&&(a+=256);const n=64+(r?32:0)+(i?16:0)+((192&a)>>4)+((192&s)>>6);this.uartPort.writeData(255&n),this.uartPort.writeData(63&s),this.uartPort.writeData(63&a)}}clearTransmitBuffer(){}mouseMoveDelta(e,t){this.sendMouseData(e,t,!1,!1)}mouseEventAbs(e,t,r){if(Math.abs(this.lastPosition.x)>.1||Math.abs(this.lastPosition.y)>.1){const i=e.x-this.lastPosition.x,s=e.y-this.lastPosition.y;this.sendMouseData(i,s,t,r)}this.lastPosition=e}mouseEventRel(e,t,r){this.sendMouseData(e.x,e.y,t,r)}resetMove(){this.lastPosition={x:0,y:0}}}class F extends b.H{constructor(e){super(),Object.defineProperty(this,"startAddr",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportWrite",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportRead",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.startAddr=e}async load(e){return new Promise(((t,r)=>{const s=new XMLHttpRequest;s.responseType="arraybuffer",s.open("GET",i.Zr.baseDir+e,!0),s.onload=()=>{if(200==s.status){const e=s.response;this.data=new Uint8Array(e),this.size=this.data.length,t()}else r()},s.onerror=()=>{r()},s.send()}))}getEndAddr(){return this.startAddr+this.size-1}peek(e){return this.data[e-this.startAddr]}poke(e,t){}}class $ extends b.H{constructor(e,t){super(),Object.defineProperty(this,"memory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"offset",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sizeKb",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"supportWrite",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"supportRead",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.sizeKb=e,this.offset=t,this.memory=new Uint8Array(1024*e)}get addrLo(){return this.offset}get addrHi(){return this.offset+1024*this.sizeKb}peek(e){return e>=this.offset&&e<this.offset+this.memory.length?this.memory[e-this.offset]:0}poke(e,t){e>=this.offset&&e<this.offset+this.memory.length&&(this.memory[e-this.offset]=t)}}!function(e){e[e.Carry=1]="Carry",e[e.Parity=4]="Parity",e[e.Adjust=16]="Adjust",e[e.Zero=64]="Zero",e[e.Sign=128]="Sign",e[e.Trap=256]="Trap",e[e.IntEnable=512]="IntEnable",e[e.Direction=1024]="Direction",e[e.Overflow=2048]="Overflow",e[e.IoPrivilegeLevel0=4096]="IoPrivilegeLevel0",e[e.IoPrivilegeLevel1=8192]="IoPrivilegeLevel1",e[e.NestedTask=16384]="NestedTask",e[e.Resume=65536]="Resume",e[e.Virtual8086Mode=131072]="Virtual8086Mode"}(w||(w={}));class E{constructor(){Object.defineProperty(this,"internalValue",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.internalValue=61440}setFlag(e){this.internalValue|=e}resetFlag(e){this.internalValue&=65535&~e}getFlag(e){return(this.internalValue&e)>0}get CF(){return this.getFlag(w.Carry)}set CF(e){e?this.setFlag(w.Carry):this.resetFlag(w.Carry)}get PF(){return this.getFlag(w.Parity)}set PF(e){e?this.setFlag(w.Parity):this.resetFlag(w.Parity)}get AF(){return this.getFlag(w.Adjust)}set AF(e){e?this.setFlag(w.Adjust):this.resetFlag(w.Adjust)}get ZF(){return this.getFlag(w.Zero)}set ZF(e){e?this.setFlag(w.Zero):this.resetFlag(w.Zero)}get SF(){return this.getFlag(w.Sign)}set SF(e){e?this.setFlag(w.Sign):this.resetFlag(w.Sign)}get TF(){return this.getFlag(w.Trap)}set TF(e){e?this.setFlag(w.Trap):this.resetFlag(w.Trap)}get IF(){return this.getFlag(w.IntEnable)}set IF(e){e?this.setFlag(w.IntEnable):this.resetFlag(w.IntEnable)}get DF(){return this.getFlag(w.Direction)}set DF(e){e?this.setFlag(w.Direction):this.resetFlag(w.Direction)}get OF(){return this.getFlag(w.Overflow)}set OF(e){e?this.setFlag(w.Overflow):this.resetFlag(w.Overflow)}get value(){return this.internalValue}set value(e){this.internalValue=61440|e}}class X{}Object.defineProperty(X,"Rep",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(X,"Lock",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"SegOverride",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"Aaa",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"Aad",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(X,"Aam",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(X,"Aas",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(X,"AdcRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AdcRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"AdcRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AdcRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"AdcAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AdcAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"AdcRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"AdcRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"AddRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AddRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"AddRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AddRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"AddAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AddAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"AddRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"AddRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"AndRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AndRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"AndRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AndRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"AndRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"AndRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"AndAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"AndAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"Bound",{enumerable:!0,configurable:!0,writable:!0,value:34}),Object.defineProperty(X,"CallNear",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(X,"CallFar",{enumerable:!0,configurable:!0,writable:!0,value:31}),Object.defineProperty(X,"CallNearReg",{enumerable:!0,configurable:!0,writable:!0,value:13}),Object.defineProperty(X,"CallNearMem",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(X,"CallFarRm",{enumerable:!0,configurable:!0,writable:!0,value:38}),Object.defineProperty(X,"Cbw",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"Clc",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"Cld",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"Cli",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"Cmc",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"CmpRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"CmpRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"CmpRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"CmpRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"CmpAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"CmpAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"CmpRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"CmpRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"Cmps",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(X,"Cwd",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"Daa",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"Das",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"DivReg",{enumerable:!0,configurable:!0,writable:!0,value:29}),Object.defineProperty(X,"DivMem",{enumerable:!0,configurable:!0,writable:!0,value:35}),Object.defineProperty(X,"DivReg16",{enumerable:!0,configurable:!0,writable:!0,value:38}),Object.defineProperty(X,"DivMem16",{enumerable:!0,configurable:!0,writable:!0,value:44}),Object.defineProperty(X,"DecReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"DecMem",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(X,"EnterLvl0",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(X,"EnterLvl1",{enumerable:!0,configurable:!0,writable:!0,value:29}),Object.defineProperty(X,"EnterInitial",{enumerable:!0,configurable:!0,writable:!0,value:26}),Object.defineProperty(X,"EnterPerLvl",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(X,"Hlt",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"IdivReg",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(X,"IdivMem",{enumerable:!0,configurable:!0,writable:!0,value:54}),Object.defineProperty(X,"IdivReg16",{enumerable:!0,configurable:!0,writable:!0,value:57}),Object.defineProperty(X,"IdivMem16",{enumerable:!0,configurable:!0,writable:!0,value:63}),Object.defineProperty(X,"ImulImmReg",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(X,"ImulImmMem",{enumerable:!0,configurable:!0,writable:!0,value:31}),Object.defineProperty(X,"ImulImmReg16",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(X,"ImulImmMem16",{enumerable:!0,configurable:!0,writable:!0,value:31}),Object.defineProperty(X,"ImulReg",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(X,"ImulMem",{enumerable:!0,configurable:!0,writable:!0,value:33}),Object.defineProperty(X,"ImulReg16",{enumerable:!0,configurable:!0,writable:!0,value:36}),Object.defineProperty(X,"ImulMem16",{enumerable:!0,configurable:!0,writable:!0,value:42}),Object.defineProperty(X,"InImm",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"InDx",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"IncReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"IncMem",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(X,"Ins",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(X,"InsRep",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"Int3",{enumerable:!0,configurable:!0,writable:!0,value:45}),Object.defineProperty(X,"IntImm",{enumerable:!0,configurable:!0,writable:!0,value:47}),Object.defineProperty(X,"Into",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(X,"IntoNoInt",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"Iret",{enumerable:!0,configurable:!0,writable:!0,value:28}),Object.defineProperty(X,"JumpCondMet",{enumerable:!0,configurable:!0,writable:!0,value:13}),Object.defineProperty(X,"JumpCondNotMet",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"JcxzMet",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(X,"JcxzNotMet",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(X,"JmpShort",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(X,"JmpNear",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(X,"JmpNearReg",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(X,"JmpNearMem",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(X,"JmpFar",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(X,"JmpFarRm",{enumerable:!0,configurable:!0,writable:!0,value:26}),Object.defineProperty(X,"Lahf",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"Lds",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(X,"Lea",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(X,"Leave",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"Les",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(X,"Lods",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(X,"LodsRep",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(X,"Loop",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"LoopFinished",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(X,"MovAxMemoffs",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"MovMemoffsAx",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"MovRegImm8",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"MovRegImm16",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"MovRmImm8",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(X,"MovRmImm16",{enumerable:!0,configurable:!0,writable:!0,value:13}),Object.defineProperty(X,"MovRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"MovRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(X,"MovRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"MovRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"MovRmSegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"MovRmSegMem",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(X,"MovSegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"MovSegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"Movs",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(X,"MovsRep",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"MulReg",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(X,"MulMem",{enumerable:!0,configurable:!0,writable:!0,value:33}),Object.defineProperty(X,"MulReg16",{enumerable:!0,configurable:!0,writable:!0,value:36}),Object.defineProperty(X,"MulMem16",{enumerable:!0,configurable:!0,writable:!0,value:42}),Object.defineProperty(X,"NegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"NegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"Nop",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"NotRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"NotRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"OrRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"OrRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"OrRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"OrRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"OrAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"OrAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"OrRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"OrRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"OutImm",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"OutDx",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(X,"Outs",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(X,"OutsRep",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"PopMem",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(X,"PopReg",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"PopSeg",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"Popa",{enumerable:!0,configurable:!0,writable:!0,value:51}),Object.defineProperty(X,"Popf",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(X,"PushMem",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(X,"PushReg",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"PushSeg",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"Pusha",{enumerable:!0,configurable:!0,writable:!0,value:36}),Object.defineProperty(X,"Pushf",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"PushImm8",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"PushImm16",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"PushRm",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"Ret",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"RetImm",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(X,"Retf",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(X,"RetfImm",{enumerable:!0,configurable:!0,writable:!0,value:25}),Object.defineProperty(X,"Sahf",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SbbRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SbbRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"SbbRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SbbRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"SbbAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SbbAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"SbbRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"SbbRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"Scas",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(X,"SetFlag",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"ShiftRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(X,"ShiftRmMem",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(X,"ShiftRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(X,"ShiftRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(X,"ShiftRmClReg",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(X,"ShiftRmClMem",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(X,"Stos",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"StosRep",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(X,"SubRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SubRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"SubRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SubRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"SubAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"SubAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"SubRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"SubRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"TestReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"TestMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"TestAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"TestAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"TestRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"TestRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"Wait",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(X,"XchgReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"XchgRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"XchgRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(X,"Xlat",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(X,"XorRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"XorRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"XorRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"XorRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(X,"XorAlImm",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"XorAxImm",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"XorRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(X,"XorRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(X,"FpuInstruction",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(X,"HardInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:40});class L{}Object.defineProperty(L,"Rep",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Lock",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SegOverride",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Aaa",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"Aad",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(L,"Aam",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(L,"Aas",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"AdcRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AdcRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"AdcRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AdcRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"AdcAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AdcAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AdcRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AdcRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"AddRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AddRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"AddRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AddRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"AddAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AddAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AddRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AddRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"AndRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AndRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"AndRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AndRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"AndAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AndAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AndRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"AndRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"ArplReg",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(L,"ArplMem",{enumerable:!0,configurable:!0,writable:!0,value:21}),Object.defineProperty(L,"Bound",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"BsfBase",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"BsfBit",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"BtReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"BtMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"BtImmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"BtImmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"BtcReg",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"BtcMem",{enumerable:!0,configurable:!0,writable:!0,value:13}),Object.defineProperty(L,"BtcImmReg",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"BtcImmMem",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(L,"CallNear",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"CallFar",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(L,"CallNearReg",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"CallNearMem",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(L,"CallFarRm",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(L,"Cbw",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"Clc",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Cld",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Cli",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"Clts",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"Cmc",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"CmpRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"CmpRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"CmpRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"CmpRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"CmpAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"CmpAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"CmpRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"CmpRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"Cmps",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"Cwd",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Daa",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"Das",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"DecReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"DecMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"DivReg",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(L,"DivMem",{enumerable:!0,configurable:!0,writable:!0,value:17}),Object.defineProperty(L,"DivReg16",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(L,"DivMem16",{enumerable:!0,configurable:!0,writable:!0,value:25}),Object.defineProperty(L,"DivReg32",{enumerable:!0,configurable:!0,writable:!0,value:38}),Object.defineProperty(L,"DivMem32",{enumerable:!0,configurable:!0,writable:!0,value:41}),Object.defineProperty(L,"EnterLvl0",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"EnterLvl1",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"EnterInitial",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(L,"EnterPerLvl",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"Hlt",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"IdivReg",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(L,"IdivMem",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(L,"IdivReg16",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(L,"IdivMem16",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(L,"IdivReg32",{enumerable:!0,configurable:!0,writable:!0,value:43}),Object.defineProperty(L,"IdivMem32",{enumerable:!0,configurable:!0,writable:!0,value:43}),Object.defineProperty(L,"ImulImmReg",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"ImulImmMem",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(L,"ImulImmReg16",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(L,"ImulImmMem16",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(L,"ImulImmReg32",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(L,"ImulImmMem32",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(L,"ImulReg",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"ImulMem",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(L,"ImulReg16",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(L,"ImulMem16",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(L,"ImulReg32",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(L,"ImulMem32",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(L,"InImm",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"InDx",{enumerable:!0,configurable:!0,writable:!0,value:13}),Object.defineProperty(L,"IncReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"IncMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"Ins",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(L,"InsRep",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(L,"Int3",{enumerable:!0,configurable:!0,writable:!0,value:33}),Object.defineProperty(L,"IntImm",{enumerable:!0,configurable:!0,writable:!0,value:37}),Object.defineProperty(L,"Into",{enumerable:!0,configurable:!0,writable:!0,value:35}),Object.defineProperty(L,"IntoNo",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"Iret",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(L,"JumpCondMet",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"JumpCondNotMet",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"JcxzMet",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(L,"JcxzNotMet",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"JmpShort",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"JmpNear",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"JmpNearReg",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"JmpNearMem",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"JmpFar",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"JmpFarRm",{enumerable:!0,configurable:!0,writable:!0,value:43}),Object.defineProperty(L,"Lahf",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Lar",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(L,"Lds",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"Lea",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Leave",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"LidtLgdt",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(L,"Lldt",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(L,"Ltr",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(L,"LmswReg",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"LmswMem",{enumerable:!0,configurable:!0,writable:!0,value:13}),Object.defineProperty(L,"Lods",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"LodsRep",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"Loop",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(L,"LoopFinished",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovAxMemoffs",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"MovMemoffsAx",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRegImm8",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRegImm16",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRmImm8",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRmImm16",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"MovRmSegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovRmSegMem",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovSegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"MovSegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"MovRegCr",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"MovCr0Reg",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"MovCr2Reg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"MovCr3Reg",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"MovDr0Reg",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(L,"MovDr6Reg",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(L,"MovRegDr0",{enumerable:!0,configurable:!0,writable:!0,value:22}),Object.defineProperty(L,"MovRegDr6",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(L,"MovRegTr",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"MovTrReg",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"Movs",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"MovsRep",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"MovsxReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"MovsxMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"MovzxReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"MovzxMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"MulReg",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(L,"MulMem",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(L,"MulReg16",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(L,"MulMem16",{enumerable:!0,configurable:!0,writable:!0,value:19}),Object.defineProperty(L,"MulReg32",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(L,"MulMem32",{enumerable:!0,configurable:!0,writable:!0,value:27}),Object.defineProperty(L,"NegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"NegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"Nop",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"NotRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"NotRmMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"OrRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"OrRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"OrRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"OrRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"OrAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"OrAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"OrRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"OrRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"OutImm",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"OutDx",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(L,"Outs",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(L,"OutsRep",{enumerable:!0,configurable:!0,writable:!0,value:14}),Object.defineProperty(L,"PopMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"PopReg",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"PopSeg",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"Popa",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(L,"Popf",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"PushMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"PushReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"PushSeg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Pusha",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(L,"Pushf",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"PushImm8",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"PushImm16",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"PushRm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"Ret",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"RetImm",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(L,"Retf",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(L,"RetfImm",{enumerable:!0,configurable:!0,writable:!0,value:18}),Object.defineProperty(L,"Sahf",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"SbbRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SbbRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"SbbRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SbbRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"SbbAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SbbAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SbbRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SbbRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"Scas",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"SetCondMet",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"SetCondNotMet",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"SetFlag",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"ShiftRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"ShiftRmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"ShiftRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"ShiftRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"ShiftRmClReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"ShiftRmClMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"ShldReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"ShldMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"SidtSgdt",{enumerable:!0,configurable:!0,writable:!0,value:9}),Object.defineProperty(L,"Sldt",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SmswReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SmswMem",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"Stos",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"StosRep",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(L,"Str",{enumerable:!0,configurable:!0,writable:!0,value:25}),Object.defineProperty(L,"SubRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SubRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"SubRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SubRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"SubAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SubAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SubRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"SubRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"TestReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"TestMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"TestAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"TestAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"TestRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"TestRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"Wait",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"XchgReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"XchgRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"XchgRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"Xlat",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(L,"XorRegRmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"XorRegRmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"XorRmRegReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"XorRmRegMem",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(L,"XorAlImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"XorAxImm",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"XorRmImmReg",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(L,"XorRmImmMem",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(L,"FpuInstruction",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(L,"HardInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:40});class T{constructor(){Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rmAddr",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}}class H{constructor(){Object.defineProperty(this,"ea",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultSeg",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}}class Z{get AL(){return 255&this.AX}set AL(e){this.AX=65280&this.AX|255&e}get AH(){return this.AX>>8&255}set AH(e){this.AX=255&this.AX|(255&e)<<8}get BL(){return 255&this.BX}set BL(e){this.BX=65280&this.BX|255&e}get BH(){return this.BX>>8&255}set BH(e){this.BX=255&this.BX|(255&e)<<8}get CL(){return 255&this.CX}set CL(e){this.CX=65280&this.CX|255&e}get CH(){return this.CX>>8&255}set CH(e){this.CX=255&this.CX|(255&e)<<8}get DL(){return 255&this.DX}set DL(e){this.DX=65280&this.DX|255&e}get DH(){return this.DX>>8&255}set DH(e){this.DX=255&this.DX|(255&e)<<8}get FLAGS(){return this.flags.value}getInstructionByte(){return this.getMemByte(this.CS,this.IP)}getAddressByte(){return this.getMemByte(this.CS,this.IP+1&65535)}getName(){return"Intel 80186"}getCurrentCodeAddr(){return this.genAddr(this.CS,this.IP)}getCodeSeg32Bit(){return!1}constructor(e,t){Object.defineProperty(this,"memoryProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"portProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parities",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:new E}),Object.defineProperty(this,"doReset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"softInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hardInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"instStartIp",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"repeatIp",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"stringOperation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"segOverride",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cpuEvents",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"eventGen",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"AX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"BX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"CX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"DX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"SP",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"BP",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"SI",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"DI",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"IP",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"CS",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"SS",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"ES",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"DS",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"halt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"instCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"clockCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"workLoad",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.memoryProvider=e,this.portProvider=t,this.initParities(),this.execReset()}initParities(){for(let e=0;e<256;e++){const t=(0!=(1&e)?1:0)+(0!=(2&e)?1:0)+(0!=(4&e)?1:0)+(0!=(8&e)?1:0)+(0!=(16&e)?1:0)+(0!=(32&e)?1:0)+(0!=(64&e)?1:0)+(0!=(128&e)?1:0);this.parities[e]=0==(1&t)}}reset(){this.doReset=!0}execNextInstruction(){this.execInstructions(1)}genAddr(e,t){return(e<<4)+t&1048575}execReset(){this.cpuEvents.length=0,this.hardInterrupt=null,this.softInterrupt=null,this.blockInterrupt=!1,this.stringOperation=u.wA.None,this.repeatIp=0,this.segOverride=null,this.flags.value=0,this.IP=65520,this.CS=61440,this.DS=this.ES=this.SS=0,this.halt=!1}execInstructions(e){const t=this.clockCount+e;do{try{for(;this.clockCount<t;){this.instStartIp=this.IP;let e,t=this.readNextCodeByte();if(this.doReset)return this.doReset=!1,void this.execReset();do{switch(e=!1,t){case 243:this.clockCount+=X.Rep,this.stringOperation=u.wA.RepZ,this.repeatIp=this.IP-1&65535,t=this.readNextCodeByte(),e=!0;break;case 242:this.clockCount+=X.Rep,this.stringOperation=u.wA.RepNz,this.repeatIp=this.IP-1&65535,t=this.readNextCodeByte(),e=!0;break;case 240:this.clockCount+=X.Lock,t=this.readNextCodeByte(),e=!0;break;case 46:this.clockCount+=X.SegOverride,this.segOverride=this.CS,t=this.readNextCodeByte(),e=!0;break;case 62:this.clockCount+=X.SegOverride,this.segOverride=this.DS,t=this.readNextCodeByte(),e=!0;break;case 38:this.clockCount+=X.SegOverride,this.segOverride=this.ES,t=this.readNextCodeByte(),e=!0;break;case 54:this.clockCount+=X.SegOverride,this.segOverride=this.SS,t=this.readNextCodeByte(),e=!0;break;case 55:this.clockCount+=X.Aaa,(15&this.AL)>9||this.flags.AF?(this.AL=this.AL+6,this.AH=this.AH+1,this.flags.CF=!0,this.flags.AF=!0):(this.flags.CF=!1,this.flags.AF=!1),this.AL=15&this.AL,this.calcParitySignZeroFlagW(this.AX);break;case 213:{this.clockCount+=X.Aad;const e=this.readNextCodeByte();this.AL=this.AH*e+this.AL,this.AH=0,this.calcParitySignZeroFlagW(this.AX);break}case 212:{this.clockCount+=X.Aam;const e=this.readNextCodeByte();this.AH=this.AL/e,this.AL=this.AL%e,this.calcParitySignZeroFlagW(this.AX);break}case 63:this.clockCount+=X.Aas,(15&this.AL)>9||this.flags.AF?(this.AL=this.AL-6,this.AH=this.AH-1,this.flags.CF=!0,this.flags.AF=!0):(this.flags.CF=!1,this.flags.AF=!1),this.AL=15&this.AL;break;case 16:this.doByteOperation(u.Nm.RegToRm,((e,t)=>this.adcByte(e,t)),X.AddRmRegReg,X.AddRmRegMem);break;case 17:this.doWordOperation(u.Nm.RegToRm,((e,t)=>this.adcWord(e,t)),X.AdcRegRmReg,X.AdcRegRmMem);break;case 18:this.doByteOperation(u.Nm.RmToReg,((e,t)=>this.adcByte(e,t)),X.AddRmRegReg,X.AddRmRegMem);break;case 19:this.doWordOperation(u.Nm.RmToReg,((e,t)=>this.adcWord(e,t)),X.AddRmRegReg,X.AddRmRegMem);break;case 20:{this.clockCount+=X.AddAlImm;const e=this.readNextCodeByte();this.AL=this.adcByte(this.AL,e);break}case 21:{this.clockCount+=X.AddAxImm;const e=this.readNextCodeWord();this.AX=this.adcWord(this.AX,e);break}case 0:this.doByteOperation(u.Nm.RegToRm,((e,t)=>this.addByte(e,t)),X.AddRmRegReg,X.AddRmRegMem);break;case 1:this.doWordOperation(u.Nm.RegToRm,((e,t)=>this.addWord(e,t)),X.AddRmRegReg,X.AddRmRegMem);break;case 2:this.doByteOperation(u.Nm.RmToReg,((e,t)=>this.addByte(e,t)),X.AddRegRmMem,X.AddRegRmMem);break;case 3:this.doWordOperation(u.Nm.RmToReg,((e,t)=>this.addWord(e,t)),X.AddRegRmReg,X.AddRegRmMem);break;case 4:{this.clockCount+=X.AddAlImm;const e=this.readNextCodeByte();this.AL=this.addByte(this.AL,e);break}case 5:{this.clockCount+=X.AddAxImm;const e=this.readNextCodeWord();this.AX=this.addWord(this.AX,e);break}case 32:this.doByteOperation(u.Nm.RegToRm,((e,t)=>{const r=e&t&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),r}),X.AndRmRegReg,X.AndRmRegMem);break;case 33:this.doWordOperation(u.Nm.RegToRm,((e,t)=>{const r=e&t&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),r}),X.AndRmRegReg,X.AndRmRegMem);break;case 34:this.doByteOperation(u.Nm.RmToReg,((e,t)=>{const r=e&t&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),r}),X.AndRegRmReg,X.AndRegRmMem);break;case 35:this.doWordOperation(u.Nm.RmToReg,((e,t)=>{const r=e&t&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),r}),X.AndRegRmReg,X.AndRegRmMem);break;case 36:{this.clockCount+=X.AndAlImm;const e=this.readNextCodeByte(),t=this.AL&e&255;this.flags.CF=this.flags.OF=!1,this.AL=t,this.calcParitySignZeroFlagB(t);break}case 37:{this.clockCount+=X.AndAxImm;const e=this.readNextCodeWord(),t=this.AX&e&65535;this.flags.CF=this.flags.OF=!1,this.AX=t,this.calcParitySignZeroFlagW(t)}break;case 98:{this.clockCount+=X.Bound;const e=this.readAndDecodeAddressByte();3==e.mode&&this.handleIllegalOpcode();let t=this.memoryProvider.peekW(e.rmAddr);t>32767&&(t-=65536);let r=this.memoryProvider.peekW(e.rmAddr+2)+2;r>32767&&(r-=65536);let i=this.getRegWord(e.reg);if(i>32767&&(i-=65536),i<t||i>r)throw this.IP=this.instStartIp,new u.K4(u.gZ.BR)}break;case 232:{this.clockCount+=X.CallNear;let e=this.readNextCodeWord();e>32767&&(e-=65536),this.pushWord(65535&this.IP),this.IP=this.IP+e&65535;break}case 154:this.clockCount+=X.CallFar;{const e=this.readNextCodeWord(),t=this.readNextCodeWord();this.pushWord(this.CS),this.pushWord(65535&this.IP),this.CS=t,this.IP=e}break;case 152:this.clockCount+=X.Cbw,this.AL>127?this.AH=255:this.AH=0;break;case 248:this.clockCount+=X.Clc,this.flags.CF=!1;break;case 252:this.clockCount+=X.Cld,this.flags.DF=!1;break;case 250:this.clockCount+=X.Clc,this.flags.IF=!1;break;case 245:this.clockCount+=X.Cmc,this.flags.CF=!this.flags.CF;break;case 56:this.doByteOperation(u.Nm.RegToRm,((e,t)=>(this.subByte(e,t),0)),X.CmpRmRegReg,X.CmpRmRegMem,!1);break;case 57:this.doWordOperation(u.Nm.RegToRm,((e,t)=>(this.subWord(e,t),0)),X.CmpRmRegReg,X.CmpRmRegMem,!1);break;case 58:this.doByteOperation(u.Nm.RmToReg,((e,t)=>(this.subByte(e,t),0)),X.CmpRegRmReg,X.CmpRegRmMem,!1);break;case 59:this.doWordOperation(u.Nm.RmToReg,((e,t)=>(this.subWord(e,t),0)),X.CmpRegRmReg,X.CmpRegRmMem,!1);break;case 60:this.clockCount+=X.CmpAlImm,this.subByte(this.AL,this.readNextCodeByte());break;case 61:{this.clockCount+=X.CmpAxImm;const e=this.readNextCodeWord();this.subWord(this.AX,e)}break;case 166:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=X.Cmps,this.subByte(this.getMemByte(this.segOverride??this.DS,this.SI),this.getMemByte(this.ES,this.DI)),this.flags.DF?(this.SI=this.SI-1&65535,this.DI=this.DI-1&65535):(this.SI=this.SI+1&65535,this.DI=this.DI+1&65535),this.handleRepeatCheckZeroFlag()),this.stringOperation=u.wA.None;break;case 167:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=X.Cmps,this.subWord(this.getMemWord(this.segOverride??this.DS,this.SI),this.getMemWord(this.ES,this.DI)),this.flags.DF?(this.SI=this.SI-2&65535,this.DI=this.DI-2&65535):(this.SI=this.SI+2&65535,this.DI=this.DI+2&65535),this.handleRepeatCheckZeroFlag()),this.stringOperation=u.wA.None;break;case 153:this.clockCount+=X.Cwd,this.DX=65535&(this.AX>=32768?65535:0);break;case 39:this.clockCount+=X.Daa,((15&this.AL)>9||this.flags.AF)&&(this.AL=this.AL+6,this.flags.AF=!0),(this.AL>159||this.flags.CF)&&(this.AL=this.AL+96,this.flags.CF=!0),this.calcParitySignZeroFlagB(this.AL);break;case 47:this.clockCount+=X.Das,((15&this.AL)>9||this.flags.AF)&&(this.AL=this.AL-6,this.flags.AF=!0),(this.AL>159||this.flags.CF)&&(this.AL=this.AL-96,this.flags.CF=!0),this.calcParitySignZeroFlagB(this.AL);break;case 72:this.clockCount+=X.DecReg,this.AX=this.decWord(this.AX);break;case 73:this.clockCount+=X.DecReg,this.CX=this.decWord(this.CX);break;case 74:this.clockCount+=X.DecReg,this.DX=this.decWord(this.DX);break;case 75:this.clockCount+=X.DecReg,this.BX=this.decWord(this.BX);break;case 76:this.clockCount+=X.DecReg,this.SP=this.decWord(this.SP);break;case 77:this.clockCount+=X.DecReg,this.BP=this.decWord(this.BP);break;case 78:this.clockCount+=X.DecReg,this.SI=this.decWord(this.SI);break;case 79:this.clockCount+=X.DecReg,this.DI=this.decWord(this.DI);break;case 200:{const e=this.readNextCodeWord();let t=this.readNextCodeByte();this.clockCount+=0==t?X.EnterLvl0:1==t?X.EnterLvl1:X.EnterInitial+X.EnterPerLvl*(t-1),t&=31,this.pushWord(this.BP);const r=this.SP;if(t>0){for(let e=1;e<t;e++)this.BP=this.BP-2&65535,this.pushWord(this.getMemWord(this.SS,this.BP));this.pushWord(r)}this.BP=r,this.SP=this.SP-e&65535;break}case 244:this.clockCount+=X.Hlt,this.halt=!0,this.IP=this.IP-1&65535;break;case 107:this.doWordOperation(u.Nm.RmToReg,((e,t)=>{t>32767&&(t-=65536);let r=this.readNextCodeByte();r>127&&(r-=256);const i=t*r,s=i>>16&65535;return this.flags.CF=this.flags.OF=0!=s&&65535!=s,this.flags.ZF=!1,65535&i}),X.ImulImmReg,X.ImulImmMem);break;case 105:this.doWordOperation(u.Nm.RmToReg,((e,t)=>{t>32767&&(t-=65536);let r=this.readNextCodeWord();r>32767&&(r-=65536);const i=t*r,s=i>>16&65535;return this.flags.CF=this.flags.OF=0!=s&&65535!=s,this.flags.ZF=!1,65535&i}),X.ImulImmReg16,X.ImulImmMem16);break;case 228:{this.clockCount+=X.InImm;const e=this.readNextCodeByte();this.AL=this.portProvider.in(e);break}case 229:{this.clockCount+=X.InImm;const e=this.readNextCodeByte();this.AX=this.portProvider.in(e);break}case 236:this.clockCount+=X.InDx,this.AL=this.portProvider.in(this.DX);break;case 237:this.clockCount+=X.InDx,this.AX=this.portProvider.in(this.DX);break;case 64:this.clockCount+=X.IncReg,this.AX=this.incWord(this.AX);break;case 65:this.clockCount+=X.IncReg,this.CX=this.incWord(this.CX);break;case 66:this.clockCount+=X.IncReg,this.DX=this.incWord(this.DX);break;case 67:this.clockCount+=X.IncReg,this.BX=this.incWord(this.BX);break;case 68:this.clockCount+=X.IncReg,this.SP=this.incWord(this.SP);break;case 69:this.clockCount+=X.IncReg,this.BP=this.incWord(this.BP);break;case 70:this.clockCount+=X.IncReg,this.SI=this.incWord(this.SI);break;case 71:this.clockCount+=X.IncReg,this.DI=this.incWord(this.DI);break;case 108:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Ins:X.InsRep,this.setMemByte(this.ES,this.DI,255&this.portProvider.in(this.DX)),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 109:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Ins:X.InsRep,this.setMemWord(this.ES,this.DI,this.portProvider.in(this.DX)),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 204:this.clockCount+=X.Int3,this.doSoftInterrupt(3);break;case 205:this.clockCount+=X.IntImm,this.doSoftInterrupt(this.readNextCodeByte());break;case 206:this.flags.OF?(this.clockCount+=X.Into,this.doSoftInterrupt(4)):this.clockCount+=X.IntoNoInt;break;case 207:this.clockCount+=X.Iret,this.IP=this.popWord(),this.CS=this.popWord(),this.flags.value=this.popWord(),this.blockInterrupt=!0;break;case 119:this.handleConditionalJump(!this.flags.CF&&!this.flags.ZF);break;case 115:this.handleConditionalJump(!this.flags.CF);break;case 114:this.handleConditionalJump(this.flags.CF);break;case 118:this.handleConditionalJump(this.flags.CF||this.flags.ZF);break;case 227:{let e=this.readNextCodeByte();e>127&&(e-=256),0==this.CX?(this.clockCount+=X.JcxzMet,this.IP=this.IP+e&65535):this.clockCount+=X.JcxzNotMet;break}case 116:this.handleConditionalJump(this.flags.ZF);break;case 127:this.handleConditionalJump(!this.flags.ZF&&this.flags.SF==this.flags.OF);break;case 125:this.handleConditionalJump(this.flags.SF==this.flags.OF);break;case 124:this.handleConditionalJump(this.flags.SF!=this.flags.OF);break;case 126:this.handleConditionalJump(this.flags.ZF||this.flags.SF!=this.flags.OF);break;case 235:{this.clockCount+=X.JmpShort;let e=this.readNextCodeByte();e>127&&(e-=256),this.IP=this.IP+e&65535;break}case 233:{this.clockCount+=X.JmpNear;let e=this.readNextCodeWord();e>32767&&(e-=65536),this.IP=this.IP+e&65535;break}case 234:this.clockCount+=X.JmpFar;{const e=this.readNextCodeWord(),t=this.readNextCodeWord();this.CS=t,this.IP=e}break;case 117:this.handleConditionalJump(!this.flags.ZF);break;case 113:this.handleConditionalJump(!this.flags.OF);break;case 121:this.handleConditionalJump(!this.flags.SF);break;case 123:this.handleConditionalJump(!this.flags.PF);break;case 112:this.handleConditionalJump(this.flags.OF);break;case 122:this.handleConditionalJump(this.flags.PF);break;case 120:this.handleConditionalJump(this.flags.SF);break;case 159:this.clockCount+=X.Lahf,this.AH=this.flags.value;break;case 197:this.DS=this.loadSeg();break;case 141:{this.clockCount+=X.Lea;const e=this.readNextCodeByte(),t=(192&e)>>6,r=(56&e)>>3,i=7&e;3==t&&this.handleIllegalOpcode();const s=this.calcEa(t,i);this.setRegWord(r,s.ea)}break;case 201:this.clockCount+=X.Leave,this.SP=this.BP,this.BP=this.popWord();break;case 196:this.ES=this.loadSeg();break;case 172:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Lods:X.LodsRep,this.AL=this.getMemByte(this.segOverride??this.DS,this.SI),this.flags.DF?this.SI=this.SI-1&65535:this.SI=this.SI+1&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 173:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Lods:X.LodsRep,this.AX=this.getMemWord(this.segOverride??this.DS,this.SI),this.flags.DF?this.SI=this.SI-2&65535:this.SI=this.SI+2&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 226:{let e=this.readNextCodeByte();e>127&&(e-=256),this.CX=this.CX-1&65535,this.CX>0?(this.clockCount+=X.Loop,this.IP=this.IP+e&65535):this.clockCount+=X.LoopFinished;break}case 225:{let e=this.readNextCodeByte();e>127&&(e-=256),this.CX=this.CX-1&65535,this.CX>0&&this.flags.ZF?(this.clockCount+=X.Loop,this.IP=this.IP+e&65535):this.clockCount+=X.LoopFinished;break}case 224:{let e=this.readNextCodeByte();e>127&&(e-=256),this.CX=this.CX-1&65535,this.CX>0&&!this.flags.ZF?(this.clockCount+=X.Loop,this.IP=this.IP+e&65535):this.clockCount+=X.LoopFinished;break}case 160:{this.clockCount+=X.MovAxMemoffs;const e=this.readNextCodeWord();this.AL=this.getMemByte(this.segOverride??this.DS,e);break}case 161:{this.clockCount+=X.MovAxMemoffs;const e=this.readNextCodeWord();this.AX=this.getMemWord(this.segOverride??this.DS,e)}break;case 162:{this.clockCount+=X.MovMemoffsAx;const e=this.readNextCodeWord();this.setMemByte(this.segOverride??this.DS,e,this.AL);break}case 163:{this.clockCount+=X.MovMemoffsAx;const e=this.readNextCodeWord();this.setMemWord(this.segOverride??this.DS,e,this.AX)}break;case 176:this.clockCount+=X.MovRegImm8,this.AL=this.readNextCodeByte();break;case 177:this.clockCount+=X.MovRegImm8,this.CL=this.readNextCodeByte();break;case 178:this.clockCount+=X.MovRegImm8,this.DL=this.readNextCodeByte();break;case 179:this.clockCount+=X.MovRegImm8,this.BL=this.readNextCodeByte();break;case 180:this.clockCount+=X.MovRegImm8,this.AH=this.readNextCodeByte();break;case 181:this.clockCount+=X.MovRegImm8,this.CH=this.readNextCodeByte();break;case 182:this.clockCount+=X.MovRegImm8,this.DH=this.readNextCodeByte();break;case 183:this.clockCount+=X.MovRegImm8,this.BH=this.readNextCodeByte();break;case 184:this.clockCount+=X.MovRegImm16,this.AX=this.readNextCodeWord();break;case 185:this.clockCount+=X.MovRegImm16,this.CX=this.readNextCodeWord();break;case 186:this.clockCount+=X.MovRegImm16,this.DX=this.readNextCodeWord();break;case 187:this.clockCount+=X.MovRegImm16,this.BX=this.readNextCodeWord();break;case 188:this.clockCount+=X.MovRegImm16,this.SP=this.readNextCodeWord();break;case 189:this.clockCount+=X.MovRegImm16,this.BP=this.readNextCodeWord();break;case 190:this.clockCount+=X.MovRegImm16,this.SI=this.readNextCodeWord();break;case 191:this.clockCount+=X.MovRegImm16,this.DI=this.readNextCodeWord();break;case 198:{this.clockCount+=X.MovRmImm8;const e=this.readAndDecodeAddressByte(),t=this.readNextCodeByte();this.setRmByte(e.mode,e.rm,e.rmAddr,t);break}case 199:{this.clockCount+=X.MovRmImm16;const e=this.readAndDecodeAddressByte(),t=this.readNextCodeWord();this.setRmWord(e.mode,e.rm,e.rmAddr,t);break}case 136:this.doByteOperationU(u.Nm.RegToRm,(e=>e),X.MovRmRegReg,X.MovRmRegMem);break;case 137:this.doWordOperationU(u.Nm.RegToRm,(e=>e),X.MovRmRegReg,X.MovRmRegMem);break;case 138:this.doByteOperationU(u.Nm.RmToReg,(e=>e),X.MovRegRmReg,X.MovRegRmMem);break;case 139:this.doWordOperationU(u.Nm.RmToReg,(e=>e),X.MovRegRmReg,X.MovRegRmMem);break;case 140:this.doSegRegWordOperation(u.Nm.RegToRm,(e=>e),X.MovRmSegReg,X.MovRmSegMem);break;case 142:this.doSegRegWordOperation(u.Nm.RmToReg,(e=>e),X.MovSegRmReg,X.MovSegRmMem);break;case 164:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?14:8,this.setMemByte(this.ES,this.DI,this.getMemByte(this.segOverride??this.DS,this.SI)),this.flags.DF?(this.SI=this.SI-1&65535,this.DI=this.DI-1&65535):(this.SI=this.SI+1&65535,this.DI=this.DI+1&65535),this.handleRepeat()),this.stringOperation=u.wA.None;break;case 165:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Movs:X.MovsRep,this.setMemWord(this.ES,this.DI,this.getMemWord(this.segOverride??this.DS,this.SI)),this.flags.DF?(this.SI=this.SI-2&65535,this.DI=this.DI-2&65535):(this.SI=this.SI+2&65535,this.DI=this.DI+2&65535),this.handleRepeat()),this.stringOperation=u.wA.None;break;case 144:this.clockCount+=X.Nop;break;case 8:this.doByteOperation(u.Nm.RegToRm,((e,t)=>{const r=255&(e|t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),r}),X.OrRmRegReg,X.OrRmRegMem);break;case 9:this.doWordOperation(u.Nm.RegToRm,((e,t)=>{const r=65535&(e|t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),r}),X.OrRmRegReg,X.OrRmRegMem);break;case 10:this.doByteOperation(u.Nm.RmToReg,((e,t)=>{const r=255&(e|t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),r}),X.OrRegRmReg,X.OrRegRmMem);break;case 11:this.doWordOperation(u.Nm.RmToReg,((e,t)=>{const r=65535&(e|t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),r}),X.OrRegRmReg,X.OrRegRmMem);break;case 12:{this.clockCount+=X.OrAlImm;const e=this.readNextCodeByte(),t=255&(this.AL|e);this.flags.CF=this.flags.OF=!1,this.AL=t,this.calcParitySignZeroFlagB(this.AL);break}case 13:this.clockCount+=X.OrAxImm;{const e=this.readNextCodeWord(),t=65535&(this.AX|e);this.flags.CF=this.flags.OF=!1,this.AX=t,this.calcParitySignZeroFlagW(this.AX)}break;case 230:{this.clockCount+=X.OutImm;const e=this.readNextCodeByte();this.portProvider.out(e,this.AL,!1);break}case 231:{this.clockCount+=X.OutImm;const e=this.readNextCodeByte();this.portProvider.out(e,this.AX,!0);break}case 238:this.clockCount+=X.OutDx,this.portProvider.out(this.DX,this.AL,!1);break;case 239:this.clockCount+=X.OutDx,this.portProvider.out(this.DX,this.AX,!0);break;case 110:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Outs:X.OutsRep,this.portProvider.out(this.DX,this.getMemByte(this.segOverride??this.DS,this.SI),!1),this.flags.DF?this.SI=this.SI-1&65535:this.SI=this.SI+1&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 111:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Outs:X.OutsRep,this.portProvider.out(this.DX,this.getMemWord(this.segOverride??this.DS,this.SI),!0),this.flags.DF?this.SI=this.SI-2&65535:this.SI=this.SI+2&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 88:this.clockCount+=X.PopReg,this.AX=this.popWord();break;case 89:this.clockCount+=X.PopReg,this.CX=this.popWord();break;case 90:this.clockCount+=X.PopReg,this.DX=this.popWord();break;case 91:this.clockCount+=X.PopReg,this.BX=this.popWord();break;case 92:this.clockCount+=X.PopReg,this.SP=this.popWord();break;case 93:this.clockCount+=X.PopReg,this.BP=this.popWord();break;case 94:this.clockCount+=X.PopReg,this.SI=this.popWord();break;case 95:this.clockCount+=X.PopReg,this.DI=this.popWord();break;case 7:this.clockCount+=X.PopSeg,this.ES=this.popWord();break;case 23:this.clockCount+=X.PopSeg,this.SS=this.popWord(),this.blockInterrupt=!0;break;case 31:this.clockCount+=X.PopSeg,this.DS=this.popWord();break;case 143:{this.clockCount+=X.PopMem;const e=this.readAndDecodeAddressByte();this.setRmWord(e.mode,e.rm,e.rmAddr,this.popWord());break}case 97:this.clockCount+=X.Popa,this.DI=this.popWord(),this.SI=this.popWord(),this.BP=this.popWord(),this.SP=this.SP+2&65535,this.BX=this.popWord(),this.DX=this.popWord(),this.CX=this.popWord(),this.AX=this.popWord();break;case 157:this.clockCount+=X.Popf,this.flags.value=this.popWord();break;case 80:this.clockCount+=X.PushReg,this.pushWord(this.AX);break;case 81:this.clockCount+=X.PushReg,this.pushWord(this.CX);break;case 82:this.clockCount+=X.PushReg,this.pushWord(this.DX);break;case 83:this.clockCount+=X.PushReg,this.pushWord(this.BX);break;case 84:this.clockCount+=X.PushReg,this.pushWord(this.SP-2&65535);break;case 85:this.clockCount+=X.PushReg,this.pushWord(this.BP);break;case 86:this.clockCount+=X.PushReg,this.pushWord(this.SI);break;case 87:this.clockCount+=X.PushReg,this.pushWord(this.DI);break;case 6:this.clockCount+=X.PushSeg,this.pushWord(this.ES);break;case 14:this.clockCount+=X.PushSeg,this.pushWord(this.CS);break;case 22:this.clockCount+=X.PushSeg,this.pushWord(this.SS);break;case 30:this.clockCount+=X.PushSeg,this.pushWord(this.DS);break;case 106:this.clockCount+=X.PushImm8,this.pushWord(this.readNextCodeByte());break;case 104:this.clockCount+=X.PushImm16,this.pushWord(this.readNextCodeWord());break;case 96:{this.clockCount+=X.Pusha;const e=this.SP;this.pushWord(this.AX),this.pushWord(this.CX),this.pushWord(this.DX),this.pushWord(this.BX),this.pushWord(e),this.pushWord(this.BP),this.pushWord(this.SI),this.pushWord(this.DI);break}case 156:this.clockCount+=X.Pushf,this.pushWord(this.flags.value);break;case 195:this.clockCount+=X.Ret,this.IP=this.popWord();break;case 194:{this.clockCount+=X.RetImm;const e=this.readNextCodeWord();this.IP=this.popWord(),this.SP=this.SP+e&65535;break}case 203:this.clockCount+=X.Retf,this.IP=this.popWord(),this.CS=this.popWord();break;case 202:{this.clockCount+=X.RetfImm;const e=this.readNextCodeWord();this.IP=this.popWord(),this.CS=this.popWord(),this.SP=this.SP+e&65535;break}case 158:this.clockCount+=X.Lahf,this.flags.value=65535&(65280&this.flags.value|this.AH);break;case 24:this.doByteOperation(u.Nm.RegToRm,((e,t)=>this.sbbByte(e,t)),X.SbbRmRegReg,X.SbbRmRegMem);break;case 25:this.doWordOperation(u.Nm.RegToRm,((e,t)=>this.sbbWord(e,t)),X.SbbRmRegReg,X.SbbRmRegMem);break;case 26:this.doByteOperation(u.Nm.RmToReg,((e,t)=>this.sbbByte(e,t)),X.SbbRegRmReg,X.SbbRegRmMem);break;case 27:this.doWordOperation(u.Nm.RmToReg,((e,t)=>this.sbbWord(e,t)),X.SbbRegRmReg,X.SbbRegRmMem);break;case 28:this.clockCount+=X.SbbAlImm,this.AL=this.sbbByte(this.AL,this.readNextCodeByte());break;case 29:this.clockCount+=X.SbbAxImm,this.AX=this.sbbWord(this.AX,this.readNextCodeWord());break;case 174:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=X.Scas,this.subByte(this.AL,this.getMemByte(this.ES,this.DI)),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeatCheckZeroFlag()),this.stringOperation=u.wA.None;break;case 175:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=X.Scas,this.subWord(this.AX,this.getMemWord(this.ES,this.DI)),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeatCheckZeroFlag()),this.stringOperation=u.wA.None;break;case 249:this.clockCount+=X.SetFlag,this.flags.CF=!0;break;case 253:this.clockCount+=X.SetFlag,this.flags.DF=!0;break;case 251:this.clockCount+=X.SetFlag,this.flags.IF=!0,this.blockInterrupt=!0;break;case 170:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Stos:X.StosRep,this.setMemByte(this.ES,this.DI,this.AL),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 171:this.stringOperation!=u.wA.None&&0==this.CX||(this.clockCount+=this.stringOperation==u.wA.None?X.Stos:X.StosRep,this.setMemWord(this.ES,this.DI,this.AX),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeat()),this.stringOperation=u.wA.None;break;case 40:this.doByteOperation(u.Nm.RegToRm,((e,t)=>this.subByte(e,t)),X.SubRmRegReg,X.SubRmRegMem);break;case 41:this.doWordOperation(u.Nm.RegToRm,((e,t)=>this.subWord(e,t)),X.SubRmRegReg,X.SubRmRegMem);break;case 42:this.doByteOperation(u.Nm.RmToReg,((e,t)=>this.subByte(e,t)),X.SubRegRmReg,X.SubRegRmMem);break;case 43:this.doWordOperation(u.Nm.RmToReg,((e,t)=>this.subWord(e,t)),X.SubRegRmReg,X.SubRegRmMem);break;case 44:{this.clockCount+=X.SubAlImm;const e=this.readNextCodeByte();this.AL=this.subByte(this.AL,e);break}case 45:this.clockCount+=X.SubAxImm,this.AX=this.subWord(this.AX,this.readNextCodeWord());break;case 132:this.doByteOperation(u.Nm.RegToRm,((e,t)=>{const r=e&t&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),0}),X.TestReg,X.TestMem,!1);break;case 133:this.doWordOperation(u.Nm.RegToRm,((e,t)=>{const r=e&t&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),0}),X.TestReg,X.TestMem,!1);break;case 168:{this.clockCount+=X.TestAlImm;const e=this.readNextCodeByte(),t=this.AL&e&255;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(t);break}case 169:this.clockCount+=X.TestAxImm;{const e=this.readNextCodeWord(),t=this.AX&e&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(t)}break;case 155:this.clockCount+=X.Wait;break;case 145:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.CX,this.CX=e}break;case 146:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.DX,this.DX=e}break;case 147:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.BX,this.BX=e}break;case 148:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.SP,this.SP=e}break;case 149:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.BP,this.BP=e}break;case 150:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.SI,this.SI=e}break;case 151:this.clockCount+=X.XchgReg;{const e=this.AX;this.AX=this.DI,this.DI=e}break;case 134:{const e=this.readAndDecodeAddressByte();this.clockCount+=3==e.mode?X.XchgRegRmReg:X.XchgRegRmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr);this.setRmByte(e.mode,e.rm,e.rmAddr,this.getRegByte(e.reg)),this.setRegByte(e.reg,t);break}case 135:{const e=this.readAndDecodeAddressByte();this.clockCount+=3==e.mode?X.XchgRegRmReg:X.XchgRegRmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr);this.setRmWord(e.mode,e.rm,e.rmAddr,this.getRegWord(e.reg)),this.setRegWord(e.reg,t)}break;case 215:this.clockCount+=X.Xlat,this.AL=this.getMemByte(this.segOverride??this.DS,this.BX+this.AL&65535);break;case 48:this.doByteOperation(u.Nm.RegToRm,((e,t)=>{const r=255&(e^t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),r}),X.XorRmRegReg,X.XorRmRegMem);break;case 49:this.doWordOperation(u.Nm.RegToRm,((e,t)=>{const r=65535&(e^t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),r}),X.XorRmRegReg,X.XorRmRegMem);break;case 50:this.doByteOperation(u.Nm.RmToReg,((e,t)=>{const r=255&(e^t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r),r}),X.XorRegRmReg,X.XorRegRmMem);break;case 51:this.doWordOperation(u.Nm.RmToReg,((e,t)=>{const r=65535&(e^t);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r),r}),X.XorRegRmReg,X.XorRegRmMem);break;case 52:{this.clockCount+=X.XorAlImm;const e=this.readNextCodeByte(),t=255&(this.AL^e);this.flags.CF=this.flags.OF=!1,this.AL=t,this.calcParitySignZeroFlagB(this.AL);break}case 53:{this.clockCount+=X.XorAxImm;const e=this.readNextCodeWord(),t=65535&(this.AX^e);this.flags.CF=this.flags.OF=!1,this.AX=t,this.calcParitySignZeroFlagW(this.AX)}break;case 254:this.handleOpcodeFeFf(!1);break;case 255:this.handleOpcodeFeFf(!0);break;case 128:this.handleOpcode80();break;case 129:this.handleOpcode81();break;case 131:this.handleOpcode83();break;case 246:this.handleOpcodeF6();break;case 247:this.handleOpcodeF7();break;case 208:this.handleOpcodeD0();break;case 209:this.handleOpcodeD1();break;case 210:this.handleOpcodeD2();break;case 211:this.handleOpcodeD3();break;case 192:this.handleOpcodeC0();break;case 193:this.handleOpcodeC1();break;case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:this.handleFpuInstruction(t);break;default:this.handleIllegalOpcode()}}while(e);this.segOverride=null,this.blockInterrupt?this.blockInterrupt=!1:(this.flags.TF&&this.doSoftInterrupt(1),null==this.softInterrupt&&null==this.hardInterrupt||this.processInterrupt()),0==(15&this.instCount)&&this.handleCpuEvents(),this.instCount++}}catch(e){if(!(e instanceof u.K4))throw e;this.segOverride=null,this.doSoftInterrupt(e.exCode),this.blockInterrupt?this.blockInterrupt=!1:this.processInterrupt(),this.instCount++}}while(this.clockCount<t)}handleIllegalOpcode(){}handleFpuInstruction(e){this.clockCount+=X.FpuInstruction,this.readNextCodeByte()<192&&(this.IP=this.IP-1&65535,this.readAndDecodeAddressByte())}handleCpuEvents(){for(let e=this.cpuEvents.length-1;e>=0;e--){const t=this.cpuEvents[e];t.clockCount<=this.clockCount&&(t.action(),this.cpuEvents.splice(e,1))}}handleConditionalJump(e){if(e){let e=this.readNextCodeByte();e>127&&(e-=256),this.clockCount+=X.JumpCondMet,this.IP=this.IP+e&65535}else this.IP=this.IP+1&65535,this.clockCount+=X.JumpCondNotMet}handleRepeat(){this.stringOperation!=u.wA.None&&(this.CX=this.CX-1&65535,0!=this.CX&&(this.IP=this.repeatIp))}handleRepeatCheckZeroFlag(){this.stringOperation!=u.wA.None&&(this.CX=this.CX-1&65535,0!=this.CX&&(this.stringOperation==u.wA.RepZ&&this.flags.ZF||this.stringOperation==u.wA.RepNz&&!this.flags.ZF)&&(this.IP=this.repeatIp))}processInterrupt(){let e;if(null!=this.softInterrupt)e=this.softInterrupt,this.softInterrupt=null,this.pushWord(this.flags.value);else{if(null==this.hardInterrupt||!this.flags.IF)return;this.clockCount+=X.HardInterrupt,this.halt&&(this.halt=!1,this.IP=this.IP+1&65535),e=this.hardInterrupt,this.hardInterrupt=null,this.pushWord(this.flags.value)}this.flags.IF=!1,this.flags.TF=!1,this.pushWord(this.CS),this.pushWord(this.IP),this.IP=this.memoryProvider.peekW(4*e),this.CS=this.memoryProvider.peekW(4*e+2)}handleOpcodeFeFf(e){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:this.clockCount+=3==t.mode?X.IncReg:X.IncMem,e?this.setRmWord(t.mode,t.rm,t.rmAddr,this.incWord(this.getRmWord(t.mode,t.rm,t.rmAddr))):this.setRmByte(t.mode,t.rm,t.rmAddr,this.incByte(this.getRmByte(t.mode,t.rm,t.rmAddr)));break;case 1:this.clockCount+=3==t.mode?X.DecReg:X.DecMem,e?this.setRmWord(t.mode,t.rm,t.rmAddr,this.decWord(this.getRmWord(t.mode,t.rm,t.rmAddr))):this.setRmByte(t.mode,t.rm,t.rmAddr,this.decByte(this.getRmByte(t.mode,t.rm,t.rmAddr)));break;case 2:this.clockCount+=3==t.mode?X.CallNearReg:X.CallNearMem,this.pushWord(this.IP),this.IP=this.getRmWord(t.mode,t.rm,t.rmAddr);break;case 3:{this.clockCount+=X.CallFarRm,3==t.mode&&this.handleIllegalOpcode(),this.pushWord(this.CS),this.pushWord(this.IP);const e=this.memoryProvider.peekW(t.rmAddr);t.rmAddr+=2;const r=this.memoryProvider.peekW(t.rmAddr);this.CS=r,this.IP=e}break;case 4:this.clockCount+=3==t.mode?X.JmpNearReg:X.JmpNearMem,this.IP=this.getRmWord(t.mode,t.rm,t.rmAddr);break;case 5:{this.clockCount+=X.JmpFarRm,3==t.mode&&this.handleIllegalOpcode();const e=this.memoryProvider.peekW(t.rmAddr),r=this.memoryProvider.peekW(t.rmAddr+2);this.CS=r,this.IP=e}break;case 6:this.clockCount+=X.PushRm,this.pushWord(this.getRmWord(t.mode,t.rm,t.rmAddr));break;default:this.handleIllegalOpcode()}}handleOpcode80(){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:{this.clockCount+=3==e.mode?X.AddRmImmReg:X.AddRmImmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=this.addByte(t,r);this.setRmByte(e.mode,e.rm,e.rmAddr,i);break}case 1:{this.clockCount+=3==e.mode?X.OrRmImmReg:X.OrRmImmMem;const t=255&(this.getRmByte(e.mode,e.rm,e.rmAddr)|this.readNextCodeByte());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(t),this.setRmByte(e.mode,e.rm,e.rmAddr,t);break}case 2:{this.clockCount+=3==e.mode?X.AdcRmImmReg:X.AdcRmImmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=this.adcByte(t,r);this.setRmByte(e.mode,e.rm,e.rmAddr,i);break}case 3:{this.clockCount+=3==e.mode?X.SbbRmImmReg:X.SbbRmImmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=this.sbbByte(t,r);this.setRmByte(e.mode,e.rm,e.rmAddr,i);break}case 4:{this.clockCount+=3==e.mode?X.AndRmImmReg:X.AndRmImmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr)&this.readNextCodeByte()&255;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(t),this.setRmByte(e.mode,e.rm,e.rmAddr,t);break}case 5:{this.clockCount+=3==e.mode?X.SubRmImmReg:X.SubRmImmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=this.subByte(t,r);this.setRmByte(e.mode,e.rm,e.rmAddr,i);break}case 6:{this.clockCount+=3==e.mode?X.XorRmImmReg:X.XorRmImmMem;const t=255&(this.getRmByte(e.mode,e.rm,e.rmAddr)^this.readNextCodeByte());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(t),this.setRmByte(e.mode,e.rm,e.rmAddr,t);break}case 7:{this.clockCount+=3==e.mode?X.CmpRmImmReg:X.CmpRmImmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte();this.subByte(t,r);break}default:this.handleIllegalOpcode()}}handleOpcode81(){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:{this.clockCount+=3==e.mode?X.AddRmImmReg:X.AddRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeWord(),i=this.addWord(t,r);this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 1:{this.clockCount+=3==e.mode?X.OrRmImmReg:X.OrRmImmMem;const t=65535&(this.getRmWord(e.mode,e.rm,e.rmAddr)|this.readNextCodeWord());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(t),this.setRmWord(e.mode,e.rm,e.rmAddr,t)}break;case 2:{this.clockCount+=3==e.mode?X.AdcRmImmReg:X.AdcRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeWord(),i=this.adcWord(t,r);this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 3:{this.clockCount+=3==e.mode?X.SbbRmImmReg:X.SbbRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeWord(),i=this.sbbWord(t,r);this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 4:{this.clockCount+=3==e.mode?X.AndRmImmReg:X.AndRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr)&this.readNextCodeWord()&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(t),this.setRmWord(e.mode,e.rm,e.rmAddr,t);break}case 5:{this.clockCount+=3==e.mode?X.SubRmImmReg:X.SubRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeWord(),i=this.subWord(t,r);this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 6:{this.clockCount+=3==e.mode?X.XorRmImmReg:X.XorRmImmMem;const t=65535&(this.getRmWord(e.mode,e.rm,e.rmAddr)^this.readNextCodeWord());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(t),this.setRmWord(e.mode,e.rm,e.rmAddr,t);break}case 7:{this.clockCount+=3==e.mode?X.CmpRmImmReg:X.CmpRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeWord();this.subWord(t,r);break}default:this.handleIllegalOpcode()}}handleOpcode83(){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:{this.clockCount+=3==e.mode?X.AddRmImmReg:X.AddRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=r>127?r+65280:r,s=this.addWord(t,i);this.setRmWord(e.mode,e.rm,e.rmAddr,s);break}case 1:{this.clockCount+=3==e.mode?X.OrRmImmReg:X.OrRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=65535&(t|(r>127?r+65280:r));this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 2:{this.clockCount+=3==e.mode?X.AdcRmImmReg:X.AdcRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=r>127?r+65280:r,s=this.adcWord(t,i);this.setRmWord(e.mode,e.rm,e.rmAddr,s);break}case 3:{this.clockCount+=3==e.mode?X.SbbRmImmReg:X.SbbRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=r>127?r+65280:r,s=this.sbbWord(t,i);this.setRmWord(e.mode,e.rm,e.rmAddr,s);break}case 4:{this.clockCount+=3==e.mode?X.AndRmImmReg:X.AndRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=t&(r>127?r+65280:r)&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 5:{this.clockCount+=3==e.mode?X.SubRmImmReg:X.SubRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=r>127?r+65280:r,s=this.subWord(t,i);this.setRmWord(e.mode,e.rm,e.rmAddr,s);break}case 6:{this.clockCount+=3==e.mode?X.XorRmImmReg:X.XorRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=65535&(t^(r>127?r+65280:r));this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(e.mode,e.rm,e.rmAddr,i);break}case 7:{this.clockCount+=3==e.mode?X.CmpRmImmReg:X.CmpRmImmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.readNextCodeByte(),i=r>127?r+65280:r;this.subWord(t,i);break}default:this.handleIllegalOpcode()}}handleOpcodeF6(){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:{this.clockCount+=3==e.mode?X.TestRmImmReg:X.TestRmImmMem;const t=this.readNextCodeByte(),r=this.getRmByte(e.mode,e.rm,e.rmAddr)&t;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(r);break}case 2:{this.clockCount+=3==e.mode?X.NotRmReg:X.NotRmMem;let t=this.getRmByte(e.mode,e.rm,e.rmAddr);t=255&~t,this.setRmByte(e.mode,e.rm,e.rmAddr,t);break}case 3:{this.clockCount+=3==e.mode?X.NegRmReg:X.NegRmMem;const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=this.subByte(0,t);this.setRmByte(e.mode,e.rm,e.rmAddr,r);break}case 4:{this.clockCount+=3==e.mode?X.MulReg:X.MulMem;const t=this.AL*this.getRmByte(e.mode,e.rm,e.rmAddr);this.flags.CF=this.flags.OF=t>255,this.flags.ZF=!1,this.AX=65535&t;break}case 5:{this.clockCount+=3==e.mode?X.ImulReg:X.ImulMem;let t=this.AL;t>127&&(t-=256);let r=this.getRmByte(e.mode,e.rm,e.rmAddr);r>127&&(r-=256);const i=t*r;this.AX=65535&i,this.flags.CF=this.flags.OF=0!=this.AH&&255!=this.AH,this.flags.ZF=!1;break}case 6:{this.clockCount+=3==e.mode?X.DivReg:X.DivMem;const t=this.AX,r=this.getRmByte(e.mode,e.rm,e.rmAddr);if(0==r)this.doSoftInterrupt(0);else{const e=Math.trunc(t/r);e>255?this.doSoftInterrupt(0):(this.AL=e,this.AH=t%r)}break}case 7:{this.clockCount+=3==e.mode?X.IdivReg:X.IdivMem;const t=this.AX>32767?this.AX-65536:this.AX;let r=this.getRmByte(e.mode,e.rm,e.rmAddr);if(r>127&&(r-=256),0==r)this.doSoftInterrupt(0);else{const e=Math.trunc(t/r);e>=128||e<-128?this.doSoftInterrupt(0):(this.AL=e,this.AH=t%r)}break}default:this.handleIllegalOpcode()}}handleOpcodeF7(){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:this.clockCount+=3==e.mode?X.TestRmImmReg:X.TestRmImmMem;{const t=this.readNextCodeWord(),r=this.getRmWord(e.mode,e.rm,e.rmAddr)&t;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(r)}break;case 2:{this.clockCount+=3==e.mode?X.NotRmReg:X.NotRmMem;let t=this.getRmWord(e.mode,e.rm,e.rmAddr);t=65535&~t,this.setRmWord(e.mode,e.rm,e.rmAddr,t)}break;case 3:{this.clockCount+=3==e.mode?X.NegRmReg:X.NegRmMem;const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=this.subWord(0,t);this.setRmWord(e.mode,e.rm,e.rmAddr,r)}break;case 4:{this.clockCount+=3==e.mode?X.MulReg16:X.MulMem16;const t=this.AX*this.getRmWord(e.mode,e.rm,e.rmAddr);this.flags.CF=this.flags.OF=t>65535,this.flags.ZF=!1,this.AX=65535&t,this.DX=t>>16&65535}break;case 5:{this.clockCount+=3==e.mode?X.ImulReg16:X.ImulMem16;const t=this.AX>32767?this.AX-65536:this.AX;let r=this.getRmWord(e.mode,e.rm,e.rmAddr);r>32767&&(r-=65536);const i=t*r;this.AX=65535&i,this.DX=i>>16&65535,this.flags.CF=this.flags.OF=0!=this.DX&&65535!=this.DX,this.flags.ZF=!1}break;case 6:{this.clockCount+=3==e.mode?X.DivReg16:X.DivMem16;const t=(this.DX<<16)+this.AX,r=this.getRmWord(e.mode,e.rm,e.rmAddr);if(0==r)this.doSoftInterrupt(0);else{const e=Math.trunc(t/r);e>65535?this.doSoftInterrupt(0):(this.AX=65535&e,this.DX=t%r&65535)}}break;case 7:{this.clockCount+=3==e.mode?X.IdivReg16:X.IdivMem16;const t=(this.DX<<16)+this.AX&4294967295;let r=this.getRmWord(e.mode,e.rm,e.rmAddr);if(r>32767&&(r-=65536),0==r)this.softInterrupt=0;else{const e=Math.trunc(t/r);e>=32768||e<-32768?this.doSoftInterrupt(0):(this.AX=65535&e,this.DX=t%r&65535)}}break;default:this.handleIllegalOpcode()}}handleOpcodeD0(){const e=this.readAndDecodeAddressByte();switch(this.clockCount+=3==e.mode?X.ShiftRmReg:X.ShiftRmMem,e.reg){case 0:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=255&(t<<1|t>>7);this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(128&t)!=(128&r),this.flags.CF=(128&t)>0;break}case 1:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=255&(t>>1|t<<7);this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(128&t)!=(128&r),this.flags.CF=(1&t)>0;break}case 2:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=(t<<1)+(this.flags.CF?1:0)&255;this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(128&t)!=(128&r),this.flags.CF=(128&t)>0;break}case 3:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=(t>>1)+(this.flags.CF?128:0)&255;this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(128&t)!=(128&r),this.flags.CF=(1&t)>0;break}case 4:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=t<<1&255;this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.calcParitySignZeroFlagB(r),this.flags.OF=(128&t)!=(128&r),this.flags.CF=(128&t)>0;break}case 5:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=t>>1&255;this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.calcParitySignZeroFlagB(r),this.flags.OF=(128&t)!=(128&r),this.flags.CF=(1&t)>0;break}case 7:{const t=this.getRmByte(e.mode,e.rm,e.rmAddr),r=255&(t>>1|128&t);this.setRmByte(e.mode,e.rm,e.rmAddr,r),this.calcParitySignZeroFlagB(r),this.flags.OF=!1,this.flags.CF=(1&t)>0;break}default:this.handleIllegalOpcode()}}handleOpcodeD1(){const e=this.readAndDecodeAddressByte();switch(this.clockCount+=3==e.mode?X.ShiftRmReg:X.ShiftRmMem,e.reg){case 0:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=65535&(t<<1|t>>15);this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(32768&t)!=(32768&r),this.flags.CF=(32768&t)>0;break}case 1:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=65535&(t>>1|t<<15);this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(32768&t)!=(32768&r),this.flags.CF=(1&t)>0;break}case 2:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=(t<<1)+(this.flags.CF?1:0)&65535;this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(32768&t)!=(32768&r),this.flags.CF=(32768&t)>0;break}case 3:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=(t>>1)+(this.flags.CF?32768:0)&65535;this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.flags.OF=(32768&t)!=(32768&r),this.flags.CF=(1&t)>0;break}case 4:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=t<<1&65535;this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.calcParitySignZeroFlagW(r),this.flags.OF=(32768&t)!=(32768&r),this.flags.CF=(32768&t)>0;break}case 5:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=t>>1&65535;this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.calcParitySignZeroFlagW(r),this.flags.OF=(32768&t)!=(32768&r),this.flags.CF=(1&t)>0;break}case 7:{const t=this.getRmWord(e.mode,e.rm,e.rmAddr),r=65535&(t>>1|32768&t);this.setRmWord(e.mode,e.rm,e.rmAddr,r),this.calcParitySignZeroFlagW(r),this.flags.OF=!1,this.flags.CF=(1&t)>0;break}default:this.handleIllegalOpcode()}}handleOpcodeC0(){const e=this.readAndDecodeAddressByte(),t=31&this.readNextCodeByte();switch(this.clockCount+=3==e.mode?X.ShiftRmImmReg+t:X.ShiftRmImmMem+t,e.reg){case 0:this.rolByte(e.mode,e.rm,e.rmAddr,t);break;case 1:this.rorByte(e.mode,e.rm,e.rmAddr,t);break;case 2:this.rclByte(e.mode,e.rm,e.rmAddr,t);break;case 3:this.rcrByte(e.mode,e.rm,e.rmAddr,t);break;case 4:this.shlByte(e.mode,e.rm,e.rmAddr,t);break;case 5:this.shrByte(e.mode,e.rm,e.rmAddr,t);break;case 7:this.sarByte(e.mode,e.rm,e.rmAddr,t);break;default:this.handleIllegalOpcode()}}handleOpcodeC1(){const e=this.readAndDecodeAddressByte(),t=this.readNextCodeByte();switch(this.clockCount+=3==e.mode?X.ShiftRmImmReg+t:X.ShiftRmImmMem+t,e.reg){case 0:this.rolWord(e.mode,e.rm,e.rmAddr,t);break;case 1:this.rorWord(e.mode,e.rm,e.rmAddr,t);break;case 2:this.rclWord(e.mode,e.rm,e.rmAddr,t);break;case 3:this.rcrWord(e.mode,e.rm,e.rmAddr,t);break;case 4:this.shlWord(e.mode,e.rm,e.rmAddr,t);break;case 5:this.shrWord(e.mode,e.rm,e.rmAddr,t);break;case 7:this.sarWord(e.mode,e.rm,e.rmAddr,t);break;default:this.handleIllegalOpcode()}}handleOpcodeD2(){const e=this.readAndDecodeAddressByte();switch(this.clockCount+=3==e.mode?X.ShiftRmClReg+this.CL:X.ShiftRmClMem+this.CL,e.reg){case 0:this.rolByte(e.mode,e.rm,e.rmAddr,this.CL);break;case 1:this.rorByte(e.mode,e.rm,e.rmAddr,this.CL);break;case 2:this.rclByte(e.mode,e.rm,e.rmAddr,this.CL);break;case 3:this.rcrByte(e.mode,e.rm,e.rmAddr,this.CL);break;case 4:this.shlByte(e.mode,e.rm,e.rmAddr,this.CL);break;case 5:this.shrByte(e.mode,e.rm,e.rmAddr,this.CL);break;case 7:this.sarByte(e.mode,e.rm,e.rmAddr,this.CL);break;default:this.handleIllegalOpcode()}}handleOpcodeD3(){const e=this.readAndDecodeAddressByte();switch(this.clockCount+=3==e.mode?X.ShiftRmClReg+this.CL:X.ShiftRmClMem+this.CL,e.reg){case 0:this.rolWord(e.mode,e.rm,e.rmAddr,this.CL);break;case 1:this.rorWord(e.mode,e.rm,e.rmAddr,this.CL);break;case 2:this.rclWord(e.mode,e.rm,e.rmAddr,this.CL);break;case 3:this.rcrWord(e.mode,e.rm,e.rmAddr,this.CL);break;case 4:this.shlWord(e.mode,e.rm,e.rmAddr,this.CL);break;case 5:this.shrWord(e.mode,e.rm,e.rmAddr,this.CL);break;case 7:this.sarWord(e.mode,e.rm,e.rmAddr,this.CL);break;default:this.handleIllegalOpcode()}}incByte(e){return e=e+1&255,this.calcParitySignZeroFlagB(e),this.flags.OF=128==e,this.flags.AF=0==(15&e),e}incWord(e){return e=e+1&65535,this.calcParitySignZeroFlagW(e),this.flags.OF=32768==e,this.flags.AF=0==(15&e),e}decWord(e){return e=e-1&65535,this.calcParitySignZeroFlagW(e),this.flags.OF=32767==e,this.flags.AF=15==(15&e),e}decByte(e){return e=e-1&255,this.calcParitySignZeroFlagB(e),this.flags.OF=127==e,this.flags.AF=15==(15&e),e}rolByte(e,t,r,i){const s=7&i,a=this.getRmByte(e,t,r),n=255&(a<<s|a>>8-s);this.setRmByte(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(128&a)!=(128&n)),this.flags.CF=(a&1<<8-s)>0)}rorByte(e,t,r,i){const s=7&i,a=this.getRmByte(e,t,r),n=255&(a>>s|a<<8-s);this.setRmByte(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(128&a)!=(128&n)),this.flags.CF=(a&1<<s-1)>0)}rclByte(e,t,r,i){const s=(31&i)%9,a=this.getRmByte(e,t,r),n=255&(a<<s|(s>0&&this.flags.CF?1<<s-1:0)|a>>9-s);this.setRmByte(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(128&a)!=(128&n)),this.flags.CF=(a&1<<8-s)>0)}rcrByte(e,t,r,i){const s=(31&i)%9,a=this.getRmByte(e,t,r),n=255&(a>>s|(s>0&&this.flags.CF?1<<8-s:0)|a<<9-s);this.setRmByte(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(128&a)!=(128&n)),this.flags.CF=(a&1<<s-1)>0)}shlByte(e,t,r,i){const s=31&i,a=this.getRmByte(e,t,r),n=a<<s&255;this.setRmByte(e,t,r,n),this.calcParitySignZeroFlagB(n),1==s&&(this.flags.OF=(128&a)!=(128&n)),this.flags.CF=s<=8&&(a&1<<8-s)>0}shrByte(e,t,r,i){const s=31&i,a=this.getRmByte(e,t,r),n=a>>s&255;this.setRmByte(e,t,r,n),this.calcParitySignZeroFlagB(n),1==s&&(this.flags.OF=(128&a)!=(128&n)),this.flags.CF=s>0&&(a&1<<s-1)>0}sarByte(e,t,r,i){const s=31&i,a=this.getRmByte(e,t,r),n=255&(a>>s|((128&a)>0?255<<8-s:0));this.setRmByte(e,t,r,n),this.calcParitySignZeroFlagB(n),this.flags.OF=!1,this.flags.CF=s>0&&(a&1<<s-1)>0}rolWord(e,t,r,i){const s=15&i,a=this.getRmWord(e,t,r),n=65535&(a<<s|a>>16-s);this.setRmWord(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(32768&a)!=(32768&n)),this.flags.CF=(a&1<<16-s)>0)}rorWord(e,t,r,i){const s=15&i,a=this.getRmWord(e,t,r),n=65535&(a>>s|a<<16-s);this.setRmWord(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(32768&a)!=(32768&n)),this.flags.CF=(a&1<<s-1)>0)}rclWord(e,t,r,i){const s=(31&i)%17,a=this.getRmWord(e,t,r),n=65535&(a<<s|(s>0&&this.flags.CF?1<<s-1:0)|a>>17-s);this.setRmWord(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(32768&a)!=(32768&n)),this.flags.CF=(a&1<<16-s)>0)}rcrWord(e,t,r,i){const s=(31&i)%17,a=this.getRmWord(e,t,r),n=65535&(a>>s|(s>0&&this.flags.CF?1<<16-s:0)|a<<17-s);this.setRmWord(e,t,r,n),s>0&&(1==s&&(this.flags.OF=(32768&a)!=(32768&n)),this.flags.CF=(a&1<<s-1)>0)}shlWord(e,t,r,i){const s=31&i,a=this.getRmWord(e,t,r),n=a<<s&65535;this.setRmWord(e,t,r,n),this.calcParitySignZeroFlagW(n),1==s&&(this.flags.OF=(32768&a)!=(32768&n)),this.flags.CF=s<=16&&(a&1<<16-s)>0}shrWord(e,t,r,i){const s=31&i,a=this.getRmWord(e,t,r),n=a>>s&65535;this.setRmWord(e,t,r,n),this.calcParitySignZeroFlagW(n),1==s&&(this.flags.OF=(32768&a)!=(32768&n)),this.flags.CF=s>0&&(a&1<<s-1)>0}sarWord(e,t,r,i){const s=31&i,a=this.getRmWord(e,t,r),n=65535&(a>>s|((32768&a)>0?65535<<16-s:0));this.setRmWord(e,t,r,n),this.calcParitySignZeroFlagW(n),this.flags.OF=!1,this.flags.CF=s>0&&(a&1<<s-1)>0}subByte(e,t){let r=e-t;const i=(e>127?e-256:e)-(t>127?t-256:t);return this.flags.CF=r<0,this.flags.OF=i>127||i<-128,this.flags.AF=(15&e)-(15&t)<0,r&=255,this.calcParitySignZeroFlagB(r),r}subWord(e,t){let r=e-t;const i=(e>32767?e-65536:e)-(t>32767?t-65536:t);return this.flags.CF=r<0,this.flags.OF=i>32767||i<-32768,this.flags.AF=(15&e)-(15&t)<0,r&=65535,this.calcParitySignZeroFlagW(r),r}sbbByte(e,t){const r=this.flags.CF?1:0;let i=e-t-r;const s=(e>127?e-256:e)-(t>127?t-256:t)-r;return this.flags.CF=i<0,this.flags.OF=s>127||s<-128,this.flags.AF=(15&e)-(15&t)-r<0,i&=255,this.calcParitySignZeroFlagB(i),i}sbbWord(e,t){const r=this.flags.CF?1:0;let i=e-t-r;const s=(e>32767?e-65536:e)-(t>32767?t-65536:t)-r;return this.flags.CF=i<0,this.flags.OF=s>32767||s<-32768,this.flags.AF=(15&e)-(15&t)-r<0,i&=65535,this.calcParitySignZeroFlagW(i),i}addByte(e,t){let r=e+t;const i=(e>127?e-256:e)-(t>127?t-256:t);return this.flags.CF=r>255,this.flags.OF=i>127||i<-128,this.flags.AF=(15&e)+(15&t)>15,r&=255,this.calcParitySignZeroFlagB(r),r}addWord(e,t){let r=e+t;const i=(e>32767?e-65536:e)-(t>32767?t-65536:t);return this.flags.CF=r>65535,this.flags.OF=i>32767||i<-32768,this.flags.AF=(15&e)+(15&t)>15,r&=65535,this.calcParitySignZeroFlagW(r),r}adcByte(e,t){const r=this.flags.CF?1:0;let i=e+t+r;const s=(e>127?e-256:e)-(t>127?t-256:t)+r;return this.flags.CF=i>255,this.flags.OF=s>127||s<-128,this.flags.AF=(15&e)+(15&t)+r>15,i&=255,this.calcParitySignZeroFlagB(i),i}adcWord(e,t){const r=this.flags.CF?1:0;let i=e+t+r;const s=(e>32767?e-65536:e)-(t>32767?t-65536:t)+r;return this.flags.CF=i>65535,this.flags.OF=s>32767||s<-32768,this.flags.AF=(15&e)+(15&t)+r>15,i&=65535,this.calcParitySignZeroFlagW(i),i}loadSeg(){this.clockCount+=X.Lds;const e=this.readAndDecodeAddressByte();3==e.mode&&this.handleIllegalOpcode();const t=this.memoryProvider.peekW(e.rmAddr);return this.setRegWord(e.reg,t),e.rmAddr+=2,this.memoryProvider.peekW(e.rmAddr)}pushWord(e){this.SP=this.SP-2&65535,this.memoryProvider.pokeW(this.genAddr(this.SS,this.SP),e)}popWord(){const e=this.memoryProvider.peekW(this.genAddr(this.SS,this.SP));return this.SP=this.SP+2&65535,e}calcParitySignZeroFlagB(e){e&=255,this.flags.PF=this.parities[e],this.flags.SF=(128&e)>0,this.flags.ZF=0==e}calcParitySignZeroFlagW(e){e&=65535,this.flags.PF=this.parities[255&e],this.flags.SF=(32768&e)>0,this.flags.ZF=0==e}readAndDecodeAddressByte(){const e=new T,t=this.readNextCodeByte();return e.mode=(192&t)>>6,e.reg=(56&t)>>3,e.rm=7&t,3==e.mode?e.rmAddr=0:e.rmAddr=this.calcRmAddr(e.mode,e.rm),e}doByteOperationU(e,t,r,i,s=!0){const a=this.readAndDecodeAddressByte();if(this.clockCount+=3==a.mode?r:i,e==u.Nm.RegToRm){const e=t(this.getRegByte(a.reg));s&&this.setRmByte(a.mode,a.rm,a.rmAddr,e)}else{const e=t(this.getRmByte(a.mode,a.rm,a.rmAddr));s&&this.setRegByte(a.reg,e)}}doByteOperation(e,t,r,i,s=!0){const a=this.readAndDecodeAddressByte();if(this.clockCount+=3==a.mode?r:i,e==u.Nm.RegToRm){const e=t(this.getRmByte(a.mode,a.rm,a.rmAddr),this.getRegByte(a.reg));s&&this.setRmByte(a.mode,a.rm,a.rmAddr,e)}else{const e=t(this.getRegByte(a.reg),this.getRmByte(a.mode,a.rm,a.rmAddr));s&&this.setRegByte(a.reg,e)}}doWordOperationU(e,t,r,i,s=!0){const a=this.readAndDecodeAddressByte();if(this.clockCount+=3==a.mode?r:i,e==u.Nm.RegToRm){const e=t(this.getRegWord(a.reg));s&&this.setRmWord(a.mode,a.rm,a.rmAddr,e)}else{const e=t(this.getRmWord(a.mode,a.rm,a.rmAddr));s&&this.setRegWord(a.reg,e)}}doSegRegWordOperation(e,t,r,i,s=!0){const a=this.readAndDecodeAddressByte();if(this.clockCount+=3==a.mode?r:i,e==u.Nm.RegToRm){const e=t(this.getSegReg(a.reg));s&&this.setRmWord(a.mode,a.rm,a.rmAddr,e)}else{const e=t(this.getRmWord(a.mode,a.rm,a.rmAddr));s&&this.setSegReg(a.reg,e)}}doWordOperation(e,t,r,i,s=!0){const a=this.readAndDecodeAddressByte();if(this.clockCount+=3==a.mode?r:i,e==u.Nm.RegToRm){const e=t(this.getRmWord(a.mode,a.rm,a.rmAddr),this.getRegWord(a.reg));s&&this.setRmWord(a.mode,a.rm,a.rmAddr,e)}else{const e=t(this.getRegWord(a.reg),this.getRmWord(a.mode,a.rm,a.rmAddr));s&&this.setRegWord(a.reg,e)}}calcRmAddr(e,t){const r=this.calcEa(e,t);return this.genAddr(this.segOverride??r.defaultSeg,r.ea)}calcEa(e,t){const r=new H;switch(e){case 0:switch(t){case 0:return r.defaultSeg=this.DS,r.ea=this.BX+this.SI&65535,r;case 1:return r.defaultSeg=this.DS,r.ea=this.BX+this.DI&65535,r;case 2:return r.defaultSeg=this.SS,r.ea=this.BP+this.SI&65535,r;case 3:return r.defaultSeg=this.SS,r.ea=this.BP+this.DI&65535,r;case 4:return r.defaultSeg=this.DS,r.ea=this.SI,r;case 5:return r.defaultSeg=this.DS,r.ea=this.DI,r;case 6:return r.defaultSeg=this.DS,r.ea=this.readNextCodeWord(),r;case 7:return r.defaultSeg=this.DS,r.ea=this.BX,r}break;case 1:{let e=this.readNextCodeByte();switch(e>127&&(e-=256),t){case 0:return r.defaultSeg=this.DS,r.ea=this.BX+this.SI+e&65535,r;case 1:return r.defaultSeg=this.DS,r.ea=this.BX+this.DI+e&65535,r;case 2:return r.defaultSeg=this.SS,r.ea=this.BP+this.SI+e&65535,r;case 3:return r.defaultSeg=this.SS,r.ea=this.BP+this.DI+e&65535,r;case 4:return r.defaultSeg=this.DS,r.ea=this.SI+e&65535,r;case 5:return r.defaultSeg=this.DS,r.ea=this.DI+e&65535,r;case 6:return r.defaultSeg=this.SS,r.ea=this.BP+e&65535,r;case 7:return r.defaultSeg=this.DS,r.ea=this.BX+e&65535,r}}break;case 2:{const e=this.readNextCodeWord();switch(t){case 0:return r.defaultSeg=this.DS,r.ea=this.BX+this.SI+e&65535,r;case 1:return r.defaultSeg=this.DS,r.ea=this.BX+this.DI+e&65535,r;case 2:return r.defaultSeg=this.SS,r.ea=this.BP+this.SI+e&65535,r;case 3:return r.defaultSeg=this.SS,r.ea=this.BP+this.DI+e&65535,r;case 4:return r.defaultSeg=this.DS,r.ea=this.SI+e&65535,r;case 5:return r.defaultSeg=this.DS,r.ea=this.DI+e&65535,r;case 6:return r.defaultSeg=this.SS,r.ea=this.BP+e&65535,r;case 7:return r.defaultSeg=this.DS,r.ea=this.BX+e&65535,r}}}return r.defaultSeg=this.DS,r.ea=0,r}getRegByte(e){switch(e){case 0:return this.AL;case 1:return this.CL;case 2:return this.DL;case 3:return this.BL;case 4:return this.AH;case 5:return this.CH;case 6:return this.DH;case 7:return this.BH}return 0}setRegByte(e,t){switch(e){case 0:this.AL=t;break;case 1:this.CL=t;break;case 2:this.DL=t;break;case 3:this.BL=t;break;case 4:this.AH=t;break;case 5:this.CH=t;break;case 6:this.DH=t;break;case 7:this.BH=t}}getRmByte(e,t,r){return 3==e?this.getRegByte(t):this.memoryProvider.peek(r)}setRmByte(e,t,r,i){3==e?this.setRegByte(t,i):this.memoryProvider.poke(r,i)}getRegWord(e){switch(e){case 0:return this.AX;case 1:return this.CX;case 2:return this.DX;case 3:return this.BX;case 4:return this.SP;case 5:return this.BP;case 6:return this.SI;case 7:return this.DI}return 0}getSegReg(e){switch(e){case 0:return this.ES;case 1:return this.CS;case 2:return this.SS;case 3:return this.DS}return 0}setRegWord(e,t){switch(e){case 0:this.AX=t;break;case 1:this.CX=t;break;case 2:this.DX=t;break;case 3:this.BX=t;break;case 4:this.SP=t;break;case 5:this.BP=t;break;case 6:this.SI=t;break;case 7:this.DI=t}}setSegReg(e,t){switch(e){case 0:this.ES=t;break;case 1:this.CS=t;break;case 2:this.SS=t,this.blockInterrupt=!0;break;case 3:this.DS=t}}getRmWord(e,t,r){return 3==e?this.getRegWord(t):this.memoryProvider.peekW(r)}setRmWord(e,t,r,i){3==e?this.setRegWord(t,i):this.memoryProvider.pokeW(r,i)}setMemByte(e,t,r){this.memoryProvider.poke(this.genAddr(e,t),r)}setMemWord(e,t,r){this.memoryProvider.pokeW(this.genAddr(e,t),r)}readNextCodeByte(){const e=this.genAddr(this.CS,this.IP);return this.IP=this.IP+1&65535,this.memoryProvider.peek(e)}readNextCodeWord(){const e=this.memoryProvider.peekW(this.genAddr(this.CS,this.IP));return this.IP=this.IP+2&65535,e}getMemByte(e,t){return this.memoryProvider.peek(this.genAddr(e,t))}getMemWord(e,t){return this.memoryProvider.peekW(this.genAddr(e,t))}doSoftInterrupt(e){this.handleSoftInterrupt(e)||(this.softInterrupt=e)}handleSoftInterrupt(e){return 19===e&&4==this.AH&&(this.AH=0,this.flags.CF=!1,!0)}doInterrupt(e){this.hardInterrupt=e}setEvent(e,t){const r=++this.eventGen;return this.cpuEvents.push({action:t,clockCount:this.clockCount+Math.trunc(e*i.Zr.cpuFrequency/1e3),id:r}),r}deleteEvent(e){for(let t=0;t<this.cpuEvents.length;t++)if(this.cpuEvents[t].id==e){this.cpuEvents.splice(t,1);break}}}class V{constructor(e,t){Object.defineProperty(this,"workLoad",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"instCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"CX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"DX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"SP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"SI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"DI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"CS",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"DS",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ES",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"SS",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"IP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"FLAGS",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"halt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clockCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}reset(){throw new Error("Method not implemented.")}getCurrentCodeAddr(){throw new Error("Method not implemented.")}getCodeSeg32Bit(){throw new Error("Method not implemented.")}execNextInstruction(){throw new Error("Method not implemented.")}execInstructions(e){throw new Error("Method not implemented.")}getInstructionByte(){throw new Error("Method not implemented.")}getAddressByte(){throw new Error("Method not implemented.")}getName(){throw new Error("Method not implemented.")}doInterrupt(e){throw new Error("Method not implemented.")}setEvent(e,t){throw new Error("Method not implemented.")}deleteEvent(e){throw new Error("Method not implemented.")}}class G{constructor(){Object.defineProperty(this,"reg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"regStr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rmStr",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}}class U{get instBytes(){let e="";for(let t=0;t<this.hexValues.length;t++)""!=e&&(e+=" "),e+=this.hexValues[t].toString(16).toUpperCase().padStart(2,"0");return e}get disassembledLine(){const e=this.instBytes.padEnd(this.instructionLineOffset," ");return this.startAddress.toString(16).toUpperCase().padStart(5,"0")+"  "+e+"    "+this.instruction}constructor(e,t){Object.defineProperty(this,"instructionLineOffset",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"cpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"memory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hexValues",{enumerable:!0,configurable:!0,writable:!0,value:Array()}),Object.defineProperty(this,"startAddress",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"localAddress",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"segOverride",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"op32Bit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"addr32Bit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"instruction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cpu=e,this.memory=t}doDisassemble(e=-1){this.hexValues.length=0,this.instruction="",this.startAddress=-1==e?this.cpu.getCurrentCodeAddr():e,this.localAddress=this.startAddress;let t,r=this.getNextByte();this.op32Bit=this.addr32Bit=this.cpu.getCodeSeg32Bit();do{switch(t=!1,r){case 243:this.instruction+="REP ",r=this.getNextByte(),t=!0;break;case 242:this.instruction+="REPNZ ",r=this.getNextByte(),t=!0}switch(r){case 240:this.instruction+="LOCK ",r=this.getNextByte(),t=!0;break;case 46:this.segOverride="CS:",r=this.getNextByte(),t=!0;break;case 62:this.segOverride="DS:",r=this.getNextByte(),t=!0;break;case 38:this.segOverride="ES:",r=this.getNextByte(),t=!0;break;case 54:this.segOverride="SS:",r=this.getNextByte(),t=!0;break;case 100:this.segOverride="FS:",r=this.getNextByte(),t=!0;break;case 101:this.segOverride="GS:",r=this.getNextByte(),t=!0}102==r&&(this.op32Bit=!this.op32Bit,r=this.getNextByte(),t=!0),103==r&&(this.addr32Bit=!this.addr32Bit,r=this.getNextByte(),t=!0)}while(t);this.processOpcode(r),this.segOverride=""}processOpcode(e){switch(e){case 55:this.instruction="AAA";break;case 213:this.instruction="AAD";break;case 212:this.instruction="AAM";break;case 63:this.instruction="AAS";break;case 16:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`ADC ${e.rmStr}, ${e.regStr}`}break;case 17:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`ADC ${e.rmStr}, ${e.regStr}`}break;case 18:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`ADC ${e.regStr}, ${e.rmStr}`}break;case 19:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`ADC ${e.regStr}, ${e.rmStr}`}break;case 20:this.instruction=`ADC AL, ${this.getNextByteStr()}`;break;case 21:this.op32Bit?this.instruction=`ADC EAX, ${this.getNextDwordStr()}`:this.instruction=`ADC AX, ${this.getNextWordStr()}`;break;case 0:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`ADD ${e.rmStr}, ${e.regStr}`}break;case 1:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`ADD ${e.rmStr}, ${e.regStr}`}break;case 2:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`ADD ${e.regStr}, ${e.rmStr}`}break;case 3:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`ADD ${e.regStr}, ${e.rmStr}`}break;case 4:this.instruction=`ADD AL, ${this.getNextByteStr()}`;break;case 5:this.instruction=`ADD AX, ${this.getNextWordStr()}`;break;case 32:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`AND ${e.rmStr}, ${e.regStr}`}break;case 33:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`AND ${e.rmStr}, ${e.regStr}`}break;case 34:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`AND ${e.regStr}, ${e.rmStr}`}break;case 35:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`AND ${e.regStr}, ${e.rmStr}`}break;case 36:this.instruction=`AND AL, ${this.getNextByteStr()}`;break;case 37:this.op32Bit?this.instruction=`AND EAX, ${this.getNextDwordStr()}`:this.instruction=`AND AX, ${this.getNextWordStr()}`;break;case 99:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`ARPL ${e.rmStr}, ${e.regStr}`}break;case 98:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BOUND ${e.regStr}, ${e.rmStr}`}break;case 232:this.op32Bit?this.instruction=`CALL ${this.getNextSDwordStr()}`:this.instruction=`CALL ${this.getNextSWordStr()}`;break;case 154:{const e=this.getNextWord(),t=this.getNextWord();this.instruction=`CALL FAR ${this.wordToHex(t)}:${this.wordToHex(e)}`}break;case 152:this.op32Bit?this.instruction="CWDE":this.instruction="CBW";break;case 248:this.instruction="CLC";break;case 252:this.instruction="CLD";break;case 250:this.instruction="CLI";break;case 245:this.instruction="CMC";break;case 56:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`CMP ${e.rmStr}, ${e.regStr}`}break;case 57:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`CMP ${e.rmStr}, ${e.regStr}`}break;case 58:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`CMP ${e.regStr}, ${e.rmStr}`}break;case 59:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`CMP ${e.regStr}, ${e.rmStr}`}break;case 60:this.instruction=`CMP AL, ${this.getNextByteStr()}`;break;case 61:this.op32Bit?this.instruction=`CMP EAX, ${this.getNextDwordStr()}`:this.instruction=`CMP AX, ${this.getNextWordStr()}`;break;case 166:{this.instruction+="CMPSB";const e=this.addr32Bit?"E":"",t=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${e}DI], ${t}[${e}SI]`}break;case 167:{this.op32Bit?this.instruction+="CMPSD":this.instruction+="CMPSW";const e=this.addr32Bit?"E":"",t=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${e}DI], ${t}[${e}SI]`}break;case 153:this.op32Bit?this.instruction="CDQ":this.instruction="CWD";break;case 39:this.instruction="DAA";break;case 47:this.instruction="DAS";break;case 72:this.instruction=`DEC ${this.prefixOp32()}AX`;break;case 73:this.instruction=`DEC ${this.prefixOp32()}CX`;break;case 74:this.instruction=`DEC ${this.prefixOp32()}DX`;break;case 75:this.instruction=`DEC ${this.prefixOp32()}BX`;break;case 76:this.instruction=`DEC ${this.prefixOp32()}SP`;break;case 77:this.instruction=`DEC ${this.prefixOp32()}BP`;break;case 78:this.instruction=`DEC ${this.prefixOp32()}SI`;break;case 79:this.instruction=`DEC ${this.prefixOp32()}DI`;break;case 200:this.instruction=`ENTER ${this.getNextWordStr()}, ${this.getNextByteStr()}`;break;case 244:this.instruction="HLT";break;case 107:{const e=this.readAndDecodeAddressByte(!1);e.regStr==e.rmStr?this.instruction=`IMUL ${e.regStr}, ${this.getNextByteStr()}`:this.instruction=`IMUL ${e.regStr}, ${e.rmStr}, ${this.getNextByteStr()}`}break;case 105:{const e=this.readAndDecodeAddressByte(!1),t=this.op32Bit?this.getNextDwordStr():this.getNextWordStr();e.regStr==e.rmStr?this.instruction=`IMUL ${e.regStr}, ${t}`:this.instruction=`IMUL ${e.regStr}, ${e.rmStr}, ${t}`}break;case 228:this.instruction=`IN AL, ${this.getNextByteStr()}`;break;case 229:this.instruction=`IN ${this.prefixOp32()}AX, ${this.getNextByteStr()}`;break;case 236:this.instruction="IN AL, DX";break;case 237:this.instruction=`IN ${this.prefixOp32()}AX, DX`;break;case 64:this.instruction=`INC ${this.prefixOp32()}AX`;break;case 65:this.instruction=`INC ${this.prefixOp32()}CX`;break;case 66:this.instruction=`INC ${this.prefixOp32()}DX`;break;case 67:this.instruction=`INC ${this.prefixOp32()}BX`;break;case 68:this.instruction=`INC ${this.prefixOp32()}SP`;break;case 69:this.instruction=`INC ${this.prefixOp32()}BP`;break;case 70:this.instruction=`INC ${this.prefixOp32()}SI`;break;case 71:this.instruction=`INC ${this.prefixOp32()}DI`;break;case 108:this.instruction+="INSB";break;case 109:this.op32Bit?this.instruction+="INSD":this.instruction+="INSW";break;case 204:this.instruction="INT3";break;case 205:this.instruction=`INT ${this.getNextByteStr()}`;break;case 206:this.instruction="INTO";break;case 207:this.op32Bit?this.instruction="IRETD":this.instruction="IRET";break;case 119:this.instruction=`JA ${this.getNextSByteStr()}`;break;case 115:this.instruction=`JAE/JNC ${this.getNextSByteStr()}`;break;case 114:this.instruction=`JB/JC ${this.getNextSByteStr()}`;break;case 118:this.instruction=`JBE ${this.getNextSByteStr()}`;break;case 227:this.instruction=`JCXZ ${this.getNextSByteStr()}`;break;case 116:this.instruction=`JE ${this.getNextSByteStr()}`;break;case 127:this.instruction=`JG ${this.getNextSByteStr()}`;break;case 125:this.instruction=`JGE ${this.getNextSByteStr()}`;break;case 124:this.instruction=`JL ${this.getNextSByteStr()}`;break;case 126:this.instruction=`JLE ${this.getNextSByteStr()}`;break;case 235:this.instruction=`JMP ${this.getNextSByteStr()}`;break;case 233:this.op32Bit?this.instruction=`JMP ${this.getNextSDwordStr()}`:this.instruction=`JMP ${this.getNextSWordStr()}`;break;case 234:if(this.op32Bit){const e=this.getNextDword(),t=this.getNextWord();this.instruction=`JMP FAR ${this.wordToHex(t)}:${this.dwordToHex(e)}`}else{const e=this.getNextWord(),t=this.getNextWord();this.instruction=`JMP FAR ${this.wordToHex(t)}:${this.wordToHex(e)}`}break;case 117:this.instruction=`JNE ${this.getNextSByteStr()}`;break;case 113:this.instruction=`JNO ${this.getNextSByteStr()}`;break;case 121:this.instruction=`JNS ${this.getNextSByteStr()}`;break;case 123:this.instruction=`JNP ${this.getNextSByteStr()}`;break;case 112:this.instruction=`JO ${this.getNextSByteStr()}`;break;case 122:this.instruction=`JP ${this.getNextSByteStr()}`;break;case 120:this.instruction=`JS ${this.getNextSByteStr()}`;break;case 159:this.instruction="LAHF";break;case 197:this.loadSeg("DS");break;case 141:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`LEA ${e.regStr}, ${e.rmStr}`}break;case 201:this.instruction="LEAVE";break;case 196:this.loadSeg("ES");break;case 240:this.instruction="LOCK";break;case 172:this.instruction+="LODSB";{let e="SI";this.addr32Bit&&(e=`E${e}`),""!=this.segOverride?this.instruction+=` ${this.segOverride}[${e}]`:this.addr32Bit&&(this.instruction+=` [${e}]`)}break;case 173:{let e="SI";this.addr32Bit&&(e=`E${e}`),this.op32Bit?this.instruction+="LODSD":this.instruction+="LODSW",""!=this.segOverride?this.instruction+=` ${this.segOverride}[${e}]`:this.addr32Bit&&(this.instruction+=` [${e}]`)}break;case 226:this.instruction=`LOOP ${this.getNextSByteStr()}`;break;case 225:this.instruction=`LOOPZ ${this.getNextSByteStr()}`;break;case 224:this.instruction=`LOOPNZ ${this.getNextSByteStr()}`;break;case 160:this.instruction=`MOV AL, ${this.segOverride}[${this.getNextWordStr()}]`;break;case 161:{const e=this.addr32Bit?this.getNextDwordStr():this.getNextWordStr(),t=this.op32Bit?"EAX":"AX";this.instruction=`MOV ${t}, ${this.segOverride}[${e}]`}break;case 162:this.instruction=`MOV ${this.segOverride}[${this.getNextWordStr()}], AL`;break;case 163:{const e=this.addr32Bit?this.getNextDwordStr():this.getNextWordStr(),t=this.op32Bit?"EAX":"AX";this.instruction=`MOV ${this.segOverride}[${e}], ${t}`}break;case 176:this.instruction=`MOV AL, ${this.getNextByteStr()}`;break;case 177:this.instruction=`MOV CL, ${this.getNextByteStr()}`;break;case 178:this.instruction=`MOV DL, ${this.getNextByteStr()}`;break;case 179:this.instruction=`MOV BL, ${this.getNextByteStr()}`;break;case 180:this.instruction=`MOV AH, ${this.getNextByteStr()}`;break;case 181:this.instruction=`MOV CH, ${this.getNextByteStr()}`;break;case 182:this.instruction=`MOV DH, ${this.getNextByteStr()}`;break;case 183:this.instruction=`MOV BH, ${this.getNextByteStr()}`;break;case 184:this.op32Bit?this.instruction=`MOV EAX, ${this.getNextDwordStr()}`:this.instruction=`MOV AX, ${this.getNextWordStr()}`;break;case 185:this.op32Bit?this.instruction=`MOV ECX, ${this.getNextDwordStr()}`:this.instruction=`MOV CX, ${this.getNextWordStr()}`;break;case 186:this.op32Bit?this.instruction=`MOV EDX, ${this.getNextDwordStr()}`:this.instruction=`MOV DX, ${this.getNextWordStr()}`;break;case 187:this.op32Bit?this.instruction=`MOV EBX, ${this.getNextDwordStr()}`:this.instruction=`MOV BX, ${this.getNextWordStr()}`;break;case 188:this.op32Bit?this.instruction=`MOV ESP, ${this.getNextDwordStr()}`:this.instruction=`MOV SP, ${this.getNextWordStr()}`;break;case 189:this.op32Bit?this.instruction=`MOV EBP, ${this.getNextDwordStr()}`:this.instruction=`MOV BP, ${this.getNextWordStr()}`;break;case 190:this.op32Bit?this.instruction=`MOV ESI, ${this.getNextDwordStr()}`:this.instruction=`MOV SI, ${this.getNextWordStr()}`;break;case 191:this.op32Bit?this.instruction=`MOV EDI, ${this.getNextDwordStr()}`:this.instruction=`MOV DI, ${this.getNextWordStr()}`;break;case 198:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${e.rmStr}, ${this.getNextByteStr()}`}break;case 199:{const e=this.readAndDecodeAddressByte(!1);this.op32Bit?this.instruction=`MOV ${e.rmStr}, ${this.getNextDwordStr()}`:this.instruction=`MOV ${e.rmStr}, ${this.getNextWordStr()}`}break;case 136:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${e.rmStr}, ${e.regStr}`}break;case 137:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${e.rmStr}, ${e.regStr}`}break;case 138:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${e.regStr}, ${e.rmStr}`}break;case 139:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${e.regStr}, ${e.rmStr}`}break;case 140:{this.op32Bit=!1;const e=this.readAndDecodeAddressByte(!1,!0);this.instruction=`MOV ${e.rmStr}, ${e.regStr}`}break;case 142:{this.op32Bit=!1;const e=this.readAndDecodeAddressByte(!1,!0);this.instruction=`MOV ${e.regStr}, ${e.rmStr}`}break;case 164:this.instruction+="MOVSB";{const e=this.addr32Bit?"E":"",t=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${e}DI], ${t}[${e}SI]`}break;case 165:{this.op32Bit?this.instruction+="MOVSD":this.instruction+="MOVSW";const e=this.addr32Bit?"E":"",t=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${e}DI], ${t}[${e}SI]`}break;case 144:this.instruction="NOP";break;case 8:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`OR ${e.rmStr}, ${e.regStr}`}break;case 9:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`OR ${e.rmStr}, ${e.regStr}`}break;case 10:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`OR ${e.regStr}, ${e.rmStr}`}break;case 11:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`OR ${e.regStr}, ${e.rmStr}`}break;case 12:this.instruction=`OR AL, ${this.getNextByteStr()}`;break;case 13:this.op32Bit?this.instruction=`OR EAX, ${this.getNextDwordStr()}`:this.instruction=`OR AX, ${this.getNextWordStr()}`;break;case 230:this.instruction=`OUT ${this.getNextByteStr()}, AL`;break;case 231:this.instruction=`OUT ${this.getNextByteStr()}, AX`;break;case 238:this.instruction="OUT DX, AL";break;case 239:this.op32Bit?this.instruction="OUT DX, EAX":this.instruction="OUT DX, AX";break;case 110:this.instruction+="OUTSB",this.addr32Bit&&(this.instruction+=" DX, [ESI]");break;case 111:this.op32Bit?this.instruction+="OUTSD":this.instruction+="OUTSW",this.addr32Bit&&(this.instruction+=" DX, [ESI]");break;case 88:this.instruction=`POP ${this.prefixOp32()}AX`;break;case 89:this.instruction=`POP ${this.prefixOp32()}CX`;break;case 90:this.instruction=`POP ${this.prefixOp32()}DX`;break;case 91:this.instruction=`POP ${this.prefixOp32()}BX`;break;case 92:this.instruction=`POP ${this.prefixOp32()}SP`;break;case 93:this.instruction=`POP ${this.prefixOp32()}BP`;break;case 94:this.instruction=`POP ${this.prefixOp32()}SI`;break;case 95:this.instruction=`POP ${this.prefixOp32()}DI`;break;case 7:this.instruction="POP ES";break;case 23:this.instruction="POP SS";break;case 31:this.instruction="POP DS";break;case 143:{const e=this.readAndDecodeAddressByte(!0);this.op32Bit?this.instruction=`POP DWORD ${e.rmStr}`:this.instruction=`POP ${e.rmStr}`}break;case 97:this.op32Bit?this.instruction="POPAD":this.instruction="POPA";break;case 157:this.op32Bit?this.instruction="POPFD":this.instruction="POPF";break;case 80:this.instruction=`PUSH ${this.prefixOp32()}AX`;break;case 81:this.instruction=`PUSH ${this.prefixOp32()}CX`;break;case 82:this.instruction=`PUSH ${this.prefixOp32()}DX`;break;case 83:this.instruction=`PUSH ${this.prefixOp32()}BX`;break;case 84:this.instruction=`PUSH ${this.prefixOp32()}SP`;break;case 85:this.instruction=`PUSH ${this.prefixOp32()}BP`;break;case 86:this.instruction=`PUSH ${this.prefixOp32()}SI`;break;case 87:this.instruction=`PUSH ${this.prefixOp32()}DI`;break;case 6:this.instruction="PUSH ES";break;case 14:this.instruction="PUSH CS";break;case 22:this.instruction="PUSH SS";break;case 30:this.instruction="PUSH DS";break;case 106:this.instruction=`PUSH ${this.getNextByteStr()}`;break;case 104:this.op32Bit?this.instruction=`PUSH ${this.getNextDwordStr()}`:this.instruction=`PUSH ${this.getNextWordStr()}`;break;case 96:this.op32Bit?this.instruction="PUSHAD":this.instruction="PUSHA";break;case 156:this.op32Bit?this.instruction="PUSHFD":this.instruction="PUSHF";break;case 195:this.instruction="RET";break;case 194:this.instruction=`RET ${this.getNextWordStr()}`;break;case 203:this.instruction="RETF";break;case 202:this.instruction=`RETF ${this.getNextWordStr()}`;break;case 158:this.instruction="SAHF";break;case 24:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`SBB ${e.rmStr}, ${e.regStr}`}break;case 25:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SBB ${e.rmStr}, ${e.regStr}`}break;case 26:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`SBB ${e.regStr}, ${e.rmStr}`}break;case 27:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SBB ${e.regStr}, ${e.rmStr}`}break;case 28:this.instruction=`SBB AL, ${this.getNextByteStr()}`;break;case 29:this.op32Bit?this.instruction=`SBB EAX, ${this.getNextDwordStr()}`:this.instruction=`SBB AX, ${this.getNextWordStr()}`;break;case 174:this.instruction+="SCASB",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 175:this.op32Bit?this.instruction+="SCASD":this.instruction+="SCASW",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 249:this.instruction="STC";break;case 253:this.instruction="STD";break;case 251:this.instruction="STI";break;case 170:this.instruction+="STOSB",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 171:this.op32Bit?this.instruction+="STOSD":this.instruction+="STOSW",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 40:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`SUB ${e.rmStr}, ${e.regStr}`}break;case 41:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SUB ${e.rmStr}, ${e.regStr}`}break;case 42:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`SUB ${e.regStr}, ${e.rmStr}`}break;case 43:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SUB ${e.regStr}, ${e.rmStr}`}break;case 44:this.instruction=`SUB AL, ${this.getNextByteStr()}`;break;case 45:this.op32Bit?this.instruction=`SUB EAX, ${this.getNextDwordStr()}`:this.instruction=`SUB AX, ${this.getNextWordStr()}`;break;case 132:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`TEST ${e.rmStr}, ${e.regStr}`}break;case 133:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`TEST ${e.rmStr}, ${e.regStr}`}break;case 168:this.instruction=`TEST AL, ${this.getNextByteStr()}`;break;case 169:this.op32Bit?this.instruction=`TEST EAX, ${this.getNextDwordStr()}`:this.instruction=`TEST AX, ${this.getNextWordStr()}`;break;case 155:this.instruction="WAIT";break;case 145:this.instruction="XCHG AX, CX";break;case 146:this.instruction="XCHG AX, DX";break;case 147:this.instruction="XCHG AX, BX";break;case 148:this.instruction="XCHG AX, SP";break;case 149:this.instruction="XCHG AX, BP";break;case 150:this.instruction="XCHG AX, SI";break;case 151:this.instruction="XCHG AX, DI";break;case 134:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`XCHG ${e.regStr}, ${e.rmStr}`}break;case 135:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`XCHG ${e.regStr}, ${e.rmStr}`}break;case 215:this.instruction=`XLAT ${this.segOverride}[BX]`;break;case 48:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`XOR ${e.rmStr}, ${e.regStr}`}break;case 49:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`XOR ${e.rmStr}, ${e.regStr}`}break;case 50:{const e=this.readAndDecodeAddressByte(!0);this.instruction=`XOR ${e.regStr}, ${e.rmStr}`}break;case 51:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`XOR ${e.regStr}, ${e.rmStr}`}break;case 52:this.instruction=`XOR AL, ${this.getNextByteStr()}`;break;case 53:this.op32Bit?this.instruction=`XOR EAX, ${this.getNextDwordStr()}`:this.instruction=`XOR AX, ${this.getNextWordStr()}`;break;case 254:this.handleOpcodeFeFf(!1);break;case 255:this.handleOpcodeFeFf(!0);break;case 128:this.handleOpcode80();break;case 129:this.handleOpcode81();break;case 131:this.handleOpcode83();break;case 246:this.handleOpcodeF6();break;case 247:this.handleOpcodeF7();break;case 15:this.handleOpcode0F();break;case 208:this.handleOpcodeD0();break;case 209:this.handleOpcodeD1();break;case 210:this.handleOpcodeD2();break;case 211:this.handleOpcodeD3();break;case 192:this.handleOpcodeC0();break;case 193:this.handleOpcodeC1()}}handleOpcodeFeFf(e){const t=this.readAndDecodeAddressByte(!e);switch(t.reg){case 0:this.op32Bit?this.instruction=`INC DWORD ${t.rmStr}`:this.instruction=`INC ${t.rmStr}`;break;case 1:this.op32Bit?this.instruction=`DEC DWORD ${t.rmStr}`:this.instruction=`DEC ${t.rmStr}`;break;case 4:this.instruction=`JMP ${t.rmStr}`;break;case 2:this.instruction=`CALL ${t.rmStr}`;break;case 3:this.instruction=`CALL FAR ${t.rmStr}`;break;case 5:this.instruction=`JMP FAR ${t.rmStr}`;break;case 6:e&&(this.op32Bit?this.instruction=`PUSH DWORD ${t.rmStr}`:this.instruction=`PUSH ${t.rmStr}`)}}handleOpcode80(){const e=this.readAndDecodeAddressByte(!0),t=this.getNextByteStr();switch(e.reg){case 0:this.instruction=`ADD ${e.rmStr}, ${t}`;break;case 1:this.instruction=`OR ${e.rmStr}, ${t}`;break;case 2:this.instruction=`ADC ${e.rmStr}, ${t}`;break;case 3:this.instruction=`SBC ${e.rmStr}, ${t}`;break;case 4:this.instruction=`AND ${e.rmStr}, ${t}`;break;case 5:this.instruction=`SUB ${e.rmStr}, ${t}`;break;case 6:this.instruction=`XOR ${e.rmStr}, ${t}`;break;case 7:this.instruction=`CMP ${e.rmStr}, ${t}`}}handleOpcode81(){const e=this.readAndDecodeAddressByte(!1),t=this.op32Bit?this.getNextDwordStr():this.getNextWordStr();switch(e.reg){case 0:this.instruction=`ADD ${e.rmStr}, ${t}`;break;case 1:this.instruction=`OR ${e.rmStr}, ${t}`;break;case 2:this.instruction=`ADC ${e.rmStr}, ${t}`;break;case 3:this.instruction=`SBC ${e.rmStr}, ${t}`;break;case 4:this.instruction=`AND ${e.rmStr}, ${t}`;break;case 5:this.instruction=`SUB ${e.rmStr}, ${t}`;break;case 6:this.instruction=`XOR ${e.rmStr}, ${t}`;break;case 7:this.instruction=`CMP ${e.rmStr}, ${t}`}}handleOpcode83(){const e=this.readAndDecodeAddressByte(!1),t=this.getNextByteStr();switch(e.reg){case 0:this.instruction=`ADD ${e.rmStr}, ${t}`;break;case 1:this.instruction=`OR ${e.rmStr}, ${t}`;break;case 2:this.instruction=`ADC ${e.rmStr}, ${t}`;break;case 3:this.instruction=`SBC ${e.rmStr}, ${t}`;break;case 4:this.instruction=`AND ${e.rmStr}, ${t}`;break;case 5:this.instruction=`SUB ${e.rmStr}, ${t}`;break;case 6:this.instruction=`XOR ${e.rmStr}, ${t}`;break;case 7:this.instruction=`CMP ${e.rmStr}, ${t}`}}handleOpcodeF6(){const e=this.readAndDecodeAddressByte(!0);switch(e.reg){case 0:this.instruction=`TEST ${e.rmStr}, ${this.getNextByteStr()}`;break;case 2:this.instruction=`NOT ${e.rmStr}`;break;case 3:this.instruction=`NEG ${e.rmStr}`;break;case 4:this.instruction=`MUL ${e.rmStr}`;break;case 5:this.instruction=`IMUL ${e.rmStr}`;break;case 6:this.instruction=`DIV ${e.rmStr}`;break;case 7:this.instruction=`IDIV ${e.rmStr}`}}handleOpcodeF7(){const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`TEST ${e.rmStr}, ${this.getNextWordStr()}`;break;case 2:this.instruction=`NOT ${e.rmStr}`;break;case 3:this.instruction=`NEG ${e.rmStr}`;break;case 4:this.instruction=`MUL ${e.rmStr}`;break;case 5:this.instruction=`IMUL ${e.rmStr}`;break;case 6:this.instruction=`DIV ${e.rmStr}`;break;case 7:this.instruction=`IDIV ${e.rmStr}`}}handleOpcode0F(){switch(this.getNextByte()){case 0:{const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`SLDT ${e.rmStr}`;break;case 1:this.instruction=`STR ${e.rmStr}`;break;case 2:this.instruction=`LLDT ${e.rmStr}`;break;case 3:this.instruction=`LTR ${e.rmStr}`}}break;case 1:{const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`SGDT ${e.rmStr}`;break;case 1:this.instruction=`SIDT ${e.rmStr}`;break;case 2:this.instruction=`LGDT ${e.rmStr}`;break;case 3:this.instruction=`LIDT ${e.rmStr}`;break;case 4:this.instruction=`SMSW ${e.rmStr}`;break;case 6:this.instruction=`LMSW ${e.rmStr}`}}break;case 2:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`LAR ${e.regStr}, ${e.rmStr}`}break;case 6:this.instruction="CLTS";break;case 9:this.instruction="WBINVD";break;case 32:{this.op32Bit=!0;const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`MOV ${e.rmStr}, CR0`;break;case 1:this.instruction=`MOV ${e.rmStr}, CR1`;break;case 2:this.instruction=`MOV ${e.rmStr}, CR2`;break;case 3:this.instruction=`MOV ${e.rmStr}, CR3`}}break;case 33:{this.op32Bit=!0;const e=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${e.rmStr}, DR${e.reg}`}break;case 34:{this.op32Bit=!0;const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`MOV CR0, ${e.rmStr}`;break;case 1:this.instruction=`MOV CR1, ${e.rmStr}`;break;case 2:this.instruction=`MOV CR2, ${e.rmStr}`;break;case 3:this.instruction=`MOV CR3, ${e.rmStr}`}}break;case 35:{this.op32Bit=!0;const e=this.readAndDecodeAddressByte(!1);this.instruction=`MOV DR${e.reg}, ${e.rmStr}`}break;case 36:{this.op32Bit=!0;const e=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${e.rmStr}, TR${e.reg}`}break;case 38:{this.op32Bit=!0;const e=this.readAndDecodeAddressByte(!1);this.instruction=`MOV TR${e.reg}, ${e.rmStr}`}break;case 128:this.instruction=`JO ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 129:this.instruction=`JNO ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 130:this.instruction=`JB/JC ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 131:this.instruction=`JNB/JNC ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 132:this.instruction=`JE/JZ ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 133:this.instruction=`JNE/JZ ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 134:this.instruction=`JBE ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 135:this.instruction=`JA ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 136:this.instruction=`JS ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 137:this.instruction=`JNS ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 138:this.instruction=`JP ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 139:this.instruction=`JNP ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 140:this.instruction=`JL ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 141:this.instruction=`JGE ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 142:this.instruction=`JLE ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 143:this.instruction=`JG ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 144:this.instruction=`SETO ${this.getRm8Str()}`;break;case 145:this.instruction=`SETNO ${this.getRm8Str()}`;break;case 146:this.instruction=`SETB/SETC ${this.getRm8Str()}`;break;case 147:this.instruction=`SETNB/SETNC ${this.getRm8Str()}`;break;case 148:this.instruction=`SETE/SETZ ${this.getRm8Str()}`;break;case 149:this.instruction=`SETNE/SETZ ${this.getRm8Str()}`;break;case 150:this.instruction=`SETBE ${this.getRm8Str()}`;break;case 151:this.instruction=`SETA ${this.getRm8Str()}`;break;case 152:this.instruction=`SETS ${this.getRm8Str()}`;break;case 153:this.instruction=`SETNS ${this.getRm8Str()}`;break;case 154:this.instruction=`SETP ${this.getRm8Str()}`;break;case 155:this.instruction=`SETNP ${this.getRm8Str()}`;break;case 156:this.instruction=`SETL ${this.getRm8Str()}`;break;case 157:this.instruction=`SETGE ${this.getRm8Str()}`;break;case 158:this.instruction=`SETLE ${this.getRm8Str()}`;break;case 159:this.instruction=`SETG ${this.getRm8Str()}`;break;case 160:this.instruction="PUSH FS";break;case 161:this.instruction="POP FS";break;case 163:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BT ${e.rmStr}, ${e.regStr}`}break;case 164:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SHLD ${e.rmStr}, ${e.regStr}, ${this.getNextByteStr()}`}break;case 165:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SHLD ${e.rmStr}, ${e.regStr}, CL`}break;case 168:this.instruction="PUSH GS";break;case 169:this.instruction="POP GS";break;case 171:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BTS ${e.rmStr}, ${e.regStr}`}break;case 172:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SHRD ${e.rmStr}, ${e.regStr}, ${this.getNextByteStr()}`}break;case 173:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`SHRD ${e.rmStr}, ${e.regStr}, CL`}break;case 178:this.loadSeg("SS");break;case 179:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BTR ${e.rmStr}, ${e.regStr}`}break;case 180:this.loadSeg("FS");break;case 181:this.loadSeg("GS");break;case 182:{const e=this.getNextByte(),t=this.decodeAddressByte(e,!1),r=this.decodeAddressByte(e,!0,!1,!0);this.instruction=`MOVZX ${t.regStr}, ${r.rmStr}`}break;case 183:{const e=this.getNextByte(),t=this.decodeAddressByte(e,!1);this.op32Bit=!1;const r=this.decodeAddressByte(e,!1,!1,!0);this.instruction=`MOVZX ${t.regStr}, ${r.rmStr}`}break;case 186:{const e=this.readAndDecodeAddressByte(!1),t=this.getNextByteStr();switch(e.reg){case 4:this.instruction=`BT ${e.rmStr}, ${t}`;break;case 5:this.instruction=`BTS ${e.rmStr}, ${t}`;break;case 6:this.instruction=`BTR ${e.rmStr}, ${t}`;break;case 7:this.instruction=`BTC ${e.rmStr}, ${t}`}}break;case 187:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BTC ${e.rmStr}, ${e.regStr}`}break;case 188:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BSF ${e.regStr}, ${e.rmStr}`}break;case 189:{const e=this.readAndDecodeAddressByte(!1);this.instruction=`BSR ${e.regStr}, ${e.rmStr}`}}}handleOpcodeD0(){const e=this.readAndDecodeAddressByte(!0);switch(e.reg){case 0:this.instruction=`ROL ${e.rmStr}, 1`;break;case 1:this.instruction=`ROR ${e.rmStr}, 1`;break;case 2:this.instruction=`RCL ${e.rmStr}, 1`;break;case 3:this.instruction=`RCR ${e.rmStr}, 1`;break;case 4:this.instruction=`SHL ${e.rmStr}, 1`;break;case 5:this.instruction=`SHR ${e.rmStr}, 1`;break;case 6:this.instruction=`SAL ${e.rmStr}, 1`;break;case 7:this.instruction=`SAR ${e.rmStr}, 1`}}handleOpcodeD1(){const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`ROL ${e.rmStr}, 1`;break;case 1:this.instruction=`ROR ${e.rmStr}, 1`;break;case 2:this.instruction=`RCL ${e.rmStr}, 1`;break;case 3:this.instruction=`RCR ${e.rmStr}, 1`;break;case 4:this.instruction=`SHL ${e.rmStr}, 1`;break;case 5:this.instruction=`SHR ${e.rmStr}, 1`;break;case 6:this.instruction=`SAL ${e.rmStr}, 1`;break;case 7:this.instruction=`SAR ${e.rmStr}, 1`}}handleOpcodeD2(){const e=this.readAndDecodeAddressByte(!0);switch(e.reg){case 0:this.instruction=`ROL ${e.rmStr}, CL`;break;case 1:this.instruction=`ROR ${e.rmStr}, CL`;break;case 2:this.instruction=`RCL ${e.rmStr}, CL`;break;case 3:this.instruction=`RCR ${e.rmStr}, CL`;break;case 4:this.instruction=`SHL ${e.rmStr}, CL`;break;case 5:this.instruction=`SHR ${e.rmStr}, CL`;break;case 6:this.instruction=`SAL ${e.rmStr}, CL`;break;case 7:this.instruction=`SAR ${e.rmStr}, CL`}}handleOpcodeD3(){const e=this.readAndDecodeAddressByte(!1);switch(e.reg){case 0:this.instruction=`ROL ${e.rmStr}, CL`;break;case 1:this.instruction=`ROR ${e.rmStr}, CL`;break;case 2:this.instruction=`RCL ${e.rmStr}, CL`;break;case 3:this.instruction=`RCR ${e.rmStr}, CL`;break;case 4:this.instruction=`SHL ${e.rmStr}, CL`;break;case 5:this.instruction=`SHR ${e.rmStr}, CL`;break;case 6:this.instruction=`SAL ${e.rmStr}, CL`;break;case 7:this.instruction=`SAR ${e.rmStr}, CL`}}handleOpcodeC0(){const e=this.readAndDecodeAddressByte(!0),t=this.getNextByteStr();switch(e.reg){case 0:this.instruction=`ROL ${e.rmStr}, ${t}`;break;case 1:this.instruction=`ROR ${e.rmStr}, ${t}`;break;case 2:this.instruction=`RCL ${e.rmStr}, ${t}`;break;case 3:this.instruction=`RCR ${e.rmStr}, ${t}`;break;case 4:this.instruction=`SHL ${e.rmStr}, ${t}`;break;case 5:this.instruction=`SHR ${e.rmStr}, ${t}`;break;case 6:this.instruction=`SAL ${e.rmStr}, ${t}`;break;case 7:this.instruction=`SAR ${e.rmStr}, ${t}`}}handleOpcodeC1(){const e=this.readAndDecodeAddressByte(!1),t=this.getNextByteStr();switch(e.reg){case 0:this.instruction=`ROL ${e.rmStr}, ${t}`;break;case 1:this.instruction=`ROR ${e.rmStr}, ${t}`;break;case 2:this.instruction=`RCL ${e.rmStr}, ${t}`;break;case 3:this.instruction=`RCR ${e.rmStr}, ${t}`;break;case 4:this.instruction=`SHL ${e.rmStr}, ${t}`;break;case 5:this.instruction=`SHR ${e.rmStr}, ${t}`;break;case 6:this.instruction=`SAL ${e.rmStr}, ${t}`;break;case 7:this.instruction=`SAR ${e.rmStr}, ${t}`}}readAndDecodeAddressByte(e,t=!1,r=!1){const i=this.getNextByte();return this.decodeAddressByte(i,e,t,r)}decodeAddressByte(e,t,r=!1,i=!1){const s=(192&e)>>6,a=(56&e)>>3,n=7&e,o=new G;o.reg=a,o.regStr=t?this.getRegByte(a):this.getRegWord(a,r),o.rmStr="";let c="";switch(i&&(c=t?"BYTE ":this.op32Bit?"DWORD ":"WORD "),s){case 0:if(this.addr32Bit)switch(n){case 0:o.rmStr=this.segOverride+"[EAX]";break;case 1:o.rmStr=this.segOverride+"[ECX]";break;case 2:o.rmStr=this.segOverride+"[EDX]";break;case 3:o.rmStr=this.segOverride+"[EBX]";break;case 4:{const e=this.readSib(s);o.rmStr=this.segOverride+e}break;case 5:{const e=this.getNextDword();o.rmStr=`${this.segOverride}[${this.dwordToHex(e)}]`}break;case 6:o.rmStr=this.segOverride+"[ESI]";break;case 7:o.rmStr=this.segOverride+"[EDI]"}else switch(n){case 0:o.rmStr=this.segOverride+"[BX + SI]";break;case 1:o.rmStr=this.segOverride+"[BX + DI]";break;case 2:o.rmStr=this.segOverride+"[BP + SI]";break;case 3:o.rmStr=this.segOverride+"[BP + DI]";break;case 4:o.rmStr=this.segOverride+"[SI]";break;case 5:o.rmStr=this.segOverride+"[DI]";break;case 6:{const e=this.getNextWord();o.rmStr=`${this.segOverride}[${this.wordToHex(e)}]`}break;case 7:o.rmStr=this.segOverride+"[BX]"}o.rmStr=c+o.rmStr;break;case 1:if(this.addr32Bit)switch(n){case 0:o.rmStr=`${this.segOverride}[EAX ${this.getNextSByteStr()}]`;break;case 1:o.rmStr=`${this.segOverride}[ECX ${this.getNextSByteStr()}]`;break;case 2:o.rmStr=`${this.segOverride}[EDX ${this.getNextSByteStr()}]`;break;case 3:o.rmStr=`${this.segOverride}[EBX ${this.getNextSByteStr()}]`;break;case 4:{const e=this.readSib(s);o.rmStr=this.segOverride+e+" "+this.getNextSByteStr()}break;case 5:o.rmStr=`${this.segOverride}[EBP ${this.getNextSByteStr()}]`;break;case 6:o.rmStr=`${this.segOverride}[BSI ${this.getNextSByteStr()}]`;break;case 7:o.rmStr=`${this.segOverride}[BDI ${this.getNextSByteStr()}]`}else{const e=this.getNextByte();switch(n){case 0:o.rmStr=`${this.segOverride}[BX + SI ${this.sByteToHex(e)}]`;break;case 1:o.rmStr=`${this.segOverride}[BX + DI ${this.sByteToHex(e)}]`;break;case 2:o.rmStr=`${this.segOverride}[BP + SI ${this.sByteToHex(e)}]`;break;case 3:o.rmStr=`${this.segOverride}[BP + DI ${this.sByteToHex(e)}]`;break;case 4:o.rmStr=`${this.segOverride}[SI ${this.sByteToHex(e)}]`;break;case 5:o.rmStr=`${this.segOverride}[DI ${this.sByteToHex(e)}]`;break;case 6:o.rmStr=`${this.segOverride}[BP ${this.sByteToHex(e)}]`;break;case 7:o.rmStr=`${this.segOverride}[BX ${this.sByteToHex(e)}]`}}o.rmStr=c+o.rmStr;break;case 2:if(this.addr32Bit)switch(n){case 0:o.rmStr=`${this.segOverride}[EAX ${this.getNextSDwordStr()}]`;break;case 1:o.rmStr=`${this.segOverride}[ECX ${this.getNextSDwordStr()}]`;break;case 2:o.rmStr=`${this.segOverride}[EDX ${this.getNextSDwordStr()}]`;break;case 3:o.rmStr=`${this.segOverride}[EBX ${this.getNextSDwordStr()}]`;break;case 4:{const e=this.readSib(s);o.rmStr=this.segOverride+this.getNextDwordStr()+e}break;case 5:o.rmStr=`${this.segOverride}[EBP ${this.getNextSDwordStr()}]`;break;case 6:o.rmStr=`${this.segOverride}[ESI ${this.getNextSDwordStr()}]`;break;case 7:o.rmStr=`${this.segOverride}[EDI ${this.getNextSDwordStr()}]`}else{const e=this.getNextWord();switch(n){case 0:o.rmStr=`${this.segOverride}[BX + SI ${this.sWordToHex(e)}]`;break;case 1:o.rmStr=`${this.segOverride}[BX + DI ${this.sWordToHex(e)}]`;break;case 2:o.rmStr=`${this.segOverride}[BP + SI ${this.sWordToHex(e)}]`;break;case 3:o.rmStr=`${this.segOverride}[BP + DI ${this.sWordToHex(e)}]`;break;case 4:o.rmStr=`${this.segOverride}[SI ${this.sWordToHex(e)}]`;break;case 5:o.rmStr=`${this.segOverride}[DI ${this.sWordToHex(e)}]`;break;case 6:o.rmStr=`${this.segOverride}[BP ${this.sWordToHex(e)}]`;break;case 7:o.rmStr=`${this.segOverride}[BX ${this.sWordToHex(e)}]`}}o.rmStr=c+o.rmStr;break;case 3:o.rmStr=t?this.getRegByte(n):this.getRegWord(n)}return o}readSib(e){const t=this.getNextByte(),r=t>>3&7,i=t>>6&3;let s="";switch(7&t){case 0:s+="[EAX]";break;case 1:s+="[ECX]";break;case 2:s+="[EDX]";break;case 3:s+="[EBX]";break;case 4:s+="[ESP]";break;case 5:s+=0==e?this.getNextDwordStr():"[EBP]";break;case 6:s+="[ESI]";break;case 7:s+="[EDI]"}switch(s+="[",r){case 0:s+="EAX";break;case 1:s+="ECX";break;case 2:s+="EDX";break;case 3:s+="EBX";break;case 5:s+="EBP";break;case 6:s+="ESI";break;case 7:s+="EDI"}switch(i){case 0:s+="*1";break;case 1:s+="*2";break;case 2:s+="*4";break;case 3:s+="*8"}return s+="]",s}getRegByte(e){switch(e){case 0:return"AL";case 1:return"CL";case 2:return"DL";case 3:return"BL";case 4:return"AH";case 5:return"CH";case 6:return"DH";case 7:return"BH"}return""}getRegWord(e,t=!1){if(!t){let t="";switch(e){case 0:t="AX";break;case 1:t="CX";break;case 2:t="DX";break;case 3:t="BX";break;case 4:t="SP";break;case 5:t="BP";break;case 6:t="SI";break;case 7:t="DI"}return this.op32Bit&&(t=`E${t}`),t}switch(e){case 0:return"ES";case 1:return"CS";case 2:return"SS";case 3:return"DS";case 4:return"FS";case 5:return"GS"}return""}loadSeg(e){{const t=this.readAndDecodeAddressByte(!1);this.instruction=`L${e} ${t.regStr}, ${t.rmStr}`}}getRm8Str(){return this.readAndDecodeAddressByte(!0).rmStr}byteToHex(e){return`${(255&e).toString(16).toUpperCase().padStart(2,"0")}h`}wordToHex(e){return`${(65535&e).toString(16).toUpperCase().padStart(4,"0")}h`}dwordToHex(e){return`${(4294967295&e).toString(16).toUpperCase().padStart(8,"0")}h`}sByteToHex(e){return e>127?`- ${(256-e).toString(16).toUpperCase().padStart(2,"0")}h`:`+ ${e.toString(16).toUpperCase().padStart(2,"0")}h`}sWordToHex(e){return e>32767?`- ${(65536-e).toString(16).toUpperCase().padStart(4,"0")}h`:`+ ${e.toString(16).toUpperCase().padStart(4,"0")}h`}sDwordToHex(e){return(e|=0)<0?`- ${(-e).toString(16).toUpperCase().padStart(8,"0")}h`:`+ ${e.toString(16).toUpperCase().padStart(8,"0")}h`}getNextByte(){const e=this.memory.peek(this.localAddress++);return this.hexValues.push(e),255&e}getNextSByteStr(){return this.sByteToHex(this.getNextByte())}getNextByteStr(){return this.byteToHex(this.getNextByte())}getNextWord(){const e=this.memory.peek(this.localAddress++);this.hexValues.push(e);const t=this.memory.peek(this.localAddress++);return this.hexValues.push(t),e+(t<<8)&65535}getNextSWordStr(){return this.sWordToHex(this.getNextWord())}getNextWordStr(){return this.wordToHex(this.getNextWord())}getNextDword(){return this.getNextWord()+(this.getNextWord()<<16)&4294967295}getNextSDwordStr(){return this.sDwordToHex(this.getNextDword())}getNextDwordStr(){return this.dwordToHex(this.getNextDword())}prefixOp32(){return this.op32Bit?"E":""}}var J=r(897);class _ extends J._0{constructor(){super(),Object.defineProperty(this,"charsetFile",{enumerable:!0,configurable:!0,writable:!0,value:"Fonts/mda.dat"}),Object.defineProperty(this,"charsetWidth",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"charsetHeight",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"charset",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"horRetrace",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"textHiColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"textColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"backgroundColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.startAddr=720896,this.setRamSize(4096),this.charWidth=9,this.charHeight=14,this.screenWidth=80*this.charWidth,this.screenHeight=25*this.charHeight,this.textColor=J.JX.fromRgb(50,205,50),this.textHiColor=J.JX.fromRgb(0,255,0),this.backgroundColor=J.JX.fromRgb(0,0,0)}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile"),this.ignoredFieldsUpdate.add("charset")}async loadCharSet(){await this.loadCharSetInternal(this.charset,this.charsetFile,this.charsetWidth,this.charsetHeight)}updateScreen(e,t){super.updateScreen(e,t);const r=this.screenWidth/this.charWidth,i=this.screenHeight/this.charHeight,s=new J.Cs(0,0,this.charWidth,this.charHeight),a=2*this.getCursorPos();let n=0;for(let o=0;o<i;o++)for(let i=0;i<r;i++){const r=this.ram[n+1],c=7&r,h=r>>4&7;let l=(8&r)>0?this.textHiColor:this.textColor,d=this.backgroundColor;if(0==c&&7==h){const e=l;l=d,d=e}const u=this.ram[n],b=this.charset[u],m=this.drawChar(u,b,l,d,1==c&&0==h,n==a&&this.cursorOn);s.x=i*this.charWidth,s.y=o*this.charHeight,this.writePixels(e,t,m,s),n+=2}}in(e){return 954===e?(this.horRetrace=1-this.horRetrace,255&(this.horRetrace|this.horRetrace<<3)):0}out(e,t,r){switch(e){case 948:this.setIndexRegister(255&t);break;case 949:this.setDataRegister(255&t)}}}class z extends b.H{constructor(e){super(),Object.defineProperty(this,"basePort",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.basePort=e}in(e){const t=new Date;switch(e-this.basePort){case 0:return this.calcBcd(t.getMilliseconds()%100);case 1:return this.calcBcd(Math.trunc(t.getMilliseconds()/10));case 2:return this.calcBcd(t.getSeconds());case 3:return this.calcBcd(t.getMinutes());case 4:return this.calcBcd(t.getHours());case 5:return this.calcBcd((t.getDay()+6)%7+1);case 6:return this.calcBcd(t.getDate());case 7:return this.calcBcd(t.getMonth());case 9:return this.calcBcd(t.getFullYear()%100);case 16:case 20:return 0}return 0}calcBcd(e){return e%10+(Math.trunc(e/10)<<4)&255}out(e,t,r){}}var q,Q=r(841);!function(e){e[e.None=0]="None",e[e.Text40x25=1]="Text40x25",e[e.Text80x25=2]="Text80x25",e[e.GraphicsLo=3]="GraphicsLo",e[e.GraphicsHi=4]="GraphicsHi"}(q||(q={}));class K extends Q.c{constructor(){super(),Object.defineProperty(this,"charsetFile1",{enumerable:!0,configurable:!0,writable:!0,value:"Fonts/cga1.dat"}),Object.defineProperty(this,"charsetFile2",{enumerable:!0,configurable:!0,writable:!0,value:"Fonts/cga2.dat"}),Object.defineProperty(this,"charsetWidth",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"charsetHeight",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"horRetrace",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"colorSelectRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"modeControlRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blackWhite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"charset1",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"charset2",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"activeCharsetNo",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.startAddr=753664,this.setRamSize(16384),this.charWidth=8,this.charHeight=8,this.activeCharsetNo=1,this.lineCount=200}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile1"),this.ignoredFields.add("charsetFile2"),this.ignoredFieldsUpdate.add("charset1"),this.ignoredFieldsUpdate.add("charset2")}modeChanged(){super.modeChanged(),this.calcRetraceValues(),this.charCache.clear()}getCharset(){return 0==this.activeCharsetNo?this.charset1:this.charset2}updateScreenGraphicsLo(e){const t=this.getCgaGraphicsColors(this.colorSelectRegister),r=new Uint32Array(e.buffer);let i=0,s=0,a=8192;for(let e=0;e<200;e++){let n=0==(1&e)?s:a;for(let e=0;e<320;e+=4){const e=this.ram[n];let s;s=t[e>>6],r[i++]=s.value,s=t[e>>4&3],r[i++]=s.value,s=t[e>>2&3],r[i++]=s.value,s=t[3&e],r[i++]=s.value,n++}e%2==0?s=n:a=n}}updateScreenGraphicsHi(e){const t=this.cgaColors[15&this.colorSelectRegister],r=new Uint32Array(e.buffer);let i=0,s=0,a=8192;for(let e=0;e<200;e++){let n=0==(1&e)?s:a;for(let e=0;e<640;e+=8){let e=this.ram[n];for(let s=0;s<8;s++)(128&e)>0&&(r[i]=t.value),i++,e<<=1;n++}e%2==0?s=n:a=n}}updateTextScreen(e,t,r,i,s,a){const n=new J.Cs(0,0,this.charWidth,this.charHeight),o=2*this.getCursorPos();let c=0;for(let h=0;h<s;h++,n.y+=this.charHeight){n.x=0;for(let s=0;s<i;s++,n.x+=this.charWidth){const i=this.ram[c+1],s=this.blink&&(128&i)>0,h=this.blink?a[i>>4&7]:a[i>>4];let l=a[15&i];s&&!this.cursorOn&&(l=h);const d=this.ram[c],u=r[d],b=this.drawChar(d,u,l,h,!1,c==o&&this.cursorOn);this.writePixels(e,t,b,n),c+=2}}}async loadCharSet(){await this.loadCharSetInternal(this.charset1,this.charsetFile1,this.charsetWidth,this.charsetHeight),await this.loadCharSetInternal(this.charset2,this.charsetFile2,this.charsetWidth,this.charsetHeight)}updateScreen(e,t){switch(super.updateScreen(e,t),this.mode){case q.Text40x25:this.updateTextScreen(e,t,this.getCharset(),40,25,this.cgaColors);break;case q.Text80x25:this.updateTextScreen(e,t,this.getCharset(),80,25,this.cgaColors);break;case q.GraphicsLo:this.updateScreenGraphicsLo(e);break;case q.GraphicsHi:this.updateScreenGraphicsHi(e)}}in(e){switch(e){case 977:case 979:case 981:case 983:return this.getDataRegister();case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister;case 986:{0==this.horRetrace&&(this.horRetrace=2),this.horRetrace--;let e=this.calcVertRetrace()?8:0;return e+=0==this.horRetrace?0:1,255&e}}return 0}out(e,t,r){switch(e){case 976:case 978:case 980:case 982:this.setIndexRegister(t);break;case 977:case 979:case 981:case 983:this.setDataRegister(t);break;case 984:{this.modeControlRegister=255&t,this.blink=(32&t)>0,this.blackWhite=(4&t)>0;const e=this.mode;switch(27&t){case 8:this.mode=q.Text40x25,this.screenWidth=320,this.screenHeight=200;break;case 9:this.mode=q.Text80x25,this.screenWidth=640,this.screenHeight=200;break;case 10:this.mode=q.GraphicsLo,this.screenWidth=320,this.screenHeight=200;break;case 26:this.mode=q.GraphicsHi,this.screenWidth=640,this.screenHeight=200}this.mode!=e&&this.modeChanged()}break;case 985:this.colorSelectRegister=255&t}}}var Y,ee,te,re,ie,se,ae,ne=r(242);!function(e){e[e.None=0]="None",e[e.M00_CGA=1]="M00_CGA",e[e.M00_EGA=2]="M00_EGA",e[e.M02_CGA=3]="M02_CGA",e[e.M02_EGA=4]="M02_EGA",e[e.M04=5]="M04",e[e.M06=6]="M06",e[e.M07=7]="M07",e[e.M0D=8]="M0D",e[e.M0E=9]="M0E",e[e.M0F=10]="M0F",e[e.M10=11]="M10"}(Y||(Y={}));class oe extends ne.b{constructor(){super(),Object.defineProperty(this,"diagnosticCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"egaSwitches",{enumerable:!0,configurable:!0,writable:!0,value:[!1,!0,!0,!1]}),Object.defineProperty(this,"charWidth9Bits",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:Y.None}),this.screenWidth=640,this.screenHeight=350,this.charBoxWidth=this.charWidth=8}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("egaSwitches")}in(e){switch(e){case 962:{let e=this.calcVertRetrace()?0:128;const t=this.miscOutputRegister>>2&3;return e+=this.egaSwitches[t]?0:16,e+=0,255&e}case 968:return 0;case 986:{this.attributeFlipFlop=!1;const e=this.calcRetraceEnable();let t=(e.vertRetrace?8:0)+(e.enable?0:1);return 4==++this.diagnosticCount&&(this.diagnosticCount=0),t+=this.diagnosticCount>1?48:0,255&t}default:return super.in(e)}}out(e,t,r){switch(e){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&t,this.attributeIndex){case 16:this.graphicsMode=(1&t)>0,this.monochrome=(2&t)>0,this.charWidth9Bits=(4&t)>0,this.blink=(8&t)>0;break;case 17:this.overscanColor=this.genColor(255&t);break;case 18:for(let e=0;e<this.colorPlaneEnabled.length;e++)this.colorPlaneEnabled[e]=(t&1<<e)>0;break;default:this.attributeIndex>=0&&this.attributeIndex<=15&&(this.egaPalette[this.attributeIndex]=this.genColor(255&t),this.cgaPalette[this.attributeIndex]=this.genCgaColor(255&t))}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&t,this.attributeFlipFlop=!this.attributeFlipFlop,r&&this.out(e,t>>8,!1);break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&t;break;case 2:this.mapMaskRegister=255&t,this.mapMask[0]=(1&t)>0,this.mapMask[1]=(2&t)>0,this.mapMask[2]=(4&t)>0,this.mapMask[3]=(8&t)>0;break;case 3:this.characterMapSelectRegister=255&t,this.characterMapA=t>>2&3,this.characterMapB=3&t;break;case 4:this.memoryModeRegister=255&t,this.oddEven=0==(4&t)}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&t);break;case 970:case 972:break;default:super.out(e,t,r)}}calcMode(){const e=this.mode,t=this.sequencerRegisters[1],r=this.sequencerRegisters[2],i=this.sequencerRegisters[4];11==t&&3==i?(35==this.miscOutputRegister&&(this.mode=Y.M00_CGA),167==this.miscOutputRegister&&(this.mode=Y.M00_EGA)):1==t&&3==i?(35==this.miscOutputRegister&&(this.mode=Y.M02_CGA),167==this.miscOutputRegister&&(this.mode=Y.M02_EGA)):11==t&&2==i?this.mode=Y.M04:1==t&&6==i?35==this.miscOutputRegister?1==r?this.mode=Y.M06:15==r&&(this.mode=Y.M0E):162==this.miscOutputRegister?this.mode=Y.M0F:167==this.miscOutputRegister&&(this.mode=Y.M10):0==t&&3==i?this.mode=Y.M07:1==t&&6==i?this.mode=Y.M04:11==t&&6==i&&(this.mode=Y.M0D),this.mode!=e&&this.modeChanged()}getCgaGraphicsColors(e){return this.cgaPalette}modeChanged(){super.modeChanged(),0==(this.miscOutputRegister>>2&3)?this.lineCount=200:this.lineCount=350,(8&this.clockMode)>0?this.colCount=320:this.colCount=640,this.calcRetraceValues()}updateDimensions(){switch(this.calcMode(),this.mode){case Y.M00_CGA:this.screenWidth=320,this.screenHeight=200;break;case Y.M00_EGA:this.screenWidth=320,this.screenHeight=350;break;case Y.M02_CGA:this.screenWidth=640,this.screenHeight=200;break;case Y.M02_EGA:this.screenWidth=640,this.screenHeight=350;break;case Y.M04:this.screenWidth=320,this.screenHeight=200;break;case Y.M06:this.screenWidth=640,this.screenHeight=200;break;case Y.M07:this.screenWidth=720,this.screenHeight=350;break;case Y.M0D:this.screenWidth=320,this.screenHeight=200;break;case Y.M0E:this.screenWidth=640,this.screenHeight=200;break;case Y.M0F:case Y.M10:this.screenWidth=640,this.screenHeight=350}}updateScreen(e,t){switch(super.updateScreen(e,t),i.Zr.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.mode){case Y.M00_CGA:case Y.M00_EGA:case Y.M02_CGA:case Y.M02_EGA:this.updateTextScreen(e,t,this.egaPalette);break;case Y.M04:this.updateScreenCgaLo(e);break;case Y.M06:this.updateScreenCgaMono(e,640,200);break;case Y.M07:break;case Y.M0D:this.updateScreen16Col(e,320,200,this.cgaPalette);break;case Y.M0E:this.updateScreen16Col(e,640,200,this.cgaPalette);break;case Y.M0F:break;case Y.M10:this.updateScreen16Col(e,640,350,this.egaPalette)}}}!function(e){e[e.None=0]="None",e[e.M01_CGA=1]="M01_CGA",e[e.M01_EGA=2]="M01_EGA",e[e.M01_VGA=3]="M01_VGA",e[e.M03_CGA=4]="M03_CGA",e[e.M03_EGA=5]="M03_EGA",e[e.M03_VGA=6]="M03_VGA",e[e.M04=7]="M04",e[e.M06=8]="M06",e[e.M07_EGA=9]="M07_EGA",e[e.M07_VGA=10]="M07_VGA",e[e.M0D=11]="M0D",e[e.M0E=12]="M0E",e[e.M0F=13]="M0F",e[e.M10=14]="M10",e[e.M11=15]="M11",e[e.M12=16]="M12",e[e.M13=17]="M13",e[e.MX_320x240=18]="MX_320x240"}(ee||(ee={})),function(e){e[e.Read=0]="Read",e[e.Write=1]="Write"}(te||(te={}));class ce extends ne.b{getModeC256(){return(64&this.gdcRegisters[5])>0}getNineDotMode(){return 0==(1&this.sequencerRegisters[1])}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB&&(2&this.sequencerRegisters[4])>0}constructor(){super(),Object.defineProperty(this,"vgaSwitches",{enumerable:!0,configurable:!0,writable:!0,value:[!1,!0,!0,!1]}),Object.defineProperty(this,"paletteRam",{enumerable:!0,configurable:!0,writable:!0,value:new Array(16)}),Object.defineProperty(this,"dacMask",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"videoSubsystemEnableRegister1",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"videoSubsystemEnableRegister2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacEntries",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"dacWriteColIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacReadColIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dacMemR",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacMemG",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"charWidth9Bits",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:ee.None}),this.charBoxWidth=this.charWidth=8,this.colCount=this.screenWidth=640,this.lineCount=this.screenHeight=480,this.dacMask=255,this.sequencerRegisters[4]=2,this.calcRetraceValues()}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("vgaSwitches"),this.ignoredFields.add("egaPalette"),this.ignoredFields.add("cgaPalette")}in(e){if(e==this.crtBasePort+10){this.attributeFlipFlop=!1;const e=this.calcRetraceEnable();return 255&(e.vertRetrace?8:0)+(e.enable?0:1)}switch(e){case 962:{let e=this.calcVertRetrace()?0:128;const t=this.miscOutputRegister>>2&3;return e+=this.vgaSwitches[t]?0:16,255&e}case 963:return this.videoSubsystemEnableRegister1;case 964:return 65535&this.sequencerIndex;case 965:return this.sequencerIndex<this.sequencerRegisters.length?this.sequencerRegisters[this.sequencerIndex]:0;case 966:return this.dacMask;case 967:return 65535&(this.dacMode==te.Read?0:3);case 969:{if(this.dacMode!=te.Read)return 0;const e=Math.trunc(this.dacReadColIndex/3);let t=0;switch(this.dacReadColIndex%3){case 0:t=this.dacEntries[e].r;break;case 1:t=this.dacEntries[e].g;break;case 2:t=this.dacEntries[e].b}return 768==++this.dacReadColIndex&&(this.dacReadColIndex=0),t>>2&65535}case 970:return this.featureControlRegister;case 972:return 207&this.miscOutputRegister;case 974:return 65535&this.gdcIndex;case 975:return 65535&(this.gdcIndex<this.gdcRegisters.length?this.gdcRegisters[this.gdcIndex]:0);case 18152:return this.videoSubsystemEnableRegister2}return super.in(e)}out(e,t,r){switch(e){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&t,this.attributeIndex){case 16:this.graphicsMode=(1&t)>0,this.monochrome=(2&t)>0,this.charWidth9Bits=(4&t)>0,this.blink=(8&t)>0;break;case 17:this.overscanColor=this.genColor(255&t);break;case 18:for(let e=0;e<this.colorPlaneEnabled.length;e++)this.colorPlaneEnabled[e]=(t&1<<e)>0;break;default:this.attributeIndex<=15&&(this.paletteRam[this.attributeIndex]=63&t)}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&t,this.attributeFlipFlop=!this.attributeFlipFlop,r&&this.out(e,t>>8&65535,!1);break;case 963:this.videoSubsystemEnableRegister1=255&t;break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&t;break;case 2:this.mapMaskRegister=255&t,this.mapMask[0]=(1&t)>0,this.mapMask[1]=(2&t)>0,this.mapMask[2]=(4&t)>0,this.mapMask[3]=(8&t)>0;break;case 3:this.characterMapSelectRegister=255&t,this.characterMapA=((32&t)>>5)+(t>>1&6),this.characterMapB=((16&t)>>4)+(t<<1&6);break;case 4:t|=2,this.memoryModeRegister=255&t,this.oddEven=0==(4&t),this.chain4=(8&t)>0}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&t);break;case 966:this.dacMask=255&t;break;case 967:this.dacReadColIndex=3*(255&t),this.dacMode=te.Read;break;case 968:this.dacWriteColIndex=3*(255&t),this.dacMode=te.Write;break;case 969:{if(this.dacMode!=te.Write)return;const e=Math.trunc(this.dacWriteColIndex/3),r=t<<2&255;switch(this.dacWriteColIndex%3){case 0:this.dacMemR=r;break;case 1:this.dacMemG=r;break;case 2:this.dacEntries[e]=J.JX.fromRgb(this.dacMemR,this.dacMemG,r)}768==++this.dacWriteColIndex&&(this.dacWriteColIndex=0);break}case 18152:this.videoSubsystemEnableRegister2=255&t;break;default:super.out(e,t,r)}}internalPoke(e,t,r){3==this.writeMode||super.internalPoke(e,t,r)}setDataRegister(e){(0==(128&this.crtRegisters[17])||this.crtIndexReg>7)&&super.setDataRegister(e)}GetDataRegister(){return this.crtIndexReg<this.crtRegisters.length?this.crtRegisters[this.crtIndexReg]:0}calcMode(){const e=this.mode,t=254&this.sequencerRegisters[1],r=this.sequencerRegisters[2],i=this.sequencerRegisters[4],s=204&this.miscOutputRegister,a=this.crtRegisters[23];this.getModeC256()?this.mode=ee.M13:8==t&&3==i?64==s?this.mode=ee.M01_CGA:128==s?this.mode=ee.M01_EGA:68==s&&(this.mode=ee.M01_VGA):0==t&&3==i?64==s?this.mode=ee.M03_CGA:128==s?this.mode=ee.M03_EGA:68==s&&(this.mode=ee.M03_VGA):8==t&&2==i?this.mode=ee.M04:0==t&&6==i?64==s?1==r?this.mode=ee.M06:15==r&&(this.mode=ee.M0E):128==s?this.mode=ee.M10:192==s&&(195==a?this.mode=ee.M11:227==a&&(this.mode=ee.M12)):0==t&&3==i?this.mode=this.getNineDotMode()?ee.M07_VGA:ee.M07_EGA:8==t&&6==i&&(this.mode=ee.M0D),this.mode!=e&&this.modeChanged()}getCgaGraphicsColors(e){let t=new Array(4);for(var r=0;r<4;r++)t[r]=this.dacEntries[r];return t}modeChanged(){switch(super.modeChanged(),this.miscOutputRegister>>6&3){case 1:this.lineCount=400;break;case 2:this.lineCount=350;break;case 3:this.lineCount=480}const e=0==(this.miscOutputRegister>>2&3)?640:720;(8&this.clockMode)>0?this.colCount=e>>1:this.colCount=e,this.calcRetraceValues()}gen16ColPalette(){const e=(128&this.attributeRegisters[16])>0,t=this.attributeRegisters[20],r=new Array(16);for(let i=0;i<16;i++){const s=63&this.paletteRam[i],a=e?15&s|(15&t)<<4:s|(12&t)<<4;r[i]=this.dacEntries[a&this.dacMask]}return r}updateDimensions(){switch(this.calcMode(),this.mode){case ee.M01_CGA:this.screenWidth=320,this.screenHeight=200;break;case ee.M01_EGA:this.screenWidth=320,this.screenHeight=350;break;case ee.M01_VGA:this.screenWidth=360,this.screenHeight=400;break;case ee.M03_CGA:this.screenWidth=640,this.screenHeight=200;break;case ee.M03_EGA:this.screenWidth=640,this.screenHeight=350;break;case ee.M03_VGA:this.screenWidth=720,this.screenHeight=400;break;case ee.M04:this.screenWidth=320,this.screenHeight=200;break;case ee.M06:this.screenWidth=640,this.screenHeight=200;break;case ee.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case ee.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case ee.M0D:this.screenWidth=320,this.screenHeight=200;break;case ee.M0E:this.screenWidth=640,this.screenHeight=200;break;case ee.M0F:case ee.M10:this.screenWidth=640,this.screenHeight=350;break;case ee.M11:case ee.M12:this.screenWidth=640,this.screenHeight=480;break;case ee.M13:this.screenWidth=320,this.screenHeight=200;break;case ee.MX_320x240:this.screenWidth=320,this.screenHeight=240}}updateScreen(e,t){switch(super.updateScreen(e,t),i.Zr.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.charBoxWidth=this.getNineDotMode()?9:8,this.mode){case ee.M01_CGA:case ee.M01_EGA:case ee.M01_VGA:case ee.M03_CGA:case ee.M03_EGA:case ee.M03_VGA:this.updateTextScreen(e,t,this.egaPalette);break;case ee.M04:this.updateScreenCgaLo(e);break;case ee.M06:this.screenWidth=640,this.screenHeight=200,this.updateScreenCgaMono(e,640,200);break;case ee.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case ee.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case ee.M0D:this.screenWidth=320,this.screenHeight=200,this.updateScreen16Col(e,320,200,this.cgaPalette);break;case ee.M0E:this.screenWidth=640,this.screenHeight=200,this.updateScreen16Col(e,640,200,this.cgaPalette);break;case ee.M0F:this.screenWidth=640,this.screenHeight=350;break;case ee.M10:this.screenWidth=640,this.screenHeight=350,this.updateScreen16Col(e,640,350,this.gen16ColPalette());break;case ee.M11:this.screenWidth=640,this.screenHeight=480,this.updateScreenVgaMono(e,640,480);break;case ee.M12:this.screenWidth=640,this.screenHeight=480,this.updateScreen16Col(e,640,480,this.gen16ColPalette());break;case ee.M13:this.screenWidth=320,this.screenHeight=200,this.updateScreen256ColChain4(e,320,200);break;case ee.MX_320x240:this.screenWidth=640,this.screenHeight=480}}updateScreen256ColChain4(e,t,r){const i=new Uint32Array(e.buffer),s=this.dacEntries,a=0==this.getCrtOffset()?Math.trunc(t/4):this.getCrtOffset()<<1;let n=this.getCrtStartAddr(),o=0;const c=this.getHorizontalPixelPanning(),h=0==c?t:t+4;for(let e=0;e<r;e++){let e=65535&n;for(let t=0;t<h;t+=4,e++)for(let r=0;r<4;r++)(0==c||t+r>=c&&t+r<h-8+c)&&(i[o++]=s[this.planes[r][e]].value);n+=a}}updateScreenVgaMono(e,t,r){const i=new Uint32Array(e.buffer),s=J.JX.fromRgb(255,255,255),a=this.overscanColor;let n=0,o=0;for(let e=0;e<r;e++)for(let e=0;e<t;e+=8){let e=this.planes[0][n];for(let t=0;t<8;t++)i[o++]=(128&e)>0?s.value:a.value,e<<=1;n++}}}class he{}Object.defineProperty(he,"screenUpdateFreq",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(he,"runFreq",{enumerable:!0,configurable:!0,writable:!0,value:25});class le{getWorkLoad(){return this.cpu.workLoad}getInstCount(){return this.cpu.instCount}getCpuName(){return this.cpu.getName()}getAX(){return this.cpu.AX}getBX(){return this.cpu.BX}getCX(){return this.cpu.CX}getDX(){return this.cpu.DX}getSP(){return this.cpu.SP}getBP(){return this.cpu.BP}getSI(){return this.cpu.SI}getDI(){return this.cpu.DI}getCS(){return this.cpu.CS}getDS(){return this.cpu.DS}getES(){return this.cpu.ES}getSS(){return this.cpu.SS}getIP(){return this.cpu.IP}getFLAGS(){return this.cpu.FLAGS}getHalt(){return this.cpu.halt}getInstructionByte(){return this.cpu.getInstructionByte()}getAddressByte(){return this.cpu.getAddressByte()}getScreenWidth(){return this.graphicsCard.screenWidth}getScreenHeight(){return this.graphicsCard.screenHeight}constructor(){switch(Object.defineProperty(this,"memMapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"portMapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"components",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"cpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmaController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyboard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"speakerController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ppi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hardDisk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"floppyDisk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uartPort1",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uartPort2",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mouse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"roms",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),Object.defineProperty(this,"graphicsCard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disassembler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"soundGenerator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isRunning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.memMapper=new s(i.Zr.ramAmount),this.portMapper=new a,i.Zr.cpuType){case u.VQ.Cpu186:this.cpu=new Z(this.memMapper,this.portMapper);break;case u.VQ.Cpu386:this.cpu=new V(this.memMapper,this.portMapper)}this.disassembler=new U(this.cpu,this.memMapper)}updateGraphicDimensions(){this.graphicsCard?.updateDimensions()}updateScreen(e,t){this.graphicsCard?.updateScreen(e,t)}dumpMemory(e){throw new Error("Method not implemented.")}getMemByte(e){return this.memMapper.peek(e)}async prepare(){for(const e of this.roms)this.memMapper.register(e.startAddr,e.getEndAddr(),e),this.registerComponent(e);if(i.Zr.enableUma){const e=new $(128,851968);this.memMapper.register(e.addrLo,e.addrHi,e),this.registerComponent(e)}switch(this.dmaController=new m(this.memMapper,(()=>this.timer.memRefreshActive)),this.portMapper.register(0,15,this.dmaController),this.portMapper.register(128,143,this.dmaController),this.portMapper.register(192,223,this.dmaController),this.registerComponent(this.dmaController),this.interruptController=new g,this.portMapper.register(32,33,this.interruptController),this.registerComponent(this.interruptController),i.Zr.graphicsAdapterType){case i.wf.MDA:this.graphicsCard=new _,this.portMapper.register(944,959,this.graphicsCard),this.memMapper.register(720896,737279,this.graphicsCard);break;case i.wf.CGA:this.graphicsCard=new K,this.portMapper.register(976,991,this.graphicsCard),this.memMapper.register(753664,770047,this.graphicsCard);break;case i.wf.EGA:this.graphicsCard=new oe,this.portMapper.register(960,991,this.graphicsCard),this.memMapper.register(655360,786431,this.graphicsCard);break;case i.wf.VGA:this.graphicsCard=new ce,this.portMapper.register(944,991,this.graphicsCard),this.portMapper.register(18152,18152,this.graphicsCard),this.memMapper.register(655360,786431,this.graphicsCard)}if(this.graphicsCard.setScreenUpdateRate(he.screenUpdateFreq),await this.graphicsCard.loadCharSet(),this.registerComponent(this.graphicsCard),this.ppi=new p(this.interruptController,(()=>this.onSpeaker())),this.portMapper.register(96,99,this.ppi),this.registerComponent(this.ppi),this.speakerController=this.ppi,this.keyboard=this.ppi,this.timer=new y(this.interruptController,(()=>this.onSpeaker())),this.portMapper.register(64,95,this.timer),this.registerComponent(this.timer),i.Zr.enableHdController&&(this.hardDisk=new B(this.interruptController,this.dmaController),await this.hardDisk.loadImages(),this.portMapper.register(800,803,this.hardDisk),this.registerComponent(this.hardDisk)),this.floppyDisk=new N(this.interruptController,this.dmaController),this.portMapper.register(1008,1015,this.floppyDisk),this.registerComponent(this.floppyDisk),this.mouse=new W(this.cpu),i.Zr.com1Device!=i.V8.None&&(this.uartPort1=new x(1016,h.Serial4,this.interruptController),this.portMapper.register(1016,1023,this.uartPort1),this.registerComponent(this.uartPort1),this.connectSerialDevice(this.uartPort1,i.Zr.com1Device)),i.Zr.com2Device!=i.V8.None&&(this.uartPort2=new x(760,h.Serial3,this.interruptController),this.portMapper.register(760,767,this.uartPort2),this.registerComponent(this.uartPort2),this.connectSerialDevice(this.uartPort2,i.Zr.com2Device)),i.Zr.enableRtc){const e=new z(832);this.portMapper.register(832,855,e),this.registerComponent(e)}this.memMapper.FinishRegistration()}connectSerialDevice(e,t){t==i.V8.EmulatedMouse&&e.connect(this.mouse)}registerComponent(e){this.components.push(e),e.eventTimer=this.cpu,e.doCpuInterrupt=e=>this.cpu.doInterrupt(e)}onSpeaker(){this.soundGenerator?.setFrequency(this.speakerController.speakerEnabled?this.timer.speakerFrequency:0)}step(){this.cpu.execNextInstruction()}runClocks(e){this.cpu.execInstructions(e)}get eventTimer(){return this.cpu}async reset(){await(this.hardDisk?.saveImages()),await(this.floppyDisk?.saveImages()),this.cpu.reset();for(const e of this.components)e.reset()}async loadRom(e,t){const r=new F(t);await r.load(e),this.roms.push(r)}async loadDiskImageFromFile(e,t){return await this.floppyDisk.loadImageFromFile(e,t)}loadDiskImageFromBuffer(e,t){this.floppyDisk.loadImageFromBuffer(e,t)}async newDiskImage(e){await this.floppyDisk.newImage(e)}getDiskImage(e){return this.floppyDisk.getDiskImage(e)}async ejectDiskImage(e){await this.floppyDisk.ejectImage(e)}runDebug(e){for(this.cpu.reset();!this.cpu.halt;)this.disassembler.doDisassemble(),e(this.disassembler.disassembledLine),this.cpu.execNextInstruction();e(""),e("finished.")}sendKey(e){this.keyboard.addScanCode(e)}screenMouseEvent(e,t,r){this.mouse?.mouseEventRel(e,t,r)}screenMouseReset(){this.mouse.resetMove()}mouseMoveDelta(e,t){this.mouse.mouseMoveDelta(e,t)}async loadIntoRam(e,t){}async loadBios(e){const t=new F(0);await t.load(e),t.startAddr=1048576-t.size,this.roms.push(t)}async saveImages(){await this.hardDisk.saveImages(),await this.floppyDisk.saveImages()}}!function(e){e.Initialize="initialize",e.UpdateScreen="updatescreen"}(re||(re={})),function(e){e.Initialized="initialized",e.ScreenUpdated="screenupdated"}(ie||(ie={})),function(e){e.Initialize="initialize",e.Run="run",e.Stop="stop",e.Reset="reset",e.SendKey="sendkey",e.LoadImage="loadimage",e.NewImage="newimage",e.DownloadImage="downloadimage",e.SaveImages="saveimages",e.MouseReset="mousereset",e.MouseEvent="mouseevent",e.MouseMoveDelta="mousemovedelta"}(se||(se={})),function(e){e.Initialized="initialized",e.DownloadImage="downloadimage",e.CpuLoad="cpuload",e.Stopped="stopped"}(ae||(ae={}));const de=self;new class{constructor(e){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"emulator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"screenWorkerPort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"running",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"doReset",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clocksPerInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"perfInterval",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"perfCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"perfFreeTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.context=e,e.onmessage=e=>{switch(e.data[0]){case se.Initialize:this.initialized||(this.screenWorkerPort=e.data[2],this.initialize(e.data[1]));break;case se.Run:this.running=!0,this.doRun(),this.doScreenUpdate();break;case se.Stop:this.emulator.saveImages(),this.running=!1;break;case se.Reset:this.doReset=!0;break;case se.SendKey:this.running&&this.emulator.sendKey(e.data[1]);break;case se.LoadImage:if(!this.initialized)return;this.emulator.loadDiskImageFromBuffer(e.data[2],e.data[1]);break;case se.NewImage:this.emulator.newDiskImage(e.data[1]);break;case se.DownloadImage:{const t=e.data[1],r=this.emulator.getDiskImage(t);r&&this.context.postMessage([ae.DownloadImage,t,r])}break;case se.SaveImages:this.emulator.saveImages();break;case se.MouseReset:if(!this.initialized)return;this.emulator.screenMouseReset();break;case se.MouseEvent:{if(!this.initialized)return;const t=e.data[1],r=e.data[2],i=e.data[3];this.emulator.screenMouseEvent(t,r,i)}break;case se.MouseMoveDelta:{if(!this.initialized)return;const t=e.data[1],r=e.data[2];this.emulator.mouseMoveDelta(t,r)}}}}triggerScreenUpdate(){if(this.running){this.emulator.updateGraphicDimensions();const e=this.emulator.graphicsCard.getJsonUpdate(),t=this.emulator.graphicsCard.getMemoryData();this.screenWorkerPort.postMessage([re.UpdateScreen,e,this.emulator.getScreenWidth(),this.emulator.getScreenHeight(),...t])}}async doRun(){this.doReset&&(this.doReset=!1,this.emulator.reset()),0==this.perfCount&&(this.perfCount=this.perfInterval*he.runFreq/1e3,this.perfFreeTime=0);const e=performance.now();this.emulator.runClocks(this.clocksPerInterval);const t=performance.now()-e,r=1e3/he.runFreq,i=t<r?r-t:1;this.perfFreeTime+=i,this.perfCount--,0==this.perfCount&&this.context.postMessage([ae.CpuLoad,1-this.perfFreeTime/this.perfInterval]),this.running?setTimeout((()=>{this.doRun()}),i):(this.context.postMessage([ae.Stopped]),this.context.postMessage([ae.CpuLoad,0]))}doScreenUpdate(){this.triggerScreenUpdate(),this.running&&setTimeout((()=>{this.doScreenUpdate()}),1e3/he.screenUpdateFreq)}async initialize(e){switch(i.Zr.baseDir="../",i.Zr.hdImageDir="HdImages/",i.Zr.cpuType=e.cpuType,i.Zr.cpuFrequency=e.cpuFrequency,i.Zr.ramAmount=e.ramAmount,i.Zr.graphicsAdapterType=e.graphicsAdapterType,i.Zr.enableHdController=e.enableHdController,i.Zr.enableUma=e.enableUma,i.Zr.enableRtc=e.enableRtc,i.Zr.com1Device=e.com1Device,i.Zr.com2Device=e.com2Device,this.clocksPerInterval=Math.trunc(1e3*i.Zr.cpuFrequency/he.runFreq),this.emulator=new le,await this.emulator.loadBios("Roms/BIOS/"+e.biosImage),i.Zr.graphicsAdapterType){case i.wf.EGA:await this.emulator.loadRom("Roms/EGA/genoa-ega-2.41.rom",786432);break;case i.wf.VGA:await this.emulator.loadRom("Roms/VGA/ibm-vga.rom",786432)}i.Zr.enableHdController&&await this.emulator.loadRom("Roms/Harddisk/IBM_XEBEC_62X0822_1985.BIN",819200),await this.emulator.prepare(),this.initialized=!0,this.screenWorkerPort.postMessage([re.Initialize,i.Zr.graphicsAdapterType,this.emulator.graphicsCard.getJsonInitial()]),this.context.postMessage([ae.Initialized])}}(de)}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={exports:{}};return r[e](a,a.exports,s),a.exports}s.m=r,s.x=()=>{var e=s.O(void 0,[885,242],(()=>s(144)));return s.O(e)},e=[],s.O=(t,r,i,a)=>{if(!r){var n=1/0;for(l=0;l<e.length;l++){for(var[r,i,a]=e[l],o=!0,c=0;c<r.length;c++)(!1&a||n>=a)&&Object.keys(s.O).every((e=>s.O[e](r[c])))?r.splice(c--,1):(o=!1,a<n&&(n=a));if(o){e.splice(l--,1);var h=i();void 0!==h&&(t=h)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[r,i,a]},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>"js/"+e+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e+"../"})(),(()=>{var e={144:1};s.f.i=(t,r)=>{e[t]||importScripts(s.p+s.u(t))};var t=self.webpackChunkemu_xt=self.webpackChunkemu_xt||[],r=t.push.bind(t);t.push=t=>{var[i,a,n]=t;for(var o in a)s.o(a,o)&&(s.m[o]=a[o]);for(n&&n(s);i.length;)e[i.pop()]=1;r(t)}})(),t=s.x,s.x=()=>Promise.all([s.e(885),s.e(242)]).then(t),s.x()})();