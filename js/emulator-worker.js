(()=>{"use strict";var t={939:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ClockCycles386=e.ClockCycles8086=void 0;class s{}e.ClockCycles8086=s,s.Rep=7,s.Lock=2,s.SegOverride=2,s.Aaa=8,s.Aad=15,s.Aam=19,s.Aas=7,s.AdcRegRmReg=3,s.AdcRegRmMem=10,s.AdcRmRegReg=3,s.AdcRmRegMem=10,s.AdcAlImm=3,s.AdcAxImm=4,s.AdcRmImmReg=4,s.AdcRmImmMem=16,s.AddRegRmReg=3,s.AddRegRmMem=10,s.AddRmRegReg=3,s.AddRmRegMem=10,s.AddAlImm=3,s.AddAxImm=4,s.AddRmImmReg=4,s.AddRmImmMem=16,s.AndRegRmReg=3,s.AndRegRmMem=10,s.AndRmRegReg=3,s.AndRmRegMem=10,s.AndRmImmReg=4,s.AndRmImmMem=16,s.AndAlImm=3,s.AndAxImm=4,s.Bound=34,s.CallNear=19,s.CallFar=31,s.CallNearReg=13,s.CallNearMem=19,s.CallFarRm=38,s.Cbw=2,s.Clc=2,s.Cld=2,s.Cli=2,s.Cmc=2,s.CmpRegRmReg=3,s.CmpRegRmMem=10,s.CmpRmRegReg=3,s.CmpRmRegMem=10,s.CmpAlImm=3,s.CmpAxImm=4,s.CmpRmImmReg=3,s.CmpRmImmMem=10,s.Cmps=22,s.Cwd=4,s.Daa=4,s.Das=4,s.DivReg=29,s.DivMem=35,s.DivReg16=38,s.DivMem16=44,s.DecReg=3,s.DecMem=15,s.EnterLvl0=19,s.EnterLvl1=29,s.EnterInitial=26,s.EnterPerLvl=20,s.Hlt=2,s.IdivReg=48,s.IdivMem=54,s.IdivReg16=57,s.IdivMem16=63,s.ImulImmReg=24,s.ImulImmMem=31,s.ImulImmReg16=24,s.ImulImmMem16=31,s.ImulReg=27,s.ImulMem=33,s.ImulReg16=36,s.ImulMem16=42,s.InImm=10,s.InDx=8,s.IncReg=3,s.IncMem=15,s.Ins=14,s.InsRep=8,s.Int3=45,s.IntImm=47,s.Into=48,s.IntoNoInt=4,s.Iret=28,s.JumpCondMet=13,s.JumpCondNotMet=4,s.JcxzMet=15,s.JcxzNotMet=5,s.JmpShort=14,s.JmpNear=14,s.JmpNearReg=11,s.JmpNearMem=17,s.JmpFar=14,s.JmpFarRm=26,s.Lahf=2,s.Lds=18,s.Lea=6,s.Leave=8,s.Les=18,s.Lods=12,s.LodsRep=11,s.Loop=16,s.LoopFinished=6,s.MovAxMemoffs=8,s.MovMemoffsAx=9,s.MovRegImm8=3,s.MovRegImm16=4,s.MovRmImm8=12,s.MovRmImm16=13,s.MovRmRegReg=2,s.MovRmRegMem=12,s.MovRegRmReg=2,s.MovRegRmMem=9,s.MovRmSegReg=2,s.MovRmSegMem=11,s.MovSegRmReg=2,s.MovSegRmMem=9,s.Movs=14,s.MovsRep=8,s.MulReg=27,s.MulMem=33,s.MulReg16=36,s.MulMem16=42,s.NegRmReg=3,s.NegRmMem=10,s.Nop=3,s.NotRmReg=3,s.NotRmMem=10,s.OrRegRmReg=3,s.OrRegRmMem=10,s.OrRmRegReg=3,s.OrRmRegMem=10,s.OrAlImm=3,s.OrAxImm=4,s.OrRmImmReg=4,s.OrRmImmMem=16,s.OutImm=9,s.OutDx=7,s.Outs=14,s.OutsRep=8,s.PopMem=20,s.PopReg=10,s.PopSeg=8,s.Popa=51,s.Popf=8,s.PushMem=20,s.PushReg=10,s.PushSeg=9,s.Pusha=36,s.Pushf=9,s.PushImm8=10,s.PushImm16=10,s.PushRm=16,s.Ret=16,s.RetImm=18,s.Retf=22,s.RetfImm=25,s.Sahf=3,s.SbbRegRmReg=3,s.SbbRegRmMem=10,s.SbbRmRegReg=3,s.SbbRmRegMem=10,s.SbbAlImm=3,s.SbbAxImm=4,s.SbbRmImmReg=4,s.SbbRmImmMem=16,s.Scas=15,s.SetFlag=2,s.ShiftRmReg=2,s.ShiftRmMem=15,s.ShiftRmImmReg=5,s.ShiftRmImmMem=17,s.ShiftRmClReg=5,s.ShiftRmClMem=17,s.Stos=10,s.StosRep=9,s.SubRegRmReg=3,s.SubRegRmMem=10,s.SubRmRegReg=3,s.SubRmRegMem=10,s.SubAlImm=3,s.SubAxImm=4,s.SubRmImmReg=4,s.SubRmImmMem=16,s.TestReg=3,s.TestMem=10,s.TestAlImm=3,s.TestAxImm=4,s.TestRmImmReg=4,s.TestRmImmMem=10,s.Wait=6,s.XchgReg=3,s.XchgRegRmReg=4,s.XchgRegRmMem=17,s.Xlat=11,s.XorRegRmReg=3,s.XorRegRmMem=10,s.XorRmRegReg=3,s.XorRmRegMem=10,s.XorAlImm=3,s.XorAxImm=4,s.XorRmImmReg=4,s.XorRmImmMem=16,s.FpuInstruction=3,s.HardInterrupt=40;class i{}e.ClockCycles386=i,i.Rep=2,i.Lock=2,i.SegOverride=2,i.Aaa=4,i.Aad=19,i.Aam=17,i.Aas=4,i.AdcRegRmReg=2,i.AdcRegRmMem=6,i.AdcRmRegReg=2,i.AdcRmRegMem=7,i.AdcAlImm=2,i.AdcAxImm=2,i.AdcRmImmReg=2,i.AdcRmImmMem=7,i.AddRegRmReg=2,i.AddRegRmMem=6,i.AddRmRegReg=2,i.AddRmRegMem=7,i.AddAlImm=2,i.AddAxImm=2,i.AddRmImmReg=2,i.AddRmImmMem=7,i.AndRegRmReg=2,i.AndRegRmMem=6,i.AndRmRegReg=2,i.AndRmRegMem=7,i.AndAlImm=2,i.AndAxImm=2,i.AndRmImmReg=2,i.AndRmImmMem=7,i.ArplReg=20,i.ArplMem=21,i.Bound=10,i.BsfBase=10,i.BsfBit=3,i.BtReg=3,i.BtMem=10,i.BtImmReg=3,i.BtImmMem=6,i.BtcReg=6,i.BtcMem=13,i.BtcImmReg=6,i.BtcImmMem=8,i.CallNear=7,i.CallFar=17,i.CallNearReg=7,i.CallNearMem=11,i.CallFarRm=22,i.Cbw=3,i.Clc=2,i.Cld=2,i.Cli=3,i.Clts=5,i.Cmc=2,i.CmpRegRmReg=2,i.CmpRegRmMem=6,i.CmpRmRegReg=2,i.CmpRmRegMem=5,i.CmpAlImm=2,i.CmpAxImm=2,i.CmpRmImmReg=2,i.CmpRmImmMem=5,i.Cmps=10,i.Cwd=2,i.Daa=4,i.Das=4,i.DecReg=2,i.DecMem=6,i.DivReg=14,i.DivMem=17,i.DivReg16=22,i.DivMem16=25,i.DivReg32=38,i.DivMem32=41,i.EnterLvl0=10,i.EnterLvl1=12,i.EnterInitial=15,i.EnterPerLvl=4,i.Hlt=5,i.IdivReg=19,i.IdivMem=19,i.IdivReg16=27,i.IdivMem16=27,i.IdivReg32=43,i.IdivMem32=43,i.ImulImmReg=12,i.ImulImmMem=15,i.ImulImmReg16=16,i.ImulImmMem16=19,i.ImulImmReg32=24,i.ImulImmMem32=27,i.ImulReg=12,i.ImulMem=15,i.ImulReg16=16,i.ImulMem16=19,i.ImulReg32=24,i.ImulMem32=27,i.InImm=12,i.InDx=13,i.IncReg=2,i.IncMem=6,i.Ins=15,i.InsRep=15,i.Int3=33,i.IntImm=37,i.Into=35,i.IntoNo=3,i.Iret=22,i.JumpCondMet=7,i.JumpCondNotMet=3,i.JcxzMet=9,i.JcxzNotMet=5,i.JmpShort=7,i.JmpNear=7,i.JmpNearReg=7,i.JmpNearMem=10,i.JmpFar=12,i.JmpFarRm=43,i.Lahf=2,i.Lar=16,i.Lds=7,i.Lea=2,i.Leave=4,i.LidtLgdt=11,i.Lldt=20,i.Ltr=27,i.LmswReg=10,i.LmswMem=13,i.Lods=5,i.LodsRep=5,i.Loop=11,i.LoopFinished=2,i.MovAxMemoffs=4,i.MovMemoffsAx=2,i.MovRegImm8=2,i.MovRegImm16=2,i.MovRmImm8=2,i.MovRmImm16=2,i.MovRmRegReg=2,i.MovRmRegMem=2,i.MovRegRmReg=2,i.MovRegRmMem=4,i.MovRmSegReg=2,i.MovRmSegMem=2,i.MovSegRmReg=2,i.MovSegRmMem=5,i.MovRegCr=6,i.MovCr0Reg=10,i.MovCr2Reg=4,i.MovCr3Reg=5,i.MovDr0Reg=22,i.MovDr6Reg=16,i.MovRegDr0=22,i.MovRegDr6=14,i.MovRegTr=12,i.MovTrReg=12,i.Movs=7,i.MovsRep=7,i.MovsxReg=3,i.MovsxMem=6,i.MovzxReg=3,i.MovzxMem=6,i.MulReg=12,i.MulMem=15,i.MulReg16=16,i.MulMem16=19,i.MulReg32=24,i.MulMem32=27,i.NegRmReg=2,i.NegRmMem=6,i.Nop=3,i.NotRmReg=2,i.NotRmMem=6,i.OrRegRmReg=2,i.OrRegRmMem=7,i.OrRmRegReg=2,i.OrRmRegMem=6,i.OrAlImm=2,i.OrAxImm=2,i.OrRmImmReg=2,i.OrRmImmMem=7,i.OutImm=10,i.OutDx=11,i.Outs=14,i.OutsRep=14,i.PopMem=5,i.PopReg=4,i.PopSeg=7,i.Popa=24,i.Popf=5,i.PushMem=5,i.PushReg=2,i.PushSeg=2,i.Pusha=18,i.Pushf=4,i.PushImm8=2,i.PushImm16=2,i.PushRm=2,i.Ret=10,i.RetImm=10,i.Retf=18,i.RetfImm=18,i.Sahf=3,i.SbbRegRmReg=2,i.SbbRegRmMem=7,i.SbbRmRegReg=2,i.SbbRmRegMem=6,i.SbbAlImm=2,i.SbbAxImm=2,i.SbbRmImmReg=2,i.SbbRmImmMem=7,i.Scas=7,i.SetCondMet=5,i.SetCondNotMet=4,i.SetFlag=2,i.ShiftRmReg=3,i.ShiftRmMem=7,i.ShiftRmImmReg=3,i.ShiftRmImmMem=7,i.ShiftRmClReg=3,i.ShiftRmClMem=7,i.ShldReg=3,i.ShldMem=7,i.SidtSgdt=9,i.Sldt=2,i.SmswReg=2,i.SmswMem=3,i.Stos=4,i.StosRep=4,i.Str=25,i.SubRegRmReg=2,i.SubRegRmMem=7,i.SubRmRegReg=2,i.SubRmRegMem=6,i.SubAlImm=2,i.SubAxImm=2,i.SubRmImmReg=2,i.SubRmImmMem=7,i.TestReg=2,i.TestMem=5,i.TestAlImm=2,i.TestAxImm=2,i.TestRmImmReg=2,i.TestRmImmMem=5,i.Wait=6,i.XchgReg=3,i.XchgRegRmReg=3,i.XchgRegRmMem=5,i.Xlat=5,i.XorRegRmReg=2,i.XorRegRmMem=7,i.XorRmRegReg=2,i.XorRmRegMem=6,i.XorAlImm=2,i.XorAxImm=2,i.XorRmImmReg=2,i.XorRmImmMem=7,i.FpuInstruction=3,i.HardInterrupt=40},139:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cpu186=void 0;const i=s(50),r=s(688),a=s(939),h=s(915);class o{}class n{}e.Cpu186=class{constructor(t,e){this.parities=new Array(256),this.flags=new r.Flags16,this.instStartIp=0,this.repeatIp=0,this.cpuEvents=new Array,this.eventGen=0,this.AX=0,this.BX=0,this.CX=0,this.DX=0,this.SP=0,this.BP=0,this.SI=0,this.DI=0,this.IP=0,this.CS=0,this.SS=0,this.ES=0,this.DS=0,this.instCount=0,this.clockCount=0,this.workLoad=0,this.memoryProvider=t,this.portProvider=e,this.initParities(),this.execReset()}getAL(){return 255&this.AX}setAL(t){this.AX=65280&this.AX|255&t}getAH(){return this.AX>>8&255}setAH(t){this.AX=255&this.AX|(255&t)<<8}getBL(){return 255&this.BX}setBL(t){this.BX=65280&this.BX|255&t}getBH(){return this.BX>>8&255}setBH(t){this.BX=255&this.BX|(255&t)<<8}getCL(){return 255&this.CX}setCL(t){this.CX=65280&this.CX|255&t}getCH(){return this.CX>>8&255}setCH(t){this.CX=255&this.CX|(255&t)<<8}getDL(){return 255&this.DX}setDL(t){this.DX=65280&this.DX|255&t}getDH(){return this.DX>>8&255}setDH(t){this.DX=255&this.DX|(255&t)<<8}get FLAGS(){return this.flags.value}getInstructionByte(){return this.getMemByte(this.CS,this.IP)}getAddressByte(){return this.getMemByte(this.CS,this.IP+1&65535)}getName(){return"Intel 80186"}getCurrentCodeAddr(){return this.genAddr(this.CS,this.IP)}getCodeSeg32Bit(){return!1}initParities(){for(let t=0;t<256;t++){const e=(0!=(1&t)?1:0)+(0!=(2&t)?1:0)+(0!=(4&t)?1:0)+(0!=(8&t)?1:0)+(0!=(16&t)?1:0)+(0!=(32&t)?1:0)+(0!=(64&t)?1:0)+(0!=(128&t)?1:0);this.parities[t]=0==(1&e)}}reset(){this.doReset=!0}execNextInstruction(){this.execInstructions(1)}genAddr(t,e){return(t<<4)+e&1048575}execReset(){this.cpuEvents.length=0,this.hardInterrupt=null,this.softInterrupt=null,this.blockInterrupt=!1,this.stringOperation=i.Repeat.None,this.repeatIp=0,this.segOverride=null,this.flags.value=0,this.IP=65520,this.CS=61440,this.DS=this.ES=this.SS=0,this.halt=!1}execInstructions(t){var e,s,r,h,o,n,c,d,l,m,u,g,p;const C=this.clockCount+t;do{try{for(;this.clockCount<C;){this.instStartIp=this.IP;let t,C=this.readNextCodeByte();if(this.doReset)return this.doReset=!1,void this.execReset();do{switch(t=!1,C){case 243:this.clockCount+=a.ClockCycles8086.Rep,this.stringOperation=i.Repeat.RepZ,this.repeatIp=this.IP-1&65535,C=this.readNextCodeByte(),t=!0;break;case 242:this.clockCount+=a.ClockCycles8086.Rep,this.stringOperation=i.Repeat.RepNz,this.repeatIp=this.IP-1&65535,C=this.readNextCodeByte(),t=!0;break;case 240:this.clockCount+=a.ClockCycles8086.Lock,C=this.readNextCodeByte(),t=!0;break;case 46:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.CS,C=this.readNextCodeByte(),t=!0;break;case 62:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.DS,C=this.readNextCodeByte(),t=!0;break;case 38:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.ES,C=this.readNextCodeByte(),t=!0;break;case 54:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.SS,C=this.readNextCodeByte(),t=!0;break;case 55:this.clockCount+=a.ClockCycles8086.Aaa,(15&this.getAL())>9||this.flags.AF?(this.setAL(this.getAL()+6),this.setAH(this.getAH()+1),this.flags.CF=!0,this.flags.AF=!0):(this.flags.CF=!1,this.flags.AF=!1),this.setAL(15&this.getAL()),this.calcParitySignZeroFlagW(this.AX);break;case 213:{this.clockCount+=a.ClockCycles8086.Aad;const t=this.readNextCodeByte();this.setAL(this.getAH()*t+this.getAL()),this.setAH(0),this.calcParitySignZeroFlagW(this.AX);break}case 212:{this.clockCount+=a.ClockCycles8086.Aam;const t=this.readNextCodeByte();this.setAH(this.getAL()/t),this.setAL(this.getAL()%t),this.calcParitySignZeroFlagW(this.AX);break}case 63:this.clockCount+=a.ClockCycles8086.Aas,(15&this.getAL())>9||this.flags.AF?(this.setAL(this.getAL()-6),this.setAH(this.getAH()-1),this.flags.CF=!0,this.flags.AF=!0):(this.flags.CF=!1,this.flags.AF=!1),this.setAL(15&this.getAL());break;case 16:this.doByteOperation(i.Direction.RegToRm,((t,e)=>this.adcByte(t,e)),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 17:this.doWordOperation(i.Direction.RegToRm,((t,e)=>this.adcWord(t,e)),a.ClockCycles8086.AdcRegRmReg,a.ClockCycles8086.AdcRegRmMem);break;case 18:this.doByteOperation(i.Direction.RmToReg,((t,e)=>this.adcByte(t,e)),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 19:this.doWordOperation(i.Direction.RmToReg,((t,e)=>this.adcWord(t,e)),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 20:{this.clockCount+=a.ClockCycles8086.AddAlImm;const t=this.readNextCodeByte();this.setAL(this.adcByte(this.getAL(),t));break}case 21:{this.clockCount+=a.ClockCycles8086.AddAxImm;const t=this.readNextCodeWord();this.AX=this.adcWord(this.AX,t);break}case 0:this.doByteOperation(i.Direction.RegToRm,((t,e)=>this.addByte(t,e)),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 1:this.doWordOperation(i.Direction.RegToRm,((t,e)=>this.addWord(t,e)),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 2:this.doByteOperation(i.Direction.RmToReg,((t,e)=>this.addByte(t,e)),a.ClockCycles8086.AddRegRmMem,a.ClockCycles8086.AddRegRmMem);break;case 3:this.doWordOperation(i.Direction.RmToReg,((t,e)=>this.addWord(t,e)),a.ClockCycles8086.AddRegRmReg,a.ClockCycles8086.AddRegRmMem);break;case 4:{this.clockCount+=a.ClockCycles8086.AddAlImm;const t=this.readNextCodeByte();this.setAL(this.addByte(this.getAL(),t));break}case 5:{this.clockCount+=a.ClockCycles8086.AddAxImm;const t=this.readNextCodeWord();this.AX=this.addWord(this.AX,t);break}case 32:this.doByteOperation(i.Direction.RegToRm,((t,e)=>{const s=t&e&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s}),a.ClockCycles8086.AndRmRegReg,a.ClockCycles8086.AndRmRegMem);break;case 33:this.doWordOperation(i.Direction.RegToRm,((t,e)=>{const s=t&e&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s}),a.ClockCycles8086.AndRmRegReg,a.ClockCycles8086.AndRmRegMem);break;case 34:this.doByteOperation(i.Direction.RmToReg,((t,e)=>{const s=t&e&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s}),a.ClockCycles8086.AndRegRmReg,a.ClockCycles8086.AndRegRmMem);break;case 35:this.doWordOperation(i.Direction.RmToReg,((t,e)=>{const s=t&e&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s}),a.ClockCycles8086.AndRegRmReg,a.ClockCycles8086.AndRegRmMem);break;case 36:{this.clockCount+=a.ClockCycles8086.AndAlImm;const t=this.readNextCodeByte(),e=this.getAL()&t&255;this.flags.CF=this.flags.OF=!1,this.setAL(e),this.calcParitySignZeroFlagB(e);break}case 37:{this.clockCount+=a.ClockCycles8086.AndAxImm;const t=this.readNextCodeWord(),e=this.AX&t&65535;this.flags.CF=this.flags.OF=!1,this.AX=e,this.calcParitySignZeroFlagW(e)}break;case 98:{this.clockCount+=a.ClockCycles8086.Bound;const t=this.readAndDecodeAddressByte();3==t.mode&&this.handleIllegalOpcode();let e=this.memoryProvider.peekW(t.rmAddr);e>32767&&(e-=65536);let s=this.memoryProvider.peekW(t.rmAddr+2)+2;s>32767&&(s-=65536);let r=this.getRegWord(t.reg);if(r>32767&&(r-=65536),r<e||r>s)throw this.IP=this.instStartIp,new i.CpuError(i.CpuExCode.BR)}break;case 232:{this.clockCount+=a.ClockCycles8086.CallNear;let t=this.readNextCodeWord();t>32767&&(t-=65536),this.pushWord(65535&this.IP),this.IP=this.IP+t&65535;break}case 154:this.clockCount+=a.ClockCycles8086.CallFar;{const t=this.readNextCodeWord(),e=this.readNextCodeWord();this.pushWord(this.CS),this.pushWord(65535&this.IP),this.CS=e,this.IP=t}break;case 152:this.clockCount+=a.ClockCycles8086.Cbw,this.getAL()>127?this.setAH(255):this.setAH(0);break;case 248:this.clockCount+=a.ClockCycles8086.Clc,this.flags.CF=!1;break;case 252:this.clockCount+=a.ClockCycles8086.Cld,this.flags.DF=!1;break;case 250:this.clockCount+=a.ClockCycles8086.Clc,this.flags.IF=!1;break;case 245:this.clockCount+=a.ClockCycles8086.Cmc,this.flags.CF=!this.flags.CF;break;case 56:this.doByteOperation(i.Direction.RegToRm,((t,e)=>(this.subByte(t,e),0)),a.ClockCycles8086.CmpRmRegReg,a.ClockCycles8086.CmpRmRegMem,!1);break;case 57:this.doWordOperation(i.Direction.RegToRm,((t,e)=>(this.subWord(t,e),0)),a.ClockCycles8086.CmpRmRegReg,a.ClockCycles8086.CmpRmRegMem,!1);break;case 58:this.doByteOperation(i.Direction.RmToReg,((t,e)=>(this.subByte(t,e),0)),a.ClockCycles8086.CmpRegRmReg,a.ClockCycles8086.CmpRegRmMem,!1);break;case 59:this.doWordOperation(i.Direction.RmToReg,((t,e)=>(this.subWord(t,e),0)),a.ClockCycles8086.CmpRegRmReg,a.ClockCycles8086.CmpRegRmMem,!1);break;case 60:this.clockCount+=a.ClockCycles8086.CmpAlImm,this.subByte(this.getAL(),this.readNextCodeByte());break;case 61:{this.clockCount+=a.ClockCycles8086.CmpAxImm;const t=this.readNextCodeWord();this.subWord(this.AX,t)}break;case 166:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Cmps,this.subByte(this.getMemByte(null!==(e=this.segOverride)&&void 0!==e?e:this.DS,this.SI),this.getMemByte(this.ES,this.DI)),this.flags.DF?(this.SI=this.SI-1&65535,this.DI=this.DI-1&65535):(this.SI=this.SI+1&65535,this.DI=this.DI+1&65535),this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 167:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Cmps,this.subWord(this.getMemWord(null!==(s=this.segOverride)&&void 0!==s?s:this.DS,this.SI),this.getMemWord(this.ES,this.DI)),this.flags.DF?(this.SI=this.SI-2&65535,this.DI=this.DI-2&65535):(this.SI=this.SI+2&65535,this.DI=this.DI+2&65535),this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 153:this.clockCount+=a.ClockCycles8086.Cwd,this.DX=65535&(this.AX>=32768?65535:0);break;case 39:this.clockCount+=a.ClockCycles8086.Daa,((15&this.getAL())>9||this.flags.AF)&&(this.setAL(this.getAL()+6),this.flags.AF=!0),(this.getAL()>159||this.flags.CF)&&(this.setAL(this.getAL()+96),this.flags.CF=!0),this.calcParitySignZeroFlagB(this.getAL());break;case 47:this.clockCount+=a.ClockCycles8086.Das,((15&this.getAL())>9||this.flags.AF)&&(this.setAL(this.getAL()-6),this.flags.AF=!0),(this.getAL()>159||this.flags.CF)&&(this.setAL(this.getAL()-96),this.flags.CF=!0),this.calcParitySignZeroFlagB(this.getAL());break;case 72:this.clockCount+=a.ClockCycles8086.DecReg,this.AX=this.decWord(this.AX);break;case 73:this.clockCount+=a.ClockCycles8086.DecReg,this.CX=this.decWord(this.CX);break;case 74:this.clockCount+=a.ClockCycles8086.DecReg,this.DX=this.decWord(this.DX);break;case 75:this.clockCount+=a.ClockCycles8086.DecReg,this.BX=this.decWord(this.BX);break;case 76:this.clockCount+=a.ClockCycles8086.DecReg,this.SP=this.decWord(this.SP);break;case 77:this.clockCount+=a.ClockCycles8086.DecReg,this.BP=this.decWord(this.BP);break;case 78:this.clockCount+=a.ClockCycles8086.DecReg,this.SI=this.decWord(this.SI);break;case 79:this.clockCount+=a.ClockCycles8086.DecReg,this.DI=this.decWord(this.DI);break;case 200:{const t=this.readNextCodeWord();let e=this.readNextCodeByte();this.clockCount+=0==e?a.ClockCycles8086.EnterLvl0:1==e?a.ClockCycles8086.EnterLvl1:a.ClockCycles8086.EnterInitial+a.ClockCycles8086.EnterPerLvl*(e-1),e&=31,this.pushWord(this.BP);const s=this.SP;if(e>0){for(let t=1;t<e;t++)this.BP=this.BP-2&65535,this.pushWord(this.getMemWord(this.SS,this.BP));this.pushWord(s)}this.BP=s,this.SP=this.SP-t&65535;break}case 244:this.clockCount+=a.ClockCycles8086.Hlt,this.halt=!0,this.IP=this.IP-1&65535;break;case 107:this.doWordOperation(i.Direction.RmToReg,((t,e)=>{e>32767&&(e-=65536);let s=this.readNextCodeByte();s>127&&(s-=256);const i=e*s,r=i>>16&65535;return this.flags.CF=this.flags.OF=0!=r&&65535!=r,this.flags.ZF=!1,65535&i}),a.ClockCycles8086.ImulImmReg,a.ClockCycles8086.ImulImmMem);break;case 105:this.doWordOperation(i.Direction.RmToReg,((t,e)=>{e>32767&&(e-=65536);let s=this.readNextCodeWord();s>32767&&(s-=65536);const i=e*s,r=i>>16&65535;return this.flags.CF=this.flags.OF=0!=r&&65535!=r,this.flags.ZF=!1,65535&i}),a.ClockCycles8086.ImulImmReg16,a.ClockCycles8086.ImulImmMem16);break;case 228:{this.clockCount+=a.ClockCycles8086.InImm;const t=this.readNextCodeByte();this.setAL(this.portProvider.in(t));break}case 229:{this.clockCount+=a.ClockCycles8086.InImm;const t=this.readNextCodeByte();this.AX=this.portProvider.in(t);break}case 236:this.clockCount+=a.ClockCycles8086.InDx,this.setAL(this.portProvider.in(this.DX));break;case 237:this.clockCount+=a.ClockCycles8086.InDx,this.AX=this.portProvider.in(this.DX);break;case 64:this.clockCount+=a.ClockCycles8086.IncReg,this.AX=this.incWord(this.AX);break;case 65:this.clockCount+=a.ClockCycles8086.IncReg,this.CX=this.incWord(this.CX);break;case 66:this.clockCount+=a.ClockCycles8086.IncReg,this.DX=this.incWord(this.DX);break;case 67:this.clockCount+=a.ClockCycles8086.IncReg,this.BX=this.incWord(this.BX);break;case 68:this.clockCount+=a.ClockCycles8086.IncReg,this.SP=this.incWord(this.SP);break;case 69:this.clockCount+=a.ClockCycles8086.IncReg,this.BP=this.incWord(this.BP);break;case 70:this.clockCount+=a.ClockCycles8086.IncReg,this.SI=this.incWord(this.SI);break;case 71:this.clockCount+=a.ClockCycles8086.IncReg,this.DI=this.incWord(this.DI);break;case 108:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Ins:a.ClockCycles8086.InsRep,this.setMemByte(this.ES,this.DI,255&this.portProvider.in(this.DX)),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 109:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Ins:a.ClockCycles8086.InsRep,this.setMemWord(this.ES,this.DI,this.portProvider.in(this.DX)),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 204:this.clockCount+=a.ClockCycles8086.Int3,this.doSoftInterrupt(3);break;case 205:this.clockCount+=a.ClockCycles8086.IntImm,this.doSoftInterrupt(this.readNextCodeByte());break;case 206:this.flags.OF?(this.clockCount+=a.ClockCycles8086.Into,this.doSoftInterrupt(4)):this.clockCount+=a.ClockCycles8086.IntoNoInt;break;case 207:this.clockCount+=a.ClockCycles8086.Iret,this.IP=this.popWord(),this.CS=this.popWord(),this.flags.value=this.popWord(),this.blockInterrupt=!0;break;case 119:this.handleConditionalJump(!this.flags.CF&&!this.flags.ZF);break;case 115:this.handleConditionalJump(!this.flags.CF);break;case 114:this.handleConditionalJump(this.flags.CF);break;case 118:this.handleConditionalJump(this.flags.CF||this.flags.ZF);break;case 227:{let t=this.readNextCodeByte();t>127&&(t-=256),0==this.CX?(this.clockCount+=a.ClockCycles8086.JcxzMet,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.JcxzNotMet;break}case 116:this.handleConditionalJump(this.flags.ZF);break;case 127:this.handleConditionalJump(!this.flags.ZF&&this.flags.SF==this.flags.OF);break;case 125:this.handleConditionalJump(this.flags.SF==this.flags.OF);break;case 124:this.handleConditionalJump(this.flags.SF!=this.flags.OF);break;case 126:this.handleConditionalJump(this.flags.ZF||this.flags.SF!=this.flags.OF);break;case 235:{this.clockCount+=a.ClockCycles8086.JmpShort;let t=this.readNextCodeByte();t>127&&(t-=256),this.IP=this.IP+t&65535;break}case 233:{this.clockCount+=a.ClockCycles8086.JmpNear;let t=this.readNextCodeWord();t>32767&&(t-=65536),this.IP=this.IP+t&65535;break}case 234:this.clockCount+=a.ClockCycles8086.JmpFar;{const t=this.readNextCodeWord(),e=this.readNextCodeWord();this.CS=e,this.IP=t}break;case 117:this.handleConditionalJump(!this.flags.ZF);break;case 113:this.handleConditionalJump(!this.flags.OF);break;case 121:this.handleConditionalJump(!this.flags.SF);break;case 123:this.handleConditionalJump(!this.flags.PF);break;case 112:this.handleConditionalJump(this.flags.OF);break;case 122:this.handleConditionalJump(this.flags.PF);break;case 120:this.handleConditionalJump(this.flags.SF);break;case 159:this.clockCount+=a.ClockCycles8086.Lahf,this.setAH(this.flags.value);break;case 197:this.DS=this.loadSeg();break;case 141:{this.clockCount+=a.ClockCycles8086.Lea;const t=this.readNextCodeByte(),e=(192&t)>>6,s=(56&t)>>3,i=7&t;3==e&&this.handleIllegalOpcode();const r=this.calcEa(e,i);this.setRegWord(s,r.ea)}break;case 201:this.clockCount+=a.ClockCycles8086.Leave,this.SP=this.BP,this.BP=this.popWord();break;case 196:this.ES=this.loadSeg();break;case 172:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Lods:a.ClockCycles8086.LodsRep,this.setAL(this.getMemByte(null!==(r=this.segOverride)&&void 0!==r?r:this.DS,this.SI)),this.flags.DF?this.SI=this.SI-1&65535:this.SI=this.SI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 173:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Lods:a.ClockCycles8086.LodsRep,this.AX=this.getMemWord(null!==(h=this.segOverride)&&void 0!==h?h:this.DS,this.SI),this.flags.DF?this.SI=this.SI-2&65535:this.SI=this.SI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 226:{let t=this.readNextCodeByte();t>127&&(t-=256),this.CX=this.CX-1&65535,this.CX>0?(this.clockCount+=a.ClockCycles8086.Loop,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.LoopFinished;break}case 225:{let t=this.readNextCodeByte();t>127&&(t-=256),this.CX=this.CX-1&65535,this.CX>0&&this.flags.ZF?(this.clockCount+=a.ClockCycles8086.Loop,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.LoopFinished;break}case 224:{let t=this.readNextCodeByte();t>127&&(t-=256),this.CX=this.CX-1&65535,this.CX>0&&!this.flags.ZF?(this.clockCount+=a.ClockCycles8086.Loop,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.LoopFinished;break}case 160:{this.clockCount+=a.ClockCycles8086.MovAxMemoffs;const t=this.readNextCodeWord();this.setAL(this.getMemByte(null!==(o=this.segOverride)&&void 0!==o?o:this.DS,t));break}case 161:{this.clockCount+=a.ClockCycles8086.MovAxMemoffs;const t=this.readNextCodeWord();this.AX=this.getMemWord(null!==(n=this.segOverride)&&void 0!==n?n:this.DS,t)}break;case 162:{this.clockCount+=a.ClockCycles8086.MovMemoffsAx;const t=this.readNextCodeWord();this.setMemByte(null!==(c=this.segOverride)&&void 0!==c?c:this.DS,t,this.getAL());break}case 163:{this.clockCount+=a.ClockCycles8086.MovMemoffsAx;const t=this.readNextCodeWord();this.setMemWord(null!==(d=this.segOverride)&&void 0!==d?d:this.DS,t,this.AX)}break;case 176:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setAL(this.readNextCodeByte());break;case 177:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setCL(this.readNextCodeByte());break;case 178:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setDL(this.readNextCodeByte());break;case 179:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setBL(this.readNextCodeByte());break;case 180:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setAH(this.readNextCodeByte());break;case 181:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setCH(this.readNextCodeByte());break;case 182:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setDH(this.readNextCodeByte());break;case 183:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setBH(this.readNextCodeByte());break;case 184:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.AX=this.readNextCodeWord();break;case 185:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.CX=this.readNextCodeWord();break;case 186:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.DX=this.readNextCodeWord();break;case 187:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.BX=this.readNextCodeWord();break;case 188:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.SP=this.readNextCodeWord();break;case 189:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.BP=this.readNextCodeWord();break;case 190:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.SI=this.readNextCodeWord();break;case 191:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.DI=this.readNextCodeWord();break;case 198:{this.clockCount+=a.ClockCycles8086.MovRmImm8;const t=this.readAndDecodeAddressByte(),e=this.readNextCodeByte();this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 199:{this.clockCount+=a.ClockCycles8086.MovRmImm16;const t=this.readAndDecodeAddressByte(),e=this.readNextCodeWord();this.setRmWord(t.mode,t.rm,t.rmAddr,e);break}case 136:this.doByteOperationU(i.Direction.RegToRm,(t=>t),a.ClockCycles8086.MovRmRegReg,a.ClockCycles8086.MovRmRegMem);break;case 137:this.doWordOperationU(i.Direction.RegToRm,(t=>t),a.ClockCycles8086.MovRmRegReg,a.ClockCycles8086.MovRmRegMem);break;case 138:this.doByteOperationU(i.Direction.RmToReg,(t=>t),a.ClockCycles8086.MovRegRmReg,a.ClockCycles8086.MovRegRmMem);break;case 139:this.doWordOperationU(i.Direction.RmToReg,(t=>t),a.ClockCycles8086.MovRegRmReg,a.ClockCycles8086.MovRegRmMem);break;case 140:this.doSegRegWordOperation(i.Direction.RegToRm,(t=>t),a.ClockCycles8086.MovRmSegReg,a.ClockCycles8086.MovRmSegMem);break;case 142:this.doSegRegWordOperation(i.Direction.RmToReg,(t=>t),a.ClockCycles8086.MovSegRmReg,a.ClockCycles8086.MovSegRmMem);break;case 164:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?14:8,this.setMemByte(this.ES,this.DI,this.getMemByte(null!==(l=this.segOverride)&&void 0!==l?l:this.DS,this.SI)),this.flags.DF?(this.SI=this.SI-1&65535,this.DI=this.DI-1&65535):(this.SI=this.SI+1&65535,this.DI=this.DI+1&65535),this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 165:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Movs:a.ClockCycles8086.MovsRep,this.setMemWord(this.ES,this.DI,this.getMemWord(null!==(m=this.segOverride)&&void 0!==m?m:this.DS,this.SI)),this.flags.DF?(this.SI=this.SI-2&65535,this.DI=this.DI-2&65535):(this.SI=this.SI+2&65535,this.DI=this.DI+2&65535),this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 144:this.clockCount+=a.ClockCycles8086.Nop;break;case 8:this.doByteOperation(i.Direction.RegToRm,((t,e)=>{const s=255&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s}),a.ClockCycles8086.OrRmRegReg,a.ClockCycles8086.OrRmRegMem);break;case 9:this.doWordOperation(i.Direction.RegToRm,((t,e)=>{const s=65535&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s}),a.ClockCycles8086.OrRmRegReg,a.ClockCycles8086.OrRmRegMem);break;case 10:this.doByteOperation(i.Direction.RmToReg,((t,e)=>{const s=255&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s}),a.ClockCycles8086.OrRegRmReg,a.ClockCycles8086.OrRegRmMem);break;case 11:this.doWordOperation(i.Direction.RmToReg,((t,e)=>{const s=65535&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s}),a.ClockCycles8086.OrRegRmReg,a.ClockCycles8086.OrRegRmMem);break;case 12:{this.clockCount+=a.ClockCycles8086.OrAlImm;const t=this.readNextCodeByte(),e=255&(this.getAL()|t);this.flags.CF=this.flags.OF=!1,this.setAL(e),this.calcParitySignZeroFlagB(this.getAL());break}case 13:this.clockCount+=a.ClockCycles8086.OrAxImm;{const t=this.readNextCodeWord(),e=65535&(this.AX|t);this.flags.CF=this.flags.OF=!1,this.AX=e,this.calcParitySignZeroFlagW(this.AX)}break;case 230:{this.clockCount+=a.ClockCycles8086.OutImm;const t=this.readNextCodeByte();this.portProvider.out(t,this.getAL(),!1);break}case 231:{this.clockCount+=a.ClockCycles8086.OutImm;const t=this.readNextCodeByte();this.portProvider.out(t,this.AX,!0);break}case 238:this.clockCount+=a.ClockCycles8086.OutDx,this.portProvider.out(this.DX,this.getAL(),!1);break;case 239:this.clockCount+=a.ClockCycles8086.OutDx,this.portProvider.out(this.DX,this.AX,!0);break;case 110:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Outs:a.ClockCycles8086.OutsRep,this.portProvider.out(this.DX,this.getMemByte(null!==(u=this.segOverride)&&void 0!==u?u:this.DS,this.SI),!1),this.flags.DF?this.SI=this.SI-1&65535:this.SI=this.SI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 111:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Outs:a.ClockCycles8086.OutsRep,this.portProvider.out(this.DX,this.getMemWord(null!==(g=this.segOverride)&&void 0!==g?g:this.DS,this.SI),!0),this.flags.DF?this.SI=this.SI-2&65535:this.SI=this.SI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 88:this.clockCount+=a.ClockCycles8086.PopReg,this.AX=this.popWord();break;case 89:this.clockCount+=a.ClockCycles8086.PopReg,this.CX=this.popWord();break;case 90:this.clockCount+=a.ClockCycles8086.PopReg,this.DX=this.popWord();break;case 91:this.clockCount+=a.ClockCycles8086.PopReg,this.BX=this.popWord();break;case 92:this.clockCount+=a.ClockCycles8086.PopReg,this.SP=this.popWord();break;case 93:this.clockCount+=a.ClockCycles8086.PopReg,this.BP=this.popWord();break;case 94:this.clockCount+=a.ClockCycles8086.PopReg,this.SI=this.popWord();break;case 95:this.clockCount+=a.ClockCycles8086.PopReg,this.DI=this.popWord();break;case 7:this.clockCount+=a.ClockCycles8086.PopSeg,this.ES=this.popWord();break;case 23:this.clockCount+=a.ClockCycles8086.PopSeg,this.SS=this.popWord();break;case 31:this.clockCount+=a.ClockCycles8086.PopSeg,this.DS=this.popWord();break;case 143:{this.clockCount+=a.ClockCycles8086.PopMem;const t=this.readAndDecodeAddressByte();this.setRmWord(t.mode,t.rm,t.rmAddr,this.popWord());break}case 97:this.clockCount+=a.ClockCycles8086.Popa,this.DI=this.popWord(),this.SI=this.popWord(),this.BP=this.popWord(),this.SP=this.SP+2&65535,this.BX=this.popWord(),this.DX=this.popWord(),this.CX=this.popWord(),this.AX=this.popWord();break;case 157:this.clockCount+=a.ClockCycles8086.Popf,this.flags.value=this.popWord();break;case 80:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.AX);break;case 81:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.CX);break;case 82:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.DX);break;case 83:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.BX);break;case 84:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.SP-2&65535);break;case 85:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.BP);break;case 86:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.SI);break;case 87:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.DI);break;case 6:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.ES);break;case 14:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.CS);break;case 22:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.SS);break;case 30:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.DS);break;case 106:this.clockCount+=a.ClockCycles8086.PushImm8,this.pushWord(this.readNextCodeByte());break;case 104:this.clockCount+=a.ClockCycles8086.PushImm16,this.pushWord(this.readNextCodeWord());break;case 96:{this.clockCount+=a.ClockCycles8086.Pusha;const t=this.SP;this.pushWord(this.AX),this.pushWord(this.CX),this.pushWord(this.DX),this.pushWord(this.BX),this.pushWord(t),this.pushWord(this.BP),this.pushWord(this.SI),this.pushWord(this.DI);break}case 156:this.clockCount+=a.ClockCycles8086.Pushf,this.pushWord(this.flags.value);break;case 195:this.clockCount+=a.ClockCycles8086.Ret,this.IP=this.popWord();break;case 194:{this.clockCount+=a.ClockCycles8086.RetImm;const t=this.readNextCodeWord();this.IP=this.popWord(),this.SP=this.SP+t&65535;break}case 203:this.clockCount+=a.ClockCycles8086.Retf,this.IP=this.popWord(),this.CS=this.popWord();break;case 202:{this.clockCount+=a.ClockCycles8086.RetfImm;const t=this.readNextCodeWord();this.IP=this.popWord(),this.CS=this.popWord(),this.SP=this.SP+t&65535;break}case 158:this.clockCount+=a.ClockCycles8086.Lahf,this.flags.value=65535&(65280&this.flags.value|this.getAH());break;case 24:this.doByteOperation(i.Direction.RegToRm,((t,e)=>this.sbbByte(t,e)),a.ClockCycles8086.SbbRmRegReg,a.ClockCycles8086.SbbRmRegMem);break;case 25:this.doWordOperation(i.Direction.RegToRm,((t,e)=>this.sbbWord(t,e)),a.ClockCycles8086.SbbRmRegReg,a.ClockCycles8086.SbbRmRegMem);break;case 26:this.doByteOperation(i.Direction.RmToReg,((t,e)=>this.sbbByte(t,e)),a.ClockCycles8086.SbbRegRmReg,a.ClockCycles8086.SbbRegRmMem);break;case 27:this.doWordOperation(i.Direction.RmToReg,((t,e)=>this.sbbWord(t,e)),a.ClockCycles8086.SbbRegRmReg,a.ClockCycles8086.SbbRegRmMem);break;case 28:this.clockCount+=a.ClockCycles8086.SbbAlImm,this.setAL(this.sbbByte(this.getAL(),this.readNextCodeByte()));break;case 29:this.clockCount+=a.ClockCycles8086.SbbAxImm,this.AX=this.sbbWord(this.AX,this.readNextCodeWord());break;case 174:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Scas,this.subByte(this.getAL(),this.getMemByte(this.ES,this.DI)),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 175:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Scas,this.subWord(this.AX,this.getMemWord(this.ES,this.DI)),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 249:this.clockCount+=a.ClockCycles8086.SetFlag,this.flags.CF=!0;break;case 253:this.clockCount+=a.ClockCycles8086.SetFlag,this.flags.DF=!0;break;case 251:this.clockCount+=a.ClockCycles8086.SetFlag,this.flags.IF=!0,this.blockInterrupt=!0;break;case 170:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Stos:a.ClockCycles8086.StosRep,this.setMemByte(this.ES,this.DI,this.getAL()),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 171:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Stos:a.ClockCycles8086.StosRep,this.setMemWord(this.ES,this.DI,this.AX),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 40:this.doByteOperation(i.Direction.RegToRm,((t,e)=>this.subByte(t,e)),a.ClockCycles8086.SubRmRegReg,a.ClockCycles8086.SubRmRegMem);break;case 41:this.doWordOperation(i.Direction.RegToRm,((t,e)=>this.subWord(t,e)),a.ClockCycles8086.SubRmRegReg,a.ClockCycles8086.SubRmRegMem);break;case 42:this.doByteOperation(i.Direction.RmToReg,((t,e)=>this.subByte(t,e)),a.ClockCycles8086.SubRegRmReg,a.ClockCycles8086.SubRegRmMem);break;case 43:this.doWordOperation(i.Direction.RmToReg,((t,e)=>this.subWord(t,e)),a.ClockCycles8086.SubRegRmReg,a.ClockCycles8086.SubRegRmMem);break;case 44:{this.clockCount+=a.ClockCycles8086.SubAlImm;const t=this.readNextCodeByte();this.setAL(this.subByte(this.getAL(),t));break}case 45:this.clockCount+=a.ClockCycles8086.SubAxImm,this.AX=this.subWord(this.AX,this.readNextCodeWord());break;case 132:this.doByteOperation(i.Direction.RegToRm,((t,e)=>{const s=t&e&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),0}),a.ClockCycles8086.TestReg,a.ClockCycles8086.TestMem,!1);break;case 133:this.doWordOperation(i.Direction.RegToRm,((t,e)=>{const s=t&e&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),0}),a.ClockCycles8086.TestReg,a.ClockCycles8086.TestMem,!1);break;case 168:{this.clockCount+=a.ClockCycles8086.TestAlImm;const t=this.readNextCodeByte(),e=this.getAL()&t&255;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e);break}case 169:this.clockCount+=a.ClockCycles8086.TestAxImm;{const t=this.readNextCodeWord(),e=this.AX&t&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e)}break;case 155:this.clockCount+=a.ClockCycles8086.Wait;break;case 145:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.CX,this.CX=t}break;case 146:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.DX,this.DX=t}break;case 147:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.BX,this.BX=t}break;case 148:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.SP,this.SP=t}break;case 149:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.BP,this.BP=t}break;case 150:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.SI,this.SI=t}break;case 151:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.DI,this.DI=t}break;case 134:{const t=this.readAndDecodeAddressByte();this.clockCount+=3==t.mode?a.ClockCycles8086.XchgRegRmReg:a.ClockCycles8086.XchgRegRmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr);this.setRmByte(t.mode,t.rm,t.rmAddr,this.getRegByte(t.reg)),this.setRegByte(t.reg,e);break}case 135:{const t=this.readAndDecodeAddressByte();this.clockCount+=3==t.mode?a.ClockCycles8086.XchgRegRmReg:a.ClockCycles8086.XchgRegRmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr);this.setRmWord(t.mode,t.rm,t.rmAddr,this.getRegWord(t.reg)),this.setRegWord(t.reg,e)}break;case 215:this.clockCount+=a.ClockCycles8086.Xlat,this.setAL(this.getMemByte(null!==(p=this.segOverride)&&void 0!==p?p:this.DS,this.BX+this.getAL()&65535));break;case 48:this.doByteOperation(i.Direction.RegToRm,((t,e)=>{const s=255&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s}),a.ClockCycles8086.XorRmRegReg,a.ClockCycles8086.XorRmRegMem);break;case 49:this.doWordOperation(i.Direction.RegToRm,((t,e)=>{const s=65535&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s}),a.ClockCycles8086.XorRmRegReg,a.ClockCycles8086.XorRmRegMem);break;case 50:this.doByteOperation(i.Direction.RmToReg,((t,e)=>{const s=255&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s}),a.ClockCycles8086.XorRegRmReg,a.ClockCycles8086.XorRegRmMem);break;case 51:this.doWordOperation(i.Direction.RmToReg,((t,e)=>{const s=65535&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s}),a.ClockCycles8086.XorRegRmReg,a.ClockCycles8086.XorRegRmMem);break;case 52:{this.clockCount+=a.ClockCycles8086.XorAlImm;const t=this.readNextCodeByte(),e=255&(this.getAL()^t);this.flags.CF=this.flags.OF=!1,this.setAL(e),this.calcParitySignZeroFlagB(this.getAL());break}case 53:{this.clockCount+=a.ClockCycles8086.XorAxImm;const t=this.readNextCodeWord(),e=65535&(this.AX^t);this.flags.CF=this.flags.OF=!1,this.AX=e,this.calcParitySignZeroFlagW(this.AX)}break;case 254:this.handleOpcodeFeFf(!1);break;case 255:this.handleOpcodeFeFf(!0);break;case 128:this.handleOpcode80();break;case 129:this.handleOpcode81();break;case 131:this.handleOpcode83();break;case 246:this.handleOpcodeF6();break;case 247:this.handleOpcodeF7();break;case 208:this.handleOpcodeD0();break;case 209:this.handleOpcodeD1();break;case 210:this.handleOpcodeD2();break;case 211:this.handleOpcodeD3();break;case 192:this.handleOpcodeC0();break;case 193:this.handleOpcodeC1();break;case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:this.handleFpuInstruction(C);break;default:this.handleIllegalOpcode()}}while(t);this.segOverride=null,this.blockInterrupt?this.blockInterrupt=!1:(this.flags.TF&&this.doSoftInterrupt(1),null==this.softInterrupt&&null==this.hardInterrupt||this.processInterrupt()),0==(15&this.instCount)&&this.handleCpuEvents(),this.instCount++}}catch(t){if(!(t instanceof i.CpuError))throw t;this.segOverride=null,this.doSoftInterrupt(t.exCode),this.blockInterrupt?this.blockInterrupt=!1:this.processInterrupt(),this.instCount++}}while(this.clockCount<C)}handleIllegalOpcode(){}handleFpuInstruction(t){this.clockCount+=a.ClockCycles8086.FpuInstruction,this.readNextCodeByte()<192&&(this.IP=this.IP-1&65535,this.readAndDecodeAddressByte())}handleCpuEvents(){for(let t=this.cpuEvents.length-1;t>=0;t--){const e=this.cpuEvents[t];e.clockCount<=this.clockCount&&(e.action(),this.cpuEvents.splice(t,1))}}handleConditionalJump(t){if(t){let t=this.readNextCodeByte();t>127&&(t-=256),this.clockCount+=a.ClockCycles8086.JumpCondMet,this.IP=this.IP+t&65535}else this.IP=this.IP+1&65535,this.clockCount+=a.ClockCycles8086.JumpCondNotMet}handleRepeat(){this.stringOperation!=i.Repeat.None&&(this.CX=this.CX-1&65535,0!=this.CX&&(this.IP=this.repeatIp))}handleRepeatCheckZeroFlag(){this.stringOperation!=i.Repeat.None&&(this.CX=this.CX-1&65535,0!=this.CX&&(this.stringOperation==i.Repeat.RepZ&&this.flags.ZF||this.stringOperation==i.Repeat.RepNz&&!this.flags.ZF)&&(this.IP=this.repeatIp))}processInterrupt(){let t;if(null!=this.softInterrupt)t=this.softInterrupt,this.softInterrupt=null,this.pushWord(this.flags.value);else{if(null==this.hardInterrupt||!this.flags.IF)return;this.clockCount+=a.ClockCycles8086.HardInterrupt,this.halt&&(this.halt=!1,this.IP=this.IP+1&65535),t=this.hardInterrupt,this.hardInterrupt=null,this.pushWord(this.flags.value)}this.flags.IF=!1,this.flags.TF=!1,this.pushWord(this.CS),this.pushWord(this.IP),this.IP=this.memoryProvider.peekW(4*t),this.CS=this.memoryProvider.peekW(4*t+2)}handleOpcodeFeFf(t){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:this.clockCount+=3==e.mode?a.ClockCycles8086.IncReg:a.ClockCycles8086.IncMem,t?this.setRmWord(e.mode,e.rm,e.rmAddr,this.incWord(this.getRmWord(e.mode,e.rm,e.rmAddr))):this.setRmByte(e.mode,e.rm,e.rmAddr,this.incByte(this.getRmByte(e.mode,e.rm,e.rmAddr)));break;case 1:this.clockCount+=3==e.mode?a.ClockCycles8086.DecReg:a.ClockCycles8086.DecMem,t?this.setRmWord(e.mode,e.rm,e.rmAddr,this.decWord(this.getRmWord(e.mode,e.rm,e.rmAddr))):this.setRmByte(e.mode,e.rm,e.rmAddr,this.decByte(this.getRmByte(e.mode,e.rm,e.rmAddr)));break;case 2:this.clockCount+=3==e.mode?a.ClockCycles8086.CallNearReg:a.ClockCycles8086.CallNearMem,this.pushWord(this.IP),this.IP=this.getRmWord(e.mode,e.rm,e.rmAddr);break;case 3:{this.clockCount+=a.ClockCycles8086.CallFarRm,3==e.mode&&this.handleIllegalOpcode(),this.pushWord(this.CS),this.pushWord(this.IP);const t=this.memoryProvider.peekW(e.rmAddr);e.rmAddr+=2;const s=this.memoryProvider.peekW(e.rmAddr);this.CS=s,this.IP=t}break;case 4:this.clockCount+=3==e.mode?a.ClockCycles8086.JmpNearReg:a.ClockCycles8086.JmpNearMem,this.IP=this.getRmWord(e.mode,e.rm,e.rmAddr);break;case 5:{this.clockCount+=a.ClockCycles8086.JmpFarRm,3==e.mode&&this.handleIllegalOpcode();const t=this.memoryProvider.peekW(e.rmAddr),s=this.memoryProvider.peekW(e.rmAddr+2);this.CS=s,this.IP=t}break;case 6:this.clockCount+=a.ClockCycles8086.PushRm,this.pushWord(this.getRmWord(e.mode,e.rm,e.rmAddr));break;default:this.handleIllegalOpcode()}}handleOpcode80(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.AddRmImmReg:a.ClockCycles8086.AddRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.addByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 1:{this.clockCount+=3==t.mode?a.ClockCycles8086.OrRmImmReg:a.ClockCycles8086.OrRmImmMem;const e=255&(this.getRmByte(t.mode,t.rm,t.rmAddr)|this.readNextCodeByte());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e),this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.AdcRmImmReg:a.ClockCycles8086.AdcRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.adcByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.SbbRmImmReg:a.ClockCycles8086.SbbRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.sbbByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.AndRmImmReg:a.ClockCycles8086.AndRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr)&this.readNextCodeByte()&255;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e),this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.SubRmImmReg:a.ClockCycles8086.SubRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.subByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.XorRmImmReg:a.ClockCycles8086.XorRmImmMem;const e=255&(this.getRmByte(t.mode,t.rm,t.rmAddr)^this.readNextCodeByte());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e),this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.CmpRmImmReg:a.ClockCycles8086.CmpRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte();this.subByte(e,s);break}default:this.handleIllegalOpcode()}}handleOpcode81(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.AddRmImmReg:a.ClockCycles8086.AddRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.addWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 1:{this.clockCount+=3==t.mode?a.ClockCycles8086.OrRmImmReg:a.ClockCycles8086.OrRmImmMem;const e=65535&(this.getRmWord(t.mode,t.rm,t.rmAddr)|this.readNextCodeWord());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e),this.setRmWord(t.mode,t.rm,t.rmAddr,e)}break;case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.AdcRmImmReg:a.ClockCycles8086.AdcRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.adcWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.SbbRmImmReg:a.ClockCycles8086.SbbRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.sbbWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.AndRmImmReg:a.ClockCycles8086.AndRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr)&this.readNextCodeWord()&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e),this.setRmWord(t.mode,t.rm,t.rmAddr,e);break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.SubRmImmReg:a.ClockCycles8086.SubRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.subWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.XorRmImmReg:a.ClockCycles8086.XorRmImmMem;const e=65535&(this.getRmWord(t.mode,t.rm,t.rmAddr)^this.readNextCodeWord());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e),this.setRmWord(t.mode,t.rm,t.rmAddr,e);break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.CmpRmImmReg:a.ClockCycles8086.CmpRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord();this.subWord(e,s);break}default:this.handleIllegalOpcode()}}handleOpcode83(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.AddRmImmReg:a.ClockCycles8086.AddRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.addWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 1:{this.clockCount+=3==t.mode?a.ClockCycles8086.OrRmImmReg:a.ClockCycles8086.OrRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=65535&(e|(s>127?s+65280:s));this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.AdcRmImmReg:a.ClockCycles8086.AdcRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.adcWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.SbbRmImmReg:a.ClockCycles8086.SbbRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.sbbWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.AndRmImmReg:a.ClockCycles8086.AndRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=e&(s>127?s+65280:s)&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.SubRmImmReg:a.ClockCycles8086.SubRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.subWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.XorRmImmReg:a.ClockCycles8086.XorRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=65535&(e^(s>127?s+65280:s));this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.CmpRmImmReg:a.ClockCycles8086.CmpRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s;this.subWord(e,i);break}default:this.handleIllegalOpcode()}}handleOpcodeF6(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.TestRmImmReg:a.ClockCycles8086.TestRmImmMem;const e=this.readNextCodeByte(),s=this.getRmByte(t.mode,t.rm,t.rmAddr)&e;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s);break}case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.NotRmReg:a.ClockCycles8086.NotRmMem;let e=this.getRmByte(t.mode,t.rm,t.rmAddr);e=255&~e,this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.NegRmReg:a.ClockCycles8086.NegRmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.subByte(0,e);this.setRmByte(t.mode,t.rm,t.rmAddr,s);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.MulReg:a.ClockCycles8086.MulMem;const e=this.getAL()*this.getRmByte(t.mode,t.rm,t.rmAddr);this.flags.CF=this.flags.OF=e>255,this.flags.ZF=!1,this.AX=65535&e;break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.ImulReg:a.ClockCycles8086.ImulMem;let e=this.getAL();e>127&&(e-=256);let s=this.getRmByte(t.mode,t.rm,t.rmAddr);s>127&&(s-=256);const i=e*s;this.AX=65535&i,this.flags.CF=this.flags.OF=0!=this.getAH()&&255!=this.getAH(),this.flags.ZF=!1;break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.DivReg:a.ClockCycles8086.DivMem;const e=this.AX,s=this.getRmByte(t.mode,t.rm,t.rmAddr);if(0==s)this.doSoftInterrupt(0);else{const t=Math.trunc(e/s);t>255?this.doSoftInterrupt(0):(this.setAL(t),this.setAH(e%s))}break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.IdivReg:a.ClockCycles8086.IdivMem;const e=this.AX>32767?this.AX-65536:this.AX;let s=this.getRmByte(t.mode,t.rm,t.rmAddr);if(s>127&&(s-=256),0==s)this.doSoftInterrupt(0);else{const t=Math.trunc(e/s);t>=128||t<-128?this.doSoftInterrupt(0):(this.setAL(t),this.setAH(e%s))}break}default:this.handleIllegalOpcode()}}handleOpcodeF7(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:this.clockCount+=3==t.mode?a.ClockCycles8086.TestRmImmReg:a.ClockCycles8086.TestRmImmMem;{const e=this.readNextCodeWord(),s=this.getRmWord(t.mode,t.rm,t.rmAddr)&e;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s)}break;case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.NotRmReg:a.ClockCycles8086.NotRmMem;let e=this.getRmWord(t.mode,t.rm,t.rmAddr);e=65535&~e,this.setRmWord(t.mode,t.rm,t.rmAddr,e)}break;case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.NegRmReg:a.ClockCycles8086.NegRmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.subWord(0,e);this.setRmWord(t.mode,t.rm,t.rmAddr,s)}break;case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.MulReg16:a.ClockCycles8086.MulMem16;const e=this.AX*this.getRmWord(t.mode,t.rm,t.rmAddr);this.flags.CF=this.flags.OF=e>65535,this.flags.ZF=!1,this.AX=65535&e,this.DX=e>>16&65535}break;case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.ImulReg16:a.ClockCycles8086.ImulMem16;const e=this.AX>32767?this.AX-65536:this.AX;let s=this.getRmWord(t.mode,t.rm,t.rmAddr);s>32767&&(s-=65536);const i=e*s;this.AX=65535&i,this.DX=i>>16&65535,this.flags.CF=this.flags.OF=0!=this.DX&&65535!=this.DX,this.flags.ZF=!1}break;case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.DivReg16:a.ClockCycles8086.DivMem16;const e=(this.DX<<16)+this.AX,s=this.getRmWord(t.mode,t.rm,t.rmAddr);if(0==s)this.doSoftInterrupt(0);else{const t=Math.trunc(e/s);t>65535?this.doSoftInterrupt(0):(this.AX=65535&t,this.DX=e%s&65535)}}break;case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.IdivReg16:a.ClockCycles8086.IdivMem16;const e=(this.DX<<16)+this.AX&4294967295;let s=this.getRmWord(t.mode,t.rm,t.rmAddr);if(s>32767&&(s-=65536),0==s)this.softInterrupt=0;else{const t=Math.trunc(e/s);t>=32768||t<-32768?this.doSoftInterrupt(0):(this.AX=65535&t,this.DX=e%s&65535)}}break;default:this.handleIllegalOpcode()}}handleOpcodeD0(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmReg:a.ClockCycles8086.ShiftRmMem,t.reg){case 0:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=255&(e<<1|e>>7);this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(128&e)>0;break}case 1:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=255&(e>>1|e<<7);this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(1&e)>0;break}case 2:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=(e<<1)+(this.flags.CF?1:0)&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(128&e)>0;break}case 3:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=(e>>1)+(this.flags.CF?128:0)&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(1&e)>0;break}case 4:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=e<<1&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagB(s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(128&e)>0;break}case 5:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=e>>1&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagB(s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(1&e)>0;break}case 7:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=255&(e>>1|128&e);this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagB(s),this.flags.OF=!1,this.flags.CF=(1&e)>0;break}default:this.handleIllegalOpcode()}}handleOpcodeD1(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmReg:a.ClockCycles8086.ShiftRmMem,t.reg){case 0:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=65535&(e<<1|e>>15);this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(32768&e)>0;break}case 1:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=65535&(e>>1|e<<15);this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(1&e)>0;break}case 2:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=(e<<1)+(this.flags.CF?1:0)&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(32768&e)>0;break}case 3:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=(e>>1)+(this.flags.CF?32768:0)&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(1&e)>0;break}case 4:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=e<<1&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagW(s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(32768&e)>0;break}case 5:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=e>>1&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagW(s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(1&e)>0;break}case 7:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=65535&(e>>1|32768&e);this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagW(s),this.flags.OF=!1,this.flags.CF=(1&e)>0;break}default:this.handleIllegalOpcode()}}handleOpcodeC0(){const t=this.readAndDecodeAddressByte(),e=31&this.readNextCodeByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmImmReg+e:a.ClockCycles8086.ShiftRmImmMem+e,t.reg){case 0:this.rolByte(t.mode,t.rm,t.rmAddr,e);break;case 1:this.rorByte(t.mode,t.rm,t.rmAddr,e);break;case 2:this.rclByte(t.mode,t.rm,t.rmAddr,e);break;case 3:this.rcrByte(t.mode,t.rm,t.rmAddr,e);break;case 4:this.shlByte(t.mode,t.rm,t.rmAddr,e);break;case 5:this.shrByte(t.mode,t.rm,t.rmAddr,e);break;case 7:this.sarByte(t.mode,t.rm,t.rmAddr,e);break;default:this.handleIllegalOpcode()}}handleOpcodeC1(){const t=this.readAndDecodeAddressByte(),e=this.readNextCodeByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmImmReg+e:a.ClockCycles8086.ShiftRmImmMem+e,t.reg){case 0:this.rolWord(t.mode,t.rm,t.rmAddr,e);break;case 1:this.rorWord(t.mode,t.rm,t.rmAddr,e);break;case 2:this.rclWord(t.mode,t.rm,t.rmAddr,e);break;case 3:this.rcrWord(t.mode,t.rm,t.rmAddr,e);break;case 4:this.shlWord(t.mode,t.rm,t.rmAddr,e);break;case 5:this.shrWord(t.mode,t.rm,t.rmAddr,e);break;case 7:this.sarWord(t.mode,t.rm,t.rmAddr,e);break;default:this.handleIllegalOpcode()}}handleOpcodeD2(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmClReg+this.getCL():a.ClockCycles8086.ShiftRmClMem+this.getCL(),t.reg){case 0:this.rolByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 1:this.rorByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 2:this.rclByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 3:this.rcrByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 4:this.shlByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 5:this.shrByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 7:this.sarByte(t.mode,t.rm,t.rmAddr,this.getCL());break;default:this.handleIllegalOpcode()}}handleOpcodeD3(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmClReg+this.getCL():a.ClockCycles8086.ShiftRmClMem+this.getCL(),t.reg){case 0:this.rolWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 1:this.rorWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 2:this.rclWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 3:this.rcrWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 4:this.shlWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 5:this.shrWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 7:this.sarWord(t.mode,t.rm,t.rmAddr,this.getCL());break;default:this.handleIllegalOpcode()}}incByte(t){return t=t+1&255,this.calcParitySignZeroFlagB(t),this.flags.OF=128==t,this.flags.AF=0==(15&t),t}incWord(t){return t=t+1&65535,this.calcParitySignZeroFlagW(t),this.flags.OF=32768==t,this.flags.AF=0==(15&t),t}decWord(t){return t=t-1&65535,this.calcParitySignZeroFlagW(t),this.flags.OF=32767==t,this.flags.AF=15==(15&t),t}decByte(t){return t=t-1&255,this.calcParitySignZeroFlagB(t),this.flags.OF=127==t,this.flags.AF=15==(15&t),t}rolByte(t,e,s,i){const r=7&i,a=this.getRmByte(t,e,s),h=255&(a<<r|a>>8-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<8-r)>0)}rorByte(t,e,s,i){const r=7&i,a=this.getRmByte(t,e,s),h=255&(a>>r|a<<8-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<r-1)>0)}rclByte(t,e,s,i){const r=(31&i)%9,a=this.getRmByte(t,e,s),h=255&(a<<r|(r>0&&this.flags.CF?1<<r-1:0)|a>>9-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<8-r)>0)}rcrByte(t,e,s,i){const r=(31&i)%9,a=this.getRmByte(t,e,s),h=255&(a>>r|(r>0&&this.flags.CF?1<<8-r:0)|a<<9-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<r-1)>0)}shlByte(t,e,s,i){const r=31&i,a=this.getRmByte(t,e,s),h=a<<r&255;this.setRmByte(t,e,s,h),this.calcParitySignZeroFlagB(h),1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=r<=8&&(a&1<<8-r)>0}shrByte(t,e,s,i){const r=31&i,a=this.getRmByte(t,e,s),h=a>>r&255;this.setRmByte(t,e,s,h),this.calcParitySignZeroFlagB(h),1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=r>0&&(a&1<<r-1)>0}sarByte(t,e,s,i){const r=31&i,a=this.getRmByte(t,e,s),h=255&(a>>r|((128&a)>0?255<<8-r:0));this.setRmByte(t,e,s,h),this.calcParitySignZeroFlagB(h),this.flags.OF=!1,this.flags.CF=r>0&&(a&1<<r-1)>0}rolWord(t,e,s,i){const r=15&i,a=this.getRmWord(t,e,s),h=65535&(a<<r|a>>16-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<16-r)>0)}rorWord(t,e,s,i){const r=15&i,a=this.getRmWord(t,e,s),h=65535&(a>>r|a<<16-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<r-1)>0)}rclWord(t,e,s,i){const r=(31&i)%17,a=this.getRmWord(t,e,s),h=65535&(a<<r|(r>0&&this.flags.CF?1<<r-1:0)|a>>17-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<16-r)>0)}rcrWord(t,e,s,i){const r=(31&i)%17,a=this.getRmWord(t,e,s),h=65535&(a>>r|(r>0&&this.flags.CF?1<<16-r:0)|a<<17-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<r-1)>0)}shlWord(t,e,s,i){const r=31&i,a=this.getRmWord(t,e,s),h=a<<r&65535;this.setRmWord(t,e,s,h),this.calcParitySignZeroFlagW(h),1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=r<=16&&(a&1<<16-r)>0}shrWord(t,e,s,i){const r=31&i,a=this.getRmWord(t,e,s),h=a>>r&65535;this.setRmWord(t,e,s,h),this.calcParitySignZeroFlagW(h),1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=r>0&&(a&1<<r-1)>0}sarWord(t,e,s,i){const r=31&i,a=this.getRmWord(t,e,s),h=65535&(a>>r|((32768&a)>0?65535<<16-r:0));this.setRmWord(t,e,s,h),this.calcParitySignZeroFlagW(h),this.flags.OF=!1,this.flags.CF=r>0&&(a&1<<r-1)>0}subByte(t,e){let s=t-e;const i=(t>127?t-256:t)-(e>127?e-256:e);return this.flags.CF=s<0,this.flags.OF=i>127||i<-128,this.flags.AF=(15&t)-(15&e)<0,s&=255,this.calcParitySignZeroFlagB(s),s}subWord(t,e){let s=t-e;const i=(t>32767?t-65536:t)-(e>32767?e-65536:e);return this.flags.CF=s<0,this.flags.OF=i>32767||i<-32768,this.flags.AF=(15&t)-(15&e)<0,s&=65535,this.calcParitySignZeroFlagW(s),s}sbbByte(t,e){const s=this.flags.CF?1:0;let i=t-e-s;const r=(t>127?t-256:t)-(e>127?e-256:e)-s;return this.flags.CF=i<0,this.flags.OF=r>127||r<-128,this.flags.AF=(15&t)-(15&e)-s<0,i&=255,this.calcParitySignZeroFlagB(i),i}sbbWord(t,e){const s=this.flags.CF?1:0;let i=t-e-s;const r=(t>32767?t-65536:t)-(e>32767?e-65536:e)-s;return this.flags.CF=i<0,this.flags.OF=r>32767||r<-32768,this.flags.AF=(15&t)-(15&e)-s<0,i&=65535,this.calcParitySignZeroFlagW(i),i}addByte(t,e){let s=t+e;const i=(t>127?t-256:t)-(e>127?e-256:e);return this.flags.CF=s>255,this.flags.OF=i>127||i<-128,this.flags.AF=(15&t)+(15&e)>15,s&=255,this.calcParitySignZeroFlagB(s),s}addWord(t,e){let s=t+e;const i=(t>32767?t-65536:t)-(e>32767?e-65536:e);return this.flags.CF=s>65535,this.flags.OF=i>32767||i<-32768,this.flags.AF=(15&t)+(15&e)>15,s&=65535,this.calcParitySignZeroFlagW(s),s}adcByte(t,e){const s=this.flags.CF?1:0;let i=t+e+s;const r=(t>127?t-256:t)-(e>127?e-256:e)+s;return this.flags.CF=i>255,this.flags.OF=r>127||r<-128,this.flags.AF=(15&t)+(15&e)+s>15,i&=255,this.calcParitySignZeroFlagB(i),i}adcWord(t,e){const s=this.flags.CF?1:0;let i=t+e+s;const r=(t>32767?t-65536:t)-(e>32767?e-65536:e)+s;return this.flags.CF=i>65535,this.flags.OF=r>32767||r<-32768,this.flags.AF=(15&t)+(15&e)+s>15,i&=65535,this.calcParitySignZeroFlagW(i),i}loadSeg(){this.clockCount+=a.ClockCycles8086.Lds;const t=this.readAndDecodeAddressByte();3==t.mode&&this.handleIllegalOpcode();const e=this.memoryProvider.peekW(t.rmAddr);return this.setRegWord(t.reg,e),t.rmAddr+=2,this.memoryProvider.peekW(t.rmAddr)}pushWord(t){this.SP=this.SP-2&65535,this.memoryProvider.pokeW(this.genAddr(this.SS,this.SP),t)}popWord(){const t=this.memoryProvider.peekW(this.genAddr(this.SS,this.SP));return this.SP=this.SP+2&65535,t}calcParitySignZeroFlagB(t){t&=255,this.flags.PF=this.parities[t],this.flags.SF=(128&t)>0,this.flags.ZF=0==t}calcParitySignZeroFlagW(t){t&=65535,this.flags.PF=this.parities[255&t],this.flags.SF=(32768&t)>0,this.flags.ZF=0==t}readAndDecodeAddressByte(){const t=new o,e=this.readNextCodeByte();return t.mode=(192&e)>>6,t.reg=(56&e)>>3,t.rm=7&e,3==t.mode?t.rmAddr=0:t.rmAddr=this.calcRmAddr(t.mode,t.rm),t}doByteOperationU(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRegByte(h.reg));a&&this.setRmByte(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRmByte(h.mode,h.rm,h.rmAddr));a&&this.setRegByte(h.reg,t)}}doByteOperation(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRmByte(h.mode,h.rm,h.rmAddr),this.getRegByte(h.reg));a&&this.setRmByte(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRegByte(h.reg),this.getRmByte(h.mode,h.rm,h.rmAddr));a&&this.setRegByte(h.reg,t)}}doWordOperationU(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRegWord(h.reg));a&&this.setRmWord(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRmWord(h.mode,h.rm,h.rmAddr));a&&this.setRegWord(h.reg,t)}}doSegRegWordOperation(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getSegReg(h.reg));a&&this.setRmWord(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRmWord(h.mode,h.rm,h.rmAddr));a&&this.setSegReg(h.reg,t)}}doWordOperation(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRmWord(h.mode,h.rm,h.rmAddr),this.getRegWord(h.reg));a&&this.setRmWord(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRegWord(h.reg),this.getRmWord(h.mode,h.rm,h.rmAddr));a&&this.setRegWord(h.reg,t)}}calcRmAddr(t,e){var s;const i=this.calcEa(t,e);return this.genAddr(null!==(s=this.segOverride)&&void 0!==s?s:i.defaultSeg,i.ea)}calcEa(t,e){const s=new n;switch(t){case 0:switch(e){case 0:return s.defaultSeg=this.DS,s.ea=this.BX+this.SI&65535,s;case 1:return s.defaultSeg=this.DS,s.ea=this.BX+this.DI&65535,s;case 2:return s.defaultSeg=this.SS,s.ea=this.BP+this.SI&65535,s;case 3:return s.defaultSeg=this.SS,s.ea=this.BP+this.DI&65535,s;case 4:return s.defaultSeg=this.DS,s.ea=this.SI,s;case 5:return s.defaultSeg=this.DS,s.ea=this.DI,s;case 6:return s.defaultSeg=this.DS,s.ea=this.readNextCodeWord(),s;case 7:return s.defaultSeg=this.DS,s.ea=this.BX,s}break;case 1:{let t=this.readNextCodeByte();switch(t>127&&(t-=256),e){case 0:return s.defaultSeg=this.DS,s.ea=this.BX+this.SI+t&65535,s;case 1:return s.defaultSeg=this.DS,s.ea=this.BX+this.DI+t&65535,s;case 2:return s.defaultSeg=this.SS,s.ea=this.BP+this.SI+t&65535,s;case 3:return s.defaultSeg=this.SS,s.ea=this.BP+this.DI+t&65535,s;case 4:return s.defaultSeg=this.DS,s.ea=this.SI+t&65535,s;case 5:return s.defaultSeg=this.DS,s.ea=this.DI+t&65535,s;case 6:return s.defaultSeg=this.SS,s.ea=this.BP+t&65535,s;case 7:return s.defaultSeg=this.DS,s.ea=this.BX+t&65535,s}}break;case 2:{const t=this.readNextCodeWord();switch(e){case 0:return s.defaultSeg=this.DS,s.ea=this.BX+this.SI+t&65535,s;case 1:return s.defaultSeg=this.DS,s.ea=this.BX+this.DI+t&65535,s;case 2:return s.defaultSeg=this.SS,s.ea=this.BP+this.SI+t&65535,s;case 3:return s.defaultSeg=this.SS,s.ea=this.BP+this.DI+t&65535,s;case 4:return s.defaultSeg=this.DS,s.ea=this.SI+t&65535,s;case 5:return s.defaultSeg=this.DS,s.ea=this.DI+t&65535,s;case 6:return s.defaultSeg=this.SS,s.ea=this.BP+t&65535,s;case 7:return s.defaultSeg=this.DS,s.ea=this.BX+t&65535,s}}}return s.defaultSeg=this.DS,s.ea=0,s}getRegByte(t){switch(t){case 0:return this.getAL();case 1:return this.getCL();case 2:return this.getDL();case 3:return this.getBL();case 4:return this.getAH();case 5:return this.getCH();case 6:return this.getDH();case 7:return this.getBH()}return 0}setRegByte(t,e){switch(t){case 0:this.setAL(e);break;case 1:this.setCL(e);break;case 2:this.setDL(e);break;case 3:this.setBL(e);break;case 4:this.setAH(e);break;case 5:this.setCH(e);break;case 6:this.setDH(e);break;case 7:this.setBH(e)}}getRmByte(t,e,s){return 3==t?this.getRegByte(e):this.memoryProvider.peek(s)}setRmByte(t,e,s,i){3==t?this.setRegByte(e,i):this.memoryProvider.poke(s,i)}getRegWord(t){switch(t){case 0:return this.AX;case 1:return this.CX;case 2:return this.DX;case 3:return this.BX;case 4:return this.SP;case 5:return this.BP;case 6:return this.SI;case 7:return this.DI}return 0}getSegReg(t){switch(t){case 0:return this.ES;case 1:return this.CS;case 2:return this.SS;case 3:return this.DS}return 0}setRegWord(t,e){switch(t){case 0:this.AX=e;break;case 1:this.CX=e;break;case 2:this.DX=e;break;case 3:this.BX=e;break;case 4:this.SP=e;break;case 5:this.BP=e;break;case 6:this.SI=e;break;case 7:this.DI=e}}setSegReg(t,e){switch(t){case 0:this.ES=e;break;case 1:this.CS=e;break;case 2:this.SS=e,this.blockInterrupt=!0;break;case 3:this.DS=e}}getRmWord(t,e,s){return 3==t?this.getRegWord(e):this.memoryProvider.peekW(s)}setRmWord(t,e,s,i){3==t?this.setRegWord(e,i):this.memoryProvider.pokeW(s,i)}setMemByte(t,e,s){this.memoryProvider.poke(this.genAddr(t,e),s)}setMemWord(t,e,s){this.memoryProvider.pokeW(this.genAddr(t,e),s)}readNextCodeByte(){const t=this.genAddr(this.CS,this.IP);return this.IP=this.IP+1&65535,this.memoryProvider.peek(t)}readNextCodeWord(){const t=this.memoryProvider.peekW(this.genAddr(this.CS,this.IP));return this.IP=this.IP+2&65535,t}getMemByte(t,e){return this.memoryProvider.peek(this.genAddr(t,e))}getMemWord(t,e){return this.memoryProvider.peekW(this.genAddr(t,e))}doSoftInterrupt(t){this.handleSoftInterrupt(t)||(this.softInterrupt=t)}handleSoftInterrupt(t){switch(t){case 19:if(4==this.getAH())return this.setAH(0),this.flags.CF=!1,!0}return!1}doInterrupt(t){this.hardInterrupt=t}setEvent(t,e){const s=++this.eventGen;return this.cpuEvents.push({action:e,clockCount:this.clockCount+Math.trunc(t*h.Settings.cpuFrequency/1e3),id:s}),s}deleteEvent(t){for(let e=0;e<this.cpuEvents.length;e++)if(this.cpuEvents[e].id==t){this.cpuEvents.splice(e,1);break}}}},63:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cpu386=void 0,e.Cpu386=class{constructor(t,e){}reset(){throw new Error("Method not implemented.")}getCurrentCodeAddr(){throw new Error("Method not implemented.")}getCodeSeg32Bit(){throw new Error("Method not implemented.")}execNextInstruction(){throw new Error("Method not implemented.")}execInstructions(t){throw new Error("Method not implemented.")}getInstructionByte(){throw new Error("Method not implemented.")}getAddressByte(){throw new Error("Method not implemented.")}getName(){throw new Error("Method not implemented.")}doInterrupt(t){throw new Error("Method not implemented.")}setEvent(t,e){throw new Error("Method not implemented.")}deleteEvent(t){throw new Error("Method not implemented.")}}},50:(t,e)=>{var s,i,r,a,h,o;Object.defineProperty(e,"__esModule",{value:!0}),e.CpuError=e.CpuExCode=e.CpuReg=e.Access=e.CpuMode=e.Repeat=e.Direction=e.CpuType=void 0,(h=e.CpuType||(e.CpuType={}))[h.Cpu186=0]="Cpu186",h[h.Cpu386=1]="Cpu386",(a=e.Direction||(e.Direction={}))[a.RegToRm=0]="RegToRm",a[a.RmToReg=1]="RmToReg",(r=e.Repeat||(e.Repeat={}))[r.None=0]="None",r[r.RepZ=1]="RepZ",r[r.RepNz=2]="RepNz",(i=e.CpuMode||(e.CpuMode={}))[i.Real=0]="Real",i[i.Protected=1]="Protected",i[i.Virtual8086=2]="Virtual8086",(s=e.Access||(e.Access={}))[s.Read=0]="Read",s[s.Write=1]="Write",e.CpuReg=class{getLoWord(){return 65535&this.value}setLoWord(t){this.value=(4294901760&this.value)+(65535&t)}getLoByte(){return 255&this.value}setLoByte(t){this.value=(4294967040&this.value)+(255&t)}getHiByte(){return this.value>>8&255}setHiByte(t){this.value=(4294902015&this.value)+((255&t)<<8)}},(o=e.CpuExCode||(e.CpuExCode={}))[o.DE=0]="DE",o[o.DB=1]="DB",o[o.BP=3]="BP",o[o.OF=4]="OF",o[o.BR=5]="BR",o[o.UD=6]="UD",o[o.NM=7]="NM",o[o.DF=8]="DF",o[o.TS=10]="TS",o[o.NP=11]="NP",o[o.SS=12]="SS",o[o.GP=13]="GP",o[o.PF=14]="PF",o[o.MF=16]="MF",o[o.AC=17]="AC",o[o.MC=18]="MC",o[o.XF=19]="XF",o[o.VE=20]="VE",o[o.SX=30]="SX",e.CpuError=class{constructor(t,e=null){this.exCode=t,this.errorCode=e}}},443:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Disassembler=void 0;class s{}e.Disassembler=class{constructor(t,e){this.instructionLineOffset=32,this.hexValues=Array(),this.startAddress=0,this.localAddress=0,this.cpu=t,this.memory=e}get instBytes(){let t="";for(let e=0;e<this.hexValues.length;e++)""!=t&&(t+=" "),t+=this.hexValues[e].toString(16).toUpperCase().padStart(2,"0");return t}get disassembledLine(){const t=this.instBytes.padEnd(this.instructionLineOffset," ");return this.startAddress.toString(16).toUpperCase().padStart(5,"0")+"  "+t+"    "+this.instruction}doDisassemble(t=-1){this.hexValues.length=0,this.instruction="",this.startAddress=-1==t?this.cpu.getCurrentCodeAddr():t,this.localAddress=this.startAddress;let e,s=this.getNextByte();this.op32Bit=this.addr32Bit=this.cpu.getCodeSeg32Bit();do{switch(e=!1,s){case 243:this.instruction+="REP ",s=this.getNextByte(),e=!0;break;case 242:this.instruction+="REPNZ ",s=this.getNextByte(),e=!0}switch(s){case 240:this.instruction+="LOCK ",s=this.getNextByte(),e=!0;break;case 46:this.segOverride="CS:",s=this.getNextByte(),e=!0;break;case 62:this.segOverride="DS:",s=this.getNextByte(),e=!0;break;case 38:this.segOverride="ES:",s=this.getNextByte(),e=!0;break;case 54:this.segOverride="SS:",s=this.getNextByte(),e=!0;break;case 100:this.segOverride="FS:",s=this.getNextByte(),e=!0;break;case 101:this.segOverride="GS:",s=this.getNextByte(),e=!0}102==s&&(this.op32Bit=!this.op32Bit,s=this.getNextByte(),e=!0),103==s&&(this.addr32Bit=!this.addr32Bit,s=this.getNextByte(),e=!0)}while(e);this.processOpcode(s),this.segOverride=""}processOpcode(t){switch(t){case 55:this.instruction="AAA";break;case 213:this.instruction="AAD";break;case 212:this.instruction="AAM";break;case 63:this.instruction="AAS";break;case 16:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADC ${t.rmStr}, ${t.regStr}`}break;case 17:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADC ${t.rmStr}, ${t.regStr}`}break;case 18:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADC ${t.regStr}, ${t.rmStr}`}break;case 19:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADC ${t.regStr}, ${t.rmStr}`}break;case 20:this.instruction=`ADC AL, ${this.getNextByteStr()}`;break;case 21:this.op32Bit?this.instruction=`ADC EAX, ${this.getNextDwordStr()}`:this.instruction=`ADC AX, ${this.getNextWordStr()}`;break;case 0:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADD ${t.rmStr}, ${t.regStr}`}break;case 1:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADD ${t.rmStr}, ${t.regStr}`}break;case 2:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADD ${t.regStr}, ${t.rmStr}`}break;case 3:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADD ${t.regStr}, ${t.rmStr}`}break;case 4:this.instruction=`ADD AL, ${this.getNextByteStr()}`;break;case 5:this.instruction=`ADD AX, ${this.getNextWordStr()}`;break;case 32:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`AND ${t.rmStr}, ${t.regStr}`}break;case 33:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`AND ${t.rmStr}, ${t.regStr}`}break;case 34:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`AND ${t.regStr}, ${t.rmStr}`}break;case 35:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`AND ${t.regStr}, ${t.rmStr}`}break;case 36:this.instruction=`AND AL, ${this.getNextByteStr()}`;break;case 37:this.op32Bit?this.instruction=`AND EAX, ${this.getNextDwordStr()}`:this.instruction=`AND AX, ${this.getNextWordStr()}`;break;case 99:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ARPL ${t.rmStr}, ${t.regStr}`}break;case 98:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BOUND ${t.regStr}, ${t.rmStr}`}break;case 232:this.op32Bit?this.instruction=`CALL ${this.getNextSDwordStr()}`:this.instruction=`CALL ${this.getNextSWordStr()}`;break;case 154:{const t=this.getNextWord(),e=this.getNextWord();this.instruction=`CALL FAR ${this.wordToHex(e)}:${this.wordToHex(t)}`}break;case 152:this.op32Bit?this.instruction="CWDE":this.instruction="CBW";break;case 248:this.instruction="CLC";break;case 252:this.instruction="CLD";break;case 250:this.instruction="CLI";break;case 245:this.instruction="CMC";break;case 56:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`CMP ${t.rmStr}, ${t.regStr}`}break;case 57:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`CMP ${t.rmStr}, ${t.regStr}`}break;case 58:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`CMP ${t.regStr}, ${t.rmStr}`}break;case 59:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`CMP ${t.regStr}, ${t.rmStr}`}break;case 60:this.instruction=`CMP AL, ${this.getNextByteStr()}`;break;case 61:this.op32Bit?this.instruction=`CMP EAX, ${this.getNextDwordStr()}`:this.instruction=`CMP AX, ${this.getNextWordStr()}`;break;case 166:{this.instruction+="CMPSB";const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 167:{this.op32Bit?this.instruction+="CMPSD":this.instruction+="CMPSW";const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 153:this.op32Bit?this.instruction="CDQ":this.instruction="CWD";break;case 39:this.instruction="DAA";break;case 47:this.instruction="DAS";break;case 72:this.instruction=`DEC ${this.prefixOp32()}AX`;break;case 73:this.instruction=`DEC ${this.prefixOp32()}CX`;break;case 74:this.instruction=`DEC ${this.prefixOp32()}DX`;break;case 75:this.instruction=`DEC ${this.prefixOp32()}BX`;break;case 76:this.instruction=`DEC ${this.prefixOp32()}SP`;break;case 77:this.instruction=`DEC ${this.prefixOp32()}BP`;break;case 78:this.instruction=`DEC ${this.prefixOp32()}SI`;break;case 79:this.instruction=`DEC ${this.prefixOp32()}DI`;break;case 200:this.instruction=`ENTER ${this.getNextWordStr()}, ${this.getNextByteStr()}`;break;case 244:this.instruction="HLT";break;case 107:{const t=this.readAndDecodeAddressByte(!1);t.regStr==t.rmStr?this.instruction=`IMUL ${t.regStr}, ${this.getNextByteStr()}`:this.instruction=`IMUL ${t.regStr}, ${t.rmStr}, ${this.getNextByteStr()}`}break;case 105:{const t=this.readAndDecodeAddressByte(!1),e=this.op32Bit?this.getNextDwordStr():this.getNextWordStr();t.regStr==t.rmStr?this.instruction=`IMUL ${t.regStr}, ${e}`:this.instruction=`IMUL ${t.regStr}, ${t.rmStr}, ${e}`}break;case 228:this.instruction=`IN AL, ${this.getNextByteStr()}`;break;case 229:this.instruction=`IN ${this.prefixOp32()}AX, ${this.getNextByteStr()}`;break;case 236:this.instruction="IN AL, DX";break;case 237:this.instruction=`IN ${this.prefixOp32()}AX, DX`;break;case 64:this.instruction=`INC ${this.prefixOp32()}AX`;break;case 65:this.instruction=`INC ${this.prefixOp32()}CX`;break;case 66:this.instruction=`INC ${this.prefixOp32()}DX`;break;case 67:this.instruction=`INC ${this.prefixOp32()}BX`;break;case 68:this.instruction=`INC ${this.prefixOp32()}SP`;break;case 69:this.instruction=`INC ${this.prefixOp32()}BP`;break;case 70:this.instruction=`INC ${this.prefixOp32()}SI`;break;case 71:this.instruction=`INC ${this.prefixOp32()}DI`;break;case 108:this.instruction+="INSB";break;case 109:this.op32Bit?this.instruction+="INSD":this.instruction+="INSW";break;case 204:this.instruction="INT3";break;case 205:this.instruction=`INT ${this.getNextByteStr()}`;break;case 206:this.instruction="INTO";break;case 207:this.op32Bit?this.instruction="IRETD":this.instruction="IRET";break;case 119:this.instruction=`JA ${this.getNextSByteStr()}`;break;case 115:this.instruction=`JAE/JNC ${this.getNextSByteStr()}`;break;case 114:this.instruction=`JB/JC ${this.getNextSByteStr()}`;break;case 118:this.instruction=`JBE ${this.getNextSByteStr()}`;break;case 227:this.instruction=`JCXZ ${this.getNextSByteStr()}`;break;case 116:this.instruction=`JE ${this.getNextSByteStr()}`;break;case 127:this.instruction=`JG ${this.getNextSByteStr()}`;break;case 125:this.instruction=`JGE ${this.getNextSByteStr()}`;break;case 124:this.instruction=`JL ${this.getNextSByteStr()}`;break;case 126:this.instruction=`JLE ${this.getNextSByteStr()}`;break;case 235:this.instruction=`JMP ${this.getNextSByteStr()}`;break;case 233:this.op32Bit?this.instruction=`JMP ${this.getNextSDwordStr()}`:this.instruction=`JMP ${this.getNextSWordStr()}`;break;case 234:if(this.op32Bit){const t=this.getNextDword(),e=this.getNextWord();this.instruction=`JMP FAR ${this.wordToHex(e)}:${this.dwordToHex(t)}`}else{const t=this.getNextWord(),e=this.getNextWord();this.instruction=`JMP FAR ${this.wordToHex(e)}:${this.wordToHex(t)}`}break;case 117:this.instruction=`JNE ${this.getNextSByteStr()}`;break;case 113:this.instruction=`JNO ${this.getNextSByteStr()}`;break;case 121:this.instruction=`JNS ${this.getNextSByteStr()}`;break;case 123:this.instruction=`JNP ${this.getNextSByteStr()}`;break;case 112:this.instruction=`JO ${this.getNextSByteStr()}`;break;case 122:this.instruction=`JP ${this.getNextSByteStr()}`;break;case 120:this.instruction=`JS ${this.getNextSByteStr()}`;break;case 159:this.instruction="LAHF";break;case 197:this.loadSeg("DS");break;case 141:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`LEA ${t.regStr}, ${t.rmStr}`}break;case 201:this.instruction="LEAVE";break;case 196:this.loadSeg("ES");break;case 240:this.instruction="LOCK";break;case 172:this.instruction+="LODSB";{let t="SI";this.addr32Bit&&(t=`E${t}`),""!=this.segOverride?this.instruction+=` ${this.segOverride}[${t}]`:this.addr32Bit&&(this.instruction+=` [${t}]`)}break;case 173:{let t="SI";this.addr32Bit&&(t=`E${t}`),this.op32Bit?this.instruction+="LODSD":this.instruction+="LODSW",""!=this.segOverride?this.instruction+=` ${this.segOverride}[${t}]`:this.addr32Bit&&(this.instruction+=` [${t}]`)}break;case 226:this.instruction=`LOOP ${this.getNextSByteStr()}`;break;case 225:this.instruction=`LOOPZ ${this.getNextSByteStr()}`;break;case 224:this.instruction=`LOOPNZ ${this.getNextSByteStr()}`;break;case 160:this.instruction=`MOV AL, ${this.segOverride}[${this.getNextWordStr()}]`;break;case 161:{const t=this.addr32Bit?this.getNextDwordStr():this.getNextWordStr(),e=this.op32Bit?"EAX":"AX";this.instruction=`MOV ${e}, ${this.segOverride}[${t}]`}break;case 162:this.instruction=`MOV ${this.segOverride}[${this.getNextWordStr()}], AL`;break;case 163:{const t=this.addr32Bit?this.getNextDwordStr():this.getNextWordStr(),e=this.op32Bit?"EAX":"AX";this.instruction=`MOV ${this.segOverride}[${t}], ${e}`}break;case 176:this.instruction=`MOV AL, ${this.getNextByteStr()}`;break;case 177:this.instruction=`MOV CL, ${this.getNextByteStr()}`;break;case 178:this.instruction=`MOV DL, ${this.getNextByteStr()}`;break;case 179:this.instruction=`MOV BL, ${this.getNextByteStr()}`;break;case 180:this.instruction=`MOV AH, ${this.getNextByteStr()}`;break;case 181:this.instruction=`MOV CH, ${this.getNextByteStr()}`;break;case 182:this.instruction=`MOV DH, ${this.getNextByteStr()}`;break;case 183:this.instruction=`MOV BH, ${this.getNextByteStr()}`;break;case 184:this.op32Bit?this.instruction=`MOV EAX, ${this.getNextDwordStr()}`:this.instruction=`MOV AX, ${this.getNextWordStr()}`;break;case 185:this.op32Bit?this.instruction=`MOV ECX, ${this.getNextDwordStr()}`:this.instruction=`MOV CX, ${this.getNextWordStr()}`;break;case 186:this.op32Bit?this.instruction=`MOV EDX, ${this.getNextDwordStr()}`:this.instruction=`MOV DX, ${this.getNextWordStr()}`;break;case 187:this.op32Bit?this.instruction=`MOV EBX, ${this.getNextDwordStr()}`:this.instruction=`MOV BX, ${this.getNextWordStr()}`;break;case 188:this.op32Bit?this.instruction=`MOV ESP, ${this.getNextDwordStr()}`:this.instruction=`MOV SP, ${this.getNextWordStr()}`;break;case 189:this.op32Bit?this.instruction=`MOV EBP, ${this.getNextDwordStr()}`:this.instruction=`MOV BP, ${this.getNextWordStr()}`;break;case 190:this.op32Bit?this.instruction=`MOV ESI, ${this.getNextDwordStr()}`:this.instruction=`MOV SI, ${this.getNextWordStr()}`;break;case 191:this.op32Bit?this.instruction=`MOV EDI, ${this.getNextDwordStr()}`:this.instruction=`MOV DI, ${this.getNextWordStr()}`;break;case 198:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${t.rmStr}, ${this.getNextByteStr()}`}break;case 199:{const t=this.readAndDecodeAddressByte(!1);this.op32Bit?this.instruction=`MOV ${t.rmStr}, ${this.getNextDwordStr()}`:this.instruction=`MOV ${t.rmStr}, ${this.getNextWordStr()}`}break;case 136:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${t.rmStr}, ${t.regStr}`}break;case 137:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.rmStr}, ${t.regStr}`}break;case 138:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${t.regStr}, ${t.rmStr}`}break;case 139:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.regStr}, ${t.rmStr}`}break;case 140:{this.op32Bit=!1;const t=this.readAndDecodeAddressByte(!1,!0);this.instruction=`MOV ${t.rmStr}, ${t.regStr}`}break;case 142:{this.op32Bit=!1;const t=this.readAndDecodeAddressByte(!1,!0);this.instruction=`MOV ${t.regStr}, ${t.rmStr}`}break;case 164:this.instruction+="MOVSB";{const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 165:{this.op32Bit?this.instruction+="MOVSD":this.instruction+="MOVSW";const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 144:this.instruction="NOP";break;case 8:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`OR ${t.rmStr}, ${t.regStr}`}break;case 9:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`OR ${t.rmStr}, ${t.regStr}`}break;case 10:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`OR ${t.regStr}, ${t.rmStr}`}break;case 11:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`OR ${t.regStr}, ${t.rmStr}`}break;case 12:this.instruction=`OR AL, ${this.getNextByteStr()}`;break;case 13:this.op32Bit?this.instruction=`OR EAX, ${this.getNextDwordStr()}`:this.instruction=`OR AX, ${this.getNextWordStr()}`;break;case 230:this.instruction=`OUT ${this.getNextByteStr()}, AL`;break;case 231:this.instruction=`OUT ${this.getNextByteStr()}, AX`;break;case 238:this.instruction="OUT DX, AL";break;case 239:this.op32Bit?this.instruction="OUT DX, EAX":this.instruction="OUT DX, AX";break;case 110:this.instruction+="OUTSB",this.addr32Bit&&(this.instruction+=" DX, [ESI]");break;case 111:this.op32Bit?this.instruction+="OUTSD":this.instruction+="OUTSW",this.addr32Bit&&(this.instruction+=" DX, [ESI]");break;case 88:this.instruction=`POP ${this.prefixOp32()}AX`;break;case 89:this.instruction=`POP ${this.prefixOp32()}CX`;break;case 90:this.instruction=`POP ${this.prefixOp32()}DX`;break;case 91:this.instruction=`POP ${this.prefixOp32()}BX`;break;case 92:this.instruction=`POP ${this.prefixOp32()}SP`;break;case 93:this.instruction=`POP ${this.prefixOp32()}BP`;break;case 94:this.instruction=`POP ${this.prefixOp32()}SI`;break;case 95:this.instruction=`POP ${this.prefixOp32()}DI`;break;case 7:this.instruction="POP ES";break;case 23:this.instruction="POP SS";break;case 31:this.instruction="POP DS";break;case 143:{const t=this.readAndDecodeAddressByte(!0);this.op32Bit?this.instruction=`POP DWORD ${t.rmStr}`:this.instruction=`POP ${t.rmStr}`}break;case 97:this.op32Bit?this.instruction="POPAD":this.instruction="POPA";break;case 157:this.op32Bit?this.instruction="POPFD":this.instruction="POPF";break;case 80:this.instruction=`PUSH ${this.prefixOp32()}AX`;break;case 81:this.instruction=`PUSH ${this.prefixOp32()}CX`;break;case 82:this.instruction=`PUSH ${this.prefixOp32()}DX`;break;case 83:this.instruction=`PUSH ${this.prefixOp32()}BX`;break;case 84:this.instruction=`PUSH ${this.prefixOp32()}SP`;break;case 85:this.instruction=`PUSH ${this.prefixOp32()}BP`;break;case 86:this.instruction=`PUSH ${this.prefixOp32()}SI`;break;case 87:this.instruction=`PUSH ${this.prefixOp32()}DI`;break;case 6:this.instruction="PUSH ES";break;case 14:this.instruction="PUSH CS";break;case 22:this.instruction="PUSH SS";break;case 30:this.instruction="PUSH DS";break;case 106:this.instruction=`PUSH ${this.getNextByteStr()}`;break;case 104:this.op32Bit?this.instruction=`PUSH ${this.getNextDwordStr()}`:this.instruction=`PUSH ${this.getNextWordStr()}`;break;case 96:this.op32Bit?this.instruction="PUSHAD":this.instruction="PUSHA";break;case 156:this.op32Bit?this.instruction="PUSHFD":this.instruction="PUSHF";break;case 195:this.instruction="RET";break;case 194:this.instruction=`RET ${this.getNextWordStr()}`;break;case 203:this.instruction="RETF";break;case 202:this.instruction=`RETF ${this.getNextWordStr()}`;break;case 158:this.instruction="SAHF";break;case 24:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SBB ${t.rmStr}, ${t.regStr}`}break;case 25:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SBB ${t.rmStr}, ${t.regStr}`}break;case 26:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SBB ${t.regStr}, ${t.rmStr}`}break;case 27:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SBB ${t.regStr}, ${t.rmStr}`}break;case 28:this.instruction=`SBB AL, ${this.getNextByteStr()}`;break;case 29:this.op32Bit?this.instruction=`SBB EAX, ${this.getNextDwordStr()}`:this.instruction=`SBB AX, ${this.getNextWordStr()}`;break;case 174:this.instruction+="SCASB",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 175:this.op32Bit?this.instruction+="SCASD":this.instruction+="SCASW",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 249:this.instruction="STC";break;case 253:this.instruction="STD";break;case 251:this.instruction="STI";break;case 170:this.instruction+="STOSB",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 171:this.op32Bit?this.instruction+="STOSD":this.instruction+="STOSW",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 40:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SUB ${t.rmStr}, ${t.regStr}`}break;case 41:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SUB ${t.rmStr}, ${t.regStr}`}break;case 42:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SUB ${t.regStr}, ${t.rmStr}`}break;case 43:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SUB ${t.regStr}, ${t.rmStr}`}break;case 44:this.instruction=`SUB AL, ${this.getNextByteStr()}`;break;case 45:this.op32Bit?this.instruction=`SUB EAX, ${this.getNextDwordStr()}`:this.instruction=`SUB AX, ${this.getNextWordStr()}`;break;case 132:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`TEST ${t.rmStr}, ${t.regStr}`}break;case 133:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`TEST ${t.rmStr}, ${t.regStr}`}break;case 168:this.instruction=`TEST AL, ${this.getNextByteStr()}`;break;case 169:this.op32Bit?this.instruction=`TEST EAX, ${this.getNextDwordStr()}`:this.instruction=`TEST AX, ${this.getNextWordStr()}`;break;case 155:this.instruction="WAIT";break;case 145:this.instruction="XCHG AX, CX";break;case 146:this.instruction="XCHG AX, DX";break;case 147:this.instruction="XCHG AX, BX";break;case 148:this.instruction="XCHG AX, SP";break;case 149:this.instruction="XCHG AX, BP";break;case 150:this.instruction="XCHG AX, SI";break;case 151:this.instruction="XCHG AX, DI";break;case 134:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`XCHG ${t.regStr}, ${t.rmStr}`}break;case 135:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`XCHG ${t.regStr}, ${t.rmStr}`}break;case 215:this.instruction=`XLAT ${this.segOverride}[BX]`;break;case 48:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`XOR ${t.rmStr}, ${t.regStr}`}break;case 49:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`XOR ${t.rmStr}, ${t.regStr}`}break;case 50:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`XOR ${t.regStr}, ${t.rmStr}`}break;case 51:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`XOR ${t.regStr}, ${t.rmStr}`}break;case 52:this.instruction=`XOR AL, ${this.getNextByteStr()}`;break;case 53:this.op32Bit?this.instruction=`XOR EAX, ${this.getNextDwordStr()}`:this.instruction=`XOR AX, ${this.getNextWordStr()}`;break;case 254:this.handleOpcodeFeFf(!1);break;case 255:this.handleOpcodeFeFf(!0);break;case 128:this.handleOpcode80();break;case 129:this.handleOpcode81();break;case 131:this.handleOpcode83();break;case 246:this.handleOpcodeF6();break;case 247:this.handleOpcodeF7();break;case 15:this.handleOpcode0F();break;case 208:this.handleOpcodeD0();break;case 209:this.handleOpcodeD1();break;case 210:this.handleOpcodeD2();break;case 211:this.handleOpcodeD3();break;case 192:this.handleOpcodeC0();break;case 193:this.handleOpcodeC1()}}handleOpcodeFeFf(t){const e=this.readAndDecodeAddressByte(!t);switch(e.reg){case 0:this.op32Bit?this.instruction=`INC DWORD ${e.rmStr}`:this.instruction=`INC ${e.rmStr}`;break;case 1:this.op32Bit?this.instruction=`DEC DWORD ${e.rmStr}`:this.instruction=`DEC ${e.rmStr}`;break;case 4:this.instruction=`JMP ${e.rmStr}`;break;case 2:this.instruction=`CALL ${e.rmStr}`;break;case 3:this.instruction=`CALL FAR ${e.rmStr}`;break;case 5:this.instruction=`JMP FAR ${e.rmStr}`;break;case 6:t&&(this.op32Bit?this.instruction=`PUSH DWORD ${e.rmStr}`:this.instruction=`PUSH ${e.rmStr}`)}}handleOpcode80(){const t=this.readAndDecodeAddressByte(!0),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ADD ${t.rmStr}, ${e}`;break;case 1:this.instruction=`OR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`ADC ${t.rmStr}, ${e}`;break;case 3:this.instruction=`SBC ${t.rmStr}, ${e}`;break;case 4:this.instruction=`AND ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SUB ${t.rmStr}, ${e}`;break;case 6:this.instruction=`XOR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`CMP ${t.rmStr}, ${e}`}}handleOpcode81(){const t=this.readAndDecodeAddressByte(!1),e=this.op32Bit?this.getNextDwordStr():this.getNextWordStr();switch(t.reg){case 0:this.instruction=`ADD ${t.rmStr}, ${e}`;break;case 1:this.instruction=`OR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`ADC ${t.rmStr}, ${e}`;break;case 3:this.instruction=`SBC ${t.rmStr}, ${e}`;break;case 4:this.instruction=`AND ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SUB ${t.rmStr}, ${e}`;break;case 6:this.instruction=`XOR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`CMP ${t.rmStr}, ${e}`}}handleOpcode83(){const t=this.readAndDecodeAddressByte(!1),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ADD ${t.rmStr}, ${e}`;break;case 1:this.instruction=`OR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`ADC ${t.rmStr}, ${e}`;break;case 3:this.instruction=`SBC ${t.rmStr}, ${e}`;break;case 4:this.instruction=`AND ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SUB ${t.rmStr}, ${e}`;break;case 6:this.instruction=`XOR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`CMP ${t.rmStr}, ${e}`}}handleOpcodeF6(){const t=this.readAndDecodeAddressByte(!0);switch(t.reg){case 0:this.instruction=`TEST ${t.rmStr}, ${this.getNextByteStr()}`;break;case 2:this.instruction=`NOT ${t.rmStr}`;break;case 3:this.instruction=`NEG ${t.rmStr}`;break;case 4:this.instruction=`MUL ${t.rmStr}`;break;case 5:this.instruction=`IMUL ${t.rmStr}`;break;case 6:this.instruction=`DIV ${t.rmStr}`;break;case 7:this.instruction=`IDIV ${t.rmStr}`}}handleOpcodeF7(){const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`TEST ${t.rmStr}, ${this.getNextWordStr()}`;break;case 2:this.instruction=`NOT ${t.rmStr}`;break;case 3:this.instruction=`NEG ${t.rmStr}`;break;case 4:this.instruction=`MUL ${t.rmStr}`;break;case 5:this.instruction=`IMUL ${t.rmStr}`;break;case 6:this.instruction=`DIV ${t.rmStr}`;break;case 7:this.instruction=`IDIV ${t.rmStr}`}}handleOpcode0F(){switch(this.getNextByte()){case 0:{const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`SLDT ${t.rmStr}`;break;case 1:this.instruction=`STR ${t.rmStr}`;break;case 2:this.instruction=`LLDT ${t.rmStr}`;break;case 3:this.instruction=`LTR ${t.rmStr}`}}break;case 1:{const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`SGDT ${t.rmStr}`;break;case 1:this.instruction=`SIDT ${t.rmStr}`;break;case 2:this.instruction=`LGDT ${t.rmStr}`;break;case 3:this.instruction=`LIDT ${t.rmStr}`;break;case 4:this.instruction=`SMSW ${t.rmStr}`;break;case 6:this.instruction=`LMSW ${t.rmStr}`}}break;case 2:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`LAR ${t.regStr}, ${t.rmStr}`}break;case 6:this.instruction="CLTS";break;case 9:this.instruction="WBINVD";break;case 32:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`MOV ${t.rmStr}, CR0`;break;case 1:this.instruction=`MOV ${t.rmStr}, CR1`;break;case 2:this.instruction=`MOV ${t.rmStr}, CR2`;break;case 3:this.instruction=`MOV ${t.rmStr}, CR3`}}break;case 33:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.rmStr}, DR${t.reg}`}break;case 34:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`MOV CR0, ${t.rmStr}`;break;case 1:this.instruction=`MOV CR1, ${t.rmStr}`;break;case 2:this.instruction=`MOV CR2, ${t.rmStr}`;break;case 3:this.instruction=`MOV CR3, ${t.rmStr}`}}break;case 35:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV DR${t.reg}, ${t.rmStr}`}break;case 36:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.rmStr}, TR${t.reg}`}break;case 38:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV TR${t.reg}, ${t.rmStr}`}break;case 128:this.instruction=`JO ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 129:this.instruction=`JNO ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 130:this.instruction=`JB/JC ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 131:this.instruction=`JNB/JNC ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 132:this.instruction=`JE/JZ ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 133:this.instruction=`JNE/JZ ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 134:this.instruction=`JBE ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 135:this.instruction=`JA ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 136:this.instruction=`JS ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 137:this.instruction=`JNS ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 138:this.instruction=`JP ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 139:this.instruction=`JNP ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 140:this.instruction=`JL ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 141:this.instruction=`JGE ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 142:this.instruction=`JLE ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 143:this.instruction=`JG ${this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr()}`;break;case 144:this.instruction=`SETO ${this.getRm8Str()}`;break;case 145:this.instruction=`SETNO ${this.getRm8Str()}`;break;case 146:this.instruction=`SETB/SETC ${this.getRm8Str()}`;break;case 147:this.instruction=`SETNB/SETNC ${this.getRm8Str()}`;break;case 148:this.instruction=`SETE/SETZ ${this.getRm8Str()}`;break;case 149:this.instruction=`SETNE/SETZ ${this.getRm8Str()}`;break;case 150:this.instruction=`SETBE ${this.getRm8Str()}`;break;case 151:this.instruction=`SETA ${this.getRm8Str()}`;break;case 152:this.instruction=`SETS ${this.getRm8Str()}`;break;case 153:this.instruction=`SETNS ${this.getRm8Str()}`;break;case 154:this.instruction=`SETP ${this.getRm8Str()}`;break;case 155:this.instruction=`SETNP ${this.getRm8Str()}`;break;case 156:this.instruction=`SETL ${this.getRm8Str()}`;break;case 157:this.instruction=`SETGE ${this.getRm8Str()}`;break;case 158:this.instruction=`SETLE ${this.getRm8Str()}`;break;case 159:this.instruction=`SETG ${this.getRm8Str()}`;break;case 160:this.instruction="PUSH FS";break;case 161:this.instruction="POP FS";break;case 163:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BT ${t.rmStr}, ${t.regStr}`}break;case 164:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHLD ${t.rmStr}, ${t.regStr}, ${this.getNextByteStr()}`}break;case 165:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHLD ${t.rmStr}, ${t.regStr}, CL`}break;case 168:this.instruction="PUSH GS";break;case 169:this.instruction="POP GS";break;case 171:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BTS ${t.rmStr}, ${t.regStr}`}break;case 172:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHRD ${t.rmStr}, ${t.regStr}, ${this.getNextByteStr()}`}break;case 173:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHRD ${t.rmStr}, ${t.regStr}, CL`}break;case 178:this.loadSeg("SS");break;case 179:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BTR ${t.rmStr}, ${t.regStr}`}break;case 180:this.loadSeg("FS");break;case 181:this.loadSeg("GS");break;case 182:{const t=this.getNextByte(),e=this.decodeAddressByte(t,!1),s=this.decodeAddressByte(t,!0,!1,!0);this.instruction=`MOVZX ${e.regStr}, ${s.rmStr}`}break;case 183:{const t=this.getNextByte(),e=this.decodeAddressByte(t,!1);this.op32Bit=!1;const s=this.decodeAddressByte(t,!1,!1,!0);this.instruction=`MOVZX ${e.regStr}, ${s.rmStr}`}break;case 186:{const t=this.readAndDecodeAddressByte(!1),e=this.getNextByteStr();switch(t.reg){case 4:this.instruction=`BT ${t.rmStr}, ${e}`;break;case 5:this.instruction=`BTS ${t.rmStr}, ${e}`;break;case 6:this.instruction=`BTR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`BTC ${t.rmStr}, ${e}`}}break;case 187:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BTC ${t.rmStr}, ${t.regStr}`}break;case 188:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BSF ${t.regStr}, ${t.rmStr}`}break;case 189:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BSR ${t.regStr}, ${t.rmStr}`}}}handleOpcodeD0(){const t=this.readAndDecodeAddressByte(!0);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, 1`;break;case 1:this.instruction=`ROR ${t.rmStr}, 1`;break;case 2:this.instruction=`RCL ${t.rmStr}, 1`;break;case 3:this.instruction=`RCR ${t.rmStr}, 1`;break;case 4:this.instruction=`SHL ${t.rmStr}, 1`;break;case 5:this.instruction=`SHR ${t.rmStr}, 1`;break;case 6:this.instruction=`SAL ${t.rmStr}, 1`;break;case 7:this.instruction=`SAR ${t.rmStr}, 1`}}handleOpcodeD1(){const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, 1`;break;case 1:this.instruction=`ROR ${t.rmStr}, 1`;break;case 2:this.instruction=`RCL ${t.rmStr}, 1`;break;case 3:this.instruction=`RCR ${t.rmStr}, 1`;break;case 4:this.instruction=`SHL ${t.rmStr}, 1`;break;case 5:this.instruction=`SHR ${t.rmStr}, 1`;break;case 6:this.instruction=`SAL ${t.rmStr}, 1`;break;case 7:this.instruction=`SAR ${t.rmStr}, 1`}}handleOpcodeD2(){const t=this.readAndDecodeAddressByte(!0);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, CL`;break;case 1:this.instruction=`ROR ${t.rmStr}, CL`;break;case 2:this.instruction=`RCL ${t.rmStr}, CL`;break;case 3:this.instruction=`RCR ${t.rmStr}, CL`;break;case 4:this.instruction=`SHL ${t.rmStr}, CL`;break;case 5:this.instruction=`SHR ${t.rmStr}, CL`;break;case 6:this.instruction=`SAL ${t.rmStr}, CL`;break;case 7:this.instruction=`SAR ${t.rmStr}, CL`}}handleOpcodeD3(){const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, CL`;break;case 1:this.instruction=`ROR ${t.rmStr}, CL`;break;case 2:this.instruction=`RCL ${t.rmStr}, CL`;break;case 3:this.instruction=`RCR ${t.rmStr}, CL`;break;case 4:this.instruction=`SHL ${t.rmStr}, CL`;break;case 5:this.instruction=`SHR ${t.rmStr}, CL`;break;case 6:this.instruction=`SAL ${t.rmStr}, CL`;break;case 7:this.instruction=`SAR ${t.rmStr}, CL`}}handleOpcodeC0(){const t=this.readAndDecodeAddressByte(!0),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, ${e}`;break;case 1:this.instruction=`ROR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`RCL ${t.rmStr}, ${e}`;break;case 3:this.instruction=`RCR ${t.rmStr}, ${e}`;break;case 4:this.instruction=`SHL ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SHR ${t.rmStr}, ${e}`;break;case 6:this.instruction=`SAL ${t.rmStr}, ${e}`;break;case 7:this.instruction=`SAR ${t.rmStr}, ${e}`}}handleOpcodeC1(){const t=this.readAndDecodeAddressByte(!1),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, ${e}`;break;case 1:this.instruction=`ROR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`RCL ${t.rmStr}, ${e}`;break;case 3:this.instruction=`RCR ${t.rmStr}, ${e}`;break;case 4:this.instruction=`SHL ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SHR ${t.rmStr}, ${e}`;break;case 6:this.instruction=`SAL ${t.rmStr}, ${e}`;break;case 7:this.instruction=`SAR ${t.rmStr}, ${e}`}}readAndDecodeAddressByte(t,e=!1,s=!1){const i=this.getNextByte();return this.decodeAddressByte(i,t,e,s)}decodeAddressByte(t,e,i=!1,r=!1){const a=(192&t)>>6,h=(56&t)>>3,o=7&t,n=new s;n.reg=h,n.regStr=e?this.getRegByte(h):this.getRegWord(h,i),n.rmStr="";let c="";switch(r&&(c=e?"BYTE ":this.op32Bit?"DWORD ":"WORD "),a){case 0:if(this.addr32Bit)switch(o){case 0:n.rmStr=this.segOverride+"[EAX]";break;case 1:n.rmStr=this.segOverride+"[ECX]";break;case 2:n.rmStr=this.segOverride+"[EDX]";break;case 3:n.rmStr=this.segOverride+"[EBX]";break;case 4:{const t=this.readSib(a);n.rmStr=this.segOverride+t}break;case 5:{const t=this.getNextDword();n.rmStr=`${this.segOverride}[${this.dwordToHex(t)}]`}break;case 6:n.rmStr=this.segOverride+"[ESI]";break;case 7:n.rmStr=this.segOverride+"[EDI]"}else switch(o){case 0:n.rmStr=this.segOverride+"[BX + SI]";break;case 1:n.rmStr=this.segOverride+"[BX + DI]";break;case 2:n.rmStr=this.segOverride+"[BP + SI]";break;case 3:n.rmStr=this.segOverride+"[BP + DI]";break;case 4:n.rmStr=this.segOverride+"[SI]";break;case 5:n.rmStr=this.segOverride+"[DI]";break;case 6:{const t=this.getNextWord();n.rmStr=`${this.segOverride}[${this.wordToHex(t)}]`}break;case 7:n.rmStr=this.segOverride+"[BX]"}n.rmStr=c+n.rmStr;break;case 1:if(this.addr32Bit)switch(o){case 0:n.rmStr=`${this.segOverride}[EAX ${this.getNextSByteStr()}]`;break;case 1:n.rmStr=`${this.segOverride}[ECX ${this.getNextSByteStr()}]`;break;case 2:n.rmStr=`${this.segOverride}[EDX ${this.getNextSByteStr()}]`;break;case 3:n.rmStr=`${this.segOverride}[EBX ${this.getNextSByteStr()}]`;break;case 4:{const t=this.readSib(a);n.rmStr=this.segOverride+t+" "+this.getNextSByteStr()}break;case 5:n.rmStr=`${this.segOverride}[EBP ${this.getNextSByteStr()}]`;break;case 6:n.rmStr=`${this.segOverride}[BSI ${this.getNextSByteStr()}]`;break;case 7:n.rmStr=`${this.segOverride}[BDI ${this.getNextSByteStr()}]`}else{const t=this.getNextByte();switch(o){case 0:n.rmStr=`${this.segOverride}[BX + SI ${this.sByteToHex(t)}]`;break;case 1:n.rmStr=`${this.segOverride}[BX + DI ${this.sByteToHex(t)}]`;break;case 2:n.rmStr=`${this.segOverride}[BP + SI ${this.sByteToHex(t)}]`;break;case 3:n.rmStr=`${this.segOverride}[BP + DI ${this.sByteToHex(t)}]`;break;case 4:n.rmStr=`${this.segOverride}[SI ${this.sByteToHex(t)}]`;break;case 5:n.rmStr=`${this.segOverride}[DI ${this.sByteToHex(t)}]`;break;case 6:n.rmStr=`${this.segOverride}[BP ${this.sByteToHex(t)}]`;break;case 7:n.rmStr=`${this.segOverride}[BX ${this.sByteToHex(t)}]`}}n.rmStr=c+n.rmStr;break;case 2:if(this.addr32Bit)switch(o){case 0:n.rmStr=`${this.segOverride}[EAX ${this.getNextSDwordStr()}]`;break;case 1:n.rmStr=`${this.segOverride}[ECX ${this.getNextSDwordStr()}]`;break;case 2:n.rmStr=`${this.segOverride}[EDX ${this.getNextSDwordStr()}]`;break;case 3:n.rmStr=`${this.segOverride}[EBX ${this.getNextSDwordStr()}]`;break;case 4:{const t=this.readSib(a);n.rmStr=this.segOverride+this.getNextDwordStr()+t}break;case 5:n.rmStr=`${this.segOverride}[EBP ${this.getNextSDwordStr()}]`;break;case 6:n.rmStr=`${this.segOverride}[ESI ${this.getNextSDwordStr()}]`;break;case 7:n.rmStr=`${this.segOverride}[EDI ${this.getNextSDwordStr()}]`}else{const t=this.getNextWord();switch(o){case 0:n.rmStr=`${this.segOverride}[BX + SI ${this.sWordToHex(t)}]`;break;case 1:n.rmStr=`${this.segOverride}[BX + DI ${this.sWordToHex(t)}]`;break;case 2:n.rmStr=`${this.segOverride}[BP + SI ${this.sWordToHex(t)}]`;break;case 3:n.rmStr=`${this.segOverride}[BP + DI ${this.sWordToHex(t)}]`;break;case 4:n.rmStr=`${this.segOverride}[SI ${this.sWordToHex(t)}]`;break;case 5:n.rmStr=`${this.segOverride}[DI ${this.sWordToHex(t)}]`;break;case 6:n.rmStr=`${this.segOverride}[BP ${this.sWordToHex(t)}]`;break;case 7:n.rmStr=`${this.segOverride}[BX ${this.sWordToHex(t)}]`}}n.rmStr=c+n.rmStr;break;case 3:n.rmStr=e?this.getRegByte(o):this.getRegWord(o)}return n}readSib(t){const e=this.getNextByte(),s=e>>3&7,i=e>>6&3;let r="";switch(7&e){case 0:r+="[EAX]";break;case 1:r+="[ECX]";break;case 2:r+="[EDX]";break;case 3:r+="[EBX]";break;case 4:r+="[ESP]";break;case 5:r+=0==t?this.getNextDwordStr():"[EBP]";break;case 6:r+="[ESI]";break;case 7:r+="[EDI]"}switch(r+="[",s){case 0:r+="EAX";break;case 1:r+="ECX";break;case 2:r+="EDX";break;case 3:r+="EBX";break;case 5:r+="EBP";break;case 6:r+="ESI";break;case 7:r+="EDI"}switch(i){case 0:r+="*1";break;case 1:r+="*2";break;case 2:r+="*4";break;case 3:r+="*8"}return r+="]",r}getRegByte(t){switch(t){case 0:return"AL";case 1:return"CL";case 2:return"DL";case 3:return"BL";case 4:return"AH";case 5:return"CH";case 6:return"DH";case 7:return"BH"}return""}getRegWord(t,e=!1){if(!e){let e="";switch(t){case 0:e="AX";break;case 1:e="CX";break;case 2:e="DX";break;case 3:e="BX";break;case 4:e="SP";break;case 5:e="BP";break;case 6:e="SI";break;case 7:e="DI"}return this.op32Bit&&(e=`E${e}`),e}switch(t){case 0:return"ES";case 1:return"CS";case 2:return"SS";case 3:return"DS";case 4:return"FS";case 5:return"GS"}return""}loadSeg(t){{const e=this.readAndDecodeAddressByte(!1);this.instruction=`L${t} ${e.regStr}, ${e.rmStr}`}}getRm8Str(){return this.readAndDecodeAddressByte(!0).rmStr}byteToHex(t){return`${(255&t).toString(16).toUpperCase().padStart(2,"0")}h`}wordToHex(t){return`${(65535&t).toString(16).toUpperCase().padStart(4,"0")}h`}dwordToHex(t){return`${(4294967295&t).toString(16).toUpperCase().padStart(8,"0")}h`}sByteToHex(t){return t>127?`- ${(256-t).toString(16).toUpperCase().padStart(2,"0")}h`:`+ ${t.toString(16).toUpperCase().padStart(2,"0")}h`}sWordToHex(t){return t>32767?`- ${(65536-t).toString(16).toUpperCase().padStart(4,"0")}h`:`+ ${t.toString(16).toUpperCase().padStart(4,"0")}h`}sDwordToHex(t){return(t|=0)<0?`- ${(-t).toString(16).toUpperCase().padStart(8,"0")}h`:`+ ${t.toString(16).toUpperCase().padStart(8,"0")}h`}getNextByte(){const t=this.memory.peek(this.localAddress++);return this.hexValues.push(t),255&t}getNextSByteStr(){return this.sByteToHex(this.getNextByte())}getNextByteStr(){return this.byteToHex(this.getNextByte())}getNextWord(){const t=this.memory.peek(this.localAddress++);this.hexValues.push(t);const e=this.memory.peek(this.localAddress++);return this.hexValues.push(e),t+(e<<8)&65535}getNextSWordStr(){return this.sWordToHex(this.getNextWord())}getNextWordStr(){return this.wordToHex(this.getNextWord())}getNextDword(){return this.getNextWord()+(this.getNextWord()<<16)&4294967295}getNextSDwordStr(){return this.sDwordToHex(this.getNextDword())}getNextDwordStr(){return this.dwordToHex(this.getNextDword())}prefixOp32(){return this.op32Bit?"E":""}}},688:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.Flags16=e.FlagValue=void 0,function(t){t[t.Carry=1]="Carry",t[t.Parity=4]="Parity",t[t.Adjust=16]="Adjust",t[t.Zero=64]="Zero",t[t.Sign=128]="Sign",t[t.Trap=256]="Trap",t[t.IntEnable=512]="IntEnable",t[t.Direction=1024]="Direction",t[t.Overflow=2048]="Overflow",t[t.IoPrivilegeLevel0=4096]="IoPrivilegeLevel0",t[t.IoPrivilegeLevel1=8192]="IoPrivilegeLevel1",t[t.NestedTask=16384]="NestedTask",t[t.Resume=65536]="Resume",t[t.Virtual8086Mode=131072]="Virtual8086Mode"}(s=e.FlagValue||(e.FlagValue={})),e.Flags16=class{constructor(){this.internalValue=0,this.internalValue=61440}setFlag(t){this.internalValue|=t}resetFlag(t){this.internalValue&=65535&~t}getFlag(t){return(this.internalValue&t)>0}get CF(){return this.getFlag(s.Carry)}set CF(t){t?this.setFlag(s.Carry):this.resetFlag(s.Carry)}get PF(){return this.getFlag(s.Parity)}set PF(t){t?this.setFlag(s.Parity):this.resetFlag(s.Parity)}get AF(){return this.getFlag(s.Adjust)}set AF(t){t?this.setFlag(s.Adjust):this.resetFlag(s.Adjust)}get ZF(){return this.getFlag(s.Zero)}set ZF(t){t?this.setFlag(s.Zero):this.resetFlag(s.Zero)}get SF(){return this.getFlag(s.Sign)}set SF(t){t?this.setFlag(s.Sign):this.resetFlag(s.Sign)}get TF(){return this.getFlag(s.Trap)}set TF(t){t?this.setFlag(s.Trap):this.resetFlag(s.Trap)}get IF(){return this.getFlag(s.IntEnable)}set IF(t){t?this.setFlag(s.IntEnable):this.resetFlag(s.IntEnable)}get DF(){return this.getFlag(s.Direction)}set DF(t){t?this.setFlag(s.Direction):this.resetFlag(s.Direction)}get OF(){return this.getFlag(s.Overflow)}set OF(t){t?this.setFlag(s.Overflow):this.resetFlag(s.Overflow)}get value(){return this.internalValue}set value(t){this.internalValue=61440|t}}},523:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ATColorGraphicsCard=void 0;const i=s(868),r=s(740);var a;!function(t){t[t.Unmodified=0]="Unmodified",t[t.And=1]="And",t[t.Or=2]="Or",t[t.Xor=3]="Xor"}(a||(a={}));class h extends i.ColorGraphicsCard{constructor(){super(),this.planeCount=4,this.planes=new Array(this.planeCount),this.latches=new Array(this.planeCount),this.mapMask=new Array(this.planeCount),this.enableSetReset=new Array(this.planeCount),this.setReset=new Array(this.planeCount),this.modeControlRegister=0,this.colorSelectRegister=0,this.miscOutputRegister=0,this.sequencerIndex=0,this.sequencerRegisters=new Array(5),this.gdcIndex=0,this.gdcRegisters=new Array(9),this.attributeFlipFlop=!1,this.attributeIndex=0,this.attributeRegisters=new Array(21),this.graphicsMode=!1,this.colorPlaneEnabled=new Array(4),this.readMapSelect=0,this.rotateCount=0,this.bitMask=0,this.oddEven=!1,this.colorDontCare=new Array(4),this.mapMaskRegister=0,this.colorCompareRegister=0,this.featureControlRegister=0,this.gdcGraphicsMode=!1,this.monochrome=!1,this.memoryModeRegister=0,this.characterMapSelectRegister=0,this.characterMapA=0,this.characterMapB=0,this.clockMode=0,this.writeMode=0,this.readMode=0,this.chain4=!1,this.egaPalette=new Array(16),this.cgaPalette=new Array(16),this.memStart=0,this.memSize=0,this.crtBasePort=0,this.charBoxWidth=0,this.startAddr=655360,this.setRamSize(262144),this.memStart=720896,this.memSize=65536,this.crtBasePort=976,this.miscOutputRegister=3,this.bitMask=255;for(let t=0;t<16;t++)this.egaPalette[t]=this.cgaColors[t],this.cgaPalette[t]=this.cgaColors[t];for(let t=0;t<this.planeCount;t++)this.planes[t]=new Uint8Array(65536),this.mapMask[t]=!0}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB}getCrtStartAddr(){return(this.crtRegisters[12]<<8)+this.crtRegisters[13]}getUnderlineLocation(){return 31&this.crtRegisters[20]}getMaximumCharScanLine(){return 31&this.crtRegisters[9]}getCrtOffset(){return this.crtRegisters[19]}getPresetRowScan(){return this.crtRegisters[8]}getHorizontalPixelPanning(){return 15&this.attributeRegisters[19]}getEnableLineGraphicsCharacterCode(){return(4&this.attributeRegisters[16])>0}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("planes")}getMemoryData(){const t=new Array(this.planeCount);for(let e=0;e<this.planeCount;e++)t[e]=this.planes[e].buffer;return t}updateMemory(t){for(let e=0;e<this.planeCount;e++)this.planes[e]=new Uint8Array(t[e])}in(t){if(t==this.crtBasePort+5)return this.getDataRegister();switch(t){case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister}return 65535}out(t,e,s){if(t==this.crtBasePort+4)return this.setIndexRegister(255&e),void(s&&this.out(981,e>>8,!1));if(t!=this.crtBasePort+5)if(t!=this.crtBasePort+10)switch(t){case 962:this.miscOutputRegister=255&e,this.crtBasePort=0==(1&e)?944:976;break;case 964:this.sequencerIndex=7&e,s&&this.out(965,e>>8&255,!1);break;case 974:this.gdcIndex=15&e,s&&this.out(975,e>>8,!1);break;case 975:switch(this.gdcIndex){case 0:this.setReset[0]=(1&e)>0,this.setReset[1]=(2&e)>0,this.setReset[2]=(4&e)>0,this.setReset[3]=(8&e)>0;break;case 1:this.enableSetReset[0]=(1&e)>0,this.enableSetReset[1]=(2&e)>0,this.enableSetReset[2]=(4&e)>0,this.enableSetReset[3]=(8&e)>0;break;case 2:this.colorCompareRegister=255&e;break;case 3:switch(this.rotateCount=7&e,e>>3&3){case 0:this.currentDataFunction=a.Unmodified;break;case 1:this.currentDataFunction=a.And;break;case 2:this.currentDataFunction=a.Or;break;case 3:this.currentDataFunction=a.Xor}break;case 4:this.readMapSelect=3&e;break;case 5:this.writeMode=3&e,this.readMode=e>>3&1;break;case 6:switch(this.gdcGraphicsMode=(1&e)>0,e>>2&3){case 0:this.memStart=655360,this.memSize=131072;break;case 1:this.memStart=655360,this.memSize=65536;break;case 2:this.memStart=720896,this.memSize=32768;break;case 3:this.memStart=753664,this.memSize=32768}break;case 7:for(let t=0;t<this.planeCount;t++)this.colorDontCare[t]=(e&1<<t)>0;break;case 8:this.bitMask=e}this.gdcIndex<this.gdcRegisters.length&&(this.gdcRegisters[this.gdcIndex]=255&e);break;case 984:this.modeControlRegister=255&e;break;case 985:this.colorSelectRegister=255&e}else this.featureControlRegister=255&e;else this.setDataRegister(255&e)}peek(t){if(t<this.memStart||t>=this.memStart+this.memSize)return 0;let e=t-this.memStart;if(this.chain4)return this.planes[3&e][e>>2];const s=0==(1&e);this.oddEven&&(e>>=1);for(let t=0;t<this.planeCount;t++)this.latches[t]=this.planes[t][e];if(0==this.readMode)return this.oddEven?s?this.planes[0][e]:this.planes[1][e]:this.planes[this.readMapSelect][e];{const t=15&this.colorCompareRegister;let s=255;for(let i=0;i<this.planeCount;i++){if(!this.colorDontCare[i])continue;const r=this.planes[i][e],a=(t&1<<i)>0;let h=1;for(let t=0;t<8;t++)(r&h)>0!=a&&(s&=~h),h<<=1}return 255&s}}poke(t,e){if(t<this.memStart||t>=this.memStart+this.memSize)return;let s=t-this.memStart;if(this.chain4)return void(this.planes[3&s][s>>2]=e);const i=0==(1&s);this.oddEven&&(s>>=1),this.internalPoke(e,i,s)}internalPoke(t,e,s){if(0==this.writeMode){let i=t;this.rotateCount>0&&(i=255&(i>>this.rotateCount|i<<8-this.rotateCount));for(let t=0;t<this.planeCount;t++){if(!this.mapMask[t])continue;if(this.oddEven&&(e&&0!=t&&2!=t||!e&&1!=t&&3!=t))continue;const r=this.latches[t];let h=this.enableSetReset[t]?this.setReset[t]?255:0:i;switch(this.currentDataFunction){case a.And:h&=r;break;case a.Or:h|=r;break;case a.Xor:h^=r}this.planes[t][s]=255&(h&this.bitMask|r&~this.bitMask)}}else if(1==this.writeMode)for(let t=0;t<this.planeCount;t++)this.planes[t][s]=this.latches[t];else if(2==this.writeMode)for(let i=0;i<this.planeCount;i++){if(!this.mapMask[i])continue;if(this.oddEven&&(e&&0!=i&&2!=i||!e&&1!=i&&3!=i))continue;const r=this.latches[i];let h=(t&1<<i)>0?255:0;switch(this.currentDataFunction){case a.And:h&=r;break;case a.Or:h|=r;break;case a.Xor:h^=r}this.planes[i][s]=255&(h&this.bitMask|r&~this.bitMask)}}waitForScreenDraw(){if(0==this.screenUpdateClocks)return;const t=this.horAreaEndClocks-this.horAreaStartClocks;this.eventTimer.clockCount%this.screenUpdateClocks>=this.horAreaStartClocks&&Math.trunc(this.horAreaStartClocks+t/2)}calcRetraceEnable(){if(0==this.screenUpdateClocks)return{vertRetrace:!1,enable:!1};const t=this.eventTimer.clockCount%this.screenUpdateClocks,e=t<this.vertRetraceClocks;let s=!1;return t>=this.horAreaStartClocks&&t<this.horAreaEndClocks&&(s=(t-this.horAreaStartClocks)%this.lineClocks<this.horRetraceClocks),{vertRetrace:e,enable:s||e&&t>this.horRetraceClocks}}genColor(t){const e=((4&t)>0?170:0)+((32&t)>0?85:0),s=((2&t)>0?170:0)+((16&t)>0?85:0),i=((1&t)>0?170:0)+((8&t)>0?85:0);return r.Col.fromRgb(e,s,i)}genCgaColor(t){return this.cgaColors[(7&t)+((16&t)>0?8:0)]}updateTextScreen(t,e,s){this.charHeight=this.getMaximumCharScanLine()+1;const i=Math.trunc(this.colCount/this.charBoxWidth),a=Math.trunc(this.lineCount/this.charHeight),h=new Array(a*i);this.internalUpdateTextScreen(h,0,a,i,s);let o=0;for(let s=0;s<a;s++)for(let a=0;a<i;a++){const i=h[o],n=new r.IntRect(a*this.charBoxWidth,s*this.charHeight,this.charBoxWidth,this.charHeight);this.writePixels(t,e,i,n),o++}}internalUpdateTextScreen(t,e,s,i,r){let a=this.getCrtStartAddr()+e*i,h=e*i;const o=this.getAllowSwitchCharSets(),n=this.charBoxWidth>this.charWidth,c=8192*this.characterMapA,d=8192*this.characterMapB;let l=0;for(let m=e;m<e+s;m++)for(let e=0;e<i;e++){const e=this.planes[1][a];let s;o?(l=(8&e)>0?c:d,s=r[7&e]):s=r[15&e];const i=this.blink&&(128&e)>0,m=this.blink?r[e>>4&7]:r[e>>4];i&&!this.cursorOn&&(s=m),t[h]=this.drawEgaVgaChar(this.planes[0][a],s,m,l,!1,a==this.getCursorPos()&&this.cursorOn,n),a++,h++}}drawEgaVgaChar(t,e,s,i,a,h,o){const n=new Uint32Array(this.charBoxWidth*this.charHeight);let c=0,d=!1;const l=this.planes[2],m=i+(t<<5),u=t>=192&&t<=223&&this.getEnableLineGraphicsCharacterCode();let g=r.Col.fromRgb(0,0,0);for(let t=0;t<this.charHeight;t++){const i=l[m+t];let r=128;const p=this.getCursorStart(),C=this.getCursorEnd();if(h&&p<this.charHeight&&C<this.charHeight){const e=0==C?this.charHeight-1:C;d=t>=p&&t<=e}const k=a&&t==this.getUnderlineLocation()||d;for(let t=0;t<this.charWidth;t++)g=k||(i&r)>0?e:s,r>>=1,n[c++]=g.value;o&&(n[c++]=u?g.value:s.value)}return n}updateScreenCgaLo(t){const e=this.getCgaGraphicsColors(this.colorSelectRegister),s=new Uint32Array(t.buffer);let i=0,r=0,a=8192;for(let t=0;t<200;t++){let h=0==(1&t)?r:a;for(let t=0;t<320;t+=4){const t=0==(1&h)?this.planes[0][h>>1]:this.planes[1][h>>1];let r;r=e[t>>6],s[i++]=r.value,r=e[t>>4&3],s[i++]=r.value,r=e[t>>2&3],s[i++]=r.value,r=e[3&t],s[i++]=r.value,h++}t%2==0?r=h:a=h}}updateScreenCgaMono(t,e,s){const i=r.Col.fromRgb(255,255,255),a=this.overscanColor,h=new Uint32Array(t.buffer);let o=0,n=0,c=8192;for(let t=0;t<s;t++){let s=0==(1&t)?n:c;for(let t=0;t<e;t+=8){let t=this.planes[0][s];for(let e=0;e<8;e++)h[o++]=(128&t)>0?i.value:a.value,t<<=1;s++}t%2==0?n=s:c=s}}updateScreen16Col(t,e,s,i){const r=new Uint32Array(t.buffer),a=0==this.getCrtOffset()?e/8:this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),o=0;const n=this.getHorizontalPixelPanning(),c=0==n?e:e+8;for(let t=0;t<s;t++){let t=h;for(let e=0;e<c;e+=8,t++){const s=65535&t;let a=this.planes[0][s],h=this.planes[1][s],d=this.planes[2][s],l=this.planes[3][s];for(let t=0;t<8;t++){const s=i[((128&a)>>7)+((128&h)>>6)+((128&d)>>5)+((128&l)>>4)];(0==n||e+t>=n&&e+t<c-8+n)&&(r[o++]=s.value),a<<=1,h<<=1,d<<=1,l<<=1}}h+=a}}}e.ATColorGraphicsCard=h},763:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseComponent=void 0,e.BaseComponent=class{reset(){}}},441:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CgaGraphics=void 0;const i=s(868),r=s(740);var a;!function(t){t[t.None=0]="None",t[t.Text40x25=1]="Text40x25",t[t.Text80x25=2]="Text80x25",t[t.GraphicsLo=3]="GraphicsLo",t[t.GraphicsHi=4]="GraphicsHi"}(a||(a={}));class h extends i.ColorGraphicsCard{constructor(){super(),this.charsetFile1="Fonts/cga1.dat",this.charsetFile2="Fonts/cga2.dat",this.charsetWidth=32,this.charsetHeight=8,this.horRetrace=0,this.colorSelectRegister=0,this.modeControlRegister=0,this.charset1=new Array(256),this.charset2=new Array(256),this.activeCharsetNo=0,this.startAddr=753664,this.setRamSize(16384),this.charWidth=8,this.charHeight=8,this.activeCharsetNo=1,this.lineCount=200}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile1"),this.ignoredFields.add("charsetFile2"),this.ignoredFieldsUpdate.add("charset1"),this.ignoredFieldsUpdate.add("charset2")}modeChanged(){super.modeChanged(),this.calcRetraceValues(),this.charCache.clear()}getCharset(){return 0==this.activeCharsetNo?this.charset1:this.charset2}updateScreenGraphicsLo(t){const e=this.getCgaGraphicsColors(this.colorSelectRegister),s=new Uint32Array(t.buffer);let i=0,r=0,a=8192;for(let t=0;t<200;t++){let h=0==(1&t)?r:a;for(let t=0;t<320;t+=4){const t=this.ram[h];let r;r=e[t>>6],s[i++]=r.value,r=e[t>>4&3],s[i++]=r.value,r=e[t>>2&3],s[i++]=r.value,r=e[3&t],s[i++]=r.value,h++}t%2==0?r=h:a=h}}updateScreenGraphicsHi(t){const e=this.cgaColors[15&this.colorSelectRegister],s=new Uint32Array(t.buffer);let i=0,r=0,a=8192;for(let t=0;t<200;t++){let h=0==(1&t)?r:a;for(let t=0;t<640;t+=8){let t=this.ram[h];for(let r=0;r<8;r++)(128&t)>0&&(s[i]=e.value),i++,t<<=1;h++}t%2==0?r=h:a=h}}updateTextScreen(t,e,s,i,a,h){const o=new r.IntRect(0,0,this.charWidth,this.charHeight),n=2*this.getCursorPos();let c=0;for(let r=0;r<a;r++,o.y+=this.charHeight){o.x=0;for(let r=0;r<i;r++,o.x+=this.charWidth){const i=this.ram[c+1],r=this.blink&&(128&i)>0,a=this.blink?h[i>>4&7]:h[i>>4];let d=h[15&i];r&&!this.cursorOn&&(d=a);const l=this.ram[c],m=s[l],u=this.drawChar(l,m,d,a,!1,c==n&&this.cursorOn);this.writePixels(t,e,u,o),c+=2}}}async loadCharSet(){await this.loadCharSetInternal(this.charset1,this.charsetFile1,this.charsetWidth,this.charsetHeight),await this.loadCharSetInternal(this.charset2,this.charsetFile2,this.charsetWidth,this.charsetHeight)}updateScreen(t,e){switch(super.updateScreen(t,e),this.mode){case a.Text40x25:this.updateTextScreen(t,e,this.getCharset(),40,25,this.cgaColors);break;case a.Text80x25:this.updateTextScreen(t,e,this.getCharset(),80,25,this.cgaColors);break;case a.GraphicsLo:this.updateScreenGraphicsLo(t);break;case a.GraphicsHi:this.updateScreenGraphicsHi(t)}}in(t){switch(t){case 977:case 979:case 981:case 983:return this.getDataRegister();case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister;case 986:{0==this.horRetrace&&(this.horRetrace=2),this.horRetrace--;let t=this.calcVertRetrace()?8:0;return t+=0==this.horRetrace?0:1,255&t}}return 0}out(t,e,s){switch(t){case 976:case 978:case 980:case 982:this.setIndexRegister(e);break;case 977:case 979:case 981:case 983:this.setDataRegister(e);break;case 984:{this.modeControlRegister=255&e,this.blink=(32&e)>0,this.blackWhite=(4&e)>0;const t=this.mode;switch(27&e){case 8:this.mode=a.Text40x25,this.screenWidth=320,this.screenHeight=200;break;case 9:this.mode=a.Text80x25,this.screenWidth=640,this.screenHeight=200;break;case 10:this.mode=a.GraphicsLo,this.screenWidth=320,this.screenHeight=200;break;case 26:this.mode=a.GraphicsHi,this.screenWidth=640,this.screenHeight=200}this.mode!=t&&this.modeChanged()}break;case 985:this.colorSelectRegister=255&e}}}e.CgaGraphics=h},868:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorGraphicsCard=void 0;const i=s(740),r=s(915);class a extends i.GraphicsCard{constructor(){super(),this.screenFrequency=60,this.screenUpdateClocks=0,this.lineClocks=0,this.vertRetraceClocks=0,this.vertBlankClocks=0,this.horRetraceClocks=0,this.horAreaStartClocks=0,this.horAreaEndClocks=0,this.blink=!1,this.colCount=0,this.lineCount=0,this.cgaColors=new Array(16),this.initCgaColors()}modeChanged(){}calcRetraceValues(){0!=this.lineCount&&(this.screenUpdateClocks=Math.trunc(1e3*r.Settings.cpuFrequency/this.screenFrequency),this.vertRetraceClocks=Math.trunc(this.screenUpdateClocks/50),this.vertBlankClocks=Math.trunc(this.screenUpdateClocks/100),this.lineClocks=Math.trunc((this.screenUpdateClocks-this.vertRetraceClocks-this.vertBlankClocks)/this.lineCount),this.horRetraceClocks=Math.trunc(this.lineClocks/5),this.horAreaStartClocks=this.vertRetraceClocks+Math.trunc(this.vertBlankClocks/2),this.horAreaEndClocks=this.horAreaStartClocks+this.lineClocks*this.lineCount)}calcVertRetrace(){return 0!=this.screenUpdateClocks&&this.eventTimer.clockCount%this.screenUpdateClocks<this.vertRetraceClocks}initCgaColors(){this.cgaColors[0]=i.Col.fromRgb(0,0,0),this.cgaColors[1]=i.Col.fromRgb(0,0,170),this.cgaColors[2]=i.Col.fromRgb(0,170,0),this.cgaColors[3]=i.Col.fromRgb(0,170,170),this.cgaColors[4]=i.Col.fromRgb(170,0,0),this.cgaColors[5]=i.Col.fromRgb(170,0,170),this.cgaColors[6]=i.Col.fromRgb(170,85,0),this.cgaColors[7]=i.Col.fromRgb(170,170,170),this.cgaColors[8]=i.Col.fromRgb(85,85,85),this.cgaColors[9]=i.Col.fromRgb(85,85,255),this.cgaColors[10]=i.Col.fromRgb(85,255,85),this.cgaColors[11]=i.Col.fromRgb(85,255,255),this.cgaColors[12]=i.Col.fromRgb(255,85,85),this.cgaColors[13]=i.Col.fromRgb(255,85,255),this.cgaColors[14]=i.Col.fromRgb(255,255,85),this.cgaColors[15]=i.Col.fromRgb(255,255,255)}getCgaGraphicsColors(t){const e=(16&t)>0?8:0,s=t>>5&1,i=new Array(4);return i[0]=this.cgaColors[15&t],0==s?(i[1]=this.cgaColors[2+e],i[2]=this.cgaColors[4+e],i[3]=this.cgaColors[6+e]):(i[1]=this.cgaColors[3+e],i[2]=this.cgaColors[5+e],i[3]=this.cgaColors[7+e]),i}}e.ColorGraphicsCard=a,a.dataBuffer=new Array},144:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DmaController=void 0;const i=s(763);var r,a,h;!function(t){t[t.Demand=0]="Demand",t[t.Single=1]="Single",t[t.Block=2]="Block",t[t.Cascade=3]="Cascade"}(r||(r={})),function(t){t[t.Inc=0]="Inc",t[t.Dec=1]="Dec"}(a||(a={})),function(t){t[t.Verify=0]="Verify",t[t.WriteMem=1]="WriteMem",t[t.ReadMem=2]="ReadMem",t[t.Undefined=3]="Undefined"}(h||(h={}));class o extends i.BaseComponent{constructor(t,e){super(),this.channelCount=8,this.memRefreshChannel=0,this.blockSize=new Array(this.channelCount),this.blockSizeByteNo=new Array(this.channelCount),this.page=new Array(this.channelCount),this.offset=new Array(this.channelCount),this.offsetByteNo=new Array(this.channelCount),this.mode=new Array(this.channelCount),this.inc=new Array(this.channelCount),this.autoInit=new Array(this.channelCount),this.transferType=new Array(this.channelCount),this.channelEnabled=new Array(this.channelCount),this.terminalCount=new Array(this.channelCount),this.memoryProvider=t,this.checkMemRefreshActiveFunc=e;for(let t=0;t<this.channelCount;t++)this.channelEnabled[t]=!0}readByte(t,e,s){let i;return i=0==e[s]?255&t[s]:(65280&t[s])>>8&255,e[s]=1-e[s],i}writeByte(t,e,s,i){0==e[s]?t[s]=65535&(65280&t[s]|i):t[s]=65535&(255&t[s]|i<<8),e[s]=1-e[s]}memRefreshActive(){return this.autoInit[this.memRefreshChannel]&&this.checkMemRefreshActiveFunc()}in(t){if(t>=0&&t<=7){const e=Math.trunc(t/2);return t%2==0?(e==this.memRefreshChannel&&this.memRefreshActive()&&(this.offset[e]+=17),this.readByte(this.offset,this.offsetByteNo,e)):this.readByte(this.blockSize,this.blockSizeByteNo,e)}if(t>=192&&t<=207){const e=4+Math.trunc((t-192)/4);if(t%4==0)return this.readByte(this.offset,this.offsetByteNo,e);if(t%4==2)return this.readByte(this.blockSize,this.blockSizeByteNo,e)}return 8==t?(this.memRefreshActive()&&(this.terminalCount[this.memRefreshChannel]=!0),255&((this.terminalCount[0]?1:0)|(this.terminalCount[1]?2:0)|(this.terminalCount[2]?4:0)|(this.terminalCount[3]?8:0))):0}out(t,e,s){if(t>=0&&t<=7){const s=Math.trunc(t/2);return t%2==0?this.writeByte(this.offset,this.offsetByteNo,s,e):this.writeByte(this.blockSize,this.blockSizeByteNo,s,e),void(this.terminalCount[s]=!1)}if(t>=192&&t<=207){const s=4+Math.trunc((t-192)/4);return t%4==0?this.writeByte(this.offset,this.offsetByteNo,s,e):t%4==2&&this.writeByte(this.blockSize,this.blockSizeByteNo,s,e),void(this.terminalCount[s]=!1)}switch(t){case 135:this.page[0]=255&e;break;case 131:this.page[1]=255&e;break;case 129:this.page[2]=255&e;break;case 130:this.page[3]=255&e;break;case 143:this.page[4]=255&e;break;case 139:this.page[5]=255&e;break;case 137:this.page[6]=255&e;break;case 138:this.page[7]=255&e;break;case 8:case 9:break;case 10:{const t=3&e;this.channelEnabled[t]=0==(4&e)}break;case 11:{const t=3&e;switch(e>>2&3){case 0:this.transferType[t]=h.Verify;break;case 1:this.transferType[t]=h.WriteMem;break;case 2:this.transferType[t]=h.ReadMem;break;case 3:this.transferType[t]=h.Undefined}switch(this.autoInit[t]=(16&e)>0,this.inc[t]=(32&e)>0?a.Dec:a.Inc,e>>6&3){case 0:this.mode[t]=r.Demand;break;case 1:this.mode[t]=r.Single;break;case 2:this.mode[t]=r.Block;break;case 3:this.mode[t]=r.Cascade}this.terminalCount[t]=!1}break;case 12:for(let t=0;t<this.channelCount;t++)this.blockSizeByteNo[t]=0,this.offsetByteNo[t]=0;break;case 13:for(let t=0;t<this.channelCount;t++)this.blockSize[t]=0,this.blockSizeByteNo[t]=0,this.page[t]=0,this.offset[t]=0,this.offsetByteNo[t]=0,this.mode[t]=0,this.inc[t]=a.Inc,this.autoInit[t]=!1,this.channelEnabled[t]=!0,this.terminalCount[t]=!1}}triggerDmaDeviceToMem(t,e,s){if(this.mode[t]==r.Single||this.mode[t]==r.Block){let i=(this.page[t]<<16)+this.offset[t],r=this.blockSize[t]+1;const h=this.inc[t]==a.Inc?1:-1,o={endOfData:!1};for(;r>0&&!o.endOfData;)this.memoryProvider.poke(i,e.getNextByte(o)),i+=h,r--;this.terminalCount[t]=!0,s&&s()}}triggerDmaMemToDevice(t,e,s){if(this.mode[t]==r.Single||this.mode[t]==r.Block){let i=(this.page[t]<<16)+this.offset[t],r=this.blockSize[t]+1;const h=this.inc[t]==a.Inc?1:-1,o={endOfData:!1};for(;r>0&&!o.endOfData;)e.setNextByte(this.memoryProvider.peek(i),o),i+=h,r--;this.terminalCount[t]=!0,s&&s()}}}e.DmaController=o},6:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EgaGraphics=void 0;const i=s(523),r=s(915);var a;!function(t){t[t.None=0]="None",t[t.M00_CGA=1]="M00_CGA",t[t.M00_EGA=2]="M00_EGA",t[t.M02_CGA=3]="M02_CGA",t[t.M02_EGA=4]="M02_EGA",t[t.M04=5]="M04",t[t.M06=6]="M06",t[t.M07=7]="M07",t[t.M0D=8]="M0D",t[t.M0E=9]="M0E",t[t.M0F=10]="M0F",t[t.M10=11]="M10"}(a||(a={}));class h extends i.ATColorGraphicsCard{constructor(){super(),this.diagnosticCount=0,this.egaSwitches=[!1,!0,!0,!1],this.charWidth9Bits=!1,this.mode=a.None,this.screenWidth=640,this.screenHeight=350,this.charBoxWidth=this.charWidth=8}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("egaSwitches")}in(t){switch(t){case 962:{let t=this.calcVertRetrace()?0:128;const e=this.miscOutputRegister>>2&3;return t+=this.egaSwitches[e]?0:16,t+=0,255&t}case 968:return 0;case 986:{this.attributeFlipFlop=!1;const t=this.calcRetraceEnable();let e=(t.vertRetrace?8:0)+(t.enable?0:1);return 4==++this.diagnosticCount&&(this.diagnosticCount=0),e+=this.diagnosticCount>1?48:0,255&e}default:return super.in(t)}}out(t,e,s){switch(t){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&e,this.attributeIndex){case 16:this.graphicsMode=(1&e)>0,this.monochrome=(2&e)>0,this.charWidth9Bits=(4&e)>0,this.blink=(8&e)>0;break;case 17:this.overscanColor=this.genColor(255&e);break;case 18:for(let t=0;t<this.colorPlaneEnabled.length;t++)this.colorPlaneEnabled[t]=(e&1<<t)>0;break;default:this.attributeIndex>=0&&this.attributeIndex<=15&&(this.egaPalette[this.attributeIndex]=this.genColor(255&e),this.cgaPalette[this.attributeIndex]=this.genCgaColor(255&e))}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&e,this.attributeFlipFlop=!this.attributeFlipFlop,s&&this.out(t,e>>8,!1);break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&e;break;case 2:this.mapMaskRegister=255&e,this.mapMask[0]=(1&e)>0,this.mapMask[1]=(2&e)>0,this.mapMask[2]=(4&e)>0,this.mapMask[3]=(8&e)>0;break;case 3:this.characterMapSelectRegister=255&e,this.characterMapA=e>>2&3,this.characterMapB=3&e;break;case 4:this.memoryModeRegister=255&e,this.oddEven=0==(4&e)}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&e);break;case 970:case 972:break;default:super.out(t,e,s)}}calcMode(){const t=this.mode,e=this.sequencerRegisters[1],s=this.sequencerRegisters[2],i=this.sequencerRegisters[4];11==e&&3==i?(35==this.miscOutputRegister&&(this.mode=a.M00_CGA),167==this.miscOutputRegister&&(this.mode=a.M00_EGA)):1==e&&3==i?(35==this.miscOutputRegister&&(this.mode=a.M02_CGA),167==this.miscOutputRegister&&(this.mode=a.M02_EGA)):11==e&&2==i?this.mode=a.M04:1==e&&6==i?35==this.miscOutputRegister?1==s?this.mode=a.M06:15==s&&(this.mode=a.M0E):162==this.miscOutputRegister?this.mode=a.M0F:167==this.miscOutputRegister&&(this.mode=a.M10):0==e&&3==i?this.mode=a.M07:1==e&&6==i?this.mode=a.M04:11==e&&6==i&&(this.mode=a.M0D),this.mode!=t&&this.modeChanged()}modeChanged(){super.modeChanged(),0==(this.miscOutputRegister>>2&3)?this.lineCount=200:this.lineCount=350,(8&this.clockMode)>0?this.colCount=320:this.colCount=640,this.calcRetraceValues()}updateDimensions(){switch(this.calcMode(),this.mode){case a.M00_CGA:this.screenWidth=320,this.screenHeight=200;break;case a.M00_EGA:this.screenWidth=320,this.screenHeight=350;break;case a.M02_CGA:this.screenWidth=640,this.screenHeight=200;break;case a.M02_EGA:this.screenWidth=640,this.screenHeight=350;break;case a.M04:this.screenWidth=320,this.screenHeight=200;break;case a.M06:this.screenWidth=640,this.screenHeight=200;break;case a.M07:this.screenWidth=720,this.screenHeight=350;break;case a.M0D:this.screenWidth=320,this.screenHeight=200;break;case a.M0E:this.screenWidth=640,this.screenHeight=200;break;case a.M0F:case a.M10:this.screenWidth=640,this.screenHeight=350}}updateScreen(t,e){switch(super.updateScreen(t,e),r.Settings.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.mode){case a.M00_CGA:case a.M00_EGA:case a.M02_CGA:case a.M02_EGA:this.updateTextScreen(t,e,this.egaPalette);break;case a.M04:this.updateScreenCgaLo(t);break;case a.M06:this.updateScreenCgaMono(t,640,200);break;case a.M07:break;case a.M0D:this.updateScreen16Col(t,320,200,this.cgaPalette);break;case a.M0E:this.updateScreen16Col(t,640,200,this.cgaPalette);break;case a.M0F:break;case a.M10:this.updateScreen16Col(t,640,350,this.egaPalette)}}}e.EgaGraphics=h},808:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FloppyDisk=void 0;const i=s(591),r=s(763),a=s(81),h=s(915);var o,n;!function(t){t[t.F360=0]="F360",t[t.F720=1]="F720"}(o||(o={})),function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(n||(n={}));class c{reset(){this.seekEnd=!1,this.noData=!1,this.timeout=!1,this.endOfCylinder=!1,this.deleteAddressMark=!1}}class d{constructor(){this.head=0,this.track=0,this.sector=0,this.sectorSize=0,this.trackLength=0,this.gap3Length=0,this.dataLength=0,this.fillByte=0}}class l{constructor(t,e,s){this.heads=0,this.tracks=0,this.sectors=0,this.heads=t,this.sectors=e,this.tracks=s}get diskSize(){return this.heads*this.tracks*this.sectors*l.sectorSize}calcLba(t,e,s){return(t*this.heads+e)*this.sectors+s-1}}l.sectorSize=512;class m extends r.BaseComponent{constructor(t,e){super(),this.commandDelay=1e3,this.maxDriveCount=4,this.driveSpecsByFloppyType=new Array,this.motor=new Array(this.maxDriveCount),this.active=new Array(this.maxDriveCount),this.selectedDrive=0,this.dataRegisterReady=!0,this.dataDirection=n.Input,this.driveInfo=new Array(this.maxDriveCount),this.commandInfo=new Array(this.maxDriveCount),this.driveSpecs=new Array(this.maxDriveCount),this.interruptCode=0,this.diskImages=new Array(this.maxDriveCount),this.diskImagePath=new Array(this.maxDriveCount),this.imageChanged=new Array(this.maxDriveCount),this.outputQueue=new Array,this.currDataPosition=new Array(this.maxDriveCount),this.currDataLength=new Array(this.maxDriveCount),this.currentCommand=0,this.cmdByteNo=0,this.headLoadTime=new Array(this.maxDriveCount),this.headUnloadTime=new Array(this.maxDriveCount),this.stepRate=new Array(this.maxDriveCount),this.pic=t,this.dmaController=e;for(let t=0;t<this.maxDriveCount;t++)this.driveInfo[t]=new c,this.commandInfo[t]=new d;this.initDriveSpecs()}*getFloppyTypes(){yield o.F360,yield o.F720}initDriveSpecs(){this.driveSpecsByFloppyType=new Array(Object.keys(o).length),this.driveSpecsByFloppyType[o.F360]=new l(2,9,40),this.driveSpecsByFloppyType[o.F720]=new l(2,9,80)}internalLoadImage(t,e){for(const s of this.getFloppyTypes()){const i=this.driveSpecsByFloppyType[s];if(i&&i.diskSize==e.byteLength)return this.resetImage(t,i),this.diskImages[t]=new Uint8Array(e),!0}return!1}resetImage(t,e){this.driveInfo[t].reset(),this.active[t]=!1,this.motor[t]=!1,this.driveSpecs[t]=e,this.diskImages[t]=new Uint8Array(e.diskSize)}async loadImageFromFile(t,e){return new Promise(((s,r)=>{const a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("GET",h.Settings.baseDir+t,!0),a.onload=async()=>{if(200!=a.status)return void r();const h=a.response,o=i.ungzip(new Uint8Array(h));if(this.internalLoadImage(e,o.buffer))return this.diskImagePath[e]=t,void s(!0);this.diskImages[e]=null,s(!1)},a.onerror=()=>{this.diskImages[e]=null,r()},a.send()}))}loadImageFromBuffer(t,e){this.internalLoadImage(e,t)}async newImage(t){await this.loadImageFromFile("Floppy/empty.ima.gz",t)}getDiskImage(t){const e=this.diskImages[t];return null!=e&&e.length>0?this.diskImages[t].buffer:null}async saveImage(t){this.diskImagePath[t]&&this.imageChanged[t]&&(this.imageChanged[t]=!1)}async saveImages(){for(let t=0;t<this.maxDriveCount;t++)await this.saveImage(t)}async ejectImage(t){await this.saveImage(t),this.diskImages[t]=null}internalReset(){for(let t=0;t<this.maxDriveCount;t++)this.motor[t]=!1;this.selectedDrive=0,this.dmaIrqEnabled=!1,this.dataDirection=n.Input,this.outputQueue.length=0,this.resetCount=0,this.doInterrupt(100,3)}doInterrupt(t,e){this.busy=this.outputQueue.length>0,this.interruptCode=e,0==t?this.pic.doInterrupt(a.HardwareInterrupt.Diskette):this.eventTimer.setEvent(t,(()=>{this.pic.doInterrupt(a.HardwareInterrupt.Diskette)}))}newCommand(){this.driveInfo[this.selectedDrive].reset(),this.dataDirection=n.Input,this.outputQueue.length=0}getStatus0(){let t;return null!=this.resetCount?(t=this.resetCount,this.resetCount<3?this.resetCount++:this.resetCount=null,t|=192):(t=this.selectedDrive,t|=this.interruptCode<<6),1==this.commandInfo[this.selectedDrive].head&&(t|=4),this.driveInfo[this.selectedDrive].seekEnd&&(t|=32),t|=this.interruptCode<<6,t}getStatus1(){let t=0;return this.driveInfo[this.selectedDrive].noData&&(t|=4),this.driveInfo[this.selectedDrive].timeout&&(t|=16),this.driveInfo[this.selectedDrive].endOfCylinder&&(t|=128),t}getStatus2(){let t=0;return this.driveInfo[this.selectedDrive].deleteAddressMark&&(t|=64),t}getStatus3(){let t=this.selectedDrive;return 1==this.commandInfo[this.selectedDrive].head&&(t|=4),t|=8,0==this.commandInfo[this.selectedDrive].track&&(t|=16),t|=32,t}initOutput(){this.outputQueue.length=0,this.dataDirection=n.Output}in(t){switch(t){case 1012:{let t=0;for(let e=0;e<this.maxDriveCount;e++)this.active[e]&&(t|=1<<e&255);return this.busy&&(t|=16),this.dmaIrqEnabled||(t|=32),this.dataDirection==n.Output&&(t|=64),this.dataRegisterReady&&(t|=128),t}case 1013:if(this.dataDirection==n.Output&&this.outputQueue.length>0){const t=this.outputQueue.shift();return 0==this.outputQueue.length&&(this.dataDirection=n.Input,this.busy=!1),t}}return 255}out(t,e,s){this.busy&&(this.busy=!1,this.outputQueue.length=0);const i=255&e;switch(t){case 1010:if(0==(4&i))return void this.internalReset();this.selectedDrive=3&i,this.dmaIrqEnabled=(8&i)>0;for(let t=0;t<this.maxDriveCount;t++)this.motor[t]=(i&16<<t)>0;break;case 1013:switch(0==this.cmdByteNo&&(this.currentCommand=31&i,this.commandInfo[this.selectedDrive].multiTrack=(128&i)>0,this.newCommand()),this.currentCommand){case 2:this.cmdReadTrack(i);break;case 5:this.cmdWriteSector(i);break;case 6:this.cmdReadSector(i);break;case 9:this.cmdWriteDeletedSector(i);break;case 12:this.cmdReadDeletedSector(i);break;case 13:this.cmdFormatTrack(i);break;case 3:this.cmdFixDriveData(i);break;case 4:this.cmdCheckDriveStatus();break;case 7:this.cmdCalibrateDrive();break;case 8:this.cmdCheckInterruptStatus();break;case 10:this.cmdReadSectorId(i);break;case 15:this.cmdSeekParkHead(i);break;default:this.cmdInvalid()}}}cmdReadTrack(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdWriteSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)if(this.cmdByteNo=0,this.busy=!0,null==this.diskImages[this.selectedDrive])this.doInterrupt(10,1);else{const t=this.commandInfo[this.selectedDrive],e=this.driveSpecs[this.selectedDrive].calcLba(t.track,t.head,t.sector)*l.sectorSize;let s=t.trackLength*l.sectorSize;s<0&&(s=l.sectorSize),this.currDataPosition[this.selectedDrive]=e,this.currDataLength[this.selectedDrive]=s;const i=()=>{this.driveInfo[this.selectedDrive].seekEnd=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.getStatus1()),this.outputQueue.push(this.getStatus2()),this.outputQueue.push(t.track),this.outputQueue.push(t.head),this.outputQueue.push(t.sector),this.outputQueue.push(t.sectorSize),this.doInterrupt(10,0)};this.eventTimer.setEvent(this.commandDelay,(()=>{this.dmaController.triggerDmaMemToDevice(2,this,i),this.imageChanged[this.selectedDrive]=!0}))}else this.cmdByteNo++}cmdReadSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)if(this.cmdByteNo=0,this.busy=!0,null==this.diskImages[this.selectedDrive])this.doInterrupt(10,1);else{const t=this.commandInfo[this.selectedDrive],e=this.driveSpecs[this.selectedDrive];this.currDataPosition[this.selectedDrive]=0;const s=e.calcLba(t.track,t.head,t.sector)*l.sectorSize;let i=t.trackLength*l.sectorSize;i<0&&(i=l.sectorSize),this.currDataPosition[this.selectedDrive]=s,this.currDataLength[this.selectedDrive]=i;const r=()=>{this.driveInfo[this.selectedDrive].seekEnd=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.getStatus1()),this.outputQueue.push(this.getStatus2()),this.outputQueue.push(t.track),this.outputQueue.push(t.head),this.outputQueue.push(t.sector),this.outputQueue.push(t.sectorSize),this.doInterrupt(10,0)};this.eventTimer.setEvent(this.commandDelay,(()=>this.dmaController.triggerDmaDeviceToMem(2,this,(()=>r()))))}else this.cmdByteNo++}cmdWriteDeletedSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdReadDeletedSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdFormatTrack(t){switch(this.resetCount=null,this.cmdByteNo){case 1:this.commandInfo[this.selectedDrive].head=t>>2&1;break;case 2:this.commandInfo[this.selectedDrive].sectorSize=t;break;case 3:this.commandInfo[this.selectedDrive].trackLength=t;break;case 4:this.commandInfo[this.selectedDrive].gap3Length=t;break;case 5:this.commandInfo[this.selectedDrive].fillByte=t}5==this.cmdByteNo?(this.cmdByteNo=0,this.busy=!0,this.eventTimer.setEvent(1e3,(()=>this.doInterrupt(10,0)))):this.cmdByteNo++}cmdFixDriveData(t){switch(this.resetCount=null,this.cmdByteNo){case 1:this.headUnloadTime[this.selectedDrive]=3&t,this.stepRate[this.selectedDrive]=t>>4&3;break;case 2:this.dmaIrqEnabled=(1&t)>0,this.headLoadTime[this.selectedDrive]=t>>1&127}2==this.cmdByteNo?this.cmdByteNo=0:this.cmdByteNo++}cmdCheckDriveStatus(){this.resetCount=null,1==this.cmdByteNo?(this.cmdByteNo=0,this.busy=!0,this.initOutput(),this.outputQueue.push(this.getStatus3())):this.cmdByteNo++}cmdCalibrateDrive(){this.resetCount=null,1==this.cmdByteNo?(this.cmdByteNo=0,this.active[this.selectedDrive]=!0,this.eventTimer.setEvent(1e4,(()=>{this.commandInfo[this.selectedDrive].track=0,this.driveInfo[this.selectedDrive].seekEnd=!0,this.active[this.selectedDrive]=!1,this.doInterrupt(0,0)}))):this.cmdByteNo++}cmdCheckInterruptStatus(){this.busy=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.commandInfo[this.selectedDrive].track)}cmdReadSectorId(t){if(this.resetCount=null,1==this.cmdByteNo)throw this.cmdByteNo=0,this.commandInfo[this.selectedDrive].head=t>>2&1,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdSeekParkHead(t){this.resetCount=null,2==this.cmdByteNo?(this.cmdByteNo=0,this.active[this.selectedDrive]=!0,this.eventTimer.setEvent(1e4,(()=>{this.commandInfo[this.selectedDrive].track=t,this.driveInfo[this.selectedDrive].seekEnd=!0,this.active[this.selectedDrive]=!1,this.doInterrupt(0,0)}))):this.cmdByteNo++}cmdInvalid(){this.resetCount=null,this.busy=!0,this.interruptCode=2,this.initOutput(),this.outputQueue.push(this.getStatus0())}setAccessValues(t){switch(this.cmdByteNo){case 1:break;case 2:this.commandInfo[this.selectedDrive].track=t;break;case 3:this.commandInfo[this.selectedDrive].head=t;break;case 4:this.commandInfo[this.selectedDrive].sector=t;break;case 5:this.commandInfo[this.selectedDrive].sectorSize=t;break;case 6:this.commandInfo[this.selectedDrive].trackLength=t;break;case 7:this.commandInfo[this.selectedDrive].gap3Length=t;break;case 8:this.commandInfo[this.selectedDrive].dataLength=t}}getNextByte(t){return this.currDataLength[this.selectedDrive]>0?(t.endOfData=!1,this.currDataLength[this.selectedDrive]--,this.diskImages[this.selectedDrive][this.currDataPosition[this.selectedDrive]++]):(t.endOfData=!0,0)}setNextByte(t,e){this.currDataLength[this.selectedDrive]>0?(e.endOfData=!1,this.currDataLength[this.selectedDrive]--,this.diskImages[this.selectedDrive][this.currDataPosition[this.selectedDrive]++]=t):e.endOfData=!0}}e.FloppyDisk=m},740:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GraphicsCard=e.IntRect=e.Col=void 0;const i=s(763),r=s(915);class a{constructor(){this.r=0,this.g=0,this.b=0,this.value=0}static fromRgb(t,e,s){const i=new a;return i.r=255&t,i.g=255&e,i.b=255&s,i.value=i.r+(i.g<<8)+(i.b<<16)+4278190080&4294967295,i}}e.Col=a,e.IntRect=class{constructor(t,e,s,i){this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=s,this.height=i}};class h extends i.BaseComponent{constructor(){super(),this.cursorBlinkDelay=250,this.ignoredFields=new Set,this.ignoredFieldsUpdate=new Set,this.cursorSwitchCountdown=0,this.cursorSwitchStartValue=0,this.charCache=new Map,this.crtIndexReg=0,this.crtRegisters=new Uint8Array(25),this.startAddr=0,this.ramSize=0,this.screenWidth=0,this.screenHeight=0,this.charWidth=0,this.charHeight=0,this.supportWrite=!0,this.supportRead=!0,this.cursorOn=!0,this.fillIgnoredFields(),this.ignoredFields.forEach((t=>this.ignoredFieldsUpdate.add(t)))}fillIgnoredFields(){this.ignoredFields.add("ignoredFields"),this.ignoredFields.add("ignoredFieldsUpdate"),this.ignoredFields.add("ram"),this.ignoredFields.add("charCache"),this.ignoredFieldsUpdate.add("cursorOn"),this.ignoredFieldsUpdate.add("cursorSwitchStartValue"),this.ignoredFieldsUpdate.add("cursorSwitchCountdown")}setRamSize(t){this.ramSize=t,this.ram=new Uint8Array(this.ramSize)}getCursorStart(){return this.crtRegisters[10]}getCursorEnd(){return this.crtRegisters[11]}getCursorPos(){return(this.crtRegisters[14]<<8)+this.crtRegisters[15]}setScreenUpdateRate(t){this.cursorSwitchStartValue=Math.trunc(this.cursorBlinkDelay*t/1e3)}loadCharSet(){}peek(t){return t>=this.startAddr&&t<this.startAddr+this.ramSize?this.ram[t-this.startAddr]:0}poke(t,e){t>=this.startAddr&&t<this.startAddr+this.ramSize&&(this.ram[t-this.startAddr]=e)}loadCharSetInternal(t,e,s,i){return new Promise(((s,i)=>{const a=new XMLHttpRequest;a.responseType="text",a.open("GET",r.Settings.baseDir+e,!0),a.onload=()=>{if(200!=a.status)return void i();const e=a.response.split(/\r?\n/);if(e.length>=256)for(let s=0;s<256;s++){const i=e[s].split(","),r=new Array(i.length);for(let t=0;t<i.length;t++)r[t]="1"==i[t];t[s]=r}s()},a.onerror=()=>{i()},a.send()}))}drawChar(t,e,s,i,r=!1,a=!1){const h=this.calcTextCharHash(s,i,t);if(!r&&!a){const t=this.charCache.get(h);if(t)return t}const o=new Uint32Array(this.charWidth*this.charHeight);let n=0,c=0,d=!1;const l=this.getCursorStart(),m=this.getCursorEnd();for(let t=0;t<this.charHeight;t++){a&&l<this.charHeight&&m<this.charHeight&&(d=l<=m?t>=l&&t<=m:t<=m||t>=l);const h=r&&t==this.charHeight-1||d;for(let t=0;t<this.charWidth;t++){const t=h||e[n]?s:i;n++,o[c++]=t.value}}return r||a||this.charCache.set(h,o),o}writePixels(t,e,s,i){const r=new Uint8Array(s.buffer);let a=4*(i.x+i.y*e),h=0;for(let s=0;s<i.height;s++)t.set(r.subarray(h,h+4*i.width),a),h+=4*i.width,a+=4*e}setIndexRegister(t){this.crtIndexReg=31&t}setDataRegister(t){this.crtIndexReg<this.crtRegisters.length&&(this.crtRegisters[this.crtIndexReg]=t)}getDataRegister(){return this.crtIndexReg>=12&&this.crtIndexReg<=15?this.crtRegisters[this.crtIndexReg]:0}updateDimensions(){}getJsonInitial(){return JSON.stringify(this,((t,e)=>{if(!this.ignoredFields.has(t))return"eventTimer"==t?{clockCount:this.eventTimer.clockCount}:e}))}getJsonUpdate(){return JSON.stringify(this,((t,e)=>{if(!this.ignoredFieldsUpdate.has(t))return"eventTimer"==t?{clockCount:this.eventTimer.clockCount}:e}))}applyJson(t){const e=JSON.parse(t);Object.assign(this,e)}getMemoryData(){return[this.ram.buffer]}updateMemory(t){this.ram=new Uint8Array(t[0])}updateScreen(t,e){this.cursorSwitchStartValue>0&&(0==this.cursorSwitchCountdown&&(this.cursorOn=!this.cursorOn,this.cursorSwitchCountdown=this.cursorSwitchStartValue),this.cursorSwitchCountdown--)}calcTextCharHash(t,e,s){return t.r+256*t.g+65536*t.b+e.r*2**24+e.g*2**32+e.b*2**40+s*2**48}}e.GraphicsCard=h},833:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.HardDisk=void 0;const i=s(763),r=s(81),a=s(915),h=s(591),o=s(475);class n{constructor(t,e,s,i,r){this.biosType=0,this.cylinders=0,this.heads=0,this.sectors=0,this.switchCode=0,this.biosType=t,this.cylinders=e,this.heads=s,this.sectors=i,this.switchCode=r}get diskSize(){return this.heads*this.cylinders*this.sectors*n.sectorSize}calcLba(t,e,s){return t<this.cylinders||e<this.heads||s<this.sectors?(t*this.heads+e)*this.sectors+s:null}}var c;n.sectorSize=512,function(t){t[t.None=0]="None",t[t.NoIndexSignal=1]="NoIndexSignal",t[t.NoSeekCompleteSignal=2]="NoSeekCompleteSignal",t[t.WriteFault=3]="WriteFault",t[t.NoReadyAfterDriveSelect=4]="NoReadyAfterDriveSelect",t[t.NoTrack00Signal=6]="NoTrack00Signal",t[t.SeekNotComplete=8]="SeekNotComplete",t[t.IdReadError=16]="IdReadError",t[t.DataError=17]="DataError",t[t.NoAddressMark=18]="NoAddressMark",t[t.SectorNotFound=20]="SectorNotFound",t[t.SeekError=21]="SeekError",t[t.CorrectableDataError=24]="CorrectableDataError",t[t.BadTrack=25]="BadTrack",t[t.InvalidCommand=32]="InvalidCommand",t[t.IllegalDiskAddress=33]="IllegalDiskAddress",t[t.RamError=48]="RamError",t[t.ProgramChecksumError=49]="ProgramChecksumError",t[t.EccError=50]="EccError"}(c||(c={}));class d extends i.BaseComponent{constructor(t,e){super(),this.driveCount=2,this.commandDelay=500,this.readWriteDelay=100,this.allDriveSpecs=new Array,this.driveSpecs=new Array(this.driveCount),this.diskImages=new Array(this.driveCount),this.diskImagePath=new Array(this.driveCount),this.imageChanged=new Array(this.driveCount),this.selectedDrive=0,this.head=0,this.cylinder=0,this.sector=0,this.interlBlockCount=0,this.controlField=0,this.command=0,this.dataPointer=0,this.dmaInterruptMask=0,this.driveCharacteristics=new Array(this.driveCount),this.dcbByteNo=0,this.errorBytes=new Array,this.outputBytes=new Array,this.addressValid=!0,this.pic=t,this.dmaController=e,this.initDriveSpecs(),this.setDriveType(0,2),this.setDriveType(1,2);for(let t=0;t<this.driveCount;t++)this.driveCharacteristics[t]=new Uint8Array(8),this.diskImagePath[t]=a.Settings.hdImageDir+"HD"+t+".ima.gz"}async loadImages(){for(let t=0;t<this.driveCount;t++){if(null==this.driveSpecs[t])return;await this.loadImage(t)}}async saveImages(){for(let t=0;t<this.driveCount;t++)await this.saveImage(t)}async loadImage(t){const e=a.Settings.baseDir+this.diskImagePath[t];this.storage||(this.storage=new o.DbStorage("HDD"),await this.storage.initialize());const s=await this.storage.getData(`image${t}`);if(void 0!==s){const e=new Uint8Array(s);if(e.length==this.driveSpecs[t].diskSize)return this.diskImages[t]=e,void(this.imageChanged[t]=!1)}return new Promise(((s,i)=>{const r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",e,!0),r.onload=()=>{if(200!=r.status)return void i();const e=r.response,a=h.ungzip(new Uint8Array(e));a.length==this.driveSpecs[t].diskSize&&(this.diskImages[t]=a,this.imageChanged[t]=!1),s()},r.onerror=()=>{i()},r.send()}))}async saveImage(t){this.storage&&await this.storage.setData(`image${t}`,this.diskImages[t].buffer)}generateError(t){this.errorBytes.length=0,this.errorBytes.push(255&(this.addressValid?128:0+t)),this.errorBytes.push((this.selectedDrive<<5)+this.head&255),this.errorBytes.push(((1792&this.cylinder)>>3)+this.sector&255),this.errorBytes.push(this.cylinder),this.currentCommandError=!0}in(t){var e,s,i,r;switch(t){case 800:if(null!=this.statusByte){const t=this.statusByte;return this.statusByte=null,this.requestBit=!1,this.modeBit=!1,this.commandDataBit=!1,this.busyBit=!1,t}if(this.outputBytes.length>0)return this.outputBytes.shift();break;case 801:return(this.requestBit?1:0)+(this.modeBit?2:0)+(this.commandDataBit?4:0)+(this.busyBit?8:0)+(null!=this.statusByte?32:0)&65535;case 802:return 65535&(null!==(s=(null===(e=this.driveSpecs[0])||void 0===e?void 0:e.switchCode)<<2)&&void 0!==s?s:0)+(null!==(r=null===(i=this.driveSpecs[1])||void 0===i?void 0:i.switchCode)&&void 0!==r?r:0)}return 0}out(t,e,s){switch(t){case 800:this.commandDataBit=!1,this.writeDataByte(255&e);break;case 801:(64&e)>0&&this.reset();break;case 802:this.requestBit=!0,this.commandDataBit=!0,this.busyBit=!0;break;case 803:this.interruptEnabled=(2&e)>0,this.dmaInterruptMask=e}}setDriveType(t,e){const s=this.allDriveSpecs.find((t=>t.biosType==e));if(null==s)throw new Error("Harddisk drive type "+e+" not found.");this.driveSpecs[t]=s,this.diskImages[t]=new Uint8Array(s.diskSize)}initDriveSpecs(){this.allDriveSpecs.push(new n(1,306,4,17,0)),this.allDriveSpecs.push(new n(2,615,4,17,1)),this.allDriveSpecs.push(new n(13,306,8,17,3)),this.allDriveSpecs.push(new n(16,612,4,17,2))}reset(){super.reset(),this.selectedDrive=0,this.dcbByteNo=0,this.requestBit=!1,this.commandDataBit=!1,this.busyBit=!1,this.requestBit=!1,this.errorBytes.length=0,this.currentCommandError=!1,this.outputBytes.length=0}writeDataByte(t){switch(this.dcbByteNo){case 0:this.command=t;break;case 1:this.head=31&t,this.selectedDrive=(32&t)>0?1:0;break;case 2:this.sector=63&t,this.cylinder=(192&t)<<2;break;case 3:this.cylinder=this.cylinder+t;break;case 4:this.interlBlockCount=t;break;case 5:this.controlField=t}this.dcbByteNo<5?this.dcbByteNo++:12==this.command&&this.dcbByteNo<13?(this.driveCharacteristics[this.selectedDrive][this.dcbByteNo-5]=t,this.dcbByteNo++):(this.dcbByteNo=0,this.executeCommand())}getStatusByte(){let t=0;return 1==this.selectedDrive&&(t|=32),this.currentCommandError&&(t|=2),t}commandFinished(){this.command=0,this.eventTimer.setEvent(this.commandDelay,(()=>{this.commandDataBit=!0,this.modeBit=!0,this.statusByte=this.getStatusByte(),this.currentCommandError=!1,this.isBusy=!1,this.interruptEnabled&&this.pic.doInterrupt(r.HardwareInterrupt.Harddisk)}))}executeCommand(){if(!this.isBusy){if(this.isBusy=!0,this.currentCommandError=!1,this.errorBytes.length=0,null==this.driveSpecs[this.selectedDrive]);else switch(this.command){case 0:case 1:break;case 3:for(;this.errorBytes.length>0;)this.outputBytes.push(this.errorBytes.shift());break;case 4:case 5:case 6:case 7:break;case 8:this.dataPointer=this.calcLba(this.cylinder,this.head,this.sector)*n.sectorSize,this.currentCommandError||this.eventTimer.setEvent(this.readWriteDelay,(()=>this.dmaController.triggerDmaDeviceToMem(3,this,null)));break;case 10:this.dataPointer=this.calcLba(this.cylinder,this.head,this.sector)*n.sectorSize,this.currentCommandError||this.eventTimer.setEvent(this.readWriteDelay,(()=>{this.dmaController.triggerDmaMemToDevice(3,this,null),this.imageChanged[this.selectedDrive]=!0}));break;case 11:case 12:case 13:break;case 14:throw new Error("Method not implemented.");case 15:case 224:case 227:case 228:break;case 229:case 230:throw new Error("Method not implemented.");default:this.generateError(c.InvalidCommand)}this.commandFinished()}}calcLba(t,e,s){const i=this.driveSpecs[this.selectedDrive].calcLba(t,e,s);return null==i?(this.generateError(c.IllegalDiskAddress),0):i}getNextByte(t){const e=this.diskImages[this.selectedDrive];return this.dataPointer<e.length?(t.endOfData=!1,e[this.dataPointer++]):(t.endOfData=!0,0)}setNextByte(t,e){e.endOfData=!1,this.diskImages[this.selectedDrive][this.dataPointer++]=t}}e.HardDisk=d},81:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InterruptController=e.HardwareInterrupt=void 0;const i=s(763);var r;!function(t){t[t.Timer=0]="Timer",t[t.Keyboard=1]="Keyboard",t[t.Reserved=2]="Reserved",t[t.Serial3=3]="Serial3",t[t.Serial4=4]="Serial4",t[t.Harddisk=5]="Harddisk",t[t.Diskette=6]="Diskette",t[t.Printer=7]="Printer"}(r=e.HardwareInterrupt||(e.HardwareInterrupt={}));class a extends i.BaseComponent{constructor(){super(),this.defaultOffset=8,this.pendingInterrupts=new Array,this.intMaskReg=0,this.inServiceReg=0,this.intRequestReg=0,this.initCommandWords=new Array(4),this.opControlWord2=0,this.opControlWord3=0,this.writeByteNo=0,this.reset()}reset(){super.reset(),this.currentInterrupt=null,this.pendingInterrupts.length=0,this.writeByteNo=1,this.intMaskReg=0,this.inServiceReg=0,this.intRequestReg=0,this.initCommandWords[1]=this.defaultOffset}in(t){switch(t){case 32:{const t=3&this.opControlWord3;if(2==t)return this.intRequestReg;if(3==t)return this.inServiceReg}break;case 33:if(!this.initializationMode)return this.intMaskReg}return 0}out(t,e,s){switch(t){case 32:if((16&e)>0)this.initializationMode=!0,this.initCommandWords[0]=255&e,this.reset();else{this.initializationMode=!1;const t=e>>3&3;if(0==t)switch(this.opControlWord2=255&e,this.opControlWord2>>5){case 1:case 3:this.endOfInterrupt()}else 1==t&&0==(128&e)&&(this.opControlWord3=255&e)}break;case 33:this.initializationMode?(this.initCommandWords[this.writeByteNo++]=255&e,(4==this.writeByteNo||3==this.writeByteNo&&0==(1&this.initCommandWords[0]))&&(3==this.writeByteNo&&(this.initCommandWords[3]=0),this.initializationMode=!1)):this.intMaskReg=255&e}}endOfInterrupt(){null!=this.currentInterrupt&&(this.inServiceReg&=255&~(1<<this.currentInterrupt),this.pendingInterrupts.length>0?this.internalDoInterrupt(this.pendingInterrupts.shift()):this.currentInterrupt=null)}internalDoInterrupt(t){const e=1<<t&255;0==(this.intMaskReg&e)&&(this.doCpuInterrupt(t+(248&this.initCommandWords[1])),this.inServiceReg|=e,this.currentInterrupt=t)}doInterrupt(t){const e=t;null==this.currentInterrupt?this.internalDoInterrupt(e):(t!=r.Timer||this.currentInterrupt!=e&&!this.pendingInterrupts.includes(e))&&this.pendingInterrupts.push(e)}}e.InterruptController=a},696:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MdaGraphics=void 0;const i=s(740);class r extends i.GraphicsCard{constructor(){super(),this.charsetFile="Fonts/mda.dat",this.charsetWidth=32,this.charsetHeight=8,this.charset=new Array(256),this.horRetrace=0,this.startAddr=720896,this.setRamSize(4096),this.charWidth=9,this.charHeight=14,this.screenWidth=80*this.charWidth,this.screenHeight=25*this.charHeight,this.textColor=i.Col.fromRgb(50,205,50),this.textHiColor=i.Col.fromRgb(0,255,0),this.backgroundColor=i.Col.fromRgb(0,0,0)}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile"),this.ignoredFieldsUpdate.add("charset")}async loadCharSet(){await this.loadCharSetInternal(this.charset,this.charsetFile,this.charsetWidth,this.charsetHeight)}updateScreen(t,e){super.updateScreen(t,e);const s=this.screenWidth/this.charWidth,r=this.screenHeight/this.charHeight,a=new i.IntRect(0,0,this.charWidth,this.charHeight),h=2*this.getCursorPos();let o=0;for(let i=0;i<r;i++)for(let r=0;r<s;r++){const s=this.ram[o+1],n=7&s,c=s>>4&7;let d=(8&s)>0?this.textHiColor:this.textColor,l=this.backgroundColor;if(0==n&&7==c){const t=d;d=l,l=t}const m=this.ram[o],u=this.charset[m],g=this.drawChar(m,u,d,l,1==n&&0==c,o==h&&this.cursorOn);a.x=r*this.charWidth,a.y=i*this.charHeight,this.writePixels(t,e,g,a),o+=2}}in(t){switch(t){case 954:return this.horRetrace=1-this.horRetrace,255&(this.horRetrace|this.horRetrace<<3)}return 0}out(t,e,s){switch(t){case 948:this.setIndexRegister(255&e);break;case 949:this.setDataRegister(255&e)}}}e.MdaGraphics=r},493:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mouse=void 0;const i=s(763),r=s(537);class a extends i.BaseComponent{constructor(t){super(),this.lastPosition={x:0,y:0},this.eventTimer=t}get dataTerminalReady(){return this._dataTerminalReady}set dataTerminalReady(t){this._dataTerminalReady!=t&&(this._dataTerminalReady=t,this.paramsChanged())}get requestToSend(){return this._requestToSend}set requestToSend(t){this._requestToSend!=t&&(this._requestToSend=t,this.paramsChanged())}get uartPort(){return this._uartPort}set uartPort(t){null!=this._uartPort&&(this._uartPort.onSerialParamsChanged=null),this._uartPort=t,null!=this._uartPort&&(this._uartPort.onSerialParamsChanged=this.paramsChanged)}get checkParamsOk(){return 1200==this.uartPort.baudRate&&7==this.uartPort.dataWordLen&&this.uartPort.stopBits==r.StopBits.One&&this.uartPort.parity==r.Parity.None&&this.requestToSend&&this.dataTerminalReady}get transmitBufferEmpty(){return!0}paramsChanged(){this.checkParamsOk?(null!=this.eventId&&this.eventTimer.deleteEvent(this.eventId),this.eventId=this.eventTimer.setEvent(2500,(()=>{this.uartPort.writeData(77),this.paramsOk=!0,this.eventId=null}))):this.paramsOk=!1}sendMouseData(t,e,s,i){if(this.paramsOk){let r=t;r<-128&&(r=-128),r>127&&(r=127),r<0&&(r+=256);let a=e;a<-128&&(a=-128),a>127&&(a=127),a<0&&(a+=256);const h=64+(s?32:0)+(i?16:0)+((192&a)>>4)+((192&r)>>6);this.uartPort.writeData(255&h),this.uartPort.writeData(63&r),this.uartPort.writeData(63&a)}}clearTransmitBuffer(){}mouseMoveDelta(t,e){this.sendMouseData(t,e,!1,!1)}mouseEventAbs(t,e,s){if(Math.abs(this.lastPosition.x)>.1||Math.abs(this.lastPosition.y)>.1){const i=t.x-this.lastPosition.x,r=t.y-this.lastPosition.y;this.sendMouseData(i,r,e,s)}this.lastPosition=t}mouseEventRel(t,e,s){this.sendMouseData(t.x,t.y,e,s)}resetMove(){this.lastPosition={x:0,y:0}}}e.Mouse=a},52:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Ppi=void 0;const i=s(763),r=s(81),a=s(915);class h extends i.BaseComponent{constructor(t,e){super(),this.emptyKey=0,this.keyDelay=500,this.keyQueue=new Array,this.currentKey=0,this.kbClockLowClockCount=0,this.pic=t,this.onSpeaker=e}get speakerEnabled(){return this._speakerEnabled}addScanCode(t){this.kbClockLow||(this.keyEventActive?this.keyQueue.push(t):(this.keyEventActive=!0,this.keyQueue.push(t),this.eventTimer.setEvent(this.keyDelay,(()=>this.doKeyEvent()))))}in(t){switch(t){case 96:return this.currentKey;case 97:{this.kbRefreshToggle=!this.kbRefreshToggle;let t=0;return this.kbClockLow||(t|=64),this.kbRefreshToggle&&(t|=16),this.readHighSwitches&&(t|=8),this.speakerData&&(t|=2),this.speakerGate&&(t|=1),t}case 98:return this.readHighSwitches?(a.Settings.graphicsAdapterType==a.GraphicsType.EGA||a.Settings.graphicsAdapterType==a.GraphicsType.VGA?0:a.Settings.monochromeGraphics?3:2)+(a.Settings.floppyCount-1<<2)&65535:13;case 99:return 0}return 0}out(t,e,s){switch(t){case 96:break;case 97:{(128&e)>0&&(this.currentKey=this.emptyKey);const t=0==(64&e);t!=this.kbClockLow&&(t?this.kbClockLowClockCount=this.eventTimer.clockCount:this.eventTimer.clockCount-this.kbClockLowClockCount>=12*a.Settings.cpuFrequency&&this.eventTimer.setEvent(100,(()=>{this.keyQueue.length=0,this.addScanCode(170)})),this.kbClockLow=t),this.speakerGate=(1&e)>0,this.speakerData=(2&e)>0;const s=this.speakerGate&&this.speakerData,i=this.speakerEnabled!=s;this._speakerEnabled=s,i&&this.onSpeaker(),this.readHighSwitches=(8&e)>0}}}doKeyEvent(){this.keyQueue.length>0?(this.internalAddScanCode(this.keyQueue.shift()),this.eventTimer.setEvent(this.keyDelay,(()=>this.doKeyEvent()))):this.keyEventActive=!1}internalAddScanCode(t){this.kbClockLow||(this.currentKey=t,this.pic.doInterrupt(r.HardwareInterrupt.Keyboard))}}e.Ppi=h},226:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Ram=void 0;const i=s(763);class r extends i.BaseComponent{constructor(t,e){super(),this.offset=0,this.sizeKb=0,this.supportWrite=!0,this.supportRead=!0,this.sizeKb=t,this.offset=e,this.memory=new Uint8Array(1024*t)}get addrLo(){return this.offset}get addrHi(){return this.offset+1024*this.sizeKb}peek(t){return t>=this.offset&&t<this.offset+this.memory.length?this.memory[t-this.offset]:0}poke(t,e){t>=this.offset&&t<this.offset+this.memory.length&&(this.memory[t-this.offset]=e)}}e.Ram=r},722:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RealTimeClock=void 0;const i=s(763);class r extends i.BaseComponent{constructor(t){super(),this.basePort=0,this.basePort=t}in(t){const e=new Date;switch(t-this.basePort){case 0:return this.calcBcd(e.getMilliseconds()%100);case 1:return this.calcBcd(Math.trunc(e.getMilliseconds()/10));case 2:return this.calcBcd(e.getSeconds());case 3:return this.calcBcd(e.getMinutes());case 4:return this.calcBcd(e.getHours());case 5:return this.calcBcd((e.getDay()+6)%7+1);case 6:return this.calcBcd(e.getDate());case 7:return this.calcBcd(e.getMonth());case 9:return this.calcBcd(e.getFullYear()%100);case 16:case 20:return 0}return 0}calcBcd(t){return t%10+(Math.trunc(t/10)<<4)&255}out(t,e,s){}}e.RealTimeClock=r},121:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Rom=void 0;const i=s(763),r=s(915);class a extends i.BaseComponent{constructor(t){super(),this.startAddr=0,this.size=0,this.supportWrite=!1,this.supportRead=!0,this.startAddr=t}async load(t){return new Promise(((e,s)=>{const i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",r.Settings.baseDir+t,!0),i.onload=()=>{if(200==i.status){const t=i.response;this.data=new Uint8Array(t),this.size=this.data.length,e()}else s()},i.onerror=()=>{s()},i.send()}))}getEndAddr(){return this.startAddr+this.size-1}peek(t){return this.data[t-this.startAddr]}poke(t,e){}}e.Rom=a},970:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=void 0;const i=s(763),r=s(81),a=s(915);var h,o;!function(t){t[t.LowNibble=0]="LowNibble",t[t.HighNibble=1]="HighNibble",t[t.LowAndHigh=2]="LowAndHigh"}(h||(h={})),function(t){t[t.M16Bit=0]="M16Bit",t[t.Bcd=1]="Bcd"}(o||(o={}));class n{constructor(t,e,s){this.countsPerSec=1193180,this.countsPerMs=Math.trunc(this.countsPerSec/1e3),this.byteNo=0,this.latchValue=0,this._mode=0,this.startValue=0,this.startClockCount=0,this.eventId=0,this.timer=t,this.pic=e,this.counterNo=s}get accessMode(){return this._accessMode}set accessMode(t){this._accessMode=t,this.byteNo=0}get frequency(){return Math.trunc(this.countsPerSec/this.startValue)}get mode(){return this._mode}set mode(t){switch(this._mode=t,this.eventId>0&&this.timer.eventTimer.deleteEvent(this.eventId),this.mode){case 0:break;case 1:throw new Error("Method not implemented.");case 2:case 3:break;case 4:case 5:throw new Error("Method not implemented.")}}calcValue(){if(this.isRunning){const t=Math.trunc(1e3*(this.timer.eventTimer.clockCount-this.startClockCount)/a.Settings.cpuFrequency);return this.startValue-Math.trunc(t*this.countsPerMs/1e3)&65535}return 0}writeFinished(){this.isRunning=!0,0==this.startValue&&(this.startValue=65536),3!=this.mode&&2!=this.mode&&0!=this.mode||(this.eventId>0&&this.timer.eventTimer.deleteEvent(this.eventId),this.startClockCount=this.timer.eventTimer.clockCount,this.eventId=this.timer.eventTimer.setEvent(Math.trunc(1e3*this.startValue/this.countsPerMs),(()=>this.onCountZero())),this.onChangeFrequency&&this.onChangeFrequency())}onCountZero(){switch(this.generateTimerInt&&this.pic.doInterrupt(r.HardwareInterrupt.Timer),this.mode){case 0:this.isRunning=!1;break;case 2:case 3:this.startClockCount=this.timer.eventTimer.clockCount,this.eventId=this.timer.eventTimer.setEvent(Math.trunc(1e3*this.startValue/this.countsPerMs),(()=>this.onCountZero()))}}reset(){this.mode=0,this.eventId=0,this.isRunning=!1,this.byteNo=0}write(t){switch(this.accessMode){case h.LowNibble:this.startValue=65535&(65280&this.startValue|t),this.writeFinished();break;case h.HighNibble:this.startValue=65535&(255&this.startValue|t<<8),this.writeFinished();break;case h.LowAndHigh:0==this.byteNo?this.startValue=65535&(65280&this.startValue|t):(this.startValue=65535&(255&this.startValue|t<<8),this.writeFinished()),this.byteNo=1-this.byteNo}}read(){let t=0;const e=this.isLatched?this.latchValue:this.calcValue();switch(this.accessMode){case h.LowNibble:t=255&e,this.isLatched=!1;break;case h.HighNibble:t=e>>8&255,this.isLatched=!1;break;case h.LowAndHigh:0==this.byteNo?t=255&e:(t=e>>8&255,this.isLatched=!1),this.byteNo=1-this.byteNo}return t}doLatch(){this.latchValue=this.calcValue(),this.isLatched=!0}}class c extends i.BaseComponent{constructor(t,e){super(),this.counters=new Array(3),this.memRefreshActive=!0;for(let e=0;e<this.counters.length;e++)this.counters[e]=new n(this,t,e);this.counters[0].generateTimerInt=!0,null!=e&&(this.counters[2].onChangeFrequency=e)}get speakerFrequency(){return 3==this.counters[2].mode?this.counters[2].frequency:0}reset(){super.reset();for(const t of this.counters)t.reset()}in(t){return t>=64&&t<=66?this.counters[t-64].read():0}out(t,e,s){if(t>=64&&t<=66&&this.counters[t-64].write(255&e),67==t){const t=e>>6&3;if(t>2)return;const s=this.counters[t],i=e>>4&3,r=e>>1&7;switch(i){case 0:s.doLatch();break;case 1:s.accessMode=h.LowNibble;break;case 2:s.accessMode=h.HighNibble;break;case 3:s.accessMode=h.LowAndHigh}0!=i&&(s.countMode=(1&e)>0?o.Bcd:o.M16Bit,s.mode=r)}}}e.Timer=c},537:(t,e)=>{var s,i;Object.defineProperty(e,"__esModule",{value:!0}),e.Parity=e.StopBits=void 0,(i=e.StopBits||(e.StopBits={}))[i.One=0]="One",i[i.OnePointFive=1]="OnePointFive",i[i.Two=2]="Two",(s=e.Parity||(e.Parity={}))[s.None=0]="None",s[s.Odd=1]="Odd",s[s.Even=2]="Even",s[s.Mark=3]="Mark",s[s.Space=4]="Space"},855:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UartPort=void 0;const i=s(763),r=s(537);var a;!function(t){t[t.None=0]="None",t[t.ModemStatusChange=1]="ModemStatusChange",t[t.TransmitterHoldingRegEmpty=2]="TransmitterHoldingRegEmpty",t[t.ReceivedDataAvailable=3]="ReceivedDataAvailable",t[t.LineStatusChange=4]="LineStatusChange",t[t.CharacterTimeout=5]="CharacterTimeout"}(a||(a={}));class h extends i.BaseComponent{constructor(t,e,s){super(),this.receiveIrqDelay=0,this.receiveBuffer=new Array,this.divisorLatch=0,this.interruptEnableRegister=0,this.lineControlRegister=0,this.scratchRegister=0,this.dmaMode=0,this.dlab=0,this.lastModemStatus=0,this.dataWordLen=0,this.receivedBytesThreshold=0,this.port=t,this.irq=e,this.pic=s,this.receivedBytesThreshold=1}getModemStatus(){return this.loopbackMode?(this.requestToSend?1:0)+(this.dataTerminalReady?2:0)+(this.auxOutput1?4:0)+(this.auxOutput2?8:0):null!=this.serialDevice?(this.serialDevice.clearToSend?1:0)+(this.serialDevice.dataSetReady?2:0)+(this.serialDevice.ringIndicator?4:0)+(this.serialDevice.dataCarrierDetect?8:0):0}in(t){switch(t-this.port){case 0:if(0==this.dlab){let t=0;return this.onBeforeReadReceiveBuffer&&this.onBeforeReadReceiveBuffer(),this.receiveBuffer.length>0&&(t=this.receiveBuffer.shift()),this.clearInterrupt(a.ReceivedDataAvailable),this.clearInterrupt(a.CharacterTimeout),(1&this.interruptEnableRegister)>0&&this.receiveBuffer.length>=this.receivedBytesThreshold&&this.doInterruptWithDelay(a.ReceivedDataAvailable,this.receiveIrqDelay),t}return 255&this.divisorLatch;case 1:return 0==this.dlab?this.interruptEnableRegister:this.divisorLatch>>8&65535;case 2:{let t=0;switch(this.uartInterruptPending||(t=1),this.interruptCause){case a.ModemStatusChange:break;case a.TransmitterHoldingRegEmpty:t|=2,this.interruptCause=a.None,this.uartInterruptPending=!1;break;case a.ReceivedDataAvailable:t|=4;break;case a.LineStatusChange:t|=6;break;case a.CharacterTimeout:t|=12}return this.fifosEnabled&&(t|=192),255&t}case 3:return this.lineControlRegister;case 4:return 255&(this.dataTerminalReady?1:0)+(this.requestToSend?2:0)+(this.auxOutput1?4:0)+(this.auxOutput2?8:0)+(this.loopbackMode?16:0);case 5:{let t=0;return this.receiveBuffer.length>0&&(t+=1),(null==this.serialDevice||this.serialDevice.transmitBufferEmpty)&&(t|=96),this.clearInterrupt(a.LineStatusChange),255&t}case 6:{const t=this.getModemStatus();let e=(11&(this.lastModemStatus^t))+(t<<4);return e+=this.trailingEdgeRingIndicator?4:0,this.trailingEdgeRingIndicator=!1,this.lastModemStatus=t,this.clearInterrupt(a.ModemStatusChange),255&e}case 7:return this.scratchRegister}return 0}out(t,e,s){var i;switch(t-this.port){case 0:0==this.dlab?(this.clearInterrupt(a.TransmitterHoldingRegEmpty),this.loopbackMode?(this.transmitBufferEmpty(),this.writeData(255&e)):this.onTransmit&&this.onTransmit(255&e)):(this.divisorLatch=(65280&this.divisorLatch)+(255&e)&65535,this.serialParamsChanged());break;case 1:0==this.dlab?this.interruptEnableRegister=15&e:(this.divisorLatch=(255&this.divisorLatch)+(e<<8)&65535,this.serialParamsChanged());break;case 2:switch(this.fifosEnabled=(1&e)>0,(2&e)>0&&(this.receiveBuffer.length=0),(4&e)>0&&(null===(i=this.serialDevice)||void 0===i||i.clearTransmitBuffer()),this.dmaMode=e>>3&1,e>>6){case 0:this.receivedBytesThreshold=1;break;case 1:this.receivedBytesThreshold=4;break;case 2:this.receivedBytesThreshold=8;break;case 3:this.receivedBytesThreshold=14}break;case 3:switch(this.lineControlRegister=255&e,3&e){case 0:this.dataWordLen=5;break;case 1:this.dataWordLen=6;break;case 2:this.dataWordLen=7;break;case 3:this.dataWordLen=8}if(this.stopBits=(4&e)>0?this.dataWordLen<=5?r.StopBits.OnePointFive:r.StopBits.Two:r.StopBits.One,0==(8&e))this.parity=r.Parity.None;else switch(e>>4&3){case 0:this.parity=r.Parity.Odd;break;case 1:this.parity=r.Parity.Even;break;case 2:this.parity=r.Parity.Mark;break;case 3:this.parity=r.Parity.Space}this.breakSignalEnabled=(64&e)>0,this.dlab=e>>7&1,this.serialParamsChanged();break;case 4:{const t=this.loopbackMode;this.dataTerminalReady=(1&e)>0,this.requestToSend=(2&e)>0,this.auxOutput1=(4&e)>0,this.auxOutput2=(8&e)>0,this.loopbackMode=(16&e)>0,this.loopbackMode&&!t&&(this.lastModemStatus=this.getModemStatus()),this.loopbackMode&&this.modemStatusChanged(),null!=this.serialDevice&&(this.serialDevice.dataTerminalReady=this.dataTerminalReady,this.serialDevice.requestToSend=this.requestToSend)}break;case 5:break;case 6:this.trailingEdgeRingIndicator=(4&e)>0;break;case 7:this.scratchRegister=255&e}}get baudRate(){return this.divisorLatch>0?Math.trunc(1843200/(this.divisorLatch<<4)):0}connect(t){this.serialDevice=t,this.serialDevice.uartPort=this,this.serialDevice.onTransmitBufferEmpty=this.transmitBufferEmpty}disconnect(){this.serialDevice.uartPort=null,this.serialDevice=null}writeData(t){this.receiveBuffer.push(t),(1&this.interruptEnableRegister)>0&&this.receiveBuffer.length>=this.receivedBytesThreshold&&this.doInterrupt(a.ReceivedDataAvailable)}modemStatusChanged(){(8&this.interruptEnableRegister)>0&&this.doInterrupt(a.ModemStatusChange)}doInterruptWithDelay(t,e){this.interruptPending||(this.interruptPending=!0,this.eventTimer.setEvent(e,(()=>this.doInterrupt(t))))}doInterrupt(t){this.uartInterruptPending||(this.interruptCause=t,this.uartInterruptPending=!0,this.pic.doInterrupt(this.irq),this.interruptPending=!1)}clearInterrupt(t){this.interruptCause==t&&(this.interruptCause=a.None,this.uartInterruptPending=!1)}serialParamsChanged(){this.onSerialParamsChanged&&this.onSerialParamsChanged(),this.receiveBuffer.length=0,this.baudRate>0&&(this.receiveIrqDelay=Math.trunc(1e6/this.baudRate))}transmitBufferEmpty(){(2&this.interruptEnableRegister)>0&&this.doInterrupt(a.TransmitterHoldingRegEmpty)}}e.UartPort=h},991:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VgaGraphics=void 0;const i=s(523),r=s(740),a=s(915);var h,o;!function(t){t[t.None=0]="None",t[t.M01_CGA=1]="M01_CGA",t[t.M01_EGA=2]="M01_EGA",t[t.M01_VGA=3]="M01_VGA",t[t.M03_CGA=4]="M03_CGA",t[t.M03_EGA=5]="M03_EGA",t[t.M03_VGA=6]="M03_VGA",t[t.M04=7]="M04",t[t.M06=8]="M06",t[t.M07_EGA=9]="M07_EGA",t[t.M07_VGA=10]="M07_VGA",t[t.M0D=11]="M0D",t[t.M0E=12]="M0E",t[t.M0F=13]="M0F",t[t.M10=14]="M10",t[t.M11=15]="M11",t[t.M12=16]="M12",t[t.M13=17]="M13",t[t.MX_320x240=18]="MX_320x240"}(h||(h={})),function(t){t[t.Read=0]="Read",t[t.Write=1]="Write"}(o||(o={}));class n extends i.ATColorGraphicsCard{constructor(){super(),this.vgaSwitches=[!1,!0,!0,!1],this.paletteRam=new Array(16),this.dacMask=0,this.videoSubsystemEnableRegister1=0,this.videoSubsystemEnableRegister2=0,this.dacEntries=new Array(256),this.dacWriteColIndex=0,this.dacReadColIndex=0,this.dacMemR=0,this.dacMemG=0,this.charWidth9Bits=!1,this.mode=h.None,this.charBoxWidth=this.charWidth=8,this.colCount=this.screenWidth=640,this.lineCount=this.screenHeight=480,this.dacMask=255,this.sequencerRegisters[4]=2,this.calcRetraceValues()}getModeC256(){return(64&this.gdcRegisters[5])>0}getNineDotMode(){return 0==(1&this.sequencerRegisters[1])}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB&&(2&this.sequencerRegisters[4])>0}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("vgaSwitches"),this.ignoredFields.add("egaPalette"),this.ignoredFields.add("cgaPalette")}in(t){if(t==this.crtBasePort+10){this.attributeFlipFlop=!1;const t=this.calcRetraceEnable();return 255&(t.vertRetrace?8:0)+(t.enable?0:1)}switch(t){case 962:{let t=this.calcVertRetrace()?0:128;const e=this.miscOutputRegister>>2&3;return t+=this.vgaSwitches[e]?0:16,255&t}case 963:return this.videoSubsystemEnableRegister1;case 964:return 65535&this.sequencerIndex;case 965:return this.sequencerIndex<this.sequencerRegisters.length?this.sequencerRegisters[this.sequencerIndex]:0;case 966:return this.dacMask;case 967:return 65535&(this.dacMode==o.Read?0:3);case 969:{if(this.dacMode!=o.Read)return 0;const t=Math.trunc(this.dacReadColIndex/3);let e=0;switch(this.dacReadColIndex%3){case 0:e=this.dacEntries[t].r;break;case 1:e=this.dacEntries[t].g;break;case 2:e=this.dacEntries[t].b}return 768==++this.dacReadColIndex&&(this.dacReadColIndex=0),e>>2&65535}case 970:return this.featureControlRegister;case 972:return 207&this.miscOutputRegister;case 974:return 65535&this.gdcIndex;case 975:return 65535&(this.gdcIndex<this.gdcRegisters.length?this.gdcRegisters[this.gdcIndex]:0);case 18152:return this.videoSubsystemEnableRegister2}return super.in(t)}out(t,e,s){switch(t){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&e,this.attributeIndex){case 16:this.graphicsMode=(1&e)>0,this.monochrome=(2&e)>0,this.charWidth9Bits=(4&e)>0,this.blink=(8&e)>0;break;case 17:this.overscanColor=this.genColor(255&e);break;case 18:for(let t=0;t<this.colorPlaneEnabled.length;t++)this.colorPlaneEnabled[t]=(e&1<<t)>0;break;default:this.attributeIndex<=15&&(this.paletteRam[this.attributeIndex]=63&e)}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&e,this.attributeFlipFlop=!this.attributeFlipFlop,s&&this.out(t,e>>8&65535,!1);break;case 963:this.videoSubsystemEnableRegister1=255&e;break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&e;break;case 2:this.mapMaskRegister=255&e,this.mapMask[0]=(1&e)>0,this.mapMask[1]=(2&e)>0,this.mapMask[2]=(4&e)>0,this.mapMask[3]=(8&e)>0;break;case 3:this.characterMapSelectRegister=255&e,this.characterMapA=((32&e)>>5)+(e>>1&6),this.characterMapB=((16&e)>>4)+(e<<1&6);break;case 4:e|=2,this.memoryModeRegister=255&e,this.oddEven=0==(4&e),this.chain4=(8&e)>0}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&e);break;case 966:this.dacMask=255&e;break;case 967:this.dacReadColIndex=3*(255&e),this.dacMode=o.Read;break;case 968:this.dacWriteColIndex=3*(255&e),this.dacMode=o.Write;break;case 969:{if(this.dacMode!=o.Write)return;const t=Math.trunc(this.dacWriteColIndex/3),s=e<<2&255;switch(this.dacWriteColIndex%3){case 0:this.dacMemR=s;break;case 1:this.dacMemG=s;break;case 2:this.dacEntries[t]=r.Col.fromRgb(this.dacMemR,this.dacMemG,s)}768==++this.dacWriteColIndex&&(this.dacWriteColIndex=0);break}case 18152:this.videoSubsystemEnableRegister2=255&e;break;default:super.out(t,e,s)}}internalPoke(t,e,s){3==this.writeMode||super.internalPoke(t,e,s)}setDataRegister(t){(0==(128&this.crtRegisters[17])||this.crtIndexReg>7)&&super.setDataRegister(t)}GetDataRegister(){return this.crtIndexReg<this.crtRegisters.length?this.crtRegisters[this.crtIndexReg]:0}calcMode(){const t=this.mode,e=254&this.sequencerRegisters[1],s=this.sequencerRegisters[2],i=this.sequencerRegisters[4],r=204&this.miscOutputRegister,a=this.crtRegisters[23];this.getModeC256()?this.mode=h.M13:8==e&&3==i?64==r?this.mode=h.M01_CGA:128==r?this.mode=h.M01_EGA:68==r&&(this.mode=h.M01_VGA):0==e&&3==i?64==r?this.mode=h.M03_CGA:128==r?this.mode=h.M03_EGA:68==r&&(this.mode=h.M03_VGA):8==e&&2==i?this.mode=h.M04:0==e&&6==i?64==r?1==s?this.mode=h.M06:15==s&&(this.mode=h.M0E):128==r?this.mode=h.M10:192==r&&(195==a?this.mode=h.M11:227==a&&(this.mode=h.M12)):0==e&&3==i?this.mode=this.getNineDotMode()?h.M07_VGA:h.M07_EGA:8==e&&6==i&&(this.mode=h.M0D),this.mode!=t&&this.modeChanged()}modeChanged(){switch(super.modeChanged(),this.miscOutputRegister>>6&3){case 1:this.lineCount=400;break;case 2:this.lineCount=350;break;case 3:this.lineCount=480}const t=0==(this.miscOutputRegister>>2&3)?640:720;(8&this.clockMode)>0?this.colCount=t>>1:this.colCount=t,this.calcRetraceValues()}gen16ColPalette(){const t=(128&this.attributeRegisters[16])>0,e=this.attributeRegisters[20],s=new Array(16);for(let i=0;i<16;i++){const r=63&this.paletteRam[i],a=t?15&r|(15&e)<<4:r|(12&e)<<4;s[i]=this.dacEntries[a&this.dacMask]}return s}updateDimensions(){switch(this.calcMode(),this.mode){case h.M01_CGA:this.screenWidth=320,this.screenHeight=200;break;case h.M01_EGA:this.screenWidth=320,this.screenHeight=350;break;case h.M01_VGA:this.screenWidth=360,this.screenHeight=400;break;case h.M03_CGA:this.screenWidth=640,this.screenHeight=200;break;case h.M03_EGA:this.screenWidth=640,this.screenHeight=350;break;case h.M03_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M04:this.screenWidth=320,this.screenHeight=200;break;case h.M06:this.screenWidth=640,this.screenHeight=200;break;case h.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case h.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M0D:this.screenWidth=320,this.screenHeight=200;break;case h.M0E:this.screenWidth=640,this.screenHeight=200;break;case h.M0F:case h.M10:this.screenWidth=640,this.screenHeight=350;break;case h.M11:case h.M12:this.screenWidth=640,this.screenHeight=480;break;case h.M13:this.screenWidth=320,this.screenHeight=200;break;case h.MX_320x240:this.screenWidth=320,this.screenHeight=240}}updateScreen(t,e){switch(super.updateScreen(t,e),a.Settings.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.charBoxWidth=this.getNineDotMode()?9:8,this.mode){case h.M01_CGA:case h.M01_EGA:case h.M01_VGA:case h.M03_CGA:case h.M03_EGA:case h.M03_VGA:this.updateTextScreen(t,e,this.egaPalette);break;case h.M04:this.updateScreenCgaLo(t);break;case h.M06:this.screenWidth=640,this.screenHeight=200,this.updateScreenCgaMono(t,640,200);break;case h.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case h.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M0D:this.screenWidth=320,this.screenHeight=200,this.updateScreen16Col(t,320,200,this.cgaPalette);break;case h.M0E:this.screenWidth=640,this.screenHeight=200,this.updateScreen16Col(t,640,200,this.cgaPalette);break;case h.M0F:this.screenWidth=640,this.screenHeight=350;break;case h.M10:this.screenWidth=640,this.screenHeight=350,this.updateScreen16Col(t,640,350,this.gen16ColPalette());break;case h.M11:this.screenWidth=640,this.screenHeight=480,this.updateScreenVgaMono(t,640,480);break;case h.M12:this.screenWidth=640,this.screenHeight=480,this.updateScreen16Col(t,640,480,this.gen16ColPalette());break;case h.M13:this.screenWidth=320,this.screenHeight=200,this.updateScreen256ColChain4(t,320,200);break;case h.MX_320x240:this.screenWidth=640,this.screenHeight=480}}updateScreen256ColChain4(t,e,s){const i=new Uint32Array(t.buffer),r=this.dacEntries,a=0==this.getCrtOffset()?Math.trunc(e/4):this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),o=0;const n=this.getHorizontalPixelPanning(),c=0==n?e:e+4;for(let t=0;t<s;t++){let t=65535&h;for(let e=0;e<c;e+=4,t++)for(let s=0;s<4;s++)(0==n||e+s>=n&&e+s<c-8+n)&&(i[o++]=r[this.planes[s][t]].value);h+=a}}updateScreenVgaMono(t,e,s){const i=new Uint32Array(t.buffer),a=r.Col.fromRgb(255,255,255),h=this.overscanColor;let o=0,n=0;for(let t=0;t<s;t++)for(let t=0;t<e;t+=8){let t=this.planes[0][o];for(let e=0;e<8;e++)i[n++]=(128&t)>0?a.value:h.value,t<<=1;o++}}}e.VgaGraphics=n},899:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MemoryMapper=void 0,e.MemoryMapper=class{constructor(t){this.extRamStart=65536,this.memoryMappings=new Array,this.readMappings=new Array,this.writeMappings=new Array,this.extRamLimit=0,this.supportRead=!0,this.supportWrite=!0;const e=t>1024?t-1024:0;this.ram=new Uint8Array(1024*Math.min(t,640)),this.extRam=new Uint8Array(1024*e),this.extRamLimit=this.extRamStart+e}peek(t){if(t<this.ram.length)return this.ram[t];if(t>=this.extRamStart&&t<this.extRamLimit)return this.extRam[t-this.extRamStart];for(let e=0;e<this.readMappings.length;e++){const s=this.readMappings[e];if(s.addrLo<=t&&s.addrHi>=t)return s.provider.peek(t)}return 0}poke(t,e){if(t<this.ram.length)this.ram[t]=255&e;else if(t>=this.extRamStart&&t<this.extRamLimit)this.extRam[t-this.extRamStart]=255&e;else for(let s=0;s<this.readMappings.length;s++){const i=this.readMappings[s];if(i.addrLo<=t&&i.addrHi>=t)return void i.provider.poke(t,255&e)}}peekW(t){if(t<this.ram.length-1)return this.ram[t]+(this.ram[t+1]<<8);if(t>=this.extRamStart&&t<this.extRamLimit){const e=t-this.extRamStart;return this.extRam[e]+(this.extRam[e+1]<<8)}for(let e=0;e<this.readMappings.length;e++){const s=this.readMappings[e];if(s.addrLo<=t&&s.addrHi>=t)return s.provider.peek(t)+(s.provider.peek(t+1)<<8)}return 0}pokeW(t,e){if(t<this.ram.length-1)return this.ram[t]=255&e,void(this.ram[t+1]=e>>8&255);if(t>=this.extRamStart&&t<this.extRamLimit){const s=t-this.extRamStart;this.extRam[s]=255&e,this.extRam[s+1]=e>>8&255}for(let s=0;s<this.readMappings.length;s++){const i=this.readMappings[s];if(i.addrLo<=t&&i.addrHi>=t)return i.provider.poke(t,255&e),void i.provider.poke(t+1,e>>8&255)}}peekD(t){if(t<this.ram.length-1)return this.ram[t]+(this.ram[t+1]<<8)+(this.ram[t+2]<<16)+(this.ram[t+3]<<24);if(t>=this.extRamStart&&t<this.extRamLimit){const e=t-this.extRamStart;return this.extRam[e]+(this.extRam[e+1]<<8)+(this.extRam[e+2]<<16)+(this.extRam[e+3]<<24)}for(let e=0;e<this.readMappings.length;e++){const s=this.readMappings[e];if(s.addrLo<=t&&s.addrHi>=t)return s.provider.peek(t)+(s.provider.peek(t+1)<<8)+(s.provider.peek(t+2)<<16)+(s.provider.peek(t+3)<<24)}return 0}pokeD(t,e){if(t<this.ram.length-1)return this.ram[t]=255&e,this.ram[t+1]=e>>8&255,this.ram[t+2]=e>>16&255,void(this.ram[t+3]=e>>24&255);if(t>=this.extRamStart&&t<this.extRamLimit){const s=t-this.extRamStart;this.extRam[s]=255&e,this.extRam[s+1]=e>>8&255,this.extRam[s+2]=e>>16&255,this.extRam[s+3]=e>>24&255}for(let s=0;s<this.readMappings.length;s++){const i=this.readMappings[s];if(i.addrLo<=t&&i.addrHi>=t)return i.provider.poke(t,255&e),i.provider.poke(t+1,e>>8&255),i.provider.poke(t+2,e>>16&255),void i.provider.poke(t+3,e>>24&255)}}register(t,e,s){this.memoryMappings.push({addrLo:t,addrHi:e,provider:s,supportRead:s.supportRead,supportWrite:s.supportWrite})}FinishRegistration(){for(const t of this.memoryMappings)t.supportRead&&this.readMappings.push(t),t.supportWrite&&this.writeMappings.push(t)}}},762:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PortMapper=void 0,e.PortMapper=class{constructor(){this.portMappings=new Array}in(t){for(let e=0;e<this.portMappings.length;e++){const s=this.portMappings[e];if(s.portLo<=t&&s.portHi>=t)return 65535&s.provider.in(t)}return 65535}out(t,e,s){for(let i=0;i<this.portMappings.length;i++){const r=this.portMappings[i];if(r.portLo<=t&&r.portHi>=t)return void r.provider.out(t,e,s)}}register(t,e,s){this.portMappings.push({provider:s,portLo:t,portHi:e})}}},475:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DbStorage=void 0,e.DbStorage=class{constructor(t){this.objStoreName="data",this.dbName=t}async initialize(){return new Promise((t=>{const e=indexedDB.open(this.dbName,1);e.onerror=()=>{alert("Database error")},e.onsuccess=()=>{this.database=e.result,this.ready=!0,t()},e.onupgradeneeded=e=>{const s=e.target;this.database=s.result,this.database.createObjectStore(this.objStoreName,{keyPath:"key"}).createIndex("primary","key"),s.transaction.oncomplete=()=>{this.ready=!0,t()}}}))}async setData(t,e){if(this.ready)return new Promise(((s,i)=>{const r=this.database.transaction(this.objStoreName,"readwrite").objectStore(this.objStoreName).put({key:t,data:e});r.onsuccess=()=>{s()},r.onerror=()=>{i()}}))}async getData(t){if(this.ready)return new Promise((e=>{const s=this.database.transaction(this.objStoreName,"readonly").objectStore(this.objStoreName).index("primary").get(t);s.onsuccess=t=>{var s;e(null===(s=t.target.result)||void 0===s?void 0:s.data)},s.onerror=()=>{e(void 0)}}))}}},85:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Emulator=void 0;const i=s(899),r=s(762),a=s(50),h=s(144),o=s(81),n=s(52),c=s(970),d=s(833),l=s(808),m=s(855),u=s(493),g=s(121),p=s(226),C=s(915),k=s(139),b=s(63),S=s(443),R=s(696),f=s(722),y=s(441),A=s(6),v=s(991);e.Emulator=class{constructor(t){switch(this.components=new Array,this.screenUpdateRate=0,this.roms=new Array,this.screenUpdateRate=t,this.memMapper=new i.MemoryMapper(C.Settings.ramAmount),this.portMapper=new r.PortMapper,C.Settings.cpuType){case a.CpuType.Cpu186:this.cpu=new k.Cpu186(this.memMapper,this.portMapper);break;case a.CpuType.Cpu386:this.cpu=new b.Cpu386(this.memMapper,this.portMapper)}this.disassembler=new S.Disassembler(this.cpu,this.memMapper)}getWorkLoad(){return this.cpu.workLoad}getInstCount(){return this.cpu.instCount}changeScreenUpdateRate(t){this.screenUpdateRate!=t&&(this.screenUpdateRate=t,null!=this.graphicsCard&&this.graphicsCard.setScreenUpdateRate(t))}getCpuName(){return this.cpu.getName()}getAX(){return this.cpu.AX}getBX(){return this.cpu.BX}getCX(){return this.cpu.CX}getDX(){return this.cpu.DX}getSP(){return this.cpu.SP}getBP(){return this.cpu.BP}getSI(){return this.cpu.SI}getDI(){return this.cpu.DI}getCS(){return this.cpu.CS}getDS(){return this.cpu.DS}getES(){return this.cpu.ES}getSS(){return this.cpu.SS}getIP(){return this.cpu.IP}getFLAGS(){return this.cpu.FLAGS}getHalt(){return this.cpu.halt}getInstructionByte(){return this.cpu.getInstructionByte()}getAddressByte(){return this.cpu.getAddressByte()}getScreenWidth(){return this.graphicsCard.screenWidth}getScreenHeight(){return this.graphicsCard.screenHeight}updateGraphicDimensions(){var t;null===(t=this.graphicsCard)||void 0===t||t.updateDimensions()}updateScreen(t,e){var s;null===(s=this.graphicsCard)||void 0===s||s.updateScreen(t,e)}dumpMemory(t){throw new Error("Method not implemented.")}getMemByte(t){return this.memMapper.peek(t)}async prepare(){for(const t of this.roms)this.memMapper.register(t.startAddr,t.getEndAddr(),t),this.registerComponent(t);if(C.Settings.enableUma){const t=new p.Ram(128,851968);this.memMapper.register(t.addrLo,t.addrHi,t),this.registerComponent(t)}switch(this.dmaController=new h.DmaController(this.memMapper,(()=>this.timer.memRefreshActive)),this.portMapper.register(0,15,this.dmaController),this.portMapper.register(128,143,this.dmaController),this.portMapper.register(192,223,this.dmaController),this.registerComponent(this.dmaController),this.interruptController=new o.InterruptController,this.portMapper.register(32,33,this.interruptController),this.registerComponent(this.interruptController),C.Settings.graphicsAdapterType){case C.GraphicsType.MDA:this.graphicsCard=new R.MdaGraphics,this.portMapper.register(944,959,this.graphicsCard),this.memMapper.register(720896,737279,this.graphicsCard);break;case C.GraphicsType.CGA:this.graphicsCard=new y.CgaGraphics,this.portMapper.register(976,991,this.graphicsCard),this.memMapper.register(753664,770047,this.graphicsCard);break;case C.GraphicsType.EGA:this.graphicsCard=new A.EgaGraphics,this.portMapper.register(960,991,this.graphicsCard),this.memMapper.register(655360,786431,this.graphicsCard);break;case C.GraphicsType.VGA:this.graphicsCard=new v.VgaGraphics,this.portMapper.register(944,991,this.graphicsCard),this.portMapper.register(18152,18152,this.graphicsCard),this.memMapper.register(655360,786431,this.graphicsCard)}if(this.graphicsCard.setScreenUpdateRate(this.screenUpdateRate),await this.graphicsCard.loadCharSet(),this.registerComponent(this.graphicsCard),this.ppi=new n.Ppi(this.interruptController,(()=>this.onSpeaker())),this.portMapper.register(96,99,this.ppi),this.registerComponent(this.ppi),this.speakerController=this.ppi,this.keyboard=this.ppi,this.timer=new c.Timer(this.interruptController,(()=>this.onSpeaker())),this.portMapper.register(64,95,this.timer),this.registerComponent(this.timer),C.Settings.enableHdController&&(this.hardDisk=new d.HardDisk(this.interruptController,this.dmaController),await this.hardDisk.loadImages(),this.portMapper.register(800,803,this.hardDisk),this.registerComponent(this.hardDisk)),this.floppyDisk=new l.FloppyDisk(this.interruptController,this.dmaController),this.portMapper.register(1008,1015,this.floppyDisk),this.registerComponent(this.floppyDisk),this.mouse=new u.Mouse(this.cpu),C.Settings.com1Device!=C.ComDevice.None&&(this.uartPort1=new m.UartPort(1016,o.HardwareInterrupt.Serial4,this.interruptController),this.portMapper.register(1016,1023,this.uartPort1),this.registerComponent(this.uartPort1),this.connectSerialDevice(this.uartPort1,C.Settings.com1Device)),C.Settings.com2Device!=C.ComDevice.None&&(this.uartPort2=new m.UartPort(760,o.HardwareInterrupt.Serial3,this.interruptController),this.portMapper.register(760,767,this.uartPort2),this.registerComponent(this.uartPort2),this.connectSerialDevice(this.uartPort2,C.Settings.com2Device)),C.Settings.enableRtc){const t=new f.RealTimeClock(832);this.portMapper.register(832,855,t),this.registerComponent(t)}this.memMapper.FinishRegistration()}connectSerialDevice(t,e){e==C.ComDevice.EmulatedMouse&&t.connect(this.mouse)}registerComponent(t){this.components.push(t),t.eventTimer=this.cpu,t.doCpuInterrupt=t=>this.cpu.doInterrupt(t)}onSpeaker(){var t;null===(t=this.soundGenerator)||void 0===t||t.setFrequency(this.speakerController.speakerEnabled?this.timer.speakerFrequency:0)}step(){this.cpu.execNextInstruction()}runClocks(t){this.cpu.execInstructions(t)}get eventTimer(){return this.cpu}async reset(){var t,e;await(null===(t=this.hardDisk)||void 0===t?void 0:t.saveImages()),await(null===(e=this.floppyDisk)||void 0===e?void 0:e.saveImages()),this.cpu.reset();for(const t of this.components)t.reset()}async loadRom(t,e){const s=new g.Rom(e);await s.load(t),this.roms.push(s)}async loadDiskImageFromFile(t,e){return await this.floppyDisk.loadImageFromFile(t,e)}loadDiskImageFromBuffer(t,e){this.floppyDisk.loadImageFromBuffer(t,e)}async newDiskImage(t){await this.floppyDisk.newImage(t)}getDiskImage(t){return this.floppyDisk.getDiskImage(t)}async ejectDiskImage(t){await this.floppyDisk.ejectImage(t)}runDebug(t){for(this.cpu.reset();!this.cpu.halt;)this.disassembler.doDisassemble(),t(this.disassembler.disassembledLine),this.cpu.execNextInstruction();t(""),t("finished.")}sendKey(t){this.keyboard.addScanCode(t)}screenMouseEvent(t,e,s){var i;null===(i=this.mouse)||void 0===i||i.mouseEventRel(t,e,s)}screenMouseReset(){this.mouse.resetMove()}mouseMoveDelta(t,e){this.mouse.mouseMoveDelta(t,e)}async loadIntoRam(t,e){}async loadBios(t){const e=new g.Rom(0);await e.load(t),e.startAddr=1048576-e.size,this.roms.push(e)}async saveImages(){await this.hardDisk.saveImages(),await this.floppyDisk.saveImages()}}},915:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Settings=e.ComDevice=e.GraphicsType=void 0;const i=s(50);var r,a;!function(t){t[t.MDA=0]="MDA",t[t.Hercules=1]="Hercules",t[t.CGA=2]="CGA",t[t.EGA=3]="EGA",t[t.VGA=4]="VGA"}(r=e.GraphicsType||(e.GraphicsType={})),function(t){t[t.None=0]="None",t[t.NotConnected=1]="NotConnected",t[t.EmulatedMouse=2]="EmulatedMouse"}(a=e.ComDevice||(e.ComDevice={}));class h{static get monochromeGraphics(){return this.graphicsAdapterType==r.MDA||this.graphicsAdapterType==r.Hercules}}e.Settings=h,h.cpuType=i.CpuType.Cpu186,h.cpuFrequency=4770,h.ramAmount=640,h.floppyCount=2,h.graphicsAdapterType=r.CGA,h.enableHdController=!0,h.enableUma=!0,h.enableRtc=!0,h.com1Device=a.EmulatedMouse,h.com1PortName="",h.com2Device=a.None,h.com2PortName="",h.hdImageDir="HdImages/",h.baseDir="",h.noScreenUpdateWhileRetrace=!0},823:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EmulatorWorker=void 0;const i=s(915),r=s(85);e.EmulatorWorker=class{constructor(t){this.initialized=!1,this.running=!1,this.doReset=!1,this.intervalLength=20,this.screenUpdateCounter=0,this.perfInterval=1e3,this.perfCount=0,this.perfFreeTime=0,this.context=t,t.onmessage=t=>{switch(t.data[0]){case"initialize":this.initialized||(this.screenWorkerPort=t.data[2],this.initialize(t.data[1]));break;case"run":this.running=!0,this.doRun();break;case"stop":this.emulator.saveImages(),this.running=!1;break;case"reset":this.doReset=!0;break;case"sendkey":this.running&&this.emulator.sendKey(t.data[1]);break;case"loadimage":if(!this.initialized)return;this.emulator.loadDiskImageFromBuffer(t.data[2],t.data[1]);break;case"newimage":this.emulator.newDiskImage(t.data[1]);break;case"downloadimage":{const e=t.data[1],s=this.emulator.getDiskImage(e);s&&this.context.postMessage(["downloadimage",e,s])}break;case"saveimages":this.emulator.saveImages();break;case"mousereset":if(!this.initialized)return;this.emulator.screenMouseReset();break;case"mouseevent":{if(!this.initialized)return;const e=t.data[1],s=t.data[2],i=t.data[3];this.emulator.screenMouseEvent(e,s,i)}break;case"mousemovedelta":{if(!this.initialized)return;const e=t.data[1],s=t.data[2];this.emulator.mouseMoveDelta(e,s)}}}}triggerScreenUpdate(){if(this.running){this.emulator.updateGraphicDimensions();const t=this.emulator.graphicsCard.getJsonUpdate(),e=this.emulator.graphicsCard.getMemoryData();this.screenWorkerPort.postMessage(["updatescreen",t,this.emulator.getScreenWidth(),this.emulator.getScreenHeight(),...e])}}async doRun(){this.doReset&&(this.doReset=!1,this.emulator.reset()),0==this.perfCount&&(this.perfCount=this.perfInterval/this.intervalLength,this.perfFreeTime=0);const t=performance.now();this.emulator.runClocks(this.clocksPerInterval),0==this.screenUpdateCounter&&(this.screenUpdateCounter=2,this.triggerScreenUpdate()),this.screenUpdateCounter--;const e=performance.now()-t,s=e<this.intervalLength?this.intervalLength-e:1;this.perfFreeTime+=s,this.perfCount--,0==this.perfCount&&this.context.postMessage(["cpuload",1-this.perfFreeTime/this.perfInterval]),this.running?setTimeout((()=>{this.doRun()}),s):(this.context.postMessage(["stopped"]),this.context.postMessage(["cpuload",0]))}async initialize(t){switch(i.Settings.baseDir="../",i.Settings.hdImageDir="HdImages/",i.Settings.cpuType=t.cpuType,i.Settings.cpuFrequency=t.cpuFrequency,i.Settings.ramAmount=t.ramAmount,i.Settings.graphicsAdapterType=t.graphicsAdapterType,i.Settings.enableHdController=t.enableHdController,i.Settings.enableUma=t.enableUma,i.Settings.enableRtc=t.enableRtc,i.Settings.com1Device=t.com1Device,i.Settings.com2Device=t.com2Device,this.clocksPerInterval=Math.trunc(i.Settings.cpuFrequency*this.intervalLength),this.emulator=new r.Emulator(t.screenUpdateRate),await this.emulator.loadBios("Roms/BIOS/"+t.biosImage),i.Settings.graphicsAdapterType){case i.GraphicsType.EGA:await this.emulator.loadRom("Roms/EGA/genoa-ega-2.41.rom",786432);break;case i.GraphicsType.VGA:await this.emulator.loadRom("Roms/VGA/ibm-vga.rom",786432)}i.Settings.enableHdController&&await this.emulator.loadRom("Roms/Harddisk/IBM_XEBEC_62X0822_1985.BIN",819200),await this.emulator.prepare(),this.initialized=!0,this.screenWorkerPort.postMessage(["initialize",i.Settings.graphicsAdapterType,this.emulator.graphicsCard.getJsonInitial()]),this.context.postMessage(["initialized"])}}},591:(t,e,s)=>{var i={};(0,s(236).assign)(i,s(555),s(843),s(619)),t.exports=i},555:(t,e,s)=>{var i=s(405),r=s(236),a=s(373),h=s(898),o=s(292),n=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var s=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==s)throw new Error(h[s]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var d;if(d="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===n.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(s=i.deflateSetDictionary(this.strm,d)))throw new Error(h[s]);this._dict_set=!0}}function d(t,e){var s=new c(e);if(s.push(t,!0),s.err)throw s.msg||h[s.err];return s.result}c.prototype.push=function(t,e){var s,h,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;h=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===n.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(c),o.next_out=0,o.avail_out=c),1!==(s=i.deflate(o,h))&&0!==s)return this.onEnd(s),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==h&&2!==h)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==s);return 4===h?(s=i.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,0===s):2!==h||(this.onEnd(0),o.avail_out=0,!0)},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=c,e.deflate=d,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,d(t,e)}},843:(t,e,s)=>{var i=s(948),r=s(236),a=s(373),h=s(619),o=s(898),n=s(292),c=s(401),d=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var s=i.inflateInit2(this.strm,e.windowBits);if(s!==h.Z_OK)throw new Error(o[s]);if(this.header=new c,i.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=a.string2buf(e.dictionary):"[object ArrayBuffer]"===d.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=i.inflateSetDictionary(this.strm,e.dictionary))!==h.Z_OK))throw new Error(o[s])}function m(t,e){var s=new l(e);if(s.push(t,!0),s.err)throw s.msg||o[s.err];return s.result}l.prototype.push=function(t,e){var s,o,n,c,l,m=this.strm,u=this.options.chunkSize,g=this.options.dictionary,p=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?h.Z_FINISH:h.Z_NO_FLUSH,"string"==typeof t?m.input=a.binstring2buf(t):"[object ArrayBuffer]"===d.call(t)?m.input=new Uint8Array(t):m.input=t,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new r.Buf8(u),m.next_out=0,m.avail_out=u),(s=i.inflate(m,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&g&&(s=i.inflateSetDictionary(this.strm,g)),s===h.Z_BUF_ERROR&&!0===p&&(s=h.Z_OK,p=!1),s!==h.Z_STREAM_END&&s!==h.Z_OK)return this.onEnd(s),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&s!==h.Z_STREAM_END&&(0!==m.avail_in||o!==h.Z_FINISH&&o!==h.Z_SYNC_FLUSH)||("string"===this.options.to?(n=a.utf8border(m.output,m.next_out),c=m.next_out-n,l=a.buf2string(m.output,n),m.next_out=c,m.avail_out=u-c,c&&r.arraySet(m.output,m.output,n,c,0),this.onData(l)):this.onData(r.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(p=!0)}while((m.avail_in>0||0===m.avail_out)&&s!==h.Z_STREAM_END);return s===h.Z_STREAM_END&&(o=h.Z_FINISH),o===h.Z_FINISH?(s=i.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===h.Z_OK):o!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),m.avail_out=0,!0)},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===h.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=l,e.inflate=m,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,m(t,e)},e.ungzip=m},236:(t,e)=>{var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var r in s)i(s,r)&&(t[r]=s[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,s,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(s,s+i),r);else for(var a=0;a<i;a++)t[r+a]=e[s+a]},flattenChunks:function(t){var e,s,i,r,a,h;for(i=0,e=0,s=t.length;e<s;e++)i+=t[e].length;for(h=new Uint8Array(i),r=0,e=0,s=t.length;e<s;e++)a=t[e],h.set(a,r),r+=a.length;return h}},a={arraySet:function(t,e,s,i,r){for(var a=0;a<i;a++)t[r+a]=e[s+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(s)},373:(t,e,s)=>{var i=s(236),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var h=new i.Buf8(256),o=0;o<256;o++)h[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function n(t,e){if(e<65534&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var s="",h=0;h<e;h++)s+=String.fromCharCode(t[h]);return s}h[254]=h[254]=1,e.string2buf=function(t){var e,s,r,a,h,o=t.length,n=0;for(a=0;a<o;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(r-56320),a++),n+=s<128?1:s<2048?2:s<65536?3:4;for(e=new i.Buf8(n),h=0,a=0;h<n;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(r-56320),a++),s<128?e[h++]=s:s<2048?(e[h++]=192|s>>>6,e[h++]=128|63&s):s<65536?(e[h++]=224|s>>>12,e[h++]=128|s>>>6&63,e[h++]=128|63&s):(e[h++]=240|s>>>18,e[h++]=128|s>>>12&63,e[h++]=128|s>>>6&63,e[h++]=128|63&s);return e},e.buf2binstring=function(t){return n(t,t.length)},e.binstring2buf=function(t){for(var e=new i.Buf8(t.length),s=0,r=e.length;s<r;s++)e[s]=t.charCodeAt(s);return e},e.buf2string=function(t,e){var s,i,r,a,o=e||t.length,c=new Array(2*o);for(i=0,s=0;s<o;)if((r=t[s++])<128)c[i++]=r;else if((a=h[r])>4)c[i++]=65533,s+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&s<o;)r=r<<6|63&t[s++],a--;a>1?c[i++]=65533:r<65536?c[i++]=r:(r-=65536,c[i++]=55296|r>>10&1023,c[i++]=56320|1023&r)}return n(c,i)},e.utf8border=function(t,e){var s;for((e=e||t.length)>t.length&&(e=t.length),s=e-1;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+h[t[s]]>e?s:e}},69:t=>{t.exports=function(t,e,s,i){for(var r=65535&t|0,a=t>>>16&65535|0,h=0;0!==s;){s-=h=s>2e3?2e3:s;do{a=a+(r=r+e[i++]|0)|0}while(--h);r%=65521,a%=65521}return r|a<<16|0}},619:t=>{t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},869:t=>{var e=function(){for(var t,e=[],s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e}();t.exports=function(t,s,i,r){var a=e,h=r+i;t^=-1;for(var o=r;o<h;o++)t=t>>>8^a[255&(t^s[o])];return-1^t}},405:(t,e,s)=>{var i,r=s(236),a=s(342),h=s(69),o=s(869),n=s(898),c=-2,d=258,l=262,m=103,u=113,g=666;function p(t,e){return t.msg=n[e],e}function C(t){return(t<<1)-(t>4?9:0)}function k(t){for(var e=t.length;--e>=0;)t[e]=0}function b(t){var e=t.state,s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(r.arraySet(t.output,e.pending_buf,e.pending_out,s,t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))}function S(t,e){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,b(t.strm)}function R(t,e){t.pending_buf[t.pending++]=e}function f(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function y(t,e){var s,i,r=t.max_chain_length,a=t.strstart,h=t.prev_length,o=t.nice_match,n=t.strstart>t.w_size-l?t.strstart-(t.w_size-l):0,c=t.window,m=t.w_mask,u=t.prev,g=t.strstart+d,p=c[a+h-1],C=c[a+h];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(c[(s=e)+h]===C&&c[s+h-1]===p&&c[s]===c[a]&&c[++s]===c[a+1]){a+=2,s++;do{}while(c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&a<g);if(i=d-(g-a),a=g-d,i>h){if(t.match_start=e,h=i,i>=o)break;p=c[a+h-1],C=c[a+h]}}}while((e=u[e&m])>n&&0!=--r);return h<=t.lookahead?h:t.lookahead}function A(t){var e,s,i,a,n,c,d,m,u,g,p=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-l)){r.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=s=t.hash_size;do{i=t.head[--e],t.head[e]=i>=p?i-p:0}while(--s);e=s=p;do{i=t.prev[--e],t.prev[e]=i>=p?i-p:0}while(--s);a+=p}if(0===t.strm.avail_in)break;if(c=t.strm,d=t.window,m=t.strstart+t.lookahead,u=a,g=void 0,(g=c.avail_in)>u&&(g=u),s=0===g?0:(c.avail_in-=g,r.arraySet(d,c.input,c.next_in,g,m),1===c.state.wrap?c.adler=h(c.adler,d,g,m):2===c.state.wrap&&(c.adler=o(c.adler,d,g,m)),c.next_in+=g,c.total_in+=g,g),t.lookahead+=s,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=(t.ins_h<<t.hash_shift^t.window[n+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[n+3-1])&t.hash_mask,t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<l&&0!==t.strm.avail_in)}function v(t,e){for(var s,i;;){if(t.lookahead<l){if(A(t),t.lookahead<l&&0===e)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-l&&(t.match_length=y(t,s)),t.match_length>=3)if(i=a._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(S(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(S(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(S(t,!1),0===t.strm.avail_out)?1:2}function B(t,e){for(var s,i,r;;){if(t.lookahead<l){if(A(t),t.lookahead<l&&0===e)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-l&&(t.match_length=y(t,s),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(S(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=a._tr_tally(t,0,t.window[t.strstart-1]))&&S(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(S(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(S(t,!1),0===t.strm.avail_out)?1:2}function I(t,e,s,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=i,this.func=r}function D(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:u,t.adler=2===e.wrap?0:1,e.last_flush=0,a._tr_init(e),0):p(t,c)}function w(t){var e,s=M(t);return 0===s&&((e=t.state).window_size=2*e.w_size,k(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),s}function x(t,e,s,i,a,h){if(!t)return c;var o=1;if(-1===e&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>9||8!==s||i<8||i>15||e<0||e>9||h<0||h>4)return p(t,c);8===i&&(i=9);var n=new D;return t.state=n,n.strm=t,n.wrap=o,n.gzhead=null,n.w_bits=i,n.w_size=1<<n.w_bits,n.w_mask=n.w_size-1,n.hash_bits=a+7,n.hash_size=1<<n.hash_bits,n.hash_mask=n.hash_size-1,n.hash_shift=~~((n.hash_bits+3-1)/3),n.window=new r.Buf8(2*n.w_size),n.head=new r.Buf16(n.hash_size),n.prev=new r.Buf16(n.w_size),n.lit_bufsize=1<<a+6,n.pending_buf_size=4*n.lit_bufsize,n.pending_buf=new r.Buf8(n.pending_buf_size),n.d_buf=1*n.lit_bufsize,n.l_buf=3*n.lit_bufsize,n.level=e,n.strategy=h,n.method=s,w(t)}i=[new I(0,0,0,0,(function(t,e){var s=65535;for(s>t.pending_buf_size-5&&(s=t.pending_buf_size-5);;){if(t.lookahead<=1){if(A(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+s;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,S(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-l&&(S(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(S(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(S(t,!1),t.strm.avail_out),1)})),new I(4,4,8,4,v),new I(4,5,16,8,v),new I(4,6,32,32,v),new I(4,4,16,16,B),new I(8,16,32,32,B),new I(8,16,128,128,B),new I(8,32,128,256,B),new I(32,128,258,1024,B),new I(32,258,258,4096,B)],e.deflateInit=function(t,e){return x(t,e,8,15,8,0)},e.deflateInit2=x,e.deflateReset=w,e.deflateResetKeep=M,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?c:(t.state.gzhead=e,0):c},e.deflate=function(t,e){var s,r,h,n;if(!t||!t.state||e>5||e<0)return t?p(t,c):c;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===g&&4!==e)return p(t,0===t.avail_out?-5:c);if(r.strm=t,s=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,R(r,31),R(r,139),R(r,8),r.gzhead?(R(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),R(r,255&r.gzhead.time),R(r,r.gzhead.time>>8&255),R(r,r.gzhead.time>>16&255),R(r,r.gzhead.time>>24&255),R(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),R(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(R(r,255&r.gzhead.extra.length),R(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(R(r,0),R(r,0),R(r,0),R(r,0),R(r,0),R(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),R(r,3),r.status=u);else{var l=8+(r.w_bits-8<<4)<<8;l|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(l|=32),l+=31-l%31,r.status=u,f(r,l),0!==r.strstart&&(f(r,t.adler>>>16),f(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(h=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),b(t),h=r.pending,r.pending!==r.pending_buf_size));)R(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){h=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),b(t),h=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,R(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),0===n&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){h=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),b(t),h=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,R(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),0===n&&(r.status=m)}else r.status=m;if(r.status===m&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&b(t),r.pending+2<=r.pending_buf_size&&(R(r,255&t.adler),R(r,t.adler>>8&255),t.adler=0,r.status=u)):r.status=u),0!==r.pending){if(b(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&C(e)<=C(s)&&4!==e)return p(t,-5);if(r.status===g&&0!==t.avail_in)return p(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&r.status!==g){var y=2===r.strategy?function(t,e){for(var s;;){if(0===t.lookahead&&(A(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(S(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(S(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(S(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var s,i,r,h,o=t.window;;){if(t.lookahead<=d){if(A(t),t.lookahead<=d&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=o[r=t.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){h=t.strstart+d;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<h);t.match_length=d-(h-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(s=a._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(S(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(S(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(S(t,!1),0===t.strm.avail_out)?1:2}(r,e):i[r.level].func(r,e);if(3!==y&&4!==y||(r.status=g),1===y||3===y)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===y&&(1===e?a._tr_align(r):5!==e&&(a._tr_stored_block(r,0,0,!1),3===e&&(k(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),b(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(R(r,255&t.adler),R(r,t.adler>>8&255),R(r,t.adler>>16&255),R(r,t.adler>>24&255),R(r,255&t.total_in),R(r,t.total_in>>8&255),R(r,t.total_in>>16&255),R(r,t.total_in>>24&255)):(f(r,t.adler>>>16),f(r,65535&t.adler)),b(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&e!==m&&e!==u&&e!==g?p(t,c):(t.state=null,e===u?p(t,-3):0):c},e.deflateSetDictionary=function(t,e){var s,i,a,o,n,d,l,m,u=e.length;if(!t||!t.state)return c;if(2===(o=(s=t.state).wrap)||1===o&&42!==s.status||s.lookahead)return c;for(1===o&&(t.adler=h(t.adler,e,u,0)),s.wrap=0,u>=s.w_size&&(0===o&&(k(s.head),s.strstart=0,s.block_start=0,s.insert=0),m=new r.Buf8(s.w_size),r.arraySet(m,e,u-s.w_size,s.w_size,0),e=m,u=s.w_size),n=t.avail_in,d=t.next_in,l=t.input,t.avail_in=u,t.next_in=0,t.input=e,A(s);s.lookahead>=3;){i=s.strstart,a=s.lookahead-2;do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[i+3-1])&s.hash_mask,s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++}while(--a);s.strstart=i,s.lookahead=2,A(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=d,t.input=l,t.avail_in=n,s.wrap=o,0},e.deflateInfo="pako deflate (from Nodeca project)"},401:t=>{t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},264:t=>{t.exports=function(t,e){var s,i,r,a,h,o,n,c,d,l,m,u,g,p,C,k,b,S,R,f,y,A,v,B,I;s=t.state,i=t.next_in,B=t.input,r=i+(t.avail_in-5),a=t.next_out,I=t.output,h=a-(e-t.avail_out),o=a+(t.avail_out-257),n=s.dmax,c=s.wsize,d=s.whave,l=s.wnext,m=s.window,u=s.hold,g=s.bits,p=s.lencode,C=s.distcode,k=(1<<s.lenbits)-1,b=(1<<s.distbits)-1;t:do{g<15&&(u+=B[i++]<<g,g+=8,u+=B[i++]<<g,g+=8),S=p[u&k];e:for(;;){if(u>>>=R=S>>>24,g-=R,0==(R=S>>>16&255))I[a++]=65535&S;else{if(!(16&R)){if(0==(64&R)){S=p[(65535&S)+(u&(1<<R)-1)];continue e}if(32&R){s.mode=12;break t}t.msg="invalid literal/length code",s.mode=30;break t}f=65535&S,(R&=15)&&(g<R&&(u+=B[i++]<<g,g+=8),f+=u&(1<<R)-1,u>>>=R,g-=R),g<15&&(u+=B[i++]<<g,g+=8,u+=B[i++]<<g,g+=8),S=C[u&b];s:for(;;){if(u>>>=R=S>>>24,g-=R,!(16&(R=S>>>16&255))){if(0==(64&R)){S=C[(65535&S)+(u&(1<<R)-1)];continue s}t.msg="invalid distance code",s.mode=30;break t}if(y=65535&S,g<(R&=15)&&(u+=B[i++]<<g,(g+=8)<R&&(u+=B[i++]<<g,g+=8)),(y+=u&(1<<R)-1)>n){t.msg="invalid distance too far back",s.mode=30;break t}if(u>>>=R,g-=R,y>(R=a-h)){if((R=y-R)>d&&s.sane){t.msg="invalid distance too far back",s.mode=30;break t}if(A=0,v=m,0===l){if(A+=c-R,R<f){f-=R;do{I[a++]=m[A++]}while(--R);A=a-y,v=I}}else if(l<R){if(A+=c+l-R,(R-=l)<f){f-=R;do{I[a++]=m[A++]}while(--R);if(A=0,l<f){f-=R=l;do{I[a++]=m[A++]}while(--R);A=a-y,v=I}}}else if(A+=l-R,R<f){f-=R;do{I[a++]=m[A++]}while(--R);A=a-y,v=I}for(;f>2;)I[a++]=v[A++],I[a++]=v[A++],I[a++]=v[A++],f-=3;f&&(I[a++]=v[A++],f>1&&(I[a++]=v[A++]))}else{A=a-y;do{I[a++]=I[A++],I[a++]=I[A++],I[a++]=I[A++],f-=3}while(f>2);f&&(I[a++]=I[A++],f>1&&(I[a++]=I[A++]))}break}}break}}while(i<r&&a<o);i-=f=g>>3,u&=(1<<(g-=f<<3))-1,t.next_in=i,t.next_out=a,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=a<o?o-a+257:257-(a-o),s.hold=u,s.bits=g}},948:(t,e,s)=>{var i=s(236),r=s(69),a=s(869),h=s(264),o=s(241),n=-2,c=12,d=30;function l(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(852),e.distcode=e.distdyn=new i.Buf32(592),e.sane=1,e.back=-1,0):n}function g(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,u(t)):n}function p(t,e){var s,i;return t&&t.state?(i=t.state,e<0?(s=0,e=-e):(s=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?n:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=s,i.wbits=e,g(t))):n}function C(t,e){var s,i;return t?(i=new m,t.state=i,i.window=null,0!==(s=p(t,e))&&(t.state=null),s):n}var k,b,S=!0;function R(t){if(S){var e;for(k=new i.Buf32(512),b=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(1,t.lens,0,288,k,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(2,t.lens,0,32,b,0,t.work,{bits:5}),S=!1}t.lencode=k,t.lenbits=9,t.distcode=b,t.distbits=5}function f(t,e,s,r){var a,h=t.state;return null===h.window&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new i.Buf8(h.wsize)),r>=h.wsize?(i.arraySet(h.window,e,s-h.wsize,h.wsize,0),h.wnext=0,h.whave=h.wsize):((a=h.wsize-h.wnext)>r&&(a=r),i.arraySet(h.window,e,s-r,a,h.wnext),(r-=a)?(i.arraySet(h.window,e,s-r,r,0),h.wnext=r,h.whave=h.wsize):(h.wnext+=a,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=a))),0}e.inflateReset=g,e.inflateReset2=p,e.inflateResetKeep=u,e.inflateInit=function(t){return C(t,15)},e.inflateInit2=C,e.inflate=function(t,e){var s,m,u,g,p,C,k,b,S,y,A,v,B,I,D,M,w,x,_,O,N,F,P,W,$=0,E=new i.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return n;(s=t.state).mode===c&&(s.mode=13),p=t.next_out,u=t.output,k=t.avail_out,g=t.next_in,m=t.input,C=t.avail_in,b=s.hold,S=s.bits,y=C,A=k,F=0;t:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;S<16;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(2&s.wrap&&35615===b){s.check=0,E[0]=255&b,E[1]=b>>>8&255,s.check=a(s.check,E,2,0),b=0,S=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&b)<<8)+(b>>8))%31){t.msg="incorrect header check",s.mode=d;break}if(8!=(15&b)){t.msg="unknown compression method",s.mode=d;break}if(S-=4,N=8+(15&(b>>>=4)),0===s.wbits)s.wbits=N;else if(N>s.wbits){t.msg="invalid window size",s.mode=d;break}s.dmax=1<<N,t.adler=s.check=1,s.mode=512&b?10:c,b=0,S=0;break;case 2:for(;S<16;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(s.flags=b,8!=(255&s.flags)){t.msg="unknown compression method",s.mode=d;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=d;break}s.head&&(s.head.text=b>>8&1),512&s.flags&&(E[0]=255&b,E[1]=b>>>8&255,s.check=a(s.check,E,2,0)),b=0,S=0,s.mode=3;case 3:for(;S<32;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}s.head&&(s.head.time=b),512&s.flags&&(E[0]=255&b,E[1]=b>>>8&255,E[2]=b>>>16&255,E[3]=b>>>24&255,s.check=a(s.check,E,4,0)),b=0,S=0,s.mode=4;case 4:for(;S<16;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}s.head&&(s.head.xflags=255&b,s.head.os=b>>8),512&s.flags&&(E[0]=255&b,E[1]=b>>>8&255,s.check=a(s.check,E,2,0)),b=0,S=0,s.mode=5;case 5:if(1024&s.flags){for(;S<16;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}s.length=b,s.head&&(s.head.extra_len=b),512&s.flags&&(E[0]=255&b,E[1]=b>>>8&255,s.check=a(s.check,E,2,0)),b=0,S=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&((v=s.length)>C&&(v=C),v&&(s.head&&(N=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),i.arraySet(s.head.extra,m,g,v,N)),512&s.flags&&(s.check=a(s.check,m,v,g)),C-=v,g+=v,s.length-=v),s.length))break t;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===C)break t;v=0;do{N=m[g+v++],s.head&&N&&s.length<65536&&(s.head.name+=String.fromCharCode(N))}while(N&&v<C);if(512&s.flags&&(s.check=a(s.check,m,v,g)),C-=v,g+=v,N)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===C)break t;v=0;do{N=m[g+v++],s.head&&N&&s.length<65536&&(s.head.comment+=String.fromCharCode(N))}while(N&&v<C);if(512&s.flags&&(s.check=a(s.check,m,v,g)),C-=v,g+=v,N)break t}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;S<16;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(b!==(65535&s.check)){t.msg="header crc mismatch",s.mode=d;break}b=0,S=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=c;break;case 10:for(;S<32;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}t.adler=s.check=l(b),b=0,S=0,s.mode=11;case 11:if(0===s.havedict)return t.next_out=p,t.avail_out=k,t.next_in=g,t.avail_in=C,s.hold=b,s.bits=S,2;t.adler=s.check=1,s.mode=c;case c:if(5===e||6===e)break t;case 13:if(s.last){b>>>=7&S,S-=7&S,s.mode=27;break}for(;S<3;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}switch(s.last=1&b,S-=1,3&(b>>>=1)){case 0:s.mode=14;break;case 1:if(R(s),s.mode=20,6===e){b>>>=2,S-=2;break t}break;case 2:s.mode=17;break;case 3:t.msg="invalid block type",s.mode=d}b>>>=2,S-=2;break;case 14:for(b>>>=7&S,S-=7&S;S<32;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if((65535&b)!=(b>>>16^65535)){t.msg="invalid stored block lengths",s.mode=d;break}if(s.length=65535&b,b=0,S=0,s.mode=15,6===e)break t;case 15:s.mode=16;case 16:if(v=s.length){if(v>C&&(v=C),v>k&&(v=k),0===v)break t;i.arraySet(u,m,g,v,p),C-=v,g+=v,k-=v,p+=v,s.length-=v;break}s.mode=c;break;case 17:for(;S<14;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(s.nlen=257+(31&b),b>>>=5,S-=5,s.ndist=1+(31&b),b>>>=5,S-=5,s.ncode=4+(15&b),b>>>=4,S-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=d;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;S<3;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}s.lens[T[s.have++]]=7&b,b>>>=3,S-=3}for(;s.have<19;)s.lens[T[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,P={bits:s.lenbits},F=o(0,s.lens,0,19,s.lencode,0,s.work,P),s.lenbits=P.bits,F){t.msg="invalid code lengths set",s.mode=d;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;M=($=s.lencode[b&(1<<s.lenbits)-1])>>>16&255,w=65535&$,!((D=$>>>24)<=S);){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(w<16)b>>>=D,S-=D,s.lens[s.have++]=w;else{if(16===w){for(W=D+2;S<W;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(b>>>=D,S-=D,0===s.have){t.msg="invalid bit length repeat",s.mode=d;break}N=s.lens[s.have-1],v=3+(3&b),b>>>=2,S-=2}else if(17===w){for(W=D+3;S<W;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}S-=D,N=0,v=3+(7&(b>>>=D)),b>>>=3,S-=3}else{for(W=D+7;S<W;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}S-=D,N=0,v=11+(127&(b>>>=D)),b>>>=7,S-=7}if(s.have+v>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=d;break}for(;v--;)s.lens[s.have++]=N}}if(s.mode===d)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=d;break}if(s.lenbits=9,P={bits:s.lenbits},F=o(1,s.lens,0,s.nlen,s.lencode,0,s.work,P),s.lenbits=P.bits,F){t.msg="invalid literal/lengths set",s.mode=d;break}if(s.distbits=6,s.distcode=s.distdyn,P={bits:s.distbits},F=o(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,P),s.distbits=P.bits,F){t.msg="invalid distances set",s.mode=d;break}if(s.mode=20,6===e)break t;case 20:s.mode=21;case 21:if(C>=6&&k>=258){t.next_out=p,t.avail_out=k,t.next_in=g,t.avail_in=C,s.hold=b,s.bits=S,h(t,A),p=t.next_out,u=t.output,k=t.avail_out,g=t.next_in,m=t.input,C=t.avail_in,b=s.hold,S=s.bits,s.mode===c&&(s.back=-1);break}for(s.back=0;M=($=s.lencode[b&(1<<s.lenbits)-1])>>>16&255,w=65535&$,!((D=$>>>24)<=S);){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(M&&0==(240&M)){for(x=D,_=M,O=w;M=($=s.lencode[O+((b&(1<<x+_)-1)>>x)])>>>16&255,w=65535&$,!(x+(D=$>>>24)<=S);){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}b>>>=x,S-=x,s.back+=x}if(b>>>=D,S-=D,s.back+=D,s.length=w,0===M){s.mode=26;break}if(32&M){s.back=-1,s.mode=c;break}if(64&M){t.msg="invalid literal/length code",s.mode=d;break}s.extra=15&M,s.mode=22;case 22:if(s.extra){for(W=s.extra;S<W;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}s.length+=b&(1<<s.extra)-1,b>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;M=($=s.distcode[b&(1<<s.distbits)-1])>>>16&255,w=65535&$,!((D=$>>>24)<=S);){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(0==(240&M)){for(x=D,_=M,O=w;M=($=s.distcode[O+((b&(1<<x+_)-1)>>x)])>>>16&255,w=65535&$,!(x+(D=$>>>24)<=S);){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}b>>>=x,S-=x,s.back+=x}if(b>>>=D,S-=D,s.back+=D,64&M){t.msg="invalid distance code",s.mode=d;break}s.offset=w,s.extra=15&M,s.mode=24;case 24:if(s.extra){for(W=s.extra;S<W;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}s.offset+=b&(1<<s.extra)-1,b>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=d;break}s.mode=25;case 25:if(0===k)break t;if(v=A-k,s.offset>v){if((v=s.offset-v)>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=d;break}v>s.wnext?(v-=s.wnext,B=s.wsize-v):B=s.wnext-v,v>s.length&&(v=s.length),I=s.window}else I=u,B=p-s.offset,v=s.length;v>k&&(v=k),k-=v,s.length-=v;do{u[p++]=I[B++]}while(--v);0===s.length&&(s.mode=21);break;case 26:if(0===k)break t;u[p++]=s.length,k--,s.mode=21;break;case 27:if(s.wrap){for(;S<32;){if(0===C)break t;C--,b|=m[g++]<<S,S+=8}if(A-=k,t.total_out+=A,s.total+=A,A&&(t.adler=s.check=s.flags?a(s.check,u,A,p-A):r(s.check,u,A,p-A)),A=k,(s.flags?b:l(b))!==s.check){t.msg="incorrect data check",s.mode=d;break}b=0,S=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;S<32;){if(0===C)break t;C--,b+=m[g++]<<S,S+=8}if(b!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=d;break}b=0,S=0}s.mode=29;case 29:F=1;break t;case d:F=-3;break t;case 31:return-4;case 32:default:return n}return t.next_out=p,t.avail_out=k,t.next_in=g,t.avail_in=C,s.hold=b,s.bits=S,(s.wsize||A!==t.avail_out&&s.mode<d&&(s.mode<27||4!==e))&&f(t,t.output,t.next_out,A-t.avail_out)?(s.mode=31,-4):(y-=t.avail_in,A-=t.avail_out,t.total_in+=y,t.total_out+=A,s.total+=A,s.wrap&&A&&(t.adler=s.check=s.flags?a(s.check,u,A,t.next_out-A):r(s.check,u,A,t.next_out-A)),t.data_type=s.bits+(s.last?64:0)+(s.mode===c?128:0)+(20===s.mode||15===s.mode?256:0),(0===y&&0===A||4===e)&&0===F&&(F=-5),F)},e.inflateEnd=function(t){if(!t||!t.state)return n;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var s;return t&&t.state?0==(2&(s=t.state).wrap)?n:(s.head=e,e.done=!1,0):n},e.inflateSetDictionary=function(t,e){var s,i=e.length;return t&&t.state?0!==(s=t.state).wrap&&11!==s.mode?n:11===s.mode&&r(1,e,i,0)!==s.check?-3:f(t,e,i,i)?(s.mode=31,-4):(s.havedict=1,0):n},e.inflateInfo="pako inflate (from Nodeca project)"},241:(t,e,s)=>{var i=s(236),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,s,n,c,d,l,m){var u,g,p,C,k,b,S,R,f,y=m.bits,A=0,v=0,B=0,I=0,D=0,M=0,w=0,x=0,_=0,O=0,N=null,F=0,P=new i.Buf16(16),W=new i.Buf16(16),$=null,E=0;for(A=0;A<=15;A++)P[A]=0;for(v=0;v<n;v++)P[e[s+v]]++;for(D=y,I=15;I>=1&&0===P[I];I--);if(D>I&&(D=I),0===I)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(B=1;B<I&&0===P[B];B++);for(D<B&&(D=B),x=1,A=1;A<=15;A++)if(x<<=1,(x-=P[A])<0)return-1;if(x>0&&(0===t||1!==I))return-1;for(W[1]=0,A=1;A<15;A++)W[A+1]=W[A]+P[A];for(v=0;v<n;v++)0!==e[s+v]&&(l[W[e[s+v]]++]=v);if(0===t?(N=$=l,b=19):1===t?(N=r,F-=257,$=a,E-=257,b=256):(N=h,$=o,b=-1),O=0,v=0,A=B,k=d,M=D,w=0,p=-1,C=(_=1<<D)-1,1===t&&_>852||2===t&&_>592)return 1;for(;;){S=A-w,l[v]<b?(R=0,f=l[v]):l[v]>b?(R=$[E+l[v]],f=N[F+l[v]]):(R=96,f=0),u=1<<A-w,B=g=1<<M;do{c[k+(O>>w)+(g-=u)]=S<<24|R<<16|f|0}while(0!==g);for(u=1<<A-1;O&u;)u>>=1;if(0!==u?(O&=u-1,O+=u):O=0,v++,0==--P[A]){if(A===I)break;A=e[s+l[v]]}if(A>D&&(O&C)!==p){for(0===w&&(w=D),k+=B,x=1<<(M=A-w);M+w<I&&!((x-=P[M+w])<=0);)M++,x<<=1;if(_+=1<<M,1===t&&_>852||2===t&&_>592)return 1;c[p=O&C]=D<<24|M<<16|k-d|0}}return 0!==O&&(c[k+O]=A-w<<24|64<<16|0),m.bits=D,0}},898:t=>{t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},342:(t,e,s)=>{var i=s(236);function r(t){for(var e=t.length;--e>=0;)t[e]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],h=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],n=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);r(c);var d=new Array(60);r(d);var l=new Array(512);r(l);var m=new Array(256);r(m);var u=new Array(29);r(u);var g,p,C,k=new Array(30);function b(t,e,s,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function S(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function R(t){return t<256?l[t]:l[256+(t>>>7)]}function f(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function y(t,e,s){t.bi_valid>16-s?(t.bi_buf|=e<<t.bi_valid&65535,f(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)}function A(t,e,s){y(t,s[2*e],s[2*e+1])}function v(t,e){var s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1}function B(t,e,s){var i,r,a=new Array(16),h=0;for(i=1;i<=15;i++)a[i]=h=h+s[i-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=v(a[o]++,o))}}function I(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function D(t){t.bi_valid>8?f(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function M(t,e,s,i){var r=2*e,a=2*s;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[s]}function w(t,e,s){for(var i=t.heap[s],r=s<<1;r<=t.heap_len&&(r<t.heap_len&&M(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!M(e,i,t.heap[r],t.depth));)t.heap[s]=t.heap[r],s=r,r<<=1;t.heap[s]=i}function x(t,e,s){var i,r,o,n,c=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],r=t.pending_buf[t.l_buf+c],c++,0===i?A(t,r,e):(A(t,(o=m[r])+256+1,e),0!==(n=a[o])&&y(t,r-=u[o],n),A(t,o=R(--i),s),0!==(n=h[o])&&y(t,i-=k[o],n))}while(c<t.last_lit);A(t,256,e)}function _(t,e){var s,i,r,a=e.dyn_tree,h=e.stat_desc.static_tree,o=e.stat_desc.has_stree,n=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<n;s++)0!==a[2*s]?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):a[2*s+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=h[2*r+1]);for(e.max_code=c,s=t.heap_len>>1;s>=1;s--)w(t,a,s);r=n;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],w(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=i,a[2*r]=a[2*s]+a[2*i],t.depth[r]=(t.depth[s]>=t.depth[i]?t.depth[s]:t.depth[i])+1,a[2*s+1]=a[2*i+1]=r,t.heap[1]=r++,w(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var s,i,r,a,h,o,n=e.dyn_tree,c=e.max_code,d=e.stat_desc.static_tree,l=e.stat_desc.has_stree,m=e.stat_desc.extra_bits,u=e.stat_desc.extra_base,g=e.stat_desc.max_length,p=0;for(a=0;a<=15;a++)t.bl_count[a]=0;for(n[2*t.heap[t.heap_max]+1]=0,s=t.heap_max+1;s<573;s++)(a=n[2*n[2*(i=t.heap[s])+1]+1]+1)>g&&(a=g,p++),n[2*i+1]=a,i>c||(t.bl_count[a]++,h=0,i>=u&&(h=m[i-u]),o=n[2*i],t.opt_len+=o*(a+h),l&&(t.static_len+=o*(d[2*i+1]+h)));if(0!==p){do{for(a=g-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[g]--,p-=2}while(p>0);for(a=g;0!==a;a--)for(i=t.bl_count[a];0!==i;)(r=t.heap[--s])>c||(n[2*r+1]!==a&&(t.opt_len+=(a-n[2*r+1])*n[2*r],n[2*r+1]=a),i--)}}(t,e),B(a,c,t.bl_count)}function O(t,e,s){var i,r,a=-1,h=e[1],o=0,n=7,c=4;for(0===h&&(n=138,c=3),e[2*(s+1)+1]=65535,i=0;i<=s;i++)r=h,h=e[2*(i+1)+1],++o<n&&r===h||(o<c?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,a=r,0===h?(n=138,c=3):r===h?(n=6,c=3):(n=7,c=4))}function N(t,e,s){var i,r,a=-1,h=e[1],o=0,n=7,c=4;for(0===h&&(n=138,c=3),i=0;i<=s;i++)if(r=h,h=e[2*(i+1)+1],!(++o<n&&r===h)){if(o<c)do{A(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(A(t,r,t.bl_tree),o--),A(t,16,t.bl_tree),y(t,o-3,2)):o<=10?(A(t,17,t.bl_tree),y(t,o-3,3)):(A(t,18,t.bl_tree),y(t,o-11,7));o=0,a=r,0===h?(n=138,c=3):r===h?(n=6,c=3):(n=7,c=4)}}r(k);var F=!1;function P(t,e,s,r){y(t,0+(r?1:0),3),function(t,e,s,r){D(t),f(t,s),f(t,~s),i.arraySet(t.pending_buf,t.window,e,s,t.pending),t.pending+=s}(t,e,s)}e._tr_init=function(t){F||(function(){var t,e,s,i,r,n=new Array(16);for(s=0,i=0;i<28;i++)for(u[i]=s,t=0;t<1<<a[i];t++)m[s++]=i;for(m[s-1]=i,r=0,i=0;i<16;i++)for(k[i]=r,t=0;t<1<<h[i];t++)l[r++]=i;for(r>>=7;i<30;i++)for(k[i]=r<<7,t=0;t<1<<h[i]-7;t++)l[256+r++]=i;for(e=0;e<=15;e++)n[e]=0;for(t=0;t<=143;)c[2*t+1]=8,t++,n[8]++;for(;t<=255;)c[2*t+1]=9,t++,n[9]++;for(;t<=279;)c[2*t+1]=7,t++,n[7]++;for(;t<=287;)c[2*t+1]=8,t++,n[8]++;for(B(c,287,n),t=0;t<30;t++)d[2*t+1]=5,d[2*t]=v(t,5);g=new b(c,a,257,286,15),p=new b(d,h,0,30,15),C=new b(new Array(0),o,0,19,7)}(),F=!0),t.l_desc=new S(t.dyn_ltree,g),t.d_desc=new S(t.dyn_dtree,p),t.bl_desc=new S(t.bl_tree,C),t.bi_buf=0,t.bi_valid=0,I(t)},e._tr_stored_block=P,e._tr_flush_block=function(t,e,s,i){var r,a,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),_(t,t.l_desc),_(t,t.d_desc),h=function(t){var e;for(O(t,t.dyn_ltree,t.l_desc.max_code),O(t,t.dyn_dtree,t.d_desc.max_code),_(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*n[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=s+5,s+4<=r&&-1!==e?P(t,e,s,i):4===t.strategy||a===r?(y(t,2+(i?1:0),3),x(t,c,d)):(y(t,4+(i?1:0),3),function(t,e,s,i){var r;for(y(t,e-257,5),y(t,s-1,5),y(t,i-4,4),r=0;r<i;r++)y(t,t.bl_tree[2*n[r]+1],3);N(t,t.dyn_ltree,e-1),N(t,t.dyn_dtree,s-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),x(t,t.dyn_ltree,t.dyn_dtree)),I(t),i&&D(t)},e._tr_tally=function(t,e,s){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&s,t.last_lit++,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(m[s]+256+1)]++,t.dyn_dtree[2*R(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){y(t,2,3),A(t,256,c),function(t){16===t.bi_valid?(f(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},292:t=>{t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}(()=>{const t=s(823),e=self;new t.EmulatorWorker(e)})()})();
//# sourceMappingURL=emulator-worker.js.map