(()=>{"use strict";var e,t,i={830:(e,t,i)=>{var s,r,a,h,c,n;i.d(t,{VQ:()=>s}),function(e){e.Cpu186="Cpu186",e.Cpu386="Cpu386"}(s||(s={})),function(e){e[e.RegToRm=0]="RegToRm",e[e.RmToReg=1]="RmToReg"}(r||(r={})),function(e){e[e.None=0]="None",e[e.RepZ=1]="RepZ",e[e.RepNz=2]="RepNz"}(a||(a={})),function(e){e[e.Real=0]="Real",e[e.Protected=1]="Protected",e[e.Virtual8086=2]="Virtual8086"}(h||(h={})),function(e){e[e.Read=0]="Read",e[e.Write=1]="Write"}(c||(c={})),function(e){e[e.DE=0]="DE",e[e.DB=1]="DB",e[e.BP=3]="BP",e[e.OF=4]="OF",e[e.BR=5]="BR",e[e.UD=6]="UD",e[e.NM=7]="NM",e[e.DF=8]="DF",e[e.TS=10]="TS",e[e.NP=11]="NP",e[e.SS=12]="SS",e[e.GP=13]="GP",e[e.PF=14]="PF",e[e.MF=16]="MF",e[e.AC=17]="AC",e[e.MC=18]="MC",e[e.XF=19]="XF",e[e.VE=20]="VE",e[e.SX=30]="SX"}(n||(n={}))},22:(e,t,i)=>{i.d(t,{Zr:()=>h,wf:()=>s});var s,r,a=i(830);!function(e){e.MDA="MDA",e.Hercules="Hercules",e.CGA="CGA",e.EGA="EGA",e.VGA="VGA"}(s||(s={})),function(e){e.None="None",e.NotConnected="NotConnected",e.EmulatedMouse="EmulatedMouse"}(r||(r={}));class h{static get monochromeGraphics(){return this.graphicsAdapterType==s.MDA||this.graphicsAdapterType==s.Hercules}}Object.defineProperty(h,"cpuType",{enumerable:!0,configurable:!0,writable:!0,value:a.VQ.Cpu186}),Object.defineProperty(h,"cpuFrequency",{enumerable:!0,configurable:!0,writable:!0,value:4770}),Object.defineProperty(h,"ramAmount",{enumerable:!0,configurable:!0,writable:!0,value:640}),Object.defineProperty(h,"floppyCount",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(h,"graphicsAdapterType",{enumerable:!0,configurable:!0,writable:!0,value:s.CGA}),Object.defineProperty(h,"enableHdController",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(h,"enableUma",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(h,"enableRtc",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(h,"com1Device",{enumerable:!0,configurable:!0,writable:!0,value:r.EmulatedMouse}),Object.defineProperty(h,"com1PortName",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(h,"com2Device",{enumerable:!0,configurable:!0,writable:!0,value:r.None}),Object.defineProperty(h,"com2PortName",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(h,"hdImageDir",{enumerable:!0,configurable:!0,writable:!0,value:"HdImages/"}),Object.defineProperty(h,"baseDir",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(h,"noScreenUpdateWhileRetrace",{enumerable:!0,configurable:!0,writable:!0,value:!0})},345:(e,t,i)=>{var s=i(22),r=i(897);class a extends r._0{constructor(){super(),Object.defineProperty(this,"charsetFile",{enumerable:!0,configurable:!0,writable:!0,value:"Fonts/mda.dat"}),Object.defineProperty(this,"charsetWidth",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"charsetHeight",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"charset",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"horRetrace",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"textHiColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"textColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"backgroundColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.startAddr=720896,this.setRamSize(4096),this.charWidth=9,this.charHeight=14,this.screenWidth=80*this.charWidth,this.screenHeight=25*this.charHeight,this.textColor=r.JX.fromRgb(50,205,50),this.textHiColor=r.JX.fromRgb(0,255,0),this.backgroundColor=r.JX.fromRgb(0,0,0)}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile"),this.ignoredFieldsUpdate.add("charset")}async loadCharSet(){await this.loadCharSetInternal(this.charset,this.charsetFile,this.charsetWidth,this.charsetHeight)}updateScreen(e,t){super.updateScreen(e,t);const i=this.screenWidth/this.charWidth,s=this.screenHeight/this.charHeight,a=new r.Cs(0,0,this.charWidth,this.charHeight),h=2*this.getCursorPos();let c=0;for(let r=0;r<s;r++)for(let s=0;s<i;s++){const i=this.ram[c+1],n=7&i,o=i>>4&7;let l=(8&i)>0?this.textHiColor:this.textColor,d=this.backgroundColor;if(0==n&&7==o){const e=l;l=d,d=e}const u=this.ram[c],b=this.charset[u],g=this.drawChar(u,b,l,d,1==n&&0==o,c==h&&this.cursorOn);a.x=s*this.charWidth,a.y=r*this.charHeight,this.writePixels(e,t,g,a),c+=2}}in(e){return 954===e?(this.horRetrace=1-this.horRetrace,255&(this.horRetrace|this.horRetrace<<3)):0}out(e,t,i){switch(e){case 948:this.setIndexRegister(255&t);break;case 949:this.setDataRegister(255&t)}}}var h,c=i(841);!function(e){e[e.None=0]="None",e[e.Text40x25=1]="Text40x25",e[e.Text80x25=2]="Text80x25",e[e.GraphicsLo=3]="GraphicsLo",e[e.GraphicsHi=4]="GraphicsHi"}(h||(h={}));class n extends c.c{constructor(){super(),Object.defineProperty(this,"charsetFile1",{enumerable:!0,configurable:!0,writable:!0,value:"Fonts/cga1.dat"}),Object.defineProperty(this,"charsetFile2",{enumerable:!0,configurable:!0,writable:!0,value:"Fonts/cga2.dat"}),Object.defineProperty(this,"charsetWidth",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"charsetHeight",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"horRetrace",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"colorSelectRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"modeControlRegister",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blackWhite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"charset1",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"charset2",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"activeCharsetNo",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.startAddr=753664,this.setRamSize(16384),this.charWidth=8,this.charHeight=8,this.activeCharsetNo=1,this.lineCount=200}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile1"),this.ignoredFields.add("charsetFile2"),this.ignoredFieldsUpdate.add("charset1"),this.ignoredFieldsUpdate.add("charset2")}modeChanged(){super.modeChanged(),this.calcRetraceValues(),this.charCache.clear()}getCharset(){return 0==this.activeCharsetNo?this.charset1:this.charset2}updateScreenGraphicsLo(e){const t=this.getCgaGraphicsColors(this.colorSelectRegister),i=new Uint32Array(e.buffer);let s=0,r=0,a=8192;for(let e=0;e<200;e++){let h=0==(1&e)?r:a;for(let e=0;e<320;e+=4){const e=this.ram[h];let r;r=t[e>>6],i[s++]=r.value,r=t[e>>4&3],i[s++]=r.value,r=t[e>>2&3],i[s++]=r.value,r=t[3&e],i[s++]=r.value,h++}e%2==0?r=h:a=h}}updateScreenGraphicsHi(e){const t=this.cgaColors[15&this.colorSelectRegister],i=new Uint32Array(e.buffer);let s=0,r=0,a=8192;for(let e=0;e<200;e++){let h=0==(1&e)?r:a;for(let e=0;e<640;e+=8){let e=this.ram[h];for(let r=0;r<8;r++)(128&e)>0&&(i[s]=t.value),s++,e<<=1;h++}e%2==0?r=h:a=h}}updateTextScreen(e,t,i,s,a,h){const c=new r.Cs(0,0,this.charWidth,this.charHeight),n=2*this.getCursorPos();let o=0;for(let r=0;r<a;r++,c.y+=this.charHeight){c.x=0;for(let r=0;r<s;r++,c.x+=this.charWidth){const s=this.ram[o+1],r=this.blink&&(128&s)>0,a=this.blink?h[s>>4&7]:h[s>>4];let l=h[15&s];r&&!this.cursorOn&&(l=a);const d=this.ram[o],u=i[d],b=this.drawChar(d,u,l,a,!1,o==n&&this.cursorOn);this.writePixels(e,t,b,c),o+=2}}}async loadCharSet(){await this.loadCharSetInternal(this.charset1,this.charsetFile1,this.charsetWidth,this.charsetHeight),await this.loadCharSetInternal(this.charset2,this.charsetFile2,this.charsetWidth,this.charsetHeight)}updateScreen(e,t){switch(super.updateScreen(e,t),this.mode){case h.Text40x25:this.updateTextScreen(e,t,this.getCharset(),40,25,this.cgaColors);break;case h.Text80x25:this.updateTextScreen(e,t,this.getCharset(),80,25,this.cgaColors);break;case h.GraphicsLo:this.updateScreenGraphicsLo(e);break;case h.GraphicsHi:this.updateScreenGraphicsHi(e)}}in(e){switch(e){case 977:case 979:case 981:case 983:return this.getDataRegister();case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister;case 986:{0==this.horRetrace&&(this.horRetrace=2),this.horRetrace--;let e=this.calcVertRetrace()?8:0;return e+=0==this.horRetrace?0:1,255&e}}return 0}out(e,t,i){switch(e){case 976:case 978:case 980:case 982:this.setIndexRegister(t);break;case 977:case 979:case 981:case 983:this.setDataRegister(t);break;case 984:{this.modeControlRegister=255&t,this.blink=(32&t)>0,this.blackWhite=(4&t)>0;const e=this.mode;switch(27&t){case 8:this.mode=h.Text40x25,this.screenWidth=320,this.screenHeight=200;break;case 9:this.mode=h.Text80x25,this.screenWidth=640,this.screenHeight=200;break;case 10:this.mode=h.GraphicsLo,this.screenWidth=320,this.screenHeight=200;break;case 26:this.mode=h.GraphicsHi,this.screenWidth=640,this.screenHeight=200}this.mode!=e&&this.modeChanged()}break;case 985:this.colorSelectRegister=255&t}}}var o,l,d,u,b,g=i(242);!function(e){e[e.None=0]="None",e[e.M00_CGA=1]="M00_CGA",e[e.M00_EGA=2]="M00_EGA",e[e.M02_CGA=3]="M02_CGA",e[e.M02_EGA=4]="M02_EGA",e[e.M04=5]="M04",e[e.M06=6]="M06",e[e.M07=7]="M07",e[e.M0D=8]="M0D",e[e.M0E=9]="M0E",e[e.M0F=10]="M0F",e[e.M10=11]="M10"}(o||(o={}));class p extends g.b{constructor(){super(),Object.defineProperty(this,"diagnosticCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"egaSwitches",{enumerable:!0,configurable:!0,writable:!0,value:[!1,!0,!0,!1]}),Object.defineProperty(this,"charWidth9Bits",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:o.None}),this.screenWidth=640,this.screenHeight=350,this.charBoxWidth=this.charWidth=8}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("egaSwitches")}in(e){switch(e){case 962:{let e=this.calcVertRetrace()?0:128;const t=this.miscOutputRegister>>2&3;return e+=this.egaSwitches[t]?0:16,e+=0,255&e}case 968:return 0;case 986:{this.attributeFlipFlop=!1;const e=this.calcRetraceEnable();let t=(e.vertRetrace?8:0)+(e.enable?0:1);return 4==++this.diagnosticCount&&(this.diagnosticCount=0),t+=this.diagnosticCount>1?48:0,255&t}default:return super.in(e)}}out(e,t,i){switch(e){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&t,this.attributeIndex){case 16:this.graphicsMode=(1&t)>0,this.monochrome=(2&t)>0,this.charWidth9Bits=(4&t)>0,this.blink=(8&t)>0;break;case 17:this.overscanColor=this.genColor(255&t);break;case 18:for(let e=0;e<this.colorPlaneEnabled.length;e++)this.colorPlaneEnabled[e]=(t&1<<e)>0;break;default:this.attributeIndex>=0&&this.attributeIndex<=15&&(this.egaPalette[this.attributeIndex]=this.genColor(255&t),this.cgaPalette[this.attributeIndex]=this.genCgaColor(255&t))}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&t,this.attributeFlipFlop=!this.attributeFlipFlop,i&&this.out(e,t>>8,!1);break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&t;break;case 2:this.mapMaskRegister=255&t,this.mapMask[0]=(1&t)>0,this.mapMask[1]=(2&t)>0,this.mapMask[2]=(4&t)>0,this.mapMask[3]=(8&t)>0;break;case 3:this.characterMapSelectRegister=255&t,this.characterMapA=t>>2&3,this.characterMapB=3&t;break;case 4:this.memoryModeRegister=255&t,this.oddEven=0==(4&t)}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&t);break;case 970:case 972:break;default:super.out(e,t,i)}}calcMode(){const e=this.mode,t=this.sequencerRegisters[1],i=this.sequencerRegisters[2],s=this.sequencerRegisters[4];11==t&&3==s?(35==this.miscOutputRegister&&(this.mode=o.M00_CGA),167==this.miscOutputRegister&&(this.mode=o.M00_EGA)):1==t&&3==s?(35==this.miscOutputRegister&&(this.mode=o.M02_CGA),167==this.miscOutputRegister&&(this.mode=o.M02_EGA)):11==t&&2==s?this.mode=o.M04:1==t&&6==s?35==this.miscOutputRegister?1==i?this.mode=o.M06:15==i&&(this.mode=o.M0E):162==this.miscOutputRegister?this.mode=o.M0F:167==this.miscOutputRegister&&(this.mode=o.M10):0==t&&3==s?this.mode=o.M07:1==t&&6==s?this.mode=o.M04:11==t&&6==s&&(this.mode=o.M0D),this.mode!=e&&this.modeChanged()}getCgaGraphicsColors(e){return this.cgaPalette}modeChanged(){super.modeChanged(),0==(this.miscOutputRegister>>2&3)?this.lineCount=200:this.lineCount=350,(8&this.clockMode)>0?this.colCount=320:this.colCount=640,this.calcRetraceValues()}updateDimensions(){switch(this.calcMode(),this.mode){case o.M00_CGA:this.screenWidth=320,this.screenHeight=200;break;case o.M00_EGA:this.screenWidth=320,this.screenHeight=350;break;case o.M02_CGA:this.screenWidth=640,this.screenHeight=200;break;case o.M02_EGA:this.screenWidth=640,this.screenHeight=350;break;case o.M04:this.screenWidth=320,this.screenHeight=200;break;case o.M06:this.screenWidth=640,this.screenHeight=200;break;case o.M07:this.screenWidth=720,this.screenHeight=350;break;case o.M0D:this.screenWidth=320,this.screenHeight=200;break;case o.M0E:this.screenWidth=640,this.screenHeight=200;break;case o.M0F:case o.M10:this.screenWidth=640,this.screenHeight=350}}updateScreen(e,t){switch(super.updateScreen(e,t),s.Zr.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.mode){case o.M00_CGA:case o.M00_EGA:case o.M02_CGA:case o.M02_EGA:this.updateTextScreen(e,t,this.egaPalette);break;case o.M04:this.updateScreenCgaLo(e);break;case o.M06:this.updateScreenCgaMono(e,640,200);break;case o.M07:break;case o.M0D:this.updateScreen16Col(e,320,200,this.cgaPalette);break;case o.M0E:this.updateScreen16Col(e,640,200,this.cgaPalette);break;case o.M0F:break;case o.M10:this.updateScreen16Col(e,640,350,this.egaPalette)}}}!function(e){e[e.None=0]="None",e[e.M01_CGA=1]="M01_CGA",e[e.M01_EGA=2]="M01_EGA",e[e.M01_VGA=3]="M01_VGA",e[e.M03_CGA=4]="M03_CGA",e[e.M03_EGA=5]="M03_EGA",e[e.M03_VGA=6]="M03_VGA",e[e.M04=7]="M04",e[e.M06=8]="M06",e[e.M07_EGA=9]="M07_EGA",e[e.M07_VGA=10]="M07_VGA",e[e.M0D=11]="M0D",e[e.M0E=12]="M0E",e[e.M0F=13]="M0F",e[e.M10=14]="M10",e[e.M11=15]="M11",e[e.M12=16]="M12",e[e.M13=17]="M13",e[e.MX_320x240=18]="MX_320x240"}(l||(l={})),function(e){e[e.Read=0]="Read",e[e.Write=1]="Write"}(d||(d={}));class f extends g.b{getModeC256(){return(64&this.gdcRegisters[5])>0}getNineDotMode(){return 0==(1&this.sequencerRegisters[1])}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB&&(2&this.sequencerRegisters[4])>0}constructor(){super(),Object.defineProperty(this,"vgaSwitches",{enumerable:!0,configurable:!0,writable:!0,value:[!1,!0,!0,!1]}),Object.defineProperty(this,"paletteRam",{enumerable:!0,configurable:!0,writable:!0,value:new Array(16)}),Object.defineProperty(this,"dacMask",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"videoSubsystemEnableRegister1",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"videoSubsystemEnableRegister2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacEntries",{enumerable:!0,configurable:!0,writable:!0,value:new Array(256)}),Object.defineProperty(this,"dacWriteColIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacReadColIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dacMemR",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dacMemG",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"charWidth9Bits",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:l.None}),this.charBoxWidth=this.charWidth=8,this.colCount=this.screenWidth=640,this.lineCount=this.screenHeight=480,this.dacMask=255,this.sequencerRegisters[4]=2,this.calcRetraceValues()}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("vgaSwitches"),this.ignoredFields.add("egaPalette"),this.ignoredFields.add("cgaPalette")}in(e){if(e==this.crtBasePort+10){this.attributeFlipFlop=!1;const e=this.calcRetraceEnable();return 255&(e.vertRetrace?8:0)+(e.enable?0:1)}switch(e){case 962:{let e=this.calcVertRetrace()?0:128;const t=this.miscOutputRegister>>2&3;return e+=this.vgaSwitches[t]?0:16,255&e}case 963:return this.videoSubsystemEnableRegister1;case 964:return 65535&this.sequencerIndex;case 965:return this.sequencerIndex<this.sequencerRegisters.length?this.sequencerRegisters[this.sequencerIndex]:0;case 966:return this.dacMask;case 967:return 65535&(this.dacMode==d.Read?0:3);case 969:{if(this.dacMode!=d.Read)return 0;const e=Math.trunc(this.dacReadColIndex/3);let t=0;switch(this.dacReadColIndex%3){case 0:t=this.dacEntries[e].r;break;case 1:t=this.dacEntries[e].g;break;case 2:t=this.dacEntries[e].b}return 768==++this.dacReadColIndex&&(this.dacReadColIndex=0),t>>2&65535}case 970:return this.featureControlRegister;case 972:return 207&this.miscOutputRegister;case 974:return 65535&this.gdcIndex;case 975:return 65535&(this.gdcIndex<this.gdcRegisters.length?this.gdcRegisters[this.gdcIndex]:0);case 18152:return this.videoSubsystemEnableRegister2}return super.in(e)}out(e,t,i){switch(e){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&t,this.attributeIndex){case 16:this.graphicsMode=(1&t)>0,this.monochrome=(2&t)>0,this.charWidth9Bits=(4&t)>0,this.blink=(8&t)>0;break;case 17:this.overscanColor=this.genColor(255&t);break;case 18:for(let e=0;e<this.colorPlaneEnabled.length;e++)this.colorPlaneEnabled[e]=(t&1<<e)>0;break;default:this.attributeIndex<=15&&(this.paletteRam[this.attributeIndex]=63&t)}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&t,this.attributeFlipFlop=!this.attributeFlipFlop,i&&this.out(e,t>>8&65535,!1);break;case 963:this.videoSubsystemEnableRegister1=255&t;break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&t;break;case 2:this.mapMaskRegister=255&t,this.mapMask[0]=(1&t)>0,this.mapMask[1]=(2&t)>0,this.mapMask[2]=(4&t)>0,this.mapMask[3]=(8&t)>0;break;case 3:this.characterMapSelectRegister=255&t,this.characterMapA=((32&t)>>5)+(t>>1&6),this.characterMapB=((16&t)>>4)+(t<<1&6);break;case 4:t|=2,this.memoryModeRegister=255&t,this.oddEven=0==(4&t),this.chain4=(8&t)>0}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&t);break;case 966:this.dacMask=255&t;break;case 967:this.dacReadColIndex=3*(255&t),this.dacMode=d.Read;break;case 968:this.dacWriteColIndex=3*(255&t),this.dacMode=d.Write;break;case 969:{if(this.dacMode!=d.Write)return;const e=Math.trunc(this.dacWriteColIndex/3),i=t<<2&255;switch(this.dacWriteColIndex%3){case 0:this.dacMemR=i;break;case 1:this.dacMemG=i;break;case 2:this.dacEntries[e]=r.JX.fromRgb(this.dacMemR,this.dacMemG,i)}768==++this.dacWriteColIndex&&(this.dacWriteColIndex=0);break}case 18152:this.videoSubsystemEnableRegister2=255&t;break;default:super.out(e,t,i)}}internalPoke(e,t,i){3==this.writeMode||super.internalPoke(e,t,i)}setDataRegister(e){(0==(128&this.crtRegisters[17])||this.crtIndexReg>7)&&super.setDataRegister(e)}GetDataRegister(){return this.crtIndexReg<this.crtRegisters.length?this.crtRegisters[this.crtIndexReg]:0}calcMode(){const e=this.mode,t=254&this.sequencerRegisters[1],i=this.sequencerRegisters[2],s=this.sequencerRegisters[4],r=204&this.miscOutputRegister,a=this.crtRegisters[23];this.getModeC256()?this.mode=l.M13:8==t&&3==s?64==r?this.mode=l.M01_CGA:128==r?this.mode=l.M01_EGA:68==r&&(this.mode=l.M01_VGA):0==t&&3==s?64==r?this.mode=l.M03_CGA:128==r?this.mode=l.M03_EGA:68==r&&(this.mode=l.M03_VGA):8==t&&2==s?this.mode=l.M04:0==t&&6==s?64==r?1==i?this.mode=l.M06:15==i&&(this.mode=l.M0E):128==r?this.mode=l.M10:192==r&&(195==a?this.mode=l.M11:227==a&&(this.mode=l.M12)):0==t&&3==s?this.mode=this.getNineDotMode()?l.M07_VGA:l.M07_EGA:8==t&&6==s&&(this.mode=l.M0D),this.mode!=e&&this.modeChanged()}getCgaGraphicsColors(e){let t=new Array(4);for(var i=0;i<4;i++)t[i]=this.dacEntries[i];return t}modeChanged(){switch(super.modeChanged(),this.miscOutputRegister>>6&3){case 1:this.lineCount=400;break;case 2:this.lineCount=350;break;case 3:this.lineCount=480}const e=0==(this.miscOutputRegister>>2&3)?640:720;(8&this.clockMode)>0?this.colCount=e>>1:this.colCount=e,this.calcRetraceValues()}gen16ColPalette(){const e=(128&this.attributeRegisters[16])>0,t=this.attributeRegisters[20],i=new Array(16);for(let s=0;s<16;s++){const r=63&this.paletteRam[s],a=e?15&r|(15&t)<<4:r|(12&t)<<4;i[s]=this.dacEntries[a&this.dacMask]}return i}updateDimensions(){switch(this.calcMode(),this.mode){case l.M01_CGA:this.screenWidth=320,this.screenHeight=200;break;case l.M01_EGA:this.screenWidth=320,this.screenHeight=350;break;case l.M01_VGA:this.screenWidth=360,this.screenHeight=400;break;case l.M03_CGA:this.screenWidth=640,this.screenHeight=200;break;case l.M03_EGA:this.screenWidth=640,this.screenHeight=350;break;case l.M03_VGA:this.screenWidth=720,this.screenHeight=400;break;case l.M04:this.screenWidth=320,this.screenHeight=200;break;case l.M06:this.screenWidth=640,this.screenHeight=200;break;case l.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case l.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case l.M0D:this.screenWidth=320,this.screenHeight=200;break;case l.M0E:this.screenWidth=640,this.screenHeight=200;break;case l.M0F:case l.M10:this.screenWidth=640,this.screenHeight=350;break;case l.M11:case l.M12:this.screenWidth=640,this.screenHeight=480;break;case l.M13:this.screenWidth=320,this.screenHeight=200;break;case l.MX_320x240:this.screenWidth=320,this.screenHeight=240}}updateScreen(e,t){switch(super.updateScreen(e,t),s.Zr.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.charBoxWidth=this.getNineDotMode()?9:8,this.mode){case l.M01_CGA:case l.M01_EGA:case l.M01_VGA:case l.M03_CGA:case l.M03_EGA:case l.M03_VGA:this.updateTextScreen(e,t,this.egaPalette);break;case l.M04:this.updateScreenCgaLo(e);break;case l.M06:this.screenWidth=640,this.screenHeight=200,this.updateScreenCgaMono(e,640,200);break;case l.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case l.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case l.M0D:this.screenWidth=320,this.screenHeight=200,this.updateScreen16Col(e,320,200,this.cgaPalette);break;case l.M0E:this.screenWidth=640,this.screenHeight=200,this.updateScreen16Col(e,640,200,this.cgaPalette);break;case l.M0F:this.screenWidth=640,this.screenHeight=350;break;case l.M10:this.screenWidth=640,this.screenHeight=350,this.updateScreen16Col(e,640,350,this.gen16ColPalette());break;case l.M11:this.screenWidth=640,this.screenHeight=480,this.updateScreenVgaMono(e,640,480);break;case l.M12:this.screenWidth=640,this.screenHeight=480,this.updateScreen16Col(e,640,480,this.gen16ColPalette());break;case l.M13:this.screenWidth=320,this.screenHeight=200,this.updateScreen256ColChain4(e,320,200);break;case l.MX_320x240:this.screenWidth=640,this.screenHeight=480}}updateScreen256ColChain4(e,t,i){const s=new Uint32Array(e.buffer),r=this.dacEntries,a=0==this.getCrtOffset()?Math.trunc(t/4):this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),c=0;const n=this.getHorizontalPixelPanning(),o=0==n?t:t+4;for(let e=0;e<i;e++){let e=65535&h;for(let t=0;t<o;t+=4,e++)for(let i=0;i<4;i++)(0==n||t+i>=n&&t+i<o-8+n)&&(s[c++]=r[this.planes[i][e]].value);h+=a}}updateScreenVgaMono(e,t,i){const s=new Uint32Array(e.buffer),a=r.JX.fromRgb(255,255,255),h=this.overscanColor;let c=0,n=0;for(let e=0;e<i;e++)for(let e=0;e<t;e+=8){let e=this.planes[0][c];for(let t=0;t<8;t++)s[n++]=(128&e)>0?a.value:h.value,e<<=1;c++}}}class m{}Object.defineProperty(m,"screenUpdateFreq",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(m,"runFreq",{enumerable:!0,configurable:!0,writable:!0,value:25});class M{constructor(){Object.defineProperty(this,"dim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}}!function(e){e.Initialize="initialize",e.UpdateScreen="updatescreen"}(u||(u={})),function(e){e.Initialized="initialized",e.ScreenUpdated="screenupdated"}(b||(b={}));const C=self;new class{constructor(e){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"emuWorkerPort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"graphicsCard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.context=e,this.context.onmessage=e=>{e.data[0]===u.Initialize&&(this.emuWorkerPort=e.data[1],this.emuWorkerPort.onmessage=e=>{switch(e.data[0]){case u.Initialize:this.initialize(e.data[1],e.data[2]),this.context.postMessage([b.Initialized]);break;case u.UpdateScreen:{const t=new M;if(t.dim={width:e.data[2],height:e.data[3]},0===t.dim.width||0===t.dim.height)return;this.graphicsCard.applyJson(e.data[1]),this.graphicsCard.updateMemory(e.data.slice(4));const i=new Uint8ClampedArray(t.dim.width*t.dim.height*4);t.buffer=i.buffer,this.graphicsCard.updateScreen(i,t.dim.width),this.context.postMessage([b.ScreenUpdated,t.dim,t.buffer],[t.buffer])}}})}}initialize(e,t){switch(e){case s.wf.MDA:this.graphicsCard=new a;break;case s.wf.CGA:this.graphicsCard=new n;break;case s.wf.EGA:this.graphicsCard=new p;break;case s.wf.VGA:this.graphicsCard=new f}this.graphicsCard.applyJson(t)}}(C)}},s={};function r(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return i[e](a,a.exports,r),a.exports}r.m=i,r.x=()=>{var e=r.O(void 0,[242],(()=>r(345)));return r.O(e)},e=[],r.O=(t,i,s,a)=>{if(!i){var h=1/0;for(l=0;l<e.length;l++){for(var[i,s,a]=e[l],c=!0,n=0;n<i.length;n++)(!1&a||h>=a)&&Object.keys(r.O).every((e=>r.O[e](i[n])))?i.splice(n--,1):(c=!1,a<h&&(h=a));if(c){e.splice(l--,1);var o=s();void 0!==o&&(t=o)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[i,s,a]},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"js/"+e+".bundle.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e+"../"})(),(()=>{var e={345:1};r.f.i=(t,i)=>{e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunkemu_xt=self.webpackChunkemu_xt||[],i=t.push.bind(t);t.push=t=>{var[s,a,h]=t;for(var c in a)r.o(a,c)&&(r.m[c]=a[c]);for(h&&h(r);s.length;)e[s.pop()]=1;i(t)}})(),t=r.x,r.x=()=>r.e(242).then(t),r.x()})();