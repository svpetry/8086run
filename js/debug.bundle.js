!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=26)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Settings=e.ComDevice=e.GraphicsType=void 0;const i=s(3);var r,a;!function(t){t[t.MDA=0]="MDA",t[t.Hercules=1]="Hercules",t[t.CGA=2]="CGA",t[t.EGA=3]="EGA",t[t.VGA=4]="VGA"}(r=e.GraphicsType||(e.GraphicsType={})),function(t){t[t.None=0]="None",t[t.NotConnected=1]="NotConnected",t[t.EmulatedMouse=2]="EmulatedMouse"}(a=e.ComDevice||(e.ComDevice={}));class h{static get monochromeGraphics(){return this.graphicsAdapterType==r.MDA||this.graphicsAdapterType==r.Hercules}}e.Settings=h,h.cpuType=i.CpuType.Cpu186,h.cpuFrequency=4770,h.ramAmount=640,h.floppyCount=2,h.graphicsAdapterType=r.CGA,h.enableHdController=!0,h.enableUma=!0,h.enableRtc=!0,h.com1Device=a.EmulatedMouse,h.com1PortName="",h.com2Device=a.None,h.com2PortName="",h.hdImageDir="HdImages/",h.baseDir="",h.noScreenUpdateWhileRetrace=!0},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseComponent=void 0;e.BaseComponent=class{reset(){}}},function(t,e,s){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var i in s)r(s,i)&&(t[i]=s[i])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var a={arraySet:function(t,e,s,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(s,s+i),r);else for(var a=0;a<i;a++)t[r+a]=e[s+a]},flattenChunks:function(t){var e,s,i,r,a,h;for(i=0,e=0,s=t.length;e<s;e++)i+=t[e].length;for(h=new Uint8Array(i),r=0,e=0,s=t.length;e<s;e++)a=t[e],h.set(a,r),r+=a.length;return h}},h={arraySet:function(t,e,s,i,r){for(var a=0;a<i;a++)t[r+a]=e[s+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,a)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,h))},e.setTyped(i)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CpuError=e.CpuExCode=e.CpuReg=e.Access=e.CpuMode=e.Repeat=e.Direction=e.CpuType=void 0,function(t){t[t.Cpu186=0]="Cpu186",t[t.Cpu386=1]="Cpu386"}(e.CpuType||(e.CpuType={})),function(t){t[t.RegToRm=0]="RegToRm",t[t.RmToReg=1]="RmToReg"}(e.Direction||(e.Direction={})),function(t){t[t.None=0]="None",t[t.RepZ=1]="RepZ",t[t.RepNz=2]="RepNz"}(e.Repeat||(e.Repeat={})),function(t){t[t.Real=0]="Real",t[t.Protected=1]="Protected",t[t.Virtual8086=2]="Virtual8086"}(e.CpuMode||(e.CpuMode={})),function(t){t[t.Read=0]="Read",t[t.Write=1]="Write"}(e.Access||(e.Access={}));e.CpuReg=class{getLoWord(){return 65535&this.value}setLoWord(t){this.value=(4294901760&this.value)+(65535&t)}getLoByte(){return 255&this.value}setLoByte(t){this.value=(4294967040&this.value)+(255&t)}getHiByte(){return this.value>>8&255}setHiByte(t){this.value=(4294902015&this.value)+((255&t)<<8)}},function(t){t[t.DE=0]="DE",t[t.DB=1]="DB",t[t.BP=3]="BP",t[t.OF=4]="OF",t[t.BR=5]="BR",t[t.UD=6]="UD",t[t.NM=7]="NM",t[t.DF=8]="DF",t[t.TS=10]="TS",t[t.NP=11]="NP",t[t.SS=12]="SS",t[t.GP=13]="GP",t[t.PF=14]="PF",t[t.MF=16]="MF",t[t.AC=17]="AC",t[t.MC=18]="MC",t[t.XF=19]="XF",t[t.VE=20]="VE",t[t.SX=30]="SX"}(e.CpuExCode||(e.CpuExCode={}));e.CpuError=class{constructor(t,e=null){this.exCode=t,this.errorCode=e}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InterruptController=e.HardwareInterrupt=void 0;const i=s(1);var r;!function(t){t[t.Timer=0]="Timer",t[t.Keyboard=1]="Keyboard",t[t.Reserved=2]="Reserved",t[t.Serial3=3]="Serial3",t[t.Serial4=4]="Serial4",t[t.Harddisk=5]="Harddisk",t[t.Diskette=6]="Diskette",t[t.Printer=7]="Printer"}(r=e.HardwareInterrupt||(e.HardwareInterrupt={}));class a extends i.BaseComponent{constructor(){super(),this.defaultOffset=8,this.pendingInterrupts=new Array,this.intMaskReg=0,this.inServiceReg=0,this.intRequestReg=0,this.initCommandWords=new Array(4),this.opControlWord2=0,this.opControlWord3=0,this.writeByteNo=0,this.reset()}reset(){super.reset(),this.currentInterrupt=null,this.pendingInterrupts.length=0,this.writeByteNo=1,this.intMaskReg=0,this.inServiceReg=0,this.intRequestReg=0,this.initCommandWords[1]=this.defaultOffset}in(t){switch(t){case 32:{const t=3&this.opControlWord3;if(2==t)return this.intRequestReg;if(3==t)return this.inServiceReg}break;case 33:if(!this.initializationMode)return this.intMaskReg}return 0}out(t,e,s){switch(t){case 32:if((16&e)>0)this.initializationMode=!0,this.initCommandWords[0]=255&e,this.reset();else{this.initializationMode=!1;const t=e>>3&3;if(0==t){this.opControlWord2=255&e;switch(this.opControlWord2>>5){case 1:case 3:this.endOfInterrupt()}}else 1==t&&0==(128&e)&&(this.opControlWord3=255&e)}break;case 33:this.initializationMode?(this.initCommandWords[this.writeByteNo++]=255&e,(4==this.writeByteNo||3==this.writeByteNo&&0==(1&this.initCommandWords[0]))&&(3==this.writeByteNo&&(this.initCommandWords[3]=0),this.initializationMode=!1)):this.intMaskReg=255&e}}endOfInterrupt(){null!=this.currentInterrupt&&(this.inServiceReg&=255&~(1<<this.currentInterrupt),this.pendingInterrupts.length>0?this.internalDoInterrupt(this.pendingInterrupts.shift()):this.currentInterrupt=null)}internalDoInterrupt(t){const e=1<<t&255;0==(this.intMaskReg&e)&&(this.doCpuInterrupt(t+(248&this.initCommandWords[1])),this.inServiceReg|=e,this.currentInterrupt=t)}doInterrupt(t){const e=t;null==this.currentInterrupt?this.internalDoInterrupt(e):(t!=r.Timer||this.currentInterrupt!=e&&!this.pendingInterrupts.includes(e))&&this.pendingInterrupts.push(e)}}e.InterruptController=a},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GraphicsCard=e.IntRect=e.Col=void 0;const i=s(1),r=s(0);class a{constructor(){this.r=0,this.g=0,this.b=0,this.value=0}static fromRgb(t,e,s){const i=new a;return i.r=255&t,i.g=255&e,i.b=255&s,i.value=i.r+(i.g<<8)+(i.b<<16)+4278190080&4294967295,i}}e.Col=a;e.IntRect=class{constructor(t,e,s,i){this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=s,this.height=i}};class h extends i.BaseComponent{constructor(){super(),this.cursorBlinkDelay=250,this.ignoredFields=new Set,this.ignoredFieldsUpdate=new Set,this.cursorSwitchCountdown=0,this.cursorSwitchStartValue=0,this.charCache=new Map,this.crtIndexReg=0,this.crtRegisters=new Uint8Array(25),this.startAddr=0,this.ramSize=0,this.screenWidth=0,this.screenHeight=0,this.charWidth=0,this.charHeight=0,this.supportWrite=!0,this.supportRead=!0,this.cursorOn=!0,this.fillIgnoredFields(),this.ignoredFields.forEach(t=>this.ignoredFieldsUpdate.add(t))}fillIgnoredFields(){this.ignoredFields.add("ignoredFields"),this.ignoredFields.add("ignoredFieldsUpdate"),this.ignoredFields.add("ram"),this.ignoredFields.add("charCache"),this.ignoredFieldsUpdate.add("cursorOn"),this.ignoredFieldsUpdate.add("cursorSwitchStartValue"),this.ignoredFieldsUpdate.add("cursorSwitchCountdown")}setRamSize(t){this.ramSize=t,this.ram=new Uint8Array(this.ramSize)}getCursorStart(){return this.crtRegisters[10]}getCursorEnd(){return this.crtRegisters[11]}getCursorPos(){return(this.crtRegisters[14]<<8)+this.crtRegisters[15]}setScreenUpdateRate(t){this.cursorSwitchStartValue=Math.trunc(this.cursorBlinkDelay*t/1e3)}loadCharSet(){}peek(t){return t>=this.startAddr&&t<this.startAddr+this.ramSize?this.ram[t-this.startAddr]:0}poke(t,e){t>=this.startAddr&&t<this.startAddr+this.ramSize&&(this.ram[t-this.startAddr]=e)}loadCharSetInternal(t,e,s,i){return new Promise((s,i)=>{const a=new XMLHttpRequest;a.responseType="text",a.open("GET",r.Settings.baseDir+e,!0),a.onload=()=>{if(200!=a.status)return void i();const e=a.response.split(/\r?\n/);if(e.length>=256)for(let s=0;s<256;s++){const i=e[s].split(","),r=new Array(i.length);for(let t=0;t<i.length;t++)r[t]="1"==i[t];t[s]=r}s()},a.onerror=()=>{i()},a.send()})}drawChar(t,e,s,i,r=!1,a=!1){const h=this.calcTextCharHash(s,i,t);if(!r&&!a){const t=this.charCache.get(h);if(t)return t}const o=new Uint32Array(this.charWidth*this.charHeight);let n=0,c=0,d=!1;const l=this.getCursorStart(),u=this.getCursorEnd();for(let t=0;t<this.charHeight;t++){a&&l<this.charHeight&&u<this.charHeight&&(d=l<=u?t>=l&&t<=u:t<=u||t>=l);const h=r&&t==this.charHeight-1||d;for(let t=0;t<this.charWidth;t++){const t=h||e[n]?s:i;n++,o[c++]=t.value}}return r||a||this.charCache.set(h,o),o}writePixels(t,e,s,i){const r=new Uint8Array(s.buffer);let a=4*(i.x+i.y*e),h=0;for(let s=0;s<i.height;s++)t.set(r.subarray(h,h+4*i.width),a),h+=4*i.width,a+=4*e}setIndexRegister(t){this.crtIndexReg=31&t}setDataRegister(t){this.crtIndexReg<this.crtRegisters.length&&(this.crtRegisters[this.crtIndexReg]=t)}getDataRegister(){return this.crtIndexReg>=12&&this.crtIndexReg<=15?this.crtRegisters[this.crtIndexReg]:0}updateDimensions(){}getJsonInitial(){return JSON.stringify(this,(t,e)=>{if(!this.ignoredFields.has(t))return"eventTimer"==t?{clockCount:this.eventTimer.clockCount}:e})}getJsonUpdate(){return JSON.stringify(this,(t,e)=>{if(!this.ignoredFieldsUpdate.has(t))return"eventTimer"==t?{clockCount:this.eventTimer.clockCount}:e})}applyJson(t){const e=JSON.parse(t);Object.assign(this,e)}getMemoryData(){return[this.ram.buffer]}updateMemory(t){this.ram=new Uint8Array(t[0])}updateScreen(t,e){this.cursorSwitchStartValue>0&&(0==this.cursorSwitchCountdown&&(this.cursorOn=!this.cursorOn,this.cursorSwitchCountdown=this.cursorSwitchStartValue),this.cursorSwitchCountdown--)}calcTextCharHash(t,e,s){return t.r+256*t.g+65536*t.b+e.r*2**24+e.g*2**32+e.b*2**40+s*2**48}}e.GraphicsCard=h},function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=e.KeyAction=void 0,function(t){t[t.Press=0]="Press",t[t.Release=1]="Release"}(i=e.KeyAction||(e.KeyAction={}));e.Utils=class{static delay(t){return new Promise(e=>setTimeout(e,t))}static download(t,e){const s=document.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),s.setAttribute("download",t),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}static downloadBinary(t,e){const s=new Blob([t]),i=document.createElement("a"),r=URL.createObjectURL(s);i.setAttribute("href",r),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}static getScanCode(t,e){let s=0;switch(t){case"Escape":s=1;break;case"Digit1":s=2;break;case"Digit2":s=3;break;case"Digit3":s=4;break;case"Digit4":s=5;break;case"Digit5":s=6;break;case"Digit6":s=7;break;case"Digit7":s=8;break;case"Digit8":s=9;break;case"Digit9":s=10;break;case"Digit0":s=11;break;case"Minus":s=12;break;case"Equal":s=13;break;case"Backspace":s=14;break;case"Tab":s=15;break;case"KeyQ":s=16;break;case"KeyW":s=17;break;case"KeyE":s=18;break;case"KeyR":s=19;break;case"KeyT":s=20;break;case"KeyY":s=21;break;case"KeyU":s=22;break;case"KeyI":s=23;break;case"KeyO":s=24;break;case"KeyP":s=25;break;case"BracketLeft":s=26;break;case"BracketRight":s=27;break;case"Enter":s=28;break;case"ControlRight":case"ControlLeft":s=29;break;case"KeyA":s=30;break;case"KeyS":s=31;break;case"KeyD":s=32;break;case"KeyF":s=33;break;case"KeyG":s=34;break;case"KeyH":s=35;break;case"KeyJ":s=36;break;case"KeyK":s=37;break;case"KeyL":s=38;break;case"Semicolon":s=39;break;case"Quote":s=40;break;case"Backslash":s=41;break;case"ShiftLeft":s=42;break;case"IntlBackslash":s=43;break;case"KeyZ":s=44;break;case"KeyX":s=45;break;case"KeyC":s=46;break;case"KeyV":s=47;break;case"KeyB":s=48;break;case"KeyN":s=49;break;case"KeyM":s=50;break;case"Comma":s=51;break;case"Period":s=52;break;case"Slash":s=53;break;case"ShiftRight":s=54;break;case"AltRight":case"AltLeft":s=56;break;case"Space":s=57;break;case"CapsLock":s=58;break;case"F1":s=59;break;case"F2":s=60;break;case"F3":s=61;break;case"F4":s=62;break;case"F5":s=63;break;case"F6":s=64;break;case"F7":s=65;break;case"F8":s=66;break;case"F9":s=67;break;case"F10":s=68;break;case"NumLock":s=69;break;case"PageUp":s=73;break;case"PageDown":s=81;break;case"ArrowLeft":s=75;break;case"ArrowRight":s=77;break;case"ArrowUp":s=72;break;case"ArrowDown":s=80;break;case"Home":s=71;break;case"End":s=79;break;case"Delete":s=83;break;case"Insert":s=82}return e==i.Release&&0!=s&&(s+=128),s}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScreenHelperAsync=e.AsyncScreenData=e.ScreenHelperSync=e.Dimensions=void 0;e.Dimensions=class{constructor(){this.width=0,this.height=0}};class i{constructor(t){this.frameCount=0,this.screenContainer=document.getElementById("screen-container"),this.screen=document.getElementById("screen"),this.updateFrame=60/t}updateCanvasIfNeeded(t){if((!this.canvas||this.canvas.width!=t.width||this.canvas.height!=t.height)&&0!=t.width&&0!=t.height){const e=this.screenContainer.clientWidth/t.width,s=this.screenContainer.clientHeight/t.height;this.screen.style.transform=`scaleX(${e}) scaleY(${s})`,this.screen.innerHTML="",this.canvas=document.createElement("canvas"),this.canvas.width=t.width,this.canvas.height=t.height,this.screen.appendChild(this.canvas),this.renderingContext=this.canvas.getContext("2d"),this.imagedata=this.renderingContext.createImageData(t.width,t.height)}}}e.ScreenHelperSync=class extends i{constructor(t){super(t.screenUpdateRate),this.emulator=t}animationFrame(){if(0==this.frameCount){this.emulator.updateGraphicDimensions();const t={width:this.emulator.getScreenWidth(),height:this.emulator.getScreenHeight()};this.updateCanvasIfNeeded(t),this.renderingContext&&(this.emulator.updateScreen(this.imagedata.data,this.imagedata.width),this.renderingContext.putImageData(this.imagedata,0,0))}++this.frameCount>=this.updateFrame&&(this.frameCount=0),window.requestAnimationFrame(()=>this.animationFrame())}};e.AsyncScreenData=class{};e.ScreenHelperAsync=class extends i{constructor(t){super(t),this.updateFrame=60/t}animationFrame(){this.screenData&&(this.updateCanvasIfNeeded(this.screenData.dim),this.renderingContext&&(this.imagedata.data.set(new Uint8ClampedArray(this.screenData.buffer),0),this.renderingContext.putImageData(this.imagedata,0,0),this.screenData=null)),window.requestAnimationFrame(()=>this.animationFrame())}}},function(t,e,s){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},,function(t,e,s){"use strict";t.exports=function(t,e,s,i){for(var r=65535&t|0,a=t>>>16&65535|0,h=0;0!==s;){s-=h=s>2e3?2e3:s;do{a=a+(r=r+e[i++]|0)|0}while(--h);r%=65521,a%=65521}return r|a<<16|0}},function(t,e,s){"use strict";var i=function(){for(var t,e=[],s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e}();t.exports=function(t,e,s,r){var a=i,h=r+s;t^=-1;for(var o=r;o<h;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},function(t,e,s){"use strict";var i=s(2),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var h=new i.Buf8(256),o=0;o<256;o++)h[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function n(t,e){if(e<65534&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var s="",h=0;h<e;h++)s+=String.fromCharCode(t[h]);return s}h[254]=h[254]=1,e.string2buf=function(t){var e,s,r,a,h,o=t.length,n=0;for(a=0;a<o;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(r-56320),a++),n+=s<128?1:s<2048?2:s<65536?3:4;for(e=new i.Buf8(n),h=0,a=0;h<n;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(r-56320),a++),s<128?e[h++]=s:s<2048?(e[h++]=192|s>>>6,e[h++]=128|63&s):s<65536?(e[h++]=224|s>>>12,e[h++]=128|s>>>6&63,e[h++]=128|63&s):(e[h++]=240|s>>>18,e[h++]=128|s>>>12&63,e[h++]=128|s>>>6&63,e[h++]=128|63&s);return e},e.buf2binstring=function(t){return n(t,t.length)},e.binstring2buf=function(t){for(var e=new i.Buf8(t.length),s=0,r=e.length;s<r;s++)e[s]=t.charCodeAt(s);return e},e.buf2string=function(t,e){var s,i,r,a,o=e||t.length,c=new Array(2*o);for(i=0,s=0;s<o;)if((r=t[s++])<128)c[i++]=r;else if((a=h[r])>4)c[i++]=65533,s+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&s<o;)r=r<<6|63&t[s++],a--;a>1?c[i++]=65533:r<65536?c[i++]=r:(r-=65536,c[i++]=55296|r>>10&1023,c[i++]=56320|1023&r)}return n(c,i)},e.utf8border=function(t,e){var s;for((e=e||t.length)>t.length&&(e=t.length),s=e-1;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+h[t[s]]>e?s:e}},function(t,e,s){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,s){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parity=e.StopBits=void 0,function(t){t[t.One=0]="One",t[t.OnePointFive=1]="OnePointFive",t[t.Two=2]="Two"}(e.StopBits||(e.StopBits={})),function(t){t[t.None=0]="None",t[t.Odd=1]="Odd",t[t.Even=2]="Even",t[t.Mark=3]="Mark",t[t.Space=4]="Space"}(e.Parity||(e.Parity={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColorGraphicsCard=void 0;const i=s(5),r=s(0);class a extends i.GraphicsCard{constructor(){super(),this.screenFrequency=60,this.screenUpdateClocks=0,this.lineClocks=0,this.vertRetraceClocks=0,this.vertBlankClocks=0,this.horRetraceClocks=0,this.horAreaStartClocks=0,this.horAreaEndClocks=0,this.blink=!1,this.colCount=0,this.lineCount=0,this.cgaColors=new Array(16),this.initCgaColors()}modeChanged(){}calcRetraceValues(){0!=this.lineCount&&(this.screenUpdateClocks=Math.trunc(1e3*r.Settings.cpuFrequency/this.screenFrequency),this.vertRetraceClocks=Math.trunc(this.screenUpdateClocks/50),this.vertBlankClocks=Math.trunc(this.screenUpdateClocks/100),this.lineClocks=Math.trunc((this.screenUpdateClocks-this.vertRetraceClocks-this.vertBlankClocks)/this.lineCount),this.horRetraceClocks=Math.trunc(this.lineClocks/5),this.horAreaStartClocks=this.vertRetraceClocks+Math.trunc(this.vertBlankClocks/2),this.horAreaEndClocks=this.horAreaStartClocks+this.lineClocks*this.lineCount)}calcVertRetrace(){if(0==this.screenUpdateClocks)return!1;return this.eventTimer.clockCount%this.screenUpdateClocks<this.vertRetraceClocks}initCgaColors(){this.cgaColors[0]=i.Col.fromRgb(0,0,0),this.cgaColors[1]=i.Col.fromRgb(0,0,170),this.cgaColors[2]=i.Col.fromRgb(0,170,0),this.cgaColors[3]=i.Col.fromRgb(0,170,170),this.cgaColors[4]=i.Col.fromRgb(170,0,0),this.cgaColors[5]=i.Col.fromRgb(170,0,170),this.cgaColors[6]=i.Col.fromRgb(170,85,0),this.cgaColors[7]=i.Col.fromRgb(170,170,170),this.cgaColors[8]=i.Col.fromRgb(85,85,85),this.cgaColors[9]=i.Col.fromRgb(85,85,255),this.cgaColors[10]=i.Col.fromRgb(85,255,85),this.cgaColors[11]=i.Col.fromRgb(85,255,255),this.cgaColors[12]=i.Col.fromRgb(255,85,85),this.cgaColors[13]=i.Col.fromRgb(255,85,255),this.cgaColors[14]=i.Col.fromRgb(255,255,85),this.cgaColors[15]=i.Col.fromRgb(255,255,255)}getCgaGraphicsColors(t){const e=(16&t)>0?8:0,s=t>>5&1,i=new Array(4);return i[0]=this.cgaColors[15&t],0==s?(i[1]=this.cgaColors[2+e],i[2]=this.cgaColors[4+e],i[3]=this.cgaColors[6+e]):(i[1]=this.cgaColors[3+e],i[2]=this.cgaColors[5+e],i[3]=this.cgaColors[7+e]),i}}e.ColorGraphicsCard=a,a.dataBuffer=new Array},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ATColorGraphicsCard=void 0;const i=s(16),r=s(5);var a;!function(t){t[t.Unmodified=0]="Unmodified",t[t.And=1]="And",t[t.Or=2]="Or",t[t.Xor=3]="Xor"}(a||(a={}));class h extends i.ColorGraphicsCard{constructor(){super(),this.planeCount=4,this.planes=new Array(this.planeCount),this.latches=new Array(this.planeCount),this.mapMask=new Array(this.planeCount),this.enableSetReset=new Array(this.planeCount),this.setReset=new Array(this.planeCount),this.modeControlRegister=0,this.colorSelectRegister=0,this.miscOutputRegister=0,this.sequencerIndex=0,this.sequencerRegisters=new Array(5),this.gdcIndex=0,this.gdcRegisters=new Array(9),this.attributeFlipFlop=!1,this.attributeIndex=0,this.attributeRegisters=new Array(21),this.graphicsMode=!1,this.colorPlaneEnabled=new Array(4),this.readMapSelect=0,this.rotateCount=0,this.bitMask=0,this.oddEven=!1,this.colorDontCare=new Array(4),this.mapMaskRegister=0,this.colorCompareRegister=0,this.featureControlRegister=0,this.gdcGraphicsMode=!1,this.monochrome=!1,this.memoryModeRegister=0,this.characterMapSelectRegister=0,this.characterMapA=0,this.characterMapB=0,this.clockMode=0,this.writeMode=0,this.readMode=0,this.chain4=!1,this.egaPalette=new Array(16),this.cgaPalette=new Array(16),this.memStart=0,this.memSize=0,this.crtBasePort=0,this.charBoxWidth=0,this.startAddr=655360,this.setRamSize(262144),this.memStart=720896,this.memSize=65536,this.crtBasePort=976,this.miscOutputRegister=3,this.bitMask=255;for(let t=0;t<16;t++)this.egaPalette[t]=this.cgaColors[t],this.cgaPalette[t]=this.cgaColors[t];for(let t=0;t<this.planeCount;t++)this.planes[t]=new Uint8Array(65536),this.mapMask[t]=!0}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB}getCrtStartAddr(){return(this.crtRegisters[12]<<8)+this.crtRegisters[13]}getUnderlineLocation(){return 31&this.crtRegisters[20]}getMaximumCharScanLine(){return 31&this.crtRegisters[9]}getCrtOffset(){return this.crtRegisters[19]}getPresetRowScan(){return this.crtRegisters[8]}getHorizontalPixelPanning(){return 15&this.attributeRegisters[19]}getEnableLineGraphicsCharacterCode(){return(4&this.attributeRegisters[16])>0}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("planes"),this.ignoredFields.add("egaPalette"),this.ignoredFields.add("cgaPalette")}getMemoryData(){const t=new Array(this.planeCount);for(let e=0;e<this.planeCount;e++)t[e]=this.planes[e].buffer;return t}updateMemory(t){for(let e=0;e<this.planeCount;e++)this.planes[e]=new Uint8Array(t[e])}in(t){if(t==this.crtBasePort+5)return this.getDataRegister();switch(t){case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister}return 65535}out(t,e,s){if(t==this.crtBasePort+4)return this.setIndexRegister(255&e),void(s&&this.out(981,e>>8,!1));if(t!=this.crtBasePort+5)if(t!=this.crtBasePort+10)switch(t){case 962:this.miscOutputRegister=255&e,this.crtBasePort=0==(1&e)?944:976;break;case 964:this.sequencerIndex=7&e,s&&this.out(965,e>>8&255,!1);break;case 974:this.gdcIndex=15&e,s&&this.out(975,e>>8,!1);break;case 975:switch(this.gdcIndex){case 0:this.setReset[0]=(1&e)>0,this.setReset[1]=(2&e)>0,this.setReset[2]=(4&e)>0,this.setReset[3]=(8&e)>0;break;case 1:this.enableSetReset[0]=(1&e)>0,this.enableSetReset[1]=(2&e)>0,this.enableSetReset[2]=(4&e)>0,this.enableSetReset[3]=(8&e)>0;break;case 2:this.colorCompareRegister=255&e;break;case 3:switch(this.rotateCount=7&e,e>>3&3){case 0:this.currentDataFunction=a.Unmodified;break;case 1:this.currentDataFunction=a.And;break;case 2:this.currentDataFunction=a.Or;break;case 3:this.currentDataFunction=a.Xor}break;case 4:this.readMapSelect=3&e;break;case 5:this.writeMode=3&e,this.readMode=e>>3&1;break;case 6:switch(this.gdcGraphicsMode=(1&e)>0,e>>2&3){case 0:this.memStart=655360,this.memSize=131072;break;case 1:this.memStart=655360,this.memSize=65536;break;case 2:this.memStart=720896,this.memSize=32768;break;case 3:this.memStart=753664,this.memSize=32768}break;case 7:for(let t=0;t<this.planeCount;t++)this.colorDontCare[t]=(e&1<<t)>0;break;case 8:this.bitMask=e}this.gdcIndex<this.gdcRegisters.length&&(this.gdcRegisters[this.gdcIndex]=255&e);break;case 984:this.modeControlRegister=255&e;break;case 985:this.colorSelectRegister=255&e}else this.featureControlRegister=255&e;else this.setDataRegister(255&e)}peek(t){if(t<this.memStart||t>=this.memStart+this.memSize)return 0;let e=t-this.memStart;if(this.chain4)return this.planes[3&e][e>>2];const s=0==(1&e);this.oddEven&&(e>>=1);for(let t=0;t<this.planeCount;t++)this.latches[t]=this.planes[t][e];if(0==this.readMode)return this.oddEven?s?this.planes[0][e]:this.planes[1][e]:this.planes[this.readMapSelect][e];{const t=15&this.colorCompareRegister;let s=255;for(let i=0;i<this.planeCount;i++){if(!this.colorDontCare[i])continue;const r=this.planes[i][e],a=(t&1<<i)>0;let h=1;for(let t=0;t<8;t++)(r&h)>0!=a&&(s&=~h),h<<=1}return 255&s}}poke(t,e){if(t<this.memStart||t>=this.memStart+this.memSize)return;let s=t-this.memStart;if(this.chain4)return void(this.planes[3&s][s>>2]=e);const i=0==(1&s);this.oddEven&&(s>>=1),this.internalPoke(e,i,s)}internalPoke(t,e,s){if(0==this.writeMode){let i=t;this.rotateCount>0&&(i=255&(i>>this.rotateCount|i<<8-this.rotateCount));for(let t=0;t<this.planeCount;t++){if(!this.mapMask[t])continue;if(this.oddEven&&(e&&0!=t&&2!=t||!e&&1!=t&&3!=t))continue;const r=this.latches[t];let h=this.enableSetReset[t]?this.setReset[t]?255:0:i;switch(this.currentDataFunction){case a.And:h&=r;break;case a.Or:h|=r;break;case a.Xor:h^=r}this.planes[t][s]=255&(h&this.bitMask|r&~this.bitMask)}}else if(1==this.writeMode)for(let t=0;t<this.planeCount;t++)this.planes[t][s]=this.latches[t];else if(2==this.writeMode)for(let i=0;i<this.planeCount;i++){if(!this.mapMask[i])continue;if(this.oddEven&&(e&&0!=i&&2!=i||!e&&1!=i&&3!=i))continue;const r=this.latches[i];let h=(t&1<<i)>0?255:0;switch(this.currentDataFunction){case a.And:h&=r;break;case a.Or:h|=r;break;case a.Xor:h^=r}this.planes[i][s]=255&(h&this.bitMask|r&~this.bitMask)}}waitForScreenDraw(){if(0==this.screenUpdateClocks)return;const t=this.horAreaEndClocks-this.horAreaStartClocks,e=this.eventTimer.clockCount%this.screenUpdateClocks;e>=this.horAreaStartClocks&&Math.trunc(this.horAreaStartClocks+t/2)}calcRetraceEnable(){if(0==this.screenUpdateClocks)return{vertRetrace:!1,enable:!1};const t=this.eventTimer.clockCount%this.screenUpdateClocks,e=t<this.vertRetraceClocks;let s=!1;if(t>=this.horAreaStartClocks&&t<this.horAreaEndClocks){s=(t-this.horAreaStartClocks)%this.lineClocks<this.horRetraceClocks}return{vertRetrace:e,enable:s||e&&t>this.horRetraceClocks}}genColor(t){const e=((4&t)>0?170:0)+((32&t)>0?85:0),s=((2&t)>0?170:0)+((16&t)>0?85:0),i=((1&t)>0?170:0)+((8&t)>0?85:0);return r.Col.fromRgb(e,s,i)}genCgaColor(t){return this.cgaColors[(7&t)+((16&t)>0?8:0)]}updateTextScreen(t,e,s){this.charHeight=this.getMaximumCharScanLine()+1;const i=Math.trunc(this.colCount/this.charBoxWidth),a=Math.trunc(this.lineCount/this.charHeight),h=new Array(a*i);this.internalUpdateTextScreen(h,0,a,i,s);let o=0;for(let s=0;s<a;s++)for(let a=0;a<i;a++){const i=h[o],n=new r.IntRect(a*this.charBoxWidth,s*this.charHeight,this.charBoxWidth,this.charHeight);this.writePixels(t,e,i,n),o++}}internalUpdateTextScreen(t,e,s,i,r){let a=this.getCrtStartAddr()+e*i,h=e*i;const o=this.getAllowSwitchCharSets(),n=this.charBoxWidth>this.charWidth,c=8192*this.characterMapA,d=8192*this.characterMapB;let l=0;for(let u=e;u<e+s;u++)for(let e=0;e<i;e++){const e=this.planes[1][a];let s;o?(l=(8&e)>0?c:d,s=r[7&e]):s=r[15&e];const i=this.blink&&(128&e)>0,u=this.blink?r[e>>4&7]:r[e>>4];i&&!this.cursorOn&&(s=u),t[h]=this.drawEgaVgaChar(this.planes[0][a],s,u,l,!1,a==this.getCursorPos()&&this.cursorOn,n),a++,h++}}drawEgaVgaChar(t,e,s,i,a,h,o){const n=new Uint32Array(this.charBoxWidth*this.charHeight);let c=0,d=!1;const l=this.planes[2],u=i+(t<<5),m=t>=192&&t<=223&&this.getEnableLineGraphicsCharacterCode();let g=r.Col.fromRgb(0,0,0);for(let t=0;t<this.charHeight;t++){const i=l[u+t];let r=128;const p=this.getCursorStart(),k=this.getCursorEnd();if(h&&p<this.charHeight&&k<this.charHeight){const e=0==k?this.charHeight-1:k;d=t>=p&&t<=e}const C=a&&t==this.getUnderlineLocation()||d;for(let t=0;t<this.charWidth;t++)g=C||(i&r)>0?e:s,r>>=1,n[c++]=g.value;o&&(n[c++]=m?g.value:s.value)}return n}updateScreenCgaLo(t){const e=this.getCgaGraphicsColors(this.colorSelectRegister),s=new Uint32Array(t.buffer);let i=0,r=0,a=8192;for(let t=0;t<200;t++){let h=0==(1&t)?r:a;for(let t=0;t<320;t+=4){const t=0==(1&h)?this.planes[0][h>>1]:this.planes[1][h>>1];let r;r=e[t>>6],s[i++]=r.value,r=e[t>>4&3],s[i++]=r.value,r=e[t>>2&3],s[i++]=r.value,r=e[3&t],s[i++]=r.value,h++}t%2==0?r=h:a=h}}updateScreenCgaMono(t,e,s){const i=r.Col.fromRgb(255,255,255),a=this.overscanColor,h=new Uint32Array(t.buffer);let o=0,n=0,c=8192;for(let t=0;t<s;t++){let s=0==(1&t)?n:c;for(let t=0;t<e;t+=8){let t=this.planes[0][s];for(let e=0;e<8;e++)h[o++]=(128&t)>0?i.value:a.value,t<<=1;s++}t%2==0?n=s:c=s}}updateScreen16Col(t,e,s,i){const r=new Uint32Array(t.buffer),a=0==this.getCrtOffset()?e/8:this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),o=0;const n=this.getHorizontalPixelPanning(),c=0==n?e:e+8;for(let t=0;t<s;t++){let t=h;for(let e=0;e<c;e+=8,t++){const s=65535&t;let a=this.planes[0][s],h=this.planes[1][s],d=this.planes[2][s],l=this.planes[3][s];for(let t=0;t<8;t++){const s=i[((128&a)>>7)+((128&h)>>6)+((128&d)>>5)+((128&l)>>4)];(0==n||e+t>=n&&e+t<c-8+n)&&(r[o++]=s.value),a<<=1,h<<=1,d<<=1,l<<=1}}h+=a}}}e.ATColorGraphicsCard=h},,,,,,,,,function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(27),r=s(0),a=s(3),h=s(59),o=s(6),n=s(7);navigator.userAgent.indexOf("Firefox")>0&&(document.getElementById("main").style.width="-moz-fit-content"),new class{constructor(){this.running=!1,this.runStep=0,this.runButton=document.getElementById("run-button"),this.stepButton=document.getElementById("step-button"),this.stopButton=document.getElementById("stop-button"),this.resetButton=document.getElementById("reset-button"),r.Settings.cpuType=a.CpuType.Cpu186,r.Settings.ramAmount=1024,r.Settings.enableRtc=!0,r.Settings.enableUma=!0,r.Settings.hdImageDir="HdImages/",r.Settings.graphicsAdapterType=r.GraphicsType.CGA,this.debugHelper=new h.DebugHelper,this.emulator=new i.Emulator(10),this.runButton.addEventListener("click",()=>this.run()),this.stepButton.addEventListener("click",()=>this.step()),this.stopButton.addEventListener("click",()=>this.stop()),this.resetButton.addEventListener("click",()=>this.reset()),document.addEventListener("keydown",t=>{if(!t.repeat)return this.emulator.sendKey(o.Utils.getScanCode(t.code,o.KeyAction.Press)),t.preventDefault(),t.stopPropagation(),!1}),document.addEventListener("keyup",t=>(this.emulator.sendKey(o.Utils.getScanCode(t.code,o.KeyAction.Release)),t.preventDefault(),t.stopPropagation(),!1)),this.startEmulation()}doRun(){for(let t=0;t<2500&&this.running;t++)this.emulator.step(),this.debugHelper.addInstructionLineToBuffer(this.emulator);this.runStep++,20==this.runStep&&(this.runStep=0,this.debugHelper.showRegisters(this.emulator)),this.running?setTimeout(()=>{this.doRun()},5):this.debugHelper.showInstructionBuffer()}async doReset(){this.debugHelper.clearInstructionHistory(),this.debugHelper.clearInstructionBuffer(),await this.emulator.reset(),this.emulator.step(),this.debugHelper.disassembleSingle(this.emulator),this.debugHelper.showRegisters(this.emulator)}async reset(){this.running=!1,setTimeout(this.doReset,20)}step(){this.running||(this.emulator.step(),this.debugHelper.disassembleSingle(this.emulator),this.debugHelper.showRegisters(this.emulator))}run(){this.running=!0,this.stepButton.disabled=!0,this.resetButton.disabled=!0,this.doRun()}stop(){this.running=!1,this.stepButton.disabled=!1,this.resetButton.disabled=!1}async startEmulation(){await this.emulator.loadRom("Roms/BIOS/PCXTBIOS.BIN",1040384),await this.emulator.loadRom("Roms/Harddisk/IBM_XEBEC_62X0822_1985.BIN",819200),await this.emulator.prepare(),this.debugHelper.disassembleSingle(this.emulator);const t=new n.ScreenHelperSync(this.emulator);window.requestAnimationFrame(()=>t.animationFrame())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Emulator=void 0;const i=s(28),r=s(29),a=s(3),h=s(30),o=s(4),n=s(31),c=s(32),d=s(33),l=s(44),u=s(45),m=s(46),g=s(47),p=s(48),k=s(0),C=s(49),b=s(52),S=s(53),f=s(54),y=s(55),R=s(56),A=s(57),v=s(58);e.Emulator=class{constructor(t){switch(this.components=new Array,this.screenUpdateRate=0,this.roms=new Array,this.screenUpdateRate=t,this.memMapper=new i.MemoryMapper(k.Settings.ramAmount),this.portMapper=new r.PortMapper,k.Settings.cpuType){case a.CpuType.Cpu186:this.cpu=new C.Cpu186(this.memMapper,this.portMapper);break;case a.CpuType.Cpu386:this.cpu=new b.Cpu386(this.memMapper,this.portMapper)}this.disassembler=new S.Disassembler(this.cpu,this.memMapper)}getWorkLoad(){return this.cpu.workLoad}getInstCount(){return this.cpu.instCount}changeScreenUpdateRate(t){this.screenUpdateRate!=t&&(this.screenUpdateRate=t,null!=this.graphicsCard&&this.graphicsCard.setScreenUpdateRate(t))}getCpuName(){return this.cpu.getName()}getAX(){return this.cpu.AX}getBX(){return this.cpu.BX}getCX(){return this.cpu.CX}getDX(){return this.cpu.DX}getSP(){return this.cpu.SP}getBP(){return this.cpu.BP}getSI(){return this.cpu.SI}getDI(){return this.cpu.DI}getCS(){return this.cpu.CS}getDS(){return this.cpu.DS}getES(){return this.cpu.ES}getSS(){return this.cpu.SS}getIP(){return this.cpu.IP}getFLAGS(){return this.cpu.FLAGS}getHalt(){return this.cpu.halt}getInstructionByte(){return this.cpu.getInstructionByte()}getAddressByte(){return this.cpu.getAddressByte()}getScreenWidth(){return this.graphicsCard.screenWidth}getScreenHeight(){return this.graphicsCard.screenHeight}updateGraphicDimensions(){var t;null===(t=this.graphicsCard)||void 0===t||t.updateDimensions()}updateScreen(t,e){var s;null===(s=this.graphicsCard)||void 0===s||s.updateScreen(t,e)}dumpMemory(t){throw new Error("Method not implemented.")}getMemByte(t){return this.memMapper.peek(t)}async prepare(){for(const t of this.roms)this.memMapper.register(t.startAddr,t.getEndAddr(),t),this.registerComponent(t);if(k.Settings.enableUma){const t=new p.Ram(128,851968);this.memMapper.register(t.addrLo,t.addrHi,t),this.registerComponent(t)}switch(this.dmaController=new h.DmaController(this.memMapper,()=>this.timer.memRefreshActive),this.portMapper.register(0,15,this.dmaController),this.portMapper.register(128,143,this.dmaController),this.portMapper.register(192,223,this.dmaController),this.registerComponent(this.dmaController),this.interruptController=new o.InterruptController,this.portMapper.register(32,33,this.interruptController),this.registerComponent(this.interruptController),k.Settings.graphicsAdapterType){case k.GraphicsType.MDA:this.graphicsCard=new f.MdaGraphics,this.portMapper.register(944,959,this.graphicsCard),this.memMapper.register(720896,737279,this.graphicsCard);break;case k.GraphicsType.CGA:this.graphicsCard=new R.CgaGraphics,this.portMapper.register(976,991,this.graphicsCard),this.memMapper.register(753664,770047,this.graphicsCard);break;case k.GraphicsType.EGA:this.graphicsCard=new A.EgaGraphics,this.portMapper.register(960,991,this.graphicsCard),this.memMapper.register(655360,786431,this.graphicsCard);break;case k.GraphicsType.VGA:this.graphicsCard=new v.VgaGraphics,this.portMapper.register(944,991,this.graphicsCard),this.portMapper.register(18152,18152,this.graphicsCard),this.memMapper.register(655360,786431,this.graphicsCard)}if(this.graphicsCard.setScreenUpdateRate(this.screenUpdateRate),await this.graphicsCard.loadCharSet(),this.registerComponent(this.graphicsCard),this.ppi=new n.Ppi(this.interruptController,()=>this.onSpeaker()),this.portMapper.register(96,99,this.ppi),this.registerComponent(this.ppi),this.speakerController=this.ppi,this.keyboard=this.ppi,this.timer=new c.Timer(this.interruptController,()=>this.onSpeaker()),this.portMapper.register(64,95,this.timer),this.registerComponent(this.timer),k.Settings.enableHdController&&(this.hardDisk=new d.HardDisk(this.interruptController,this.dmaController),await this.hardDisk.loadImages(),this.portMapper.register(800,803,this.hardDisk),this.registerComponent(this.hardDisk)),this.floppyDisk=new l.FloppyDisk(this.interruptController,this.dmaController),this.portMapper.register(1008,1015,this.floppyDisk),this.registerComponent(this.floppyDisk),this.mouse=new m.Mouse(this.cpu),k.Settings.com1Device!=k.ComDevice.None&&(this.uartPort1=new u.UartPort(1016,o.HardwareInterrupt.Serial4,this.interruptController),this.portMapper.register(1016,1023,this.uartPort1),this.registerComponent(this.uartPort1),this.connectSerialDevice(this.uartPort1,k.Settings.com1Device)),k.Settings.com2Device!=k.ComDevice.None&&(this.uartPort2=new u.UartPort(760,o.HardwareInterrupt.Serial3,this.interruptController),this.portMapper.register(760,767,this.uartPort2),this.registerComponent(this.uartPort2),this.connectSerialDevice(this.uartPort2,k.Settings.com2Device)),k.Settings.enableRtc){const t=new y.RealTimeClock(832);this.portMapper.register(832,855,t),this.registerComponent(t)}this.memMapper.FinishRegistration()}connectSerialDevice(t,e){e==k.ComDevice.EmulatedMouse&&t.connect(this.mouse)}registerComponent(t){this.components.push(t),t.eventTimer=this.cpu,t.doCpuInterrupt=t=>this.cpu.doInterrupt(t)}onSpeaker(){var t;null===(t=this.soundGenerator)||void 0===t||t.setFrequency(this.speakerController.speakerEnabled?this.timer.speakerFrequency:0)}step(){this.cpu.execNextInstruction()}runClocks(t){this.cpu.execInstructions(t)}get eventTimer(){return this.cpu}async reset(){var t,e;await(null===(t=this.hardDisk)||void 0===t?void 0:t.saveImages()),await(null===(e=this.floppyDisk)||void 0===e?void 0:e.saveImages()),this.cpu.reset();for(const t of this.components)t.reset()}async loadRom(t,e){const s=new g.Rom(e);await s.load(t),this.roms.push(s)}async loadDiskImageFromFile(t,e){return await this.floppyDisk.loadImageFromFile(t,e)}loadDiskImageFromBuffer(t,e){this.floppyDisk.loadImageFromBuffer(t,e)}newDiskImage(t){this.floppyDisk.newImage(t)}getDiskImage(t){return this.floppyDisk.getDiskImage(t)}async ejectDiskImage(t){await this.floppyDisk.ejectImage(t)}runDebug(t){for(this.cpu.reset();!this.cpu.halt;)this.disassembler.doDisassemble(),t(this.disassembler.disassembledLine),this.cpu.execNextInstruction();t(""),t("finished.")}sendKey(t){this.keyboard.addScanCode(t)}screenMouseEvent(t,e,s){var i;null===(i=this.mouse)||void 0===i||i.mouseEventRel(t,e,s)}screenMouseReset(){this.mouse.resetMove()}mouseMoveDelta(t,e){this.mouse.mouseMoveDelta(t,e)}async loadIntoRam(t,e){}async loadBios(t){const e=new g.Rom(0);await e.load(t),e.startAddr=1048576-e.size,this.roms.push(e)}async saveImages(){await this.hardDisk.saveImages()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MemoryMapper=void 0;e.MemoryMapper=class{constructor(t){this.extRamStart=65536,this.memoryMappings=new Array,this.readMappings=new Array,this.writeMappings=new Array,this.extRamLimit=0,this.supportRead=!0,this.supportWrite=!0;const e=t>1024?t-1024:0;this.ram=new Uint8Array(1024*Math.min(t,640)),this.extRam=new Uint8Array(1024*e),this.extRamLimit=this.extRamStart+e}peek(t){if(t<this.ram.length)return this.ram[t];if(t>=this.extRamStart&&t<this.extRamLimit)return this.extRam[t-this.extRamStart];for(let e=0;e<this.readMappings.length;e++){const s=this.readMappings[e];if(s.addrLo<=t&&s.addrHi>=t)return s.provider.peek(t)}return 0}poke(t,e){if(t<this.ram.length)this.ram[t]=255&e;else if(t>=this.extRamStart&&t<this.extRamLimit)this.extRam[t-this.extRamStart]=255&e;else for(let s=0;s<this.readMappings.length;s++){const i=this.readMappings[s];if(i.addrLo<=t&&i.addrHi>=t)return void i.provider.poke(t,255&e)}}peekW(t){if(t<this.ram.length-1)return this.ram[t]+(this.ram[t+1]<<8);if(t>=this.extRamStart&&t<this.extRamLimit){const e=t-this.extRamStart;return this.extRam[e]+(this.extRam[e+1]<<8)}for(let e=0;e<this.readMappings.length;e++){const s=this.readMappings[e];if(s.addrLo<=t&&s.addrHi>=t)return s.provider.peek(t)+(s.provider.peek(t+1)<<8)}return 0}pokeW(t,e){if(t<this.ram.length-1)return this.ram[t]=255&e,void(this.ram[t+1]=e>>8&255);if(t>=this.extRamStart&&t<this.extRamLimit){const s=t-this.extRamStart;this.extRam[s]=255&e,this.extRam[s+1]=e>>8&255}for(let s=0;s<this.readMappings.length;s++){const i=this.readMappings[s];if(i.addrLo<=t&&i.addrHi>=t)return i.provider.poke(t,255&e),void i.provider.poke(t+1,e>>8&255)}}peekD(t){if(t<this.ram.length-1)return this.ram[t]+(this.ram[t+1]<<8)+(this.ram[t+2]<<16)+(this.ram[t+3]<<24);if(t>=this.extRamStart&&t<this.extRamLimit){const e=t-this.extRamStart;return this.extRam[e]+(this.extRam[e+1]<<8)+(this.extRam[e+2]<<16)+(this.extRam[e+3]<<24)}for(let e=0;e<this.readMappings.length;e++){const s=this.readMappings[e];if(s.addrLo<=t&&s.addrHi>=t)return s.provider.peek(t)+(s.provider.peek(t+1)<<8)+(s.provider.peek(t+2)<<16)+(s.provider.peek(t+3)<<24)}return 0}pokeD(t,e){if(t<this.ram.length-1)return this.ram[t]=255&e,this.ram[t+1]=e>>8&255,this.ram[t+2]=e>>16&255,void(this.ram[t+3]=e>>24&255);if(t>=this.extRamStart&&t<this.extRamLimit){const s=t-this.extRamStart;this.extRam[s]=255&e,this.extRam[s+1]=e>>8&255,this.extRam[s+2]=e>>16&255,this.extRam[s+3]=e>>24&255}for(let s=0;s<this.readMappings.length;s++){const i=this.readMappings[s];if(i.addrLo<=t&&i.addrHi>=t)return i.provider.poke(t,255&e),i.provider.poke(t+1,e>>8&255),i.provider.poke(t+2,e>>16&255),void i.provider.poke(t+3,e>>24&255)}}register(t,e,s){this.memoryMappings.push({addrLo:t,addrHi:e,provider:s,supportRead:s.supportRead,supportWrite:s.supportWrite})}FinishRegistration(){for(const t of this.memoryMappings)t.supportRead&&this.readMappings.push(t),t.supportWrite&&this.writeMappings.push(t)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PortMapper=void 0;e.PortMapper=class{constructor(){this.portMappings=new Array}in(t){for(let e=0;e<this.portMappings.length;e++){const s=this.portMappings[e];if(s.portLo<=t&&s.portHi>=t)return 65535&s.provider.in(t)}return 65535}out(t,e,s){for(let i=0;i<this.portMappings.length;i++){const r=this.portMappings[i];if(r.portLo<=t&&r.portHi>=t)return void r.provider.out(t,e,s)}}register(t,e,s){this.portMappings.push({provider:s,portLo:t,portHi:e})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DmaController=void 0;const i=s(1);var r,a,h;!function(t){t[t.Demand=0]="Demand",t[t.Single=1]="Single",t[t.Block=2]="Block",t[t.Cascade=3]="Cascade"}(r||(r={})),function(t){t[t.Inc=0]="Inc",t[t.Dec=1]="Dec"}(a||(a={})),function(t){t[t.Verify=0]="Verify",t[t.WriteMem=1]="WriteMem",t[t.ReadMem=2]="ReadMem",t[t.Undefined=3]="Undefined"}(h||(h={}));class o extends i.BaseComponent{constructor(t,e){super(),this.channelCount=8,this.memRefreshChannel=0,this.blockSize=new Array(this.channelCount),this.blockSizeByteNo=new Array(this.channelCount),this.page=new Array(this.channelCount),this.offset=new Array(this.channelCount),this.offsetByteNo=new Array(this.channelCount),this.mode=new Array(this.channelCount),this.inc=new Array(this.channelCount),this.autoInit=new Array(this.channelCount),this.transferType=new Array(this.channelCount),this.channelEnabled=new Array(this.channelCount),this.terminalCount=new Array(this.channelCount),this.memoryProvider=t,this.checkMemRefreshActiveFunc=e;for(let t=0;t<this.channelCount;t++)this.channelEnabled[t]=!0}readByte(t,e,s){let i;return i=0==e[s]?255&t[s]:(65280&t[s])>>8&255,e[s]=1-e[s],i}writeByte(t,e,s,i){0==e[s]?t[s]=65535&(65280&t[s]|i):t[s]=65535&(255&t[s]|i<<8),e[s]=1-e[s]}memRefreshActive(){return this.autoInit[this.memRefreshChannel]&&this.checkMemRefreshActiveFunc()}in(t){if(t>=0&&t<=7){const e=Math.trunc(t/2);return t%2==0?(e==this.memRefreshChannel&&this.memRefreshActive()&&(this.offset[e]+=17),this.readByte(this.offset,this.offsetByteNo,e)):this.readByte(this.blockSize,this.blockSizeByteNo,e)}if(t>=192&&t<=207){const e=4+Math.trunc((t-192)/4);if(t%4==0)return this.readByte(this.offset,this.offsetByteNo,e);if(t%4==2)return this.readByte(this.blockSize,this.blockSizeByteNo,e)}return 8==t?(this.memRefreshActive()&&(this.terminalCount[this.memRefreshChannel]=!0),255&((this.terminalCount[0]?1:0)|(this.terminalCount[1]?2:0)|(this.terminalCount[2]?4:0)|(this.terminalCount[3]?8:0))):0}out(t,e,s){if(t>=0&&t<=7){const s=Math.trunc(t/2);return t%2==0?this.writeByte(this.offset,this.offsetByteNo,s,e):this.writeByte(this.blockSize,this.blockSizeByteNo,s,e),void(this.terminalCount[s]=!1)}if(t>=192&&t<=207){const s=4+Math.trunc((t-192)/4);return t%4==0?this.writeByte(this.offset,this.offsetByteNo,s,e):t%4==2&&this.writeByte(this.blockSize,this.blockSizeByteNo,s,e),void(this.terminalCount[s]=!1)}switch(t){case 135:this.page[0]=255&e;break;case 131:this.page[1]=255&e;break;case 129:this.page[2]=255&e;break;case 130:this.page[3]=255&e;break;case 143:this.page[4]=255&e;break;case 139:this.page[5]=255&e;break;case 137:this.page[6]=255&e;break;case 138:this.page[7]=255&e;break;case 8:case 9:break;case 10:{const t=3&e;this.channelEnabled[t]=0==(4&e)}break;case 11:{const t=3&e;switch(e>>2&3){case 0:this.transferType[t]=h.Verify;break;case 1:this.transferType[t]=h.WriteMem;break;case 2:this.transferType[t]=h.ReadMem;break;case 3:this.transferType[t]=h.Undefined}switch(this.autoInit[t]=(16&e)>0,this.inc[t]=(32&e)>0?a.Dec:a.Inc,e>>6&3){case 0:this.mode[t]=r.Demand;break;case 1:this.mode[t]=r.Single;break;case 2:this.mode[t]=r.Block;break;case 3:this.mode[t]=r.Cascade}this.terminalCount[t]=!1}break;case 12:for(let t=0;t<this.channelCount;t++)this.blockSizeByteNo[t]=0,this.offsetByteNo[t]=0;break;case 13:for(let t=0;t<this.channelCount;t++)this.blockSize[t]=0,this.blockSizeByteNo[t]=0,this.page[t]=0,this.offset[t]=0,this.offsetByteNo[t]=0,this.mode[t]=0,this.inc[t]=a.Inc,this.autoInit[t]=!1,this.channelEnabled[t]=!0,this.terminalCount[t]=!1}}triggerDmaDeviceToMem(t,e,s){if(this.mode[t]==r.Single||this.mode[t]==r.Block){let i=(this.page[t]<<16)+this.offset[t],r=this.blockSize[t]+1;const h=this.inc[t]==a.Inc?1:-1,o={endOfData:!1};for(;r>0&&!o.endOfData;)this.memoryProvider.poke(i,e.getNextByte(o)),i+=h,r--;this.terminalCount[t]=!0,s&&s()}}triggerDmaMemToDevice(t,e,s){if(this.mode[t]==r.Single||this.mode[t]==r.Block){let i=(this.page[t]<<16)+this.offset[t],r=this.blockSize[t]+1;const h=this.inc[t]==a.Inc?1:-1,o={endOfData:!1};for(;r>0&&!o.endOfData;)e.setNextByte(this.memoryProvider.peek(i),o),i+=h,r--;this.terminalCount[t]=!0,s&&s()}}}e.DmaController=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ppi=void 0;const i=s(1),r=s(4),a=s(0);class h extends i.BaseComponent{constructor(t,e){super(),this.emptyKey=0,this.keyDelay=500,this.keyQueue=new Array,this.currentKey=0,this.kbClockLowClockCount=0,this.pic=t,this.onSpeaker=e}get speakerEnabled(){return this._speakerEnabled}addScanCode(t){this.kbClockLow||(this.keyEventActive?this.keyQueue.push(t):(this.keyEventActive=!0,this.keyQueue.push(t),this.eventTimer.setEvent(this.keyDelay,()=>this.doKeyEvent())))}in(t){switch(t){case 96:return this.currentKey;case 97:{this.kbRefreshToggle=!this.kbRefreshToggle;let t=0;return this.kbClockLow||(t|=64),this.kbRefreshToggle&&(t|=16),this.readHighSwitches&&(t|=8),this.speakerData&&(t|=2),this.speakerGate&&(t|=1),t}case 98:if(this.readHighSwitches){return(a.Settings.graphicsAdapterType==a.GraphicsType.EGA||a.Settings.graphicsAdapterType==a.GraphicsType.VGA?0:a.Settings.monochromeGraphics?3:2)+(a.Settings.floppyCount-1<<2)&65535}return 13;case 99:return 0}return 0}out(t,e,s){switch(t){case 96:break;case 97:{(128&e)>0&&(this.currentKey=this.emptyKey);const t=0==(64&e);t!=this.kbClockLow&&(t?this.kbClockLowClockCount=this.eventTimer.clockCount:this.eventTimer.clockCount-this.kbClockLowClockCount>=12*a.Settings.cpuFrequency&&this.eventTimer.setEvent(100,()=>{this.keyQueue.length=0,this.addScanCode(170)}),this.kbClockLow=t),this.speakerGate=(1&e)>0,this.speakerData=(2&e)>0;const s=this.speakerGate&&this.speakerData,i=this.speakerEnabled!=s;this._speakerEnabled=s,i&&this.onSpeaker(),this.readHighSwitches=(8&e)>0}}}doKeyEvent(){this.keyQueue.length>0?(this.internalAddScanCode(this.keyQueue.shift()),this.eventTimer.setEvent(this.keyDelay,()=>this.doKeyEvent())):this.keyEventActive=!1}internalAddScanCode(t){this.kbClockLow||(this.currentKey=t,this.pic.doInterrupt(r.HardwareInterrupt.Keyboard))}}e.Ppi=h},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=void 0;const i=s(1),r=s(4),a=s(0);var h,o;!function(t){t[t.LowNibble=0]="LowNibble",t[t.HighNibble=1]="HighNibble",t[t.LowAndHigh=2]="LowAndHigh"}(h||(h={})),function(t){t[t.M16Bit=0]="M16Bit",t[t.Bcd=1]="Bcd"}(o||(o={}));class n{constructor(t,e,s){this.countsPerSec=1193180,this.countsPerMs=Math.trunc(this.countsPerSec/1e3),this.byteNo=0,this.latchValue=0,this._mode=0,this.startValue=0,this.startClockCount=0,this.eventId=0,this.timer=t,this.pic=e,this.counterNo=s}get accessMode(){return this._accessMode}set accessMode(t){this._accessMode=t,this.byteNo=0}get frequency(){return Math.trunc(this.countsPerSec/this.startValue)}get mode(){return this._mode}set mode(t){switch(this._mode=t,this.eventId>0&&this.timer.eventTimer.deleteEvent(this.eventId),this.mode){case 0:break;case 1:throw new Error("Method not implemented.");case 2:case 3:break;case 4:case 5:throw new Error("Method not implemented.")}}calcValue(){if(this.isRunning){const t=Math.trunc(1e3*(this.timer.eventTimer.clockCount-this.startClockCount)/a.Settings.cpuFrequency);return this.startValue-Math.trunc(t*this.countsPerMs/1e3)&65535}return 0}writeFinished(){this.isRunning=!0,0==this.startValue&&(this.startValue=65536),3!=this.mode&&2!=this.mode&&0!=this.mode||(this.eventId>0&&this.timer.eventTimer.deleteEvent(this.eventId),this.startClockCount=this.timer.eventTimer.clockCount,this.eventId=this.timer.eventTimer.setEvent(Math.trunc(1e3*this.startValue/this.countsPerMs),()=>this.onCountZero()),this.onChangeFrequency&&this.onChangeFrequency())}onCountZero(){switch(this.generateTimerInt&&this.pic.doInterrupt(r.HardwareInterrupt.Timer),this.mode){case 0:this.isRunning=!1;break;case 2:case 3:this.startClockCount=this.timer.eventTimer.clockCount,this.eventId=this.timer.eventTimer.setEvent(Math.trunc(1e3*this.startValue/this.countsPerMs),()=>this.onCountZero())}}reset(){this.mode=0,this.eventId=0,this.isRunning=!1,this.byteNo=0}write(t){switch(this.accessMode){case h.LowNibble:this.startValue=65535&(65280&this.startValue|t),this.writeFinished();break;case h.HighNibble:this.startValue=65535&(255&this.startValue|t<<8),this.writeFinished();break;case h.LowAndHigh:0==this.byteNo?this.startValue=65535&(65280&this.startValue|t):(this.startValue=65535&(255&this.startValue|t<<8),this.writeFinished()),this.byteNo=1-this.byteNo}}read(){let t=0;const e=this.isLatched?this.latchValue:this.calcValue();switch(this.accessMode){case h.LowNibble:t=255&e,this.isLatched=!1;break;case h.HighNibble:t=e>>8&255,this.isLatched=!1;break;case h.LowAndHigh:0==this.byteNo?t=255&e:(t=e>>8&255,this.isLatched=!1),this.byteNo=1-this.byteNo}return t}doLatch(){this.latchValue=this.calcValue(),this.isLatched=!0}}class c extends i.BaseComponent{constructor(t,e){super(),this.counters=new Array(3),this.memRefreshActive=!0;for(let e=0;e<this.counters.length;e++)this.counters[e]=new n(this,t,e);this.counters[0].generateTimerInt=!0,null!=e&&(this.counters[2].onChangeFrequency=e)}get speakerFrequency(){return 3==this.counters[2].mode?this.counters[2].frequency:0}reset(){super.reset();for(const t of this.counters)t.reset()}in(t){return t>=64&&t<=66?this.counters[t-64].read():0}out(t,e,s){if(t>=64&&t<=66&&this.counters[t-64].write(255&e),67==t){const t=e>>6&3;if(t>2)return;const s=this.counters[t],i=e>>4&3,r=e>>1&7;switch(i){case 0:s.doLatch();break;case 1:s.accessMode=h.LowNibble;break;case 2:s.accessMode=h.HighNibble;break;case 3:s.accessMode=h.LowAndHigh}0!=i&&(s.countMode=(1&e)>0?o.Bcd:o.M16Bit,s.mode=r)}}}e.Timer=c},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HardDisk=void 0;const i=s(1),r=s(4),a=s(0),h=s(34),o=s(43);class n{constructor(t,e,s,i,r){this.biosType=0,this.cylinders=0,this.heads=0,this.sectors=0,this.switchCode=0,this.biosType=t,this.cylinders=e,this.heads=s,this.sectors=i,this.switchCode=r}get diskSize(){return this.heads*this.cylinders*this.sectors*n.sectorSize}calcLba(t,e,s){return t<this.cylinders||e<this.heads||s<this.sectors?(t*this.heads+e)*this.sectors+s:null}}var c;n.sectorSize=512,function(t){t[t.None=0]="None",t[t.NoIndexSignal=1]="NoIndexSignal",t[t.NoSeekCompleteSignal=2]="NoSeekCompleteSignal",t[t.WriteFault=3]="WriteFault",t[t.NoReadyAfterDriveSelect=4]="NoReadyAfterDriveSelect",t[t.NoTrack00Signal=6]="NoTrack00Signal",t[t.SeekNotComplete=8]="SeekNotComplete",t[t.IdReadError=16]="IdReadError",t[t.DataError=17]="DataError",t[t.NoAddressMark=18]="NoAddressMark",t[t.SectorNotFound=20]="SectorNotFound",t[t.SeekError=21]="SeekError",t[t.CorrectableDataError=24]="CorrectableDataError",t[t.BadTrack=25]="BadTrack",t[t.InvalidCommand=32]="InvalidCommand",t[t.IllegalDiskAddress=33]="IllegalDiskAddress",t[t.RamError=48]="RamError",t[t.ProgramChecksumError=49]="ProgramChecksumError",t[t.EccError=50]="EccError"}(c||(c={}));class d extends i.BaseComponent{constructor(t,e){super(),this.driveCount=2,this.commandDelay=500,this.readWriteDelay=100,this.allDriveSpecs=new Array,this.driveSpecs=new Array(this.driveCount),this.diskImages=new Array(this.driveCount),this.diskImagePath=new Array(this.driveCount),this.imageChanged=new Array(this.driveCount),this.selectedDrive=0,this.head=0,this.cylinder=0,this.sector=0,this.interlBlockCount=0,this.controlField=0,this.command=0,this.dataPointer=0,this.dmaInterruptMask=0,this.driveCharacteristics=new Array(this.driveCount),this.dcbByteNo=0,this.errorBytes=new Array,this.outputBytes=new Array,this.addressValid=!0,this.pic=t,this.dmaController=e,this.initDriveSpecs(),this.setDriveType(0,2),this.setDriveType(1,2);for(let t=0;t<this.driveCount;t++)this.driveCharacteristics[t]=new Uint8Array(8),this.diskImagePath[t]=a.Settings.hdImageDir+"HD"+t+".ima.gz"}async loadImages(){for(let t=0;t<this.driveCount;t++){if(null==this.driveSpecs[t])return;await this.loadImage(t)}}async saveImages(){for(let t=0;t<this.driveCount;t++)await this.saveImage(t)}async loadImage(t){const e=a.Settings.baseDir+this.diskImagePath[t];this.storage||(this.storage=new o.DbStorage("HDD"),await this.storage.initialize());const s=await this.storage.getData("image"+t);if(void 0!==s){const e=new Uint8Array(s);if(e.length==this.driveSpecs[t].diskSize)return this.diskImages[t]=e,void(this.imageChanged[t]=!1)}return new Promise((s,i)=>{const r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",e,!0),r.onload=()=>{if(200!=r.status)return void i();const e=r.response,a=h.ungzip(new Uint8Array(e));a.length==this.driveSpecs[t].diskSize&&(this.diskImages[t]=a,this.imageChanged[t]=!1),s()},r.onerror=()=>{i()},r.send()})}async saveImage(t){this.storage&&await this.storage.setData("image"+t,this.diskImages[t].buffer)}generateError(t){this.errorBytes.length=0,this.errorBytes.push(255&(this.addressValid?128:0+t)),this.errorBytes.push((this.selectedDrive<<5)+this.head&255),this.errorBytes.push(((1792&this.cylinder)>>3)+this.sector&255),this.errorBytes.push(this.cylinder),this.currentCommandError=!0}in(t){var e,s,i,r;switch(t){case 800:if(null!=this.statusByte){const t=this.statusByte;return this.statusByte=null,this.requestBit=!1,this.modeBit=!1,this.commandDataBit=!1,this.busyBit=!1,t}if(this.outputBytes.length>0){return this.outputBytes.shift()}break;case 801:return(this.requestBit?1:0)+(this.modeBit?2:0)+(this.commandDataBit?4:0)+(this.busyBit?8:0)+(null!=this.statusByte?32:0)&65535;case 802:return 65535&(null!==(s=(null===(e=this.driveSpecs[0])||void 0===e?void 0:e.switchCode)<<2)&&void 0!==s?s:0)+(null!==(r=null===(i=this.driveSpecs[1])||void 0===i?void 0:i.switchCode)&&void 0!==r?r:0)}return 0}out(t,e,s){switch(t){case 800:this.commandDataBit=!1,this.writeDataByte(255&e);break;case 801:(64&e)>0&&this.reset();break;case 802:this.requestBit=!0,this.commandDataBit=!0,this.busyBit=!0;break;case 803:this.interruptEnabled=(2&e)>0,this.dmaInterruptMask=e}}setDriveType(t,e){const s=this.allDriveSpecs.find(t=>t.biosType==e);if(null==s)throw new Error("Harddisk drive type "+e+" not found.");this.driveSpecs[t]=s,this.diskImages[t]=new Uint8Array(s.diskSize)}initDriveSpecs(){this.allDriveSpecs.push(new n(1,306,4,17,0)),this.allDriveSpecs.push(new n(2,615,4,17,1)),this.allDriveSpecs.push(new n(13,306,8,17,3)),this.allDriveSpecs.push(new n(16,612,4,17,2))}reset(){super.reset(),this.selectedDrive=0,this.dcbByteNo=0,this.requestBit=!1,this.commandDataBit=!1,this.busyBit=!1,this.requestBit=!1,this.errorBytes.length=0,this.currentCommandError=!1,this.outputBytes.length=0}writeDataByte(t){switch(this.dcbByteNo){case 0:this.command=t;break;case 1:this.head=31&t,this.selectedDrive=(32&t)>0?1:0;break;case 2:this.sector=63&t,this.cylinder=(192&t)<<2;break;case 3:this.cylinder=this.cylinder+t;break;case 4:this.interlBlockCount=t;break;case 5:this.controlField=t}this.dcbByteNo<5?this.dcbByteNo++:12==this.command&&this.dcbByteNo<13?(this.driveCharacteristics[this.selectedDrive][this.dcbByteNo-5]=t,this.dcbByteNo++):(this.dcbByteNo=0,this.executeCommand())}getStatusByte(){let t=0;return 1==this.selectedDrive&&(t|=32),this.currentCommandError&&(t|=2),t}commandFinished(){this.command=0,this.eventTimer.setEvent(this.commandDelay,()=>{this.commandDataBit=!0,this.modeBit=!0,this.statusByte=this.getStatusByte(),this.currentCommandError=!1,this.isBusy=!1,this.interruptEnabled&&this.pic.doInterrupt(r.HardwareInterrupt.Harddisk)})}executeCommand(){if(!this.isBusy){if(this.isBusy=!0,this.currentCommandError=!1,this.errorBytes.length=0,null==this.driveSpecs[this.selectedDrive]);else switch(this.command){case 0:case 1:break;case 3:for(;this.errorBytes.length>0;)this.outputBytes.push(this.errorBytes.shift());break;case 4:case 5:case 6:case 7:break;case 8:this.dataPointer=this.calcLba(this.cylinder,this.head,this.sector)*n.sectorSize,this.currentCommandError||this.eventTimer.setEvent(this.readWriteDelay,()=>this.dmaController.triggerDmaDeviceToMem(3,this,null));break;case 10:this.dataPointer=this.calcLba(this.cylinder,this.head,this.sector)*n.sectorSize,this.currentCommandError||this.eventTimer.setEvent(this.readWriteDelay,()=>{this.dmaController.triggerDmaMemToDevice(3,this,null),this.imageChanged[this.selectedDrive]=!0});break;case 11:case 12:case 13:break;case 14:throw new Error("Method not implemented.");case 15:case 224:case 227:case 228:break;case 229:case 230:throw new Error("Method not implemented.");default:this.generateError(c.InvalidCommand)}this.commandFinished()}}calcLba(t,e,s){const i=this.driveSpecs[this.selectedDrive].calcLba(t,e,s);return null==i?(this.generateError(c.IllegalDiskAddress),0):i}getNextByte(t){const e=this.diskImages[this.selectedDrive];return this.dataPointer<e.length?(t.endOfData=!1,e[this.dataPointer++]):(t.endOfData=!0,0)}setNextByte(t,e){e.endOfData=!1,this.diskImages[this.selectedDrive][this.dataPointer++]=t}}e.HardDisk=d},function(t,e,s){"use strict";var i={};(0,s(2).assign)(i,s(35),s(38),s(14)),t.exports=i},function(t,e,s){"use strict";var i=s(36),r=s(2),a=s(12),h=s(8),o=s(13),n=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var s=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==s)throw new Error(h[s]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var d;if(d="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===n.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(s=i.deflateSetDictionary(this.strm,d)))throw new Error(h[s]);this._dict_set=!0}}function d(t,e){var s=new c(e);if(s.push(t,!0),s.err)throw s.msg||h[s.err];return s.result}c.prototype.push=function(t,e){var s,h,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;h=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===n.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(c),o.next_out=0,o.avail_out=c),1!==(s=i.deflate(o,h))&&0!==s)return this.onEnd(s),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==h&&2!==h)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==s);return 4===h?(s=i.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,0===s):2!==h||(this.onEnd(0),o.avail_out=0,!0)},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=c,e.deflate=d,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,d(t,e)}},function(t,e,s){"use strict";var i,r=s(2),a=s(37),h=s(10),o=s(11),n=s(8);function c(t,e){return t.msg=n[e],e}function d(t){return(t<<1)-(t>4?9:0)}function l(t){for(var e=t.length;--e>=0;)t[e]=0}function u(t){var e=t.state,s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(r.arraySet(t.output,e.pending_buf,e.pending_out,s,t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))}function m(t,e){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,u(t.strm)}function g(t,e){t.pending_buf[t.pending++]=e}function p(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function k(t,e){var s,i,r=t.max_chain_length,a=t.strstart,h=t.prev_length,o=t.nice_match,n=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,c=t.window,d=t.w_mask,l=t.prev,u=t.strstart+258,m=c[a+h-1],g=c[a+h];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(c[(s=e)+h]===g&&c[s+h-1]===m&&c[s]===c[a]&&c[++s]===c[a+1]){a+=2,s++;do{}while(c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&a<u);if(i=258-(u-a),a=u-258,i>h){if(t.match_start=e,h=i,i>=o)break;m=c[a+h-1],g=c[a+h]}}}while((e=l[e&d])>n&&0!=--r);return h<=t.lookahead?h:t.lookahead}function C(t){var e,s,i,a,n,c,d,l,u,m,g=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=g+(g-262)){r.arraySet(t.window,t.window,g,g,0),t.match_start-=g,t.strstart-=g,t.block_start-=g,e=s=t.hash_size;do{i=t.head[--e],t.head[e]=i>=g?i-g:0}while(--s);e=s=g;do{i=t.prev[--e],t.prev[e]=i>=g?i-g:0}while(--s);a+=g}if(0===t.strm.avail_in)break;if(c=t.strm,d=t.window,l=t.strstart+t.lookahead,u=a,m=void 0,(m=c.avail_in)>u&&(m=u),s=0===m?0:(c.avail_in-=m,r.arraySet(d,c.input,c.next_in,m,l),1===c.state.wrap?c.adler=h(c.adler,d,m,l):2===c.state.wrap&&(c.adler=o(c.adler,d,m,l)),c.next_in+=m,c.total_in+=m,m),t.lookahead+=s,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=(t.ins_h<<t.hash_shift^t.window[n+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[n+3-1])&t.hash_mask,t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function b(t,e){for(var s,i;;){if(t.lookahead<262){if(C(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-262&&(t.match_length=k(t,s)),t.match_length>=3)if(i=a._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}function S(t,e){for(var s,i,r;;){if(t.lookahead<262){if(C(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-262&&(t.match_length=k(t,s),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(m(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=a._tr_tally(t,0,t.window[t.strstart-1]))&&m(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}function f(t,e,s,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=i,this.func=r}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),l(this.dyn_ltree),l(this.dyn_dtree),l(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),l(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),l(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function R(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,a._tr_init(e),0):c(t,-2)}function A(t){var e,s=R(t);return 0===s&&((e=t.state).window_size=2*e.w_size,l(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),s}function v(t,e,s,i,a,h){if(!t)return-2;var o=1;if(-1===e&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>9||8!==s||i<8||i>15||e<0||e>9||h<0||h>4)return c(t,-2);8===i&&(i=9);var n=new y;return t.state=n,n.strm=t,n.wrap=o,n.gzhead=null,n.w_bits=i,n.w_size=1<<n.w_bits,n.w_mask=n.w_size-1,n.hash_bits=a+7,n.hash_size=1<<n.hash_bits,n.hash_mask=n.hash_size-1,n.hash_shift=~~((n.hash_bits+3-1)/3),n.window=new r.Buf8(2*n.w_size),n.head=new r.Buf16(n.hash_size),n.prev=new r.Buf16(n.w_size),n.lit_bufsize=1<<a+6,n.pending_buf_size=4*n.lit_bufsize,n.pending_buf=new r.Buf8(n.pending_buf_size),n.d_buf=1*n.lit_bufsize,n.l_buf=3*n.lit_bufsize,n.level=e,n.strategy=h,n.method=s,A(t)}i=[new f(0,0,0,0,(function(t,e){var s=65535;for(s>t.pending_buf_size-5&&(s=t.pending_buf_size-5);;){if(t.lookahead<=1){if(C(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+s;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,m(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(m(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(m(t,!1),t.strm.avail_out),1)})),new f(4,4,8,4,b),new f(4,5,16,8,b),new f(4,6,32,32,b),new f(4,4,16,16,S),new f(8,16,32,32,S),new f(8,16,128,128,S),new f(8,32,128,256,S),new f(32,128,258,1024,S),new f(32,258,258,4096,S)],e.deflateInit=function(t,e){return v(t,e,8,15,8,0)},e.deflateInit2=v,e.deflateReset=A,e.deflateResetKeep=R,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},e.deflate=function(t,e){var s,r,h,n;if(!t||!t.state||e>5||e<0)return t?c(t,-2):-2;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&4!==e)return c(t,0===t.avail_out?-5:-2);if(r.strm=t,s=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,g(r,31),g(r,139),g(r,8),r.gzhead?(g(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),g(r,255&r.gzhead.time),g(r,r.gzhead.time>>8&255),g(r,r.gzhead.time>>16&255),g(r,r.gzhead.time>>24&255),g(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),g(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(g(r,255&r.gzhead.extra.length),g(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(g(r,0),g(r,0),g(r,0),g(r,0),g(r,0),g(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),g(r,3),r.status=113);else{var k=8+(r.w_bits-8<<4)<<8;k|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(k|=32),k+=31-k%31,r.status=113,p(r,k),0!==r.strstart&&(p(r,t.adler>>>16),p(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(h=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),u(t),h=r.pending,r.pending!==r.pending_buf_size));)g(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){h=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),u(t),h=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,g(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),0===n&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){h=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),u(t),h=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,g(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>h&&(t.adler=o(t.adler,r.pending_buf,r.pending-h,h)),0===n&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&u(t),r.pending+2<=r.pending_buf_size&&(g(r,255&t.adler),g(r,t.adler>>8&255),t.adler=0,r.status=113)):r.status=113),0!==r.pending){if(u(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&d(e)<=d(s)&&4!==e)return c(t,-5);if(666===r.status&&0!==t.avail_in)return c(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&666!==r.status){var b=2===r.strategy?function(t,e){for(var s;;){if(0===t.lookahead&&(C(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var s,i,r,h,o=t.window;;){if(t.lookahead<=258){if(C(t),t.lookahead<=258&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=o[r=t.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){h=t.strstart+258;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<h);t.match_length=258-(h-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(s=a._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}(r,e):i[r.level].func(r,e);if(3!==b&&4!==b||(r.status=666),1===b||3===b)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===b&&(1===e?a._tr_align(r):5!==e&&(a._tr_stored_block(r,0,0,!1),3===e&&(l(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),u(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(g(r,255&t.adler),g(r,t.adler>>8&255),g(r,t.adler>>16&255),g(r,t.adler>>24&255),g(r,255&t.total_in),g(r,t.total_in>>8&255),g(r,t.total_in>>16&255),g(r,t.total_in>>24&255)):(p(r,t.adler>>>16),p(r,65535&t.adler)),u(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?c(t,-2):(t.state=null,113===e?c(t,-3):0):-2},e.deflateSetDictionary=function(t,e){var s,i,a,o,n,c,d,u,m=e.length;if(!t||!t.state)return-2;if(2===(o=(s=t.state).wrap)||1===o&&42!==s.status||s.lookahead)return-2;for(1===o&&(t.adler=h(t.adler,e,m,0)),s.wrap=0,m>=s.w_size&&(0===o&&(l(s.head),s.strstart=0,s.block_start=0,s.insert=0),u=new r.Buf8(s.w_size),r.arraySet(u,e,m-s.w_size,s.w_size,0),e=u,m=s.w_size),n=t.avail_in,c=t.next_in,d=t.input,t.avail_in=m,t.next_in=0,t.input=e,C(s);s.lookahead>=3;){i=s.strstart,a=s.lookahead-2;do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[i+3-1])&s.hash_mask,s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++}while(--a);s.strstart=i,s.lookahead=2,C(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=c,t.input=d,t.avail_in=n,s.wrap=o,0},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,s){"use strict";var i=s(2);function r(t){for(var e=t.length;--e>=0;)t[e]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],h=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],n=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);r(c);var d=new Array(60);r(d);var l=new Array(512);r(l);var u=new Array(256);r(u);var m=new Array(29);r(m);var g,p,k,C=new Array(30);function b(t,e,s,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function S(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function f(t){return t<256?l[t]:l[256+(t>>>7)]}function y(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function R(t,e,s){t.bi_valid>16-s?(t.bi_buf|=e<<t.bi_valid&65535,y(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)}function A(t,e,s){R(t,s[2*e],s[2*e+1])}function v(t,e){var s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1}function B(t,e,s){var i,r,a=new Array(16),h=0;for(i=1;i<=15;i++)a[i]=h=h+s[i-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=v(a[o]++,o))}}function I(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function D(t){t.bi_valid>8?y(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function M(t,e,s,i){var r=2*e,a=2*s;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[s]}function w(t,e,s){for(var i=t.heap[s],r=s<<1;r<=t.heap_len&&(r<t.heap_len&&M(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!M(e,i,t.heap[r],t.depth));)t.heap[s]=t.heap[r],s=r,r<<=1;t.heap[s]=i}function x(t,e,s){var i,r,o,n,c=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],r=t.pending_buf[t.l_buf+c],c++,0===i?A(t,r,e):(A(t,(o=u[r])+256+1,e),0!==(n=a[o])&&R(t,r-=m[o],n),A(t,o=f(--i),s),0!==(n=h[o])&&R(t,i-=C[o],n))}while(c<t.last_lit);A(t,256,e)}function _(t,e){var s,i,r,a=e.dyn_tree,h=e.stat_desc.static_tree,o=e.stat_desc.has_stree,n=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<n;s++)0!==a[2*s]?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):a[2*s+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=h[2*r+1]);for(e.max_code=c,s=t.heap_len>>1;s>=1;s--)w(t,a,s);r=n;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],w(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=i,a[2*r]=a[2*s]+a[2*i],t.depth[r]=(t.depth[s]>=t.depth[i]?t.depth[s]:t.depth[i])+1,a[2*s+1]=a[2*i+1]=r,t.heap[1]=r++,w(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var s,i,r,a,h,o,n=e.dyn_tree,c=e.max_code,d=e.stat_desc.static_tree,l=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,m=e.stat_desc.extra_base,g=e.stat_desc.max_length,p=0;for(a=0;a<=15;a++)t.bl_count[a]=0;for(n[2*t.heap[t.heap_max]+1]=0,s=t.heap_max+1;s<573;s++)(a=n[2*n[2*(i=t.heap[s])+1]+1]+1)>g&&(a=g,p++),n[2*i+1]=a,i>c||(t.bl_count[a]++,h=0,i>=m&&(h=u[i-m]),o=n[2*i],t.opt_len+=o*(a+h),l&&(t.static_len+=o*(d[2*i+1]+h)));if(0!==p){do{for(a=g-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[g]--,p-=2}while(p>0);for(a=g;0!==a;a--)for(i=t.bl_count[a];0!==i;)(r=t.heap[--s])>c||(n[2*r+1]!==a&&(t.opt_len+=(a-n[2*r+1])*n[2*r],n[2*r+1]=a),i--)}}(t,e),B(a,c,t.bl_count)}function O(t,e,s){var i,r,a=-1,h=e[1],o=0,n=7,c=4;for(0===h&&(n=138,c=3),e[2*(s+1)+1]=65535,i=0;i<=s;i++)r=h,h=e[2*(i+1)+1],++o<n&&r===h||(o<c?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,a=r,0===h?(n=138,c=3):r===h?(n=6,c=3):(n=7,c=4))}function F(t,e,s){var i,r,a=-1,h=e[1],o=0,n=7,c=4;for(0===h&&(n=138,c=3),i=0;i<=s;i++)if(r=h,h=e[2*(i+1)+1],!(++o<n&&r===h)){if(o<c)do{A(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(A(t,r,t.bl_tree),o--),A(t,16,t.bl_tree),R(t,o-3,2)):o<=10?(A(t,17,t.bl_tree),R(t,o-3,3)):(A(t,18,t.bl_tree),R(t,o-11,7));o=0,a=r,0===h?(n=138,c=3):r===h?(n=6,c=3):(n=7,c=4)}}r(C);var N=!1;function P(t,e,s,r){R(t,0+(r?1:0),3),function(t,e,s,r){D(t),r&&(y(t,s),y(t,~s)),i.arraySet(t.pending_buf,t.window,e,s,t.pending),t.pending+=s}(t,e,s,!0)}e._tr_init=function(t){N||(!function(){var t,e,s,i,r,n=new Array(16);for(s=0,i=0;i<28;i++)for(m[i]=s,t=0;t<1<<a[i];t++)u[s++]=i;for(u[s-1]=i,r=0,i=0;i<16;i++)for(C[i]=r,t=0;t<1<<h[i];t++)l[r++]=i;for(r>>=7;i<30;i++)for(C[i]=r<<7,t=0;t<1<<h[i]-7;t++)l[256+r++]=i;for(e=0;e<=15;e++)n[e]=0;for(t=0;t<=143;)c[2*t+1]=8,t++,n[8]++;for(;t<=255;)c[2*t+1]=9,t++,n[9]++;for(;t<=279;)c[2*t+1]=7,t++,n[7]++;for(;t<=287;)c[2*t+1]=8,t++,n[8]++;for(B(c,287,n),t=0;t<30;t++)d[2*t+1]=5,d[2*t]=v(t,5);g=new b(c,a,257,286,15),p=new b(d,h,0,30,15),k=new b(new Array(0),o,0,19,7)}(),N=!0),t.l_desc=new S(t.dyn_ltree,g),t.d_desc=new S(t.dyn_dtree,p),t.bl_desc=new S(t.bl_tree,k),t.bi_buf=0,t.bi_valid=0,I(t)},e._tr_stored_block=P,e._tr_flush_block=function(t,e,s,i){var r,a,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),_(t,t.l_desc),_(t,t.d_desc),h=function(t){var e;for(O(t,t.dyn_ltree,t.l_desc.max_code),O(t,t.dyn_dtree,t.d_desc.max_code),_(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*n[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=s+5,s+4<=r&&-1!==e?P(t,e,s,i):4===t.strategy||a===r?(R(t,2+(i?1:0),3),x(t,c,d)):(R(t,4+(i?1:0),3),function(t,e,s,i){var r;for(R(t,e-257,5),R(t,s-1,5),R(t,i-4,4),r=0;r<i;r++)R(t,t.bl_tree[2*n[r]+1],3);F(t,t.dyn_ltree,e-1),F(t,t.dyn_dtree,s-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),x(t,t.dyn_ltree,t.dyn_dtree)),I(t),i&&D(t)},e._tr_tally=function(t,e,s){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&s,t.last_lit++,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(u[s]+256+1)]++,t.dyn_dtree[2*f(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){R(t,2,3),A(t,256,c),function(t){16===t.bi_valid?(y(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,s){"use strict";var i=s(39),r=s(2),a=s(12),h=s(14),o=s(8),n=s(13),c=s(42),d=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var s=i.inflateInit2(this.strm,e.windowBits);if(s!==h.Z_OK)throw new Error(o[s]);if(this.header=new c,i.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=a.string2buf(e.dictionary):"[object ArrayBuffer]"===d.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=i.inflateSetDictionary(this.strm,e.dictionary))!==h.Z_OK))throw new Error(o[s])}function u(t,e){var s=new l(e);if(s.push(t,!0),s.err)throw s.msg||o[s.err];return s.result}l.prototype.push=function(t,e){var s,o,n,c,l,u=this.strm,m=this.options.chunkSize,g=this.options.dictionary,p=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?h.Z_FINISH:h.Z_NO_FLUSH,"string"==typeof t?u.input=a.binstring2buf(t):"[object ArrayBuffer]"===d.call(t)?u.input=new Uint8Array(t):u.input=t,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new r.Buf8(m),u.next_out=0,u.avail_out=m),(s=i.inflate(u,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&g&&(s=i.inflateSetDictionary(this.strm,g)),s===h.Z_BUF_ERROR&&!0===p&&(s=h.Z_OK,p=!1),s!==h.Z_STREAM_END&&s!==h.Z_OK)return this.onEnd(s),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&s!==h.Z_STREAM_END&&(0!==u.avail_in||o!==h.Z_FINISH&&o!==h.Z_SYNC_FLUSH)||("string"===this.options.to?(n=a.utf8border(u.output,u.next_out),c=u.next_out-n,l=a.buf2string(u.output,n),u.next_out=c,u.avail_out=m-c,c&&r.arraySet(u.output,u.output,n,c,0),this.onData(l)):this.onData(r.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(p=!0)}while((u.avail_in>0||0===u.avail_out)&&s!==h.Z_STREAM_END);return s===h.Z_STREAM_END&&(o=h.Z_FINISH),o===h.Z_FINISH?(s=i.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===h.Z_OK):o!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),u.avail_out=0,!0)},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===h.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=l,e.inflate=u,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},e.ungzip=u},function(t,e,s){"use strict";var i=s(2),r=s(10),a=s(11),h=s(40),o=s(41);function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(852),e.distcode=e.distdyn=new i.Buf32(592),e.sane=1,e.back=-1,0):-2}function l(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,d(t)):-2}function u(t,e){var s,i;return t&&t.state?(i=t.state,e<0?(s=0,e=-e):(s=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=s,i.wbits=e,l(t))):-2}function m(t,e){var s,i;return t?(i=new c,t.state=i,i.window=null,0!==(s=u(t,e))&&(t.state=null),s):-2}var g,p,k=!0;function C(t){if(k){var e;for(g=new i.Buf32(512),p=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(1,t.lens,0,288,g,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(2,t.lens,0,32,p,0,t.work,{bits:5}),k=!1}t.lencode=g,t.lenbits=9,t.distcode=p,t.distbits=5}function b(t,e,s,r){var a,h=t.state;return null===h.window&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new i.Buf8(h.wsize)),r>=h.wsize?(i.arraySet(h.window,e,s-h.wsize,h.wsize,0),h.wnext=0,h.whave=h.wsize):((a=h.wsize-h.wnext)>r&&(a=r),i.arraySet(h.window,e,s-r,a,h.wnext),(r-=a)?(i.arraySet(h.window,e,s-r,r,0),h.wnext=r,h.whave=h.wsize):(h.wnext+=a,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=a))),0}e.inflateReset=l,e.inflateReset2=u,e.inflateResetKeep=d,e.inflateInit=function(t){return m(t,15)},e.inflateInit2=m,e.inflate=function(t,e){var s,c,d,l,u,m,g,p,k,S,f,y,R,A,v,B,I,D,M,w,x,_,O,F,N=0,P=new i.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(s=t.state).mode&&(s.mode=13),u=t.next_out,d=t.output,g=t.avail_out,l=t.next_in,c=t.input,m=t.avail_in,p=s.hold,k=s.bits,S=m,f=g,_=0;t:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;k<16;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(2&s.wrap&&35615===p){s.check=0,P[0]=255&p,P[1]=p>>>8&255,s.check=a(s.check,P,2,0),p=0,k=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&p)<<8)+(p>>8))%31){t.msg="incorrect header check",s.mode=30;break}if(8!=(15&p)){t.msg="unknown compression method",s.mode=30;break}if(k-=4,x=8+(15&(p>>>=4)),0===s.wbits)s.wbits=x;else if(x>s.wbits){t.msg="invalid window size",s.mode=30;break}s.dmax=1<<x,t.adler=s.check=1,s.mode=512&p?10:12,p=0,k=0;break;case 2:for(;k<16;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(s.flags=p,8!=(255&s.flags)){t.msg="unknown compression method",s.mode=30;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=30;break}s.head&&(s.head.text=p>>8&1),512&s.flags&&(P[0]=255&p,P[1]=p>>>8&255,s.check=a(s.check,P,2,0)),p=0,k=0,s.mode=3;case 3:for(;k<32;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}s.head&&(s.head.time=p),512&s.flags&&(P[0]=255&p,P[1]=p>>>8&255,P[2]=p>>>16&255,P[3]=p>>>24&255,s.check=a(s.check,P,4,0)),p=0,k=0,s.mode=4;case 4:for(;k<16;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}s.head&&(s.head.xflags=255&p,s.head.os=p>>8),512&s.flags&&(P[0]=255&p,P[1]=p>>>8&255,s.check=a(s.check,P,2,0)),p=0,k=0,s.mode=5;case 5:if(1024&s.flags){for(;k<16;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}s.length=p,s.head&&(s.head.extra_len=p),512&s.flags&&(P[0]=255&p,P[1]=p>>>8&255,s.check=a(s.check,P,2,0)),p=0,k=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&((y=s.length)>m&&(y=m),y&&(s.head&&(x=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),i.arraySet(s.head.extra,c,l,y,x)),512&s.flags&&(s.check=a(s.check,c,y,l)),m-=y,l+=y,s.length-=y),s.length))break t;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===m)break t;y=0;do{x=c[l+y++],s.head&&x&&s.length<65536&&(s.head.name+=String.fromCharCode(x))}while(x&&y<m);if(512&s.flags&&(s.check=a(s.check,c,y,l)),m-=y,l+=y,x)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===m)break t;y=0;do{x=c[l+y++],s.head&&x&&s.length<65536&&(s.head.comment+=String.fromCharCode(x))}while(x&&y<m);if(512&s.flags&&(s.check=a(s.check,c,y,l)),m-=y,l+=y,x)break t}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;k<16;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(p!==(65535&s.check)){t.msg="header crc mismatch",s.mode=30;break}p=0,k=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=12;break;case 10:for(;k<32;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}t.adler=s.check=n(p),p=0,k=0,s.mode=11;case 11:if(0===s.havedict)return t.next_out=u,t.avail_out=g,t.next_in=l,t.avail_in=m,s.hold=p,s.bits=k,2;t.adler=s.check=1,s.mode=12;case 12:if(5===e||6===e)break t;case 13:if(s.last){p>>>=7&k,k-=7&k,s.mode=27;break}for(;k<3;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}switch(s.last=1&p,k-=1,3&(p>>>=1)){case 0:s.mode=14;break;case 1:if(C(s),s.mode=20,6===e){p>>>=2,k-=2;break t}break;case 2:s.mode=17;break;case 3:t.msg="invalid block type",s.mode=30}p>>>=2,k-=2;break;case 14:for(p>>>=7&k,k-=7&k;k<32;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if((65535&p)!=(p>>>16^65535)){t.msg="invalid stored block lengths",s.mode=30;break}if(s.length=65535&p,p=0,k=0,s.mode=15,6===e)break t;case 15:s.mode=16;case 16:if(y=s.length){if(y>m&&(y=m),y>g&&(y=g),0===y)break t;i.arraySet(d,c,l,y,u),m-=y,l+=y,g-=y,u+=y,s.length-=y;break}s.mode=12;break;case 17:for(;k<14;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(s.nlen=257+(31&p),p>>>=5,k-=5,s.ndist=1+(31&p),p>>>=5,k-=5,s.ncode=4+(15&p),p>>>=4,k-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=30;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;k<3;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}s.lens[W[s.have++]]=7&p,p>>>=3,k-=3}for(;s.have<19;)s.lens[W[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,O={bits:s.lenbits},_=o(0,s.lens,0,19,s.lencode,0,s.work,O),s.lenbits=O.bits,_){t.msg="invalid code lengths set",s.mode=30;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;B=(N=s.lencode[p&(1<<s.lenbits)-1])>>>16&255,I=65535&N,!((v=N>>>24)<=k);){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(I<16)p>>>=v,k-=v,s.lens[s.have++]=I;else{if(16===I){for(F=v+2;k<F;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(p>>>=v,k-=v,0===s.have){t.msg="invalid bit length repeat",s.mode=30;break}x=s.lens[s.have-1],y=3+(3&p),p>>>=2,k-=2}else if(17===I){for(F=v+3;k<F;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}k-=v,x=0,y=3+(7&(p>>>=v)),p>>>=3,k-=3}else{for(F=v+7;k<F;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}k-=v,x=0,y=11+(127&(p>>>=v)),p>>>=7,k-=7}if(s.have+y>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=30;break}for(;y--;)s.lens[s.have++]=x}}if(30===s.mode)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=30;break}if(s.lenbits=9,O={bits:s.lenbits},_=o(1,s.lens,0,s.nlen,s.lencode,0,s.work,O),s.lenbits=O.bits,_){t.msg="invalid literal/lengths set",s.mode=30;break}if(s.distbits=6,s.distcode=s.distdyn,O={bits:s.distbits},_=o(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,O),s.distbits=O.bits,_){t.msg="invalid distances set",s.mode=30;break}if(s.mode=20,6===e)break t;case 20:s.mode=21;case 21:if(m>=6&&g>=258){t.next_out=u,t.avail_out=g,t.next_in=l,t.avail_in=m,s.hold=p,s.bits=k,h(t,f),u=t.next_out,d=t.output,g=t.avail_out,l=t.next_in,c=t.input,m=t.avail_in,p=s.hold,k=s.bits,12===s.mode&&(s.back=-1);break}for(s.back=0;B=(N=s.lencode[p&(1<<s.lenbits)-1])>>>16&255,I=65535&N,!((v=N>>>24)<=k);){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(B&&0==(240&B)){for(D=v,M=B,w=I;B=(N=s.lencode[w+((p&(1<<D+M)-1)>>D)])>>>16&255,I=65535&N,!(D+(v=N>>>24)<=k);){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}p>>>=D,k-=D,s.back+=D}if(p>>>=v,k-=v,s.back+=v,s.length=I,0===B){s.mode=26;break}if(32&B){s.back=-1,s.mode=12;break}if(64&B){t.msg="invalid literal/length code",s.mode=30;break}s.extra=15&B,s.mode=22;case 22:if(s.extra){for(F=s.extra;k<F;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}s.length+=p&(1<<s.extra)-1,p>>>=s.extra,k-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;B=(N=s.distcode[p&(1<<s.distbits)-1])>>>16&255,I=65535&N,!((v=N>>>24)<=k);){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(0==(240&B)){for(D=v,M=B,w=I;B=(N=s.distcode[w+((p&(1<<D+M)-1)>>D)])>>>16&255,I=65535&N,!(D+(v=N>>>24)<=k);){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}p>>>=D,k-=D,s.back+=D}if(p>>>=v,k-=v,s.back+=v,64&B){t.msg="invalid distance code",s.mode=30;break}s.offset=I,s.extra=15&B,s.mode=24;case 24:if(s.extra){for(F=s.extra;k<F;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}s.offset+=p&(1<<s.extra)-1,p>>>=s.extra,k-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=30;break}s.mode=25;case 25:if(0===g)break t;if(y=f-g,s.offset>y){if((y=s.offset-y)>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=30;break}y>s.wnext?(y-=s.wnext,R=s.wsize-y):R=s.wnext-y,y>s.length&&(y=s.length),A=s.window}else A=d,R=u-s.offset,y=s.length;y>g&&(y=g),g-=y,s.length-=y;do{d[u++]=A[R++]}while(--y);0===s.length&&(s.mode=21);break;case 26:if(0===g)break t;d[u++]=s.length,g--,s.mode=21;break;case 27:if(s.wrap){for(;k<32;){if(0===m)break t;m--,p|=c[l++]<<k,k+=8}if(f-=g,t.total_out+=f,s.total+=f,f&&(t.adler=s.check=s.flags?a(s.check,d,f,u-f):r(s.check,d,f,u-f)),f=g,(s.flags?p:n(p))!==s.check){t.msg="incorrect data check",s.mode=30;break}p=0,k=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;k<32;){if(0===m)break t;m--,p+=c[l++]<<k,k+=8}if(p!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=30;break}p=0,k=0}s.mode=29;case 29:_=1;break t;case 30:_=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=u,t.avail_out=g,t.next_in=l,t.avail_in=m,s.hold=p,s.bits=k,(s.wsize||f!==t.avail_out&&s.mode<30&&(s.mode<27||4!==e))&&b(t,t.output,t.next_out,f-t.avail_out)?(s.mode=31,-4):(S-=t.avail_in,f-=t.avail_out,t.total_in+=S,t.total_out+=f,s.total+=f,s.wrap&&f&&(t.adler=s.check=s.flags?a(s.check,d,f,t.next_out-f):r(s.check,d,f,t.next_out-f)),t.data_type=s.bits+(s.last?64:0)+(12===s.mode?128:0)+(20===s.mode||15===s.mode?256:0),(0===S&&0===f||4===e)&&0===_&&(_=-5),_)},e.inflateEnd=function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var s;return t&&t.state?0==(2&(s=t.state).wrap)?-2:(s.head=e,e.done=!1,0):-2},e.inflateSetDictionary=function(t,e){var s,i=e.length;return t&&t.state?0!==(s=t.state).wrap&&11!==s.mode?-2:11===s.mode&&r(1,e,i,0)!==s.check?-3:b(t,e,i,i)?(s.mode=31,-4):(s.havedict=1,0):-2},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,s){"use strict";t.exports=function(t,e){var s,i,r,a,h,o,n,c,d,l,u,m,g,p,k,C,b,S,f,y,R,A,v,B,I;s=t.state,i=t.next_in,B=t.input,r=i+(t.avail_in-5),a=t.next_out,I=t.output,h=a-(e-t.avail_out),o=a+(t.avail_out-257),n=s.dmax,c=s.wsize,d=s.whave,l=s.wnext,u=s.window,m=s.hold,g=s.bits,p=s.lencode,k=s.distcode,C=(1<<s.lenbits)-1,b=(1<<s.distbits)-1;t:do{g<15&&(m+=B[i++]<<g,g+=8,m+=B[i++]<<g,g+=8),S=p[m&C];e:for(;;){if(m>>>=f=S>>>24,g-=f,0===(f=S>>>16&255))I[a++]=65535&S;else{if(!(16&f)){if(0==(64&f)){S=p[(65535&S)+(m&(1<<f)-1)];continue e}if(32&f){s.mode=12;break t}t.msg="invalid literal/length code",s.mode=30;break t}y=65535&S,(f&=15)&&(g<f&&(m+=B[i++]<<g,g+=8),y+=m&(1<<f)-1,m>>>=f,g-=f),g<15&&(m+=B[i++]<<g,g+=8,m+=B[i++]<<g,g+=8),S=k[m&b];s:for(;;){if(m>>>=f=S>>>24,g-=f,!(16&(f=S>>>16&255))){if(0==(64&f)){S=k[(65535&S)+(m&(1<<f)-1)];continue s}t.msg="invalid distance code",s.mode=30;break t}if(R=65535&S,g<(f&=15)&&(m+=B[i++]<<g,(g+=8)<f&&(m+=B[i++]<<g,g+=8)),(R+=m&(1<<f)-1)>n){t.msg="invalid distance too far back",s.mode=30;break t}if(m>>>=f,g-=f,R>(f=a-h)){if((f=R-f)>d&&s.sane){t.msg="invalid distance too far back",s.mode=30;break t}if(A=0,v=u,0===l){if(A+=c-f,f<y){y-=f;do{I[a++]=u[A++]}while(--f);A=a-R,v=I}}else if(l<f){if(A+=c+l-f,(f-=l)<y){y-=f;do{I[a++]=u[A++]}while(--f);if(A=0,l<y){y-=f=l;do{I[a++]=u[A++]}while(--f);A=a-R,v=I}}}else if(A+=l-f,f<y){y-=f;do{I[a++]=u[A++]}while(--f);A=a-R,v=I}for(;y>2;)I[a++]=v[A++],I[a++]=v[A++],I[a++]=v[A++],y-=3;y&&(I[a++]=v[A++],y>1&&(I[a++]=v[A++]))}else{A=a-R;do{I[a++]=I[A++],I[a++]=I[A++],I[a++]=I[A++],y-=3}while(y>2);y&&(I[a++]=I[A++],y>1&&(I[a++]=I[A++]))}break}}break}}while(i<r&&a<o);i-=y=g>>3,m&=(1<<(g-=y<<3))-1,t.next_in=i,t.next_out=a,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=a<o?o-a+257:257-(a-o),s.hold=m,s.bits=g}},function(t,e,s){"use strict";var i=s(2),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,s,n,c,d,l,u){var m,g,p,k,C,b,S,f,y,R=u.bits,A=0,v=0,B=0,I=0,D=0,M=0,w=0,x=0,_=0,O=0,F=null,N=0,P=new i.Buf16(16),W=new i.Buf16(16),E=null,L=0;for(A=0;A<=15;A++)P[A]=0;for(v=0;v<n;v++)P[e[s+v]]++;for(D=R,I=15;I>=1&&0===P[I];I--);if(D>I&&(D=I),0===I)return c[d++]=20971520,c[d++]=20971520,u.bits=1,0;for(B=1;B<I&&0===P[B];B++);for(D<B&&(D=B),x=1,A=1;A<=15;A++)if(x<<=1,(x-=P[A])<0)return-1;if(x>0&&(0===t||1!==I))return-1;for(W[1]=0,A=1;A<15;A++)W[A+1]=W[A]+P[A];for(v=0;v<n;v++)0!==e[s+v]&&(l[W[e[s+v]]++]=v);if(0===t?(F=E=l,b=19):1===t?(F=r,N-=257,E=a,L-=257,b=256):(F=h,E=o,b=-1),O=0,v=0,A=B,C=d,M=D,w=0,p=-1,k=(_=1<<D)-1,1===t&&_>852||2===t&&_>592)return 1;for(;;){S=A-w,l[v]<b?(f=0,y=l[v]):l[v]>b?(f=E[L+l[v]],y=F[N+l[v]]):(f=96,y=0),m=1<<A-w,B=g=1<<M;do{c[C+(O>>w)+(g-=m)]=S<<24|f<<16|y|0}while(0!==g);for(m=1<<A-1;O&m;)m>>=1;if(0!==m?(O&=m-1,O+=m):O=0,v++,0==--P[A]){if(A===I)break;A=e[s+l[v]]}if(A>D&&(O&k)!==p){for(0===w&&(w=D),C+=B,x=1<<(M=A-w);M+w<I&&!((x-=P[M+w])<=0);)M++,x<<=1;if(_+=1<<M,1===t&&_>852||2===t&&_>592)return 1;c[p=O&k]=D<<24|M<<16|C-d|0}}return 0!==O&&(c[C+O]=A-w<<24|64<<16|0),u.bits=D,0}},function(t,e,s){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DbStorage=void 0;e.DbStorage=class{constructor(t){this.objStoreName="data",this.dbName=t}async initialize(){return new Promise(t=>{const e=indexedDB.open(this.dbName,1);e.onerror=()=>{alert("Database error")},e.onsuccess=()=>{this.database=e.result,this.ready=!0,t()},e.onupgradeneeded=e=>{const s=e.target;this.database=s.result;this.database.createObjectStore(this.objStoreName,{keyPath:"key"}).createIndex("primary","key"),s.transaction.oncomplete=()=>{this.ready=!0,t()}}})}async setData(t,e){if(this.ready)return new Promise((s,i)=>{const r=this.database.transaction(this.objStoreName,"readwrite").objectStore(this.objStoreName).put({key:t,data:e});r.onsuccess=()=>{s()},r.onerror=()=>{i()}})}async getData(t){if(this.ready)return new Promise(e=>{const s=this.database.transaction(this.objStoreName,"readonly").objectStore(this.objStoreName).index("primary").get(t);s.onsuccess=t=>{var s;e(null===(s=t.target.result)||void 0===s?void 0:s.data)},s.onerror=()=>{e(void 0)}})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FloppyDisk=void 0;const i=s(1),r=s(4),a=s(0);var h,o;!function(t){t[t.F360=0]="F360",t[t.F720=1]="F720"}(h||(h={})),function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(o||(o={}));class n{reset(){this.seekEnd=!1,this.noData=!1,this.timeout=!1,this.endOfCylinder=!1,this.deleteAddressMark=!1}}class c{constructor(){this.head=0,this.track=0,this.sector=0,this.sectorSize=0,this.trackLength=0,this.gap3Length=0,this.dataLength=0,this.fillByte=0}}class d{constructor(t,e,s){this.heads=0,this.tracks=0,this.sectors=0,this.heads=t,this.sectors=e,this.tracks=s}get diskSize(){return this.heads*this.tracks*this.sectors*d.sectorSize}calcLba(t,e,s){return(t*this.heads+e)*this.sectors+s-1}}d.sectorSize=512;class l extends i.BaseComponent{constructor(t,e){super(),this.commandDelay=1e3,this.maxDriveCount=4,this.driveSpecsByFloppyType=new Array,this.motor=new Array(this.maxDriveCount),this.active=new Array(this.maxDriveCount),this.selectedDrive=0,this.dataRegisterReady=!0,this.dataDirection=o.Input,this.driveInfo=new Array(this.maxDriveCount),this.commandInfo=new Array(this.maxDriveCount),this.driveSpecs=new Array(this.maxDriveCount),this.interruptCode=0,this.diskImages=new Array(this.maxDriveCount),this.diskImagePath=new Array(this.maxDriveCount),this.imageChanged=new Array(this.maxDriveCount),this.outputQueue=new Array,this.currDataPosition=new Array(this.maxDriveCount),this.currDataLength=new Array(this.maxDriveCount),this.currentCommand=0,this.cmdByteNo=0,this.headLoadTime=new Array(this.maxDriveCount),this.headUnloadTime=new Array(this.maxDriveCount),this.stepRate=new Array(this.maxDriveCount),this.pic=t,this.dmaController=e;for(let t=0;t<this.maxDriveCount;t++)this.driveInfo[t]=new n,this.commandInfo[t]=new c;this.initDriveSpecs()}*getFloppyTypes(){yield h.F360,yield h.F720}initDriveSpecs(){this.driveSpecsByFloppyType=new Array(Object.keys(h).length),this.driveSpecsByFloppyType[h.F360]=new d(2,9,40),this.driveSpecsByFloppyType[h.F720]=new d(2,9,80)}internalLoadImage(t,e){for(const s of this.getFloppyTypes()){const i=this.driveSpecsByFloppyType[s];if(i&&i.diskSize==e.byteLength)return this.resetImage(t,i),this.diskImages[t]=new Uint8Array(e),!0}return!1}resetImage(t,e){this.driveInfo[t].reset(),this.active[t]=!1,this.motor[t]=!1,this.driveSpecs[t]=e,this.diskImages[t]=new Uint8Array(e.diskSize)}async loadImageFromFile(t,e){return new Promise((s,i)=>{const r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",a.Settings.baseDir+t,!0),r.onload=async()=>{if(200!=r.status)return void i();const a=r.response;if(this.internalLoadImage(e,a))return this.diskImagePath[e]=t,void s(!0);this.diskImages[e]=null,s(!1)},r.onerror=()=>{this.diskImages[e]=null,i()},r.send()})}loadImageFromBuffer(t,e){this.internalLoadImage(e,t)}newImage(t){this.resetImage(t,this.driveSpecsByFloppyType[h.F360])}getDiskImage(t){const e=this.diskImages[t];return null!=e&&e.length>0?this.diskImages[t].buffer:null}async saveImage(t){this.diskImagePath[t]&&this.imageChanged[t]&&(this.imageChanged[t]=!1)}async saveImages(){for(let t=0;t<this.maxDriveCount;t++)await this.saveImage(t)}async ejectImage(t){await this.saveImage(t),this.diskImages[t]=null}internalReset(){for(let t=0;t<this.maxDriveCount;t++)this.motor[t]=!1;this.selectedDrive=0,this.dmaIrqEnabled=!1,this.dataDirection=o.Input,this.outputQueue.length=0,this.resetCount=0,this.doInterrupt(100,3)}doInterrupt(t,e){this.busy=this.outputQueue.length>0,this.interruptCode=e,0==t?this.pic.doInterrupt(r.HardwareInterrupt.Diskette):this.eventTimer.setEvent(t,()=>{this.pic.doInterrupt(r.HardwareInterrupt.Diskette)})}newCommand(){this.driveInfo[this.selectedDrive].reset(),this.dataDirection=o.Input,this.outputQueue.length=0}getStatus0(){let t;return null!=this.resetCount?(t=this.resetCount,this.resetCount<3?this.resetCount++:this.resetCount=null,t|=192):(t=this.selectedDrive,t|=this.interruptCode<<6),1==this.commandInfo[this.selectedDrive].head&&(t|=4),this.driveInfo[this.selectedDrive].seekEnd&&(t|=32),t|=this.interruptCode<<6,t}getStatus1(){let t=0;return this.driveInfo[this.selectedDrive].noData&&(t|=4),this.driveInfo[this.selectedDrive].timeout&&(t|=16),this.driveInfo[this.selectedDrive].endOfCylinder&&(t|=128),t}getStatus2(){let t=0;return this.driveInfo[this.selectedDrive].deleteAddressMark&&(t|=64),t}getStatus3(){let t=this.selectedDrive;return 1==this.commandInfo[this.selectedDrive].head&&(t|=4),t|=8,0==this.commandInfo[this.selectedDrive].track&&(t|=16),t|=32,t}initOutput(){this.outputQueue.length=0,this.dataDirection=o.Output}in(t){switch(t){case 1012:{let t=0;for(let e=0;e<this.maxDriveCount;e++)this.active[e]&&(t|=1<<e&255);return this.busy&&(t|=16),this.dmaIrqEnabled||(t|=32),this.dataDirection==o.Output&&(t|=64),this.dataRegisterReady&&(t|=128),t}case 1013:if(this.dataDirection==o.Output&&this.outputQueue.length>0){const t=this.outputQueue.shift();return 0==this.outputQueue.length&&(this.dataDirection=o.Input,this.busy=!1),t}}return 255}out(t,e,s){this.busy&&(this.busy=!1,this.outputQueue.length=0);const i=255&e;switch(t){case 1010:if(0==(4&i))return void this.internalReset();this.selectedDrive=3&i,this.dmaIrqEnabled=(8&i)>0;for(let t=0;t<this.maxDriveCount;t++)this.motor[t]=(i&16<<t)>0;break;case 1013:switch(0==this.cmdByteNo&&(this.currentCommand=31&i,this.commandInfo[this.selectedDrive].multiTrack=(128&i)>0,this.newCommand()),this.currentCommand){case 2:this.cmdReadTrack(i);break;case 5:this.cmdWriteSector(i);break;case 6:this.cmdReadSector(i);break;case 9:this.cmdWriteDeletedSector(i);break;case 12:this.cmdReadDeletedSector(i);break;case 13:this.cmdFormatTrack(i);break;case 3:this.cmdFixDriveData(i);break;case 4:this.cmdCheckDriveStatus();break;case 7:this.cmdCalibrateDrive();break;case 8:this.cmdCheckInterruptStatus();break;case 10:this.cmdReadSectorId(i);break;case 15:this.cmdSeekParkHead(i);break;default:this.cmdInvalid()}}}cmdReadTrack(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdWriteSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)if(this.cmdByteNo=0,this.busy=!0,null==this.diskImages[this.selectedDrive])this.doInterrupt(10,1);else{const t=this.commandInfo[this.selectedDrive],e=this.driveSpecs[this.selectedDrive].calcLba(t.track,t.head,t.sector)*d.sectorSize;let s=t.trackLength*d.sectorSize;s<0&&(s=d.sectorSize),this.currDataPosition[this.selectedDrive]=e,this.currDataLength[this.selectedDrive]=s;const i=()=>{this.driveInfo[this.selectedDrive].seekEnd=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.getStatus1()),this.outputQueue.push(this.getStatus2()),this.outputQueue.push(t.track),this.outputQueue.push(t.head),this.outputQueue.push(t.sector),this.outputQueue.push(t.sectorSize),this.doInterrupt(10,0)};this.eventTimer.setEvent(this.commandDelay,()=>{this.dmaController.triggerDmaMemToDevice(2,this,i),this.imageChanged[this.selectedDrive]=!0})}else this.cmdByteNo++}cmdReadSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)if(this.cmdByteNo=0,this.busy=!0,null==this.diskImages[this.selectedDrive])this.doInterrupt(10,1);else{const t=this.commandInfo[this.selectedDrive],e=this.driveSpecs[this.selectedDrive];this.currDataPosition[this.selectedDrive]=0;const s=e.calcLba(t.track,t.head,t.sector)*d.sectorSize;let i=t.trackLength*d.sectorSize;i<0&&(i=d.sectorSize),this.currDataPosition[this.selectedDrive]=s,this.currDataLength[this.selectedDrive]=i;const r=()=>{this.driveInfo[this.selectedDrive].seekEnd=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.getStatus1()),this.outputQueue.push(this.getStatus2()),this.outputQueue.push(t.track),this.outputQueue.push(t.head),this.outputQueue.push(t.sector),this.outputQueue.push(t.sectorSize),this.doInterrupt(10,0)};this.eventTimer.setEvent(this.commandDelay,()=>this.dmaController.triggerDmaDeviceToMem(2,this,()=>r()))}else this.cmdByteNo++}cmdWriteDeletedSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdReadDeletedSector(t){if(this.resetCount=null,this.setAccessValues(t),8==this.cmdByteNo)throw this.cmdByteNo=0,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdFormatTrack(t){switch(this.resetCount=null,this.cmdByteNo){case 1:this.commandInfo[this.selectedDrive].head=t>>2&1;break;case 2:this.commandInfo[this.selectedDrive].sectorSize=t;break;case 3:this.commandInfo[this.selectedDrive].trackLength=t;break;case 4:this.commandInfo[this.selectedDrive].gap3Length=t;break;case 5:this.commandInfo[this.selectedDrive].fillByte=t}5==this.cmdByteNo?(this.cmdByteNo=0,this.busy=!0,this.eventTimer.setEvent(1e3,()=>this.doInterrupt(10,0))):this.cmdByteNo++}cmdFixDriveData(t){switch(this.resetCount=null,this.cmdByteNo){case 1:this.headUnloadTime[this.selectedDrive]=3&t,this.stepRate[this.selectedDrive]=t>>4&3;break;case 2:this.dmaIrqEnabled=(1&t)>0,this.headLoadTime[this.selectedDrive]=t>>1&127}2==this.cmdByteNo?this.cmdByteNo=0:this.cmdByteNo++}cmdCheckDriveStatus(){this.resetCount=null,1==this.cmdByteNo?(this.cmdByteNo=0,this.busy=!0,this.initOutput(),this.outputQueue.push(this.getStatus3())):this.cmdByteNo++}cmdCalibrateDrive(){this.resetCount=null,1==this.cmdByteNo?(this.cmdByteNo=0,this.active[this.selectedDrive]=!0,this.eventTimer.setEvent(1e4,()=>{this.commandInfo[this.selectedDrive].track=0,this.driveInfo[this.selectedDrive].seekEnd=!0,this.active[this.selectedDrive]=!1,this.doInterrupt(0,0)})):this.cmdByteNo++}cmdCheckInterruptStatus(){this.busy=!0,this.initOutput(),this.outputQueue.push(this.getStatus0()),this.outputQueue.push(this.commandInfo[this.selectedDrive].track)}cmdReadSectorId(t){if(this.resetCount=null,1==this.cmdByteNo)throw this.cmdByteNo=0,this.commandInfo[this.selectedDrive].head=t>>2&1,this.busy=!0,new Error("Method not implemented.");this.cmdByteNo++}cmdSeekParkHead(t){this.resetCount=null,2==this.cmdByteNo?(this.cmdByteNo=0,this.active[this.selectedDrive]=!0,this.eventTimer.setEvent(1e4,()=>{this.commandInfo[this.selectedDrive].track=t,this.driveInfo[this.selectedDrive].seekEnd=!0,this.active[this.selectedDrive]=!1,this.doInterrupt(0,0)})):this.cmdByteNo++}cmdInvalid(){this.resetCount=null,this.busy=!0,this.interruptCode=2,this.initOutput(),this.outputQueue.push(this.getStatus0())}setAccessValues(t){switch(this.cmdByteNo){case 1:break;case 2:this.commandInfo[this.selectedDrive].track=t;break;case 3:this.commandInfo[this.selectedDrive].head=t;break;case 4:this.commandInfo[this.selectedDrive].sector=t;break;case 5:this.commandInfo[this.selectedDrive].sectorSize=t;break;case 6:this.commandInfo[this.selectedDrive].trackLength=t;break;case 7:this.commandInfo[this.selectedDrive].gap3Length=t;break;case 8:this.commandInfo[this.selectedDrive].dataLength=t}}getNextByte(t){return this.currDataLength[this.selectedDrive]>0?(t.endOfData=!1,this.currDataLength[this.selectedDrive]--,this.diskImages[this.selectedDrive][this.currDataPosition[this.selectedDrive]++]):(t.endOfData=!0,0)}setNextByte(t,e){this.currDataLength[this.selectedDrive]>0?(e.endOfData=!1,this.currDataLength[this.selectedDrive]--,this.diskImages[this.selectedDrive][this.currDataPosition[this.selectedDrive]++]=t):e.endOfData=!0}}e.FloppyDisk=l},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UartPort=void 0;const i=s(1),r=s(15);var a;!function(t){t[t.None=0]="None",t[t.ModemStatusChange=1]="ModemStatusChange",t[t.TransmitterHoldingRegEmpty=2]="TransmitterHoldingRegEmpty",t[t.ReceivedDataAvailable=3]="ReceivedDataAvailable",t[t.LineStatusChange=4]="LineStatusChange",t[t.CharacterTimeout=5]="CharacterTimeout"}(a||(a={}));class h extends i.BaseComponent{constructor(t,e,s){super(),this.receiveIrqDelay=0,this.receiveBuffer=new Array,this.divisorLatch=0,this.interruptEnableRegister=0,this.lineControlRegister=0,this.scratchRegister=0,this.dmaMode=0,this.dlab=0,this.lastModemStatus=0,this.dataWordLen=0,this.receivedBytesThreshold=0,this.port=t,this.irq=e,this.pic=s,this.receivedBytesThreshold=1}getModemStatus(){return this.loopbackMode?(this.requestToSend?1:0)+(this.dataTerminalReady?2:0)+(this.auxOutput1?4:0)+(this.auxOutput2?8:0):null!=this.serialDevice?(this.serialDevice.clearToSend?1:0)+(this.serialDevice.dataSetReady?2:0)+(this.serialDevice.ringIndicator?4:0)+(this.serialDevice.dataCarrierDetect?8:0):0}in(t){switch(t-this.port){case 0:if(0==this.dlab){let t=0;return this.onBeforeReadReceiveBuffer&&this.onBeforeReadReceiveBuffer(),this.receiveBuffer.length>0&&(t=this.receiveBuffer.shift()),this.clearInterrupt(a.ReceivedDataAvailable),this.clearInterrupt(a.CharacterTimeout),(1&this.interruptEnableRegister)>0&&this.receiveBuffer.length>=this.receivedBytesThreshold&&this.doInterruptWithDelay(a.ReceivedDataAvailable,this.receiveIrqDelay),t}return 255&this.divisorLatch;case 1:return 0==this.dlab?this.interruptEnableRegister:this.divisorLatch>>8&65535;case 2:{let t=0;switch(this.uartInterruptPending||(t=1),this.interruptCause){case a.ModemStatusChange:break;case a.TransmitterHoldingRegEmpty:t|=2,this.interruptCause=a.None,this.uartInterruptPending=!1;break;case a.ReceivedDataAvailable:t|=4;break;case a.LineStatusChange:t|=6;break;case a.CharacterTimeout:t|=12}return this.fifosEnabled&&(t|=192),255&t}case 3:return this.lineControlRegister;case 4:return 255&(this.dataTerminalReady?1:0)+(this.requestToSend?2:0)+(this.auxOutput1?4:0)+(this.auxOutput2?8:0)+(this.loopbackMode?16:0);case 5:{let t=0;return this.receiveBuffer.length>0&&(t+=1),(null==this.serialDevice||this.serialDevice.transmitBufferEmpty)&&(t|=96),this.clearInterrupt(a.LineStatusChange),255&t}case 6:{const t=this.getModemStatus();let e=(11&(this.lastModemStatus^t))+(t<<4);return e+=this.trailingEdgeRingIndicator?4:0,this.trailingEdgeRingIndicator=!1,this.lastModemStatus=t,this.clearInterrupt(a.ModemStatusChange),255&e}case 7:return this.scratchRegister}return 0}out(t,e,s){var i;switch(t-this.port){case 0:0==this.dlab?(this.clearInterrupt(a.TransmitterHoldingRegEmpty),this.loopbackMode?(this.transmitBufferEmpty(),this.writeData(255&e)):this.onTransmit&&this.onTransmit(255&e)):(this.divisorLatch=(65280&this.divisorLatch)+(255&e)&65535,this.serialParamsChanged());break;case 1:0==this.dlab?this.interruptEnableRegister=15&e:(this.divisorLatch=(255&this.divisorLatch)+(e<<8)&65535,this.serialParamsChanged());break;case 2:switch(this.fifosEnabled=(1&e)>0,(2&e)>0&&(this.receiveBuffer.length=0),(4&e)>0&&(null===(i=this.serialDevice)||void 0===i||i.clearTransmitBuffer()),this.dmaMode=e>>3&1,e>>6){case 0:this.receivedBytesThreshold=1;break;case 1:this.receivedBytesThreshold=4;break;case 2:this.receivedBytesThreshold=8;break;case 3:this.receivedBytesThreshold=14}break;case 3:switch(this.lineControlRegister=255&e,3&e){case 0:this.dataWordLen=5;break;case 1:this.dataWordLen=6;break;case 2:this.dataWordLen=7;break;case 3:this.dataWordLen=8}if(this.stopBits=(4&e)>0?this.dataWordLen<=5?r.StopBits.OnePointFive:r.StopBits.Two:r.StopBits.One,0==(8&e))this.parity=r.Parity.None;else switch(e>>4&3){case 0:this.parity=r.Parity.Odd;break;case 1:this.parity=r.Parity.Even;break;case 2:this.parity=r.Parity.Mark;break;case 3:this.parity=r.Parity.Space}this.breakSignalEnabled=(64&e)>0,this.dlab=e>>7&1,this.serialParamsChanged();break;case 4:{const t=this.loopbackMode;this.dataTerminalReady=(1&e)>0,this.requestToSend=(2&e)>0,this.auxOutput1=(4&e)>0,this.auxOutput2=(8&e)>0,this.loopbackMode=(16&e)>0,this.loopbackMode&&!t&&(this.lastModemStatus=this.getModemStatus()),this.loopbackMode&&this.modemStatusChanged(),null!=this.serialDevice&&(this.serialDevice.dataTerminalReady=this.dataTerminalReady,this.serialDevice.requestToSend=this.requestToSend)}break;case 5:break;case 6:this.trailingEdgeRingIndicator=(4&e)>0;break;case 7:this.scratchRegister=255&e}}get baudRate(){return this.divisorLatch>0?Math.trunc(1843200/(this.divisorLatch<<4)):0}connect(t){this.serialDevice=t,this.serialDevice.uartPort=this,this.serialDevice.onTransmitBufferEmpty=this.transmitBufferEmpty}disconnect(){this.serialDevice.uartPort=null,this.serialDevice=null}writeData(t){this.receiveBuffer.push(t),(1&this.interruptEnableRegister)>0&&this.receiveBuffer.length>=this.receivedBytesThreshold&&this.doInterrupt(a.ReceivedDataAvailable)}modemStatusChanged(){(8&this.interruptEnableRegister)>0&&this.doInterrupt(a.ModemStatusChange)}doInterruptWithDelay(t,e){this.interruptPending||(this.interruptPending=!0,this.eventTimer.setEvent(e,()=>this.doInterrupt(t)))}doInterrupt(t){this.uartInterruptPending||(this.interruptCause=t,this.uartInterruptPending=!0,this.pic.doInterrupt(this.irq),this.interruptPending=!1)}clearInterrupt(t){this.interruptCause==t&&(this.interruptCause=a.None,this.uartInterruptPending=!1)}serialParamsChanged(){this.onSerialParamsChanged&&this.onSerialParamsChanged(),this.receiveBuffer.length=0,this.baudRate>0&&(this.receiveIrqDelay=Math.trunc(1e6/this.baudRate))}transmitBufferEmpty(){(2&this.interruptEnableRegister)>0&&this.doInterrupt(a.TransmitterHoldingRegEmpty)}}e.UartPort=h},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Mouse=void 0;const i=s(1),r=s(15);class a extends i.BaseComponent{constructor(t){super(),this.lastPosition={x:0,y:0},this.eventTimer=t}get dataTerminalReady(){return this._dataTerminalReady}set dataTerminalReady(t){this._dataTerminalReady!=t&&(this._dataTerminalReady=t,this.paramsChanged())}get requestToSend(){return this._requestToSend}set requestToSend(t){this._requestToSend!=t&&(this._requestToSend=t,this.paramsChanged())}get uartPort(){return this._uartPort}set uartPort(t){null!=this._uartPort&&(this._uartPort.onSerialParamsChanged=null),this._uartPort=t,null!=this._uartPort&&(this._uartPort.onSerialParamsChanged=this.paramsChanged)}get checkParamsOk(){return 1200==this.uartPort.baudRate&&7==this.uartPort.dataWordLen&&this.uartPort.stopBits==r.StopBits.One&&this.uartPort.parity==r.Parity.None&&this.requestToSend&&this.dataTerminalReady}get transmitBufferEmpty(){return!0}paramsChanged(){this.checkParamsOk?(null!=this.eventId&&this.eventTimer.deleteEvent(this.eventId),this.eventId=this.eventTimer.setEvent(2500,()=>{this.uartPort.writeData(77),this.paramsOk=!0,this.eventId=null})):this.paramsOk=!1}sendMouseData(t,e,s,i){if(this.paramsOk){let r=t;r<-128&&(r=-128),r>127&&(r=127),r<0&&(r+=256);let a=e;a<-128&&(a=-128),a>127&&(a=127),a<0&&(a+=256);const h=64+(s?32:0)+(i?16:0)+((192&a)>>4)+((192&r)>>6);this.uartPort.writeData(255&h),this.uartPort.writeData(63&r),this.uartPort.writeData(63&a)}}clearTransmitBuffer(){}mouseMoveDelta(t,e){this.sendMouseData(t,e,!1,!1)}mouseEventAbs(t,e,s){if(Math.abs(this.lastPosition.x)>.1||Math.abs(this.lastPosition.y)>.1){const i=t.x-this.lastPosition.x,r=t.y-this.lastPosition.y;this.sendMouseData(i,r,e,s)}this.lastPosition=t}mouseEventRel(t,e,s){this.sendMouseData(t.x,t.y,e,s)}resetMove(){this.lastPosition={x:0,y:0}}}e.Mouse=a},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rom=void 0;const i=s(1),r=s(0);class a extends i.BaseComponent{constructor(t){super(),this.startAddr=0,this.size=0,this.supportWrite=!1,this.supportRead=!0,this.startAddr=t}async load(t){return new Promise((e,s)=>{const i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",r.Settings.baseDir+t,!0),i.onload=()=>{if(200==i.status){const t=i.response;this.data=new Uint8Array(t),this.size=this.data.length,e()}else s()},i.onerror=()=>{s()},i.send()})}getEndAddr(){return this.startAddr+this.size-1}peek(t){return this.data[t-this.startAddr]}poke(t,e){}}e.Rom=a},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ram=void 0;const i=s(1);class r extends i.BaseComponent{constructor(t,e){super(),this.offset=0,this.sizeKb=0,this.supportWrite=!0,this.supportRead=!0,this.sizeKb=t,this.offset=e,this.memory=new Uint8Array(1024*t)}get addrLo(){return this.offset}get addrHi(){return this.offset+1024*this.sizeKb}peek(t){return t>=this.offset&&t<this.offset+this.memory.length?this.memory[t-this.offset]:0}poke(t,e){t>=this.offset&&t<this.offset+this.memory.length&&(this.memory[t-this.offset]=e)}}e.Ram=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Cpu186=void 0;const i=s(3),r=s(50),a=s(51),h=s(0);class o{}class n{}e.Cpu186=class{constructor(t,e){this.parities=new Array(256),this.flags=new r.Flags16,this.instStartIp=0,this.repeatIp=0,this.cpuEvents=new Array,this.eventGen=0,this.AX=0,this.BX=0,this.CX=0,this.DX=0,this.SP=0,this.BP=0,this.SI=0,this.DI=0,this.IP=0,this.CS=0,this.SS=0,this.ES=0,this.DS=0,this.instCount=0,this.clockCount=0,this.workLoad=0,this.memoryProvider=t,this.portProvider=e,this.initParities(),this.execReset()}getAL(){return 255&this.AX}setAL(t){this.AX=65280&this.AX|255&t}getAH(){return this.AX>>8&255}setAH(t){this.AX=255&this.AX|(255&t)<<8}getBL(){return 255&this.BX}setBL(t){this.BX=65280&this.BX|255&t}getBH(){return this.BX>>8&255}setBH(t){this.BX=255&this.BX|(255&t)<<8}getCL(){return 255&this.CX}setCL(t){this.CX=65280&this.CX|255&t}getCH(){return this.CX>>8&255}setCH(t){this.CX=255&this.CX|(255&t)<<8}getDL(){return 255&this.DX}setDL(t){this.DX=65280&this.DX|255&t}getDH(){return this.DX>>8&255}setDH(t){this.DX=255&this.DX|(255&t)<<8}get FLAGS(){return this.flags.value}getInstructionByte(){return this.getMemByte(this.CS,this.IP)}getAddressByte(){return this.getMemByte(this.CS,this.IP+1&65535)}getName(){return"Intel 80186"}getCurrentCodeAddr(){return this.genAddr(this.CS,this.IP)}getCodeSeg32Bit(){return!1}initParities(){for(let t=0;t<256;t++){const e=(0!=(1&t)?1:0)+(0!=(2&t)?1:0)+(0!=(4&t)?1:0)+(0!=(8&t)?1:0)+(0!=(16&t)?1:0)+(0!=(32&t)?1:0)+(0!=(64&t)?1:0)+(0!=(128&t)?1:0);this.parities[t]=0==(1&e)}}reset(){this.doReset=!0}execNextInstruction(){this.execInstructions(1)}genAddr(t,e){return(t<<4)+e&1048575}execReset(){this.cpuEvents.length=0,this.hardInterrupt=null,this.softInterrupt=null,this.blockInterrupt=!1,this.stringOperation=i.Repeat.None,this.repeatIp=0,this.segOverride=null,this.flags.value=0,this.IP=65520,this.CS=61440,this.DS=this.ES=this.SS=0,this.halt=!1}execInstructions(t){var e,s,r,h,o,n,c,d,l,u,m,g,p;const k=this.clockCount+t;do{try{for(;this.clockCount<k;){this.instStartIp=this.IP;let t,k=this.readNextCodeByte();if(this.doReset)return this.doReset=!1,void this.execReset();do{switch(t=!1,k){case 243:this.clockCount+=a.ClockCycles8086.Rep,this.stringOperation=i.Repeat.RepZ,this.repeatIp=this.IP-1&65535,k=this.readNextCodeByte(),t=!0;break;case 242:this.clockCount+=a.ClockCycles8086.Rep,this.stringOperation=i.Repeat.RepNz,this.repeatIp=this.IP-1&65535,k=this.readNextCodeByte(),t=!0;break;case 240:this.clockCount+=a.ClockCycles8086.Lock,k=this.readNextCodeByte(),t=!0;break;case 46:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.CS,k=this.readNextCodeByte(),t=!0;break;case 62:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.DS,k=this.readNextCodeByte(),t=!0;break;case 38:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.ES,k=this.readNextCodeByte(),t=!0;break;case 54:this.clockCount+=a.ClockCycles8086.SegOverride,this.segOverride=this.SS,k=this.readNextCodeByte(),t=!0;break;case 55:this.clockCount+=a.ClockCycles8086.Aaa,(15&this.getAL())>9||this.flags.AF?(this.setAL(this.getAL()+6),this.setAH(this.getAH()+1),this.flags.CF=!0,this.flags.AF=!0):(this.flags.CF=!1,this.flags.AF=!1),this.setAL(15&this.getAL()),this.calcParitySignZeroFlagW(this.AX);break;case 213:{this.clockCount+=a.ClockCycles8086.Aad;const t=this.readNextCodeByte();this.setAL(this.getAH()*t+this.getAL()),this.setAH(0),this.calcParitySignZeroFlagW(this.AX);break}case 212:{this.clockCount+=a.ClockCycles8086.Aam;const t=this.readNextCodeByte();this.setAH(this.getAL()/t),this.setAL(this.getAL()%t),this.calcParitySignZeroFlagW(this.AX);break}case 63:this.clockCount+=a.ClockCycles8086.Aas,(15&this.getAL())>9||this.flags.AF?(this.setAL(this.getAL()-6),this.setAH(this.getAH()-1),this.flags.CF=!0,this.flags.AF=!0):(this.flags.CF=!1,this.flags.AF=!1),this.setAL(15&this.getAL());break;case 16:this.doByteOperation(i.Direction.RegToRm,(t,e)=>this.adcByte(t,e),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 17:this.doWordOperation(i.Direction.RegToRm,(t,e)=>this.adcWord(t,e),a.ClockCycles8086.AdcRegRmReg,a.ClockCycles8086.AdcRegRmMem);break;case 18:this.doByteOperation(i.Direction.RmToReg,(t,e)=>this.adcByte(t,e),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 19:this.doWordOperation(i.Direction.RmToReg,(t,e)=>this.adcWord(t,e),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 20:{this.clockCount+=a.ClockCycles8086.AddAlImm;const t=this.readNextCodeByte();this.setAL(this.adcByte(this.getAL(),t));break}case 21:{this.clockCount+=a.ClockCycles8086.AddAxImm;const t=this.readNextCodeWord();this.AX=this.adcWord(this.AX,t);break}case 0:this.doByteOperation(i.Direction.RegToRm,(t,e)=>this.addByte(t,e),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 1:this.doWordOperation(i.Direction.RegToRm,(t,e)=>this.addWord(t,e),a.ClockCycles8086.AddRmRegReg,a.ClockCycles8086.AddRmRegMem);break;case 2:this.doByteOperation(i.Direction.RmToReg,(t,e)=>this.addByte(t,e),a.ClockCycles8086.AddRegRmMem,a.ClockCycles8086.AddRegRmMem);break;case 3:this.doWordOperation(i.Direction.RmToReg,(t,e)=>this.addWord(t,e),a.ClockCycles8086.AddRegRmReg,a.ClockCycles8086.AddRegRmMem);break;case 4:{this.clockCount+=a.ClockCycles8086.AddAlImm;const t=this.readNextCodeByte();this.setAL(this.addByte(this.getAL(),t));break}case 5:{this.clockCount+=a.ClockCycles8086.AddAxImm;const t=this.readNextCodeWord();this.AX=this.addWord(this.AX,t);break}case 32:this.doByteOperation(i.Direction.RegToRm,(t,e)=>{const s=t&e&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s},a.ClockCycles8086.AndRmRegReg,a.ClockCycles8086.AndRmRegMem);break;case 33:this.doWordOperation(i.Direction.RegToRm,(t,e)=>{const s=t&e&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s},a.ClockCycles8086.AndRmRegReg,a.ClockCycles8086.AndRmRegMem);break;case 34:this.doByteOperation(i.Direction.RmToReg,(t,e)=>{const s=t&e&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s},a.ClockCycles8086.AndRegRmReg,a.ClockCycles8086.AndRegRmMem);break;case 35:this.doWordOperation(i.Direction.RmToReg,(t,e)=>{const s=t&e&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s},a.ClockCycles8086.AndRegRmReg,a.ClockCycles8086.AndRegRmMem);break;case 36:{this.clockCount+=a.ClockCycles8086.AndAlImm;const t=this.readNextCodeByte(),e=this.getAL()&t&255;this.flags.CF=this.flags.OF=!1,this.setAL(e),this.calcParitySignZeroFlagB(e);break}case 37:{this.clockCount+=a.ClockCycles8086.AndAxImm;const t=this.readNextCodeWord(),e=this.AX&t&65535;this.flags.CF=this.flags.OF=!1,this.AX=e,this.calcParitySignZeroFlagW(e)}break;case 98:{this.clockCount+=a.ClockCycles8086.Bound;const t=this.readAndDecodeAddressByte();3==t.mode&&this.handleIllegalOpcode();let e=this.memoryProvider.peekW(t.rmAddr);e>32767&&(e-=65536);let s=this.memoryProvider.peekW(t.rmAddr+2)+2;s>32767&&(s-=65536);let r=this.getRegWord(t.reg);if(r>32767&&(r-=65536),r<e||r>s)throw this.IP=this.instStartIp,new i.CpuError(i.CpuExCode.BR)}break;case 232:{this.clockCount+=a.ClockCycles8086.CallNear;let t=this.readNextCodeWord();t>32767&&(t-=65536),this.pushWord(65535&this.IP),this.IP=this.IP+t&65535;break}case 154:this.clockCount+=a.ClockCycles8086.CallFar;{const t=this.readNextCodeWord(),e=this.readNextCodeWord();this.pushWord(this.CS),this.pushWord(65535&this.IP),this.CS=e,this.IP=t}break;case 152:this.clockCount+=a.ClockCycles8086.Cbw,this.getAL()>127?this.setAH(255):this.setAH(0);break;case 248:this.clockCount+=a.ClockCycles8086.Clc,this.flags.CF=!1;break;case 252:this.clockCount+=a.ClockCycles8086.Cld,this.flags.DF=!1;break;case 250:this.clockCount+=a.ClockCycles8086.Clc,this.flags.IF=!1;break;case 245:this.clockCount+=a.ClockCycles8086.Cmc,this.flags.CF=!this.flags.CF;break;case 56:this.doByteOperation(i.Direction.RegToRm,(t,e)=>(this.subByte(t,e),0),a.ClockCycles8086.CmpRmRegReg,a.ClockCycles8086.CmpRmRegMem,!1);break;case 57:this.doWordOperation(i.Direction.RegToRm,(t,e)=>(this.subWord(t,e),0),a.ClockCycles8086.CmpRmRegReg,a.ClockCycles8086.CmpRmRegMem,!1);break;case 58:this.doByteOperation(i.Direction.RmToReg,(t,e)=>(this.subByte(t,e),0),a.ClockCycles8086.CmpRegRmReg,a.ClockCycles8086.CmpRegRmMem,!1);break;case 59:this.doWordOperation(i.Direction.RmToReg,(t,e)=>(this.subWord(t,e),0),a.ClockCycles8086.CmpRegRmReg,a.ClockCycles8086.CmpRegRmMem,!1);break;case 60:this.clockCount+=a.ClockCycles8086.CmpAlImm,this.subByte(this.getAL(),this.readNextCodeByte());break;case 61:{this.clockCount+=a.ClockCycles8086.CmpAxImm;const t=this.readNextCodeWord();this.subWord(this.AX,t)}break;case 166:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Cmps,this.subByte(this.getMemByte(null!==(e=this.segOverride)&&void 0!==e?e:this.DS,this.SI),this.getMemByte(this.ES,this.DI)),this.flags.DF?(this.SI=this.SI-1&65535,this.DI=this.DI-1&65535):(this.SI=this.SI+1&65535,this.DI=this.DI+1&65535),this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 167:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Cmps,this.subWord(this.getMemWord(null!==(s=this.segOverride)&&void 0!==s?s:this.DS,this.SI),this.getMemWord(this.ES,this.DI)),this.flags.DF?(this.SI=this.SI-2&65535,this.DI=this.DI-2&65535):(this.SI=this.SI+2&65535,this.DI=this.DI+2&65535),this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 153:this.clockCount+=a.ClockCycles8086.Cwd,this.DX=65535&(this.AX>=32768?65535:0);break;case 39:this.clockCount+=a.ClockCycles8086.Daa,((15&this.getAL())>9||this.flags.AF)&&(this.setAL(this.getAL()+6),this.flags.AF=!0),(this.getAL()>159||this.flags.CF)&&(this.setAL(this.getAL()+96),this.flags.CF=!0),this.calcParitySignZeroFlagB(this.getAL());break;case 47:this.clockCount+=a.ClockCycles8086.Das,((15&this.getAL())>9||this.flags.AF)&&(this.setAL(this.getAL()-6),this.flags.AF=!0),(this.getAL()>159||this.flags.CF)&&(this.setAL(this.getAL()-96),this.flags.CF=!0),this.calcParitySignZeroFlagB(this.getAL());break;case 72:this.clockCount+=a.ClockCycles8086.DecReg,this.AX=this.decWord(this.AX);break;case 73:this.clockCount+=a.ClockCycles8086.DecReg,this.CX=this.decWord(this.CX);break;case 74:this.clockCount+=a.ClockCycles8086.DecReg,this.DX=this.decWord(this.DX);break;case 75:this.clockCount+=a.ClockCycles8086.DecReg,this.BX=this.decWord(this.BX);break;case 76:this.clockCount+=a.ClockCycles8086.DecReg,this.SP=this.decWord(this.SP);break;case 77:this.clockCount+=a.ClockCycles8086.DecReg,this.BP=this.decWord(this.BP);break;case 78:this.clockCount+=a.ClockCycles8086.DecReg,this.SI=this.decWord(this.SI);break;case 79:this.clockCount+=a.ClockCycles8086.DecReg,this.DI=this.decWord(this.DI);break;case 200:{const t=this.readNextCodeWord();let e=this.readNextCodeByte();this.clockCount+=0==e?a.ClockCycles8086.EnterLvl0:1==e?a.ClockCycles8086.EnterLvl1:a.ClockCycles8086.EnterInitial+a.ClockCycles8086.EnterPerLvl*(e-1),e&=31,this.pushWord(this.BP);const s=this.SP;if(e>0){for(let t=1;t<e;t++)this.BP=this.BP-2&65535,this.pushWord(this.getMemWord(this.SS,this.BP));this.pushWord(s)}this.BP=s,this.SP=this.SP-t&65535;break}case 244:this.clockCount+=a.ClockCycles8086.Hlt,this.halt=!0,this.IP=this.IP-1&65535;break;case 107:this.doWordOperation(i.Direction.RmToReg,(t,e)=>{e>32767&&(e-=65536);let s=this.readNextCodeByte();s>127&&(s-=256);const i=e*s,r=i>>16&65535;return this.flags.CF=this.flags.OF=0!=r&&65535!=r,this.flags.ZF=!1,65535&i},a.ClockCycles8086.ImulImmReg,a.ClockCycles8086.ImulImmMem);break;case 105:this.doWordOperation(i.Direction.RmToReg,(t,e)=>{e>32767&&(e-=65536);let s=this.readNextCodeWord();s>32767&&(s-=65536);const i=e*s,r=i>>16&65535;return this.flags.CF=this.flags.OF=0!=r&&65535!=r,this.flags.ZF=!1,65535&i},a.ClockCycles8086.ImulImmReg16,a.ClockCycles8086.ImulImmMem16);break;case 228:{this.clockCount+=a.ClockCycles8086.InImm;const t=this.readNextCodeByte();this.setAL(this.portProvider.in(t));break}case 229:{this.clockCount+=a.ClockCycles8086.InImm;const t=this.readNextCodeByte();this.AX=this.portProvider.in(t);break}case 236:this.clockCount+=a.ClockCycles8086.InDx,this.setAL(this.portProvider.in(this.DX));break;case 237:this.clockCount+=a.ClockCycles8086.InDx,this.AX=this.portProvider.in(this.DX);break;case 64:this.clockCount+=a.ClockCycles8086.IncReg,this.AX=this.incWord(this.AX);break;case 65:this.clockCount+=a.ClockCycles8086.IncReg,this.CX=this.incWord(this.CX);break;case 66:this.clockCount+=a.ClockCycles8086.IncReg,this.DX=this.incWord(this.DX);break;case 67:this.clockCount+=a.ClockCycles8086.IncReg,this.BX=this.incWord(this.BX);break;case 68:this.clockCount+=a.ClockCycles8086.IncReg,this.SP=this.incWord(this.SP);break;case 69:this.clockCount+=a.ClockCycles8086.IncReg,this.BP=this.incWord(this.BP);break;case 70:this.clockCount+=a.ClockCycles8086.IncReg,this.SI=this.incWord(this.SI);break;case 71:this.clockCount+=a.ClockCycles8086.IncReg,this.DI=this.incWord(this.DI);break;case 108:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Ins:a.ClockCycles8086.InsRep,this.setMemByte(this.ES,this.DI,255&this.portProvider.in(this.DX)),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 109:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Ins:a.ClockCycles8086.InsRep,this.setMemWord(this.ES,this.DI,this.portProvider.in(this.DX)),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 204:this.clockCount+=a.ClockCycles8086.Int3,this.doSoftInterrupt(3);break;case 205:this.clockCount+=a.ClockCycles8086.IntImm,this.doSoftInterrupt(this.readNextCodeByte());break;case 206:this.flags.OF?(this.clockCount+=a.ClockCycles8086.Into,this.doSoftInterrupt(4)):this.clockCount+=a.ClockCycles8086.IntoNoInt;break;case 207:this.clockCount+=a.ClockCycles8086.Iret,this.IP=this.popWord(),this.CS=this.popWord(),this.flags.value=this.popWord(),this.blockInterrupt=!0;break;case 119:this.handleConditionalJump(!this.flags.CF&&!this.flags.ZF);break;case 115:this.handleConditionalJump(!this.flags.CF);break;case 114:this.handleConditionalJump(this.flags.CF);break;case 118:this.handleConditionalJump(this.flags.CF||this.flags.ZF);break;case 227:{let t=this.readNextCodeByte();t>127&&(t-=256),0==this.CX?(this.clockCount+=a.ClockCycles8086.JcxzMet,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.JcxzNotMet;break}case 116:this.handleConditionalJump(this.flags.ZF);break;case 127:this.handleConditionalJump(!this.flags.ZF&&this.flags.SF==this.flags.OF);break;case 125:this.handleConditionalJump(this.flags.SF==this.flags.OF);break;case 124:this.handleConditionalJump(this.flags.SF!=this.flags.OF);break;case 126:this.handleConditionalJump(this.flags.ZF||this.flags.SF!=this.flags.OF);break;case 235:{this.clockCount+=a.ClockCycles8086.JmpShort;let t=this.readNextCodeByte();t>127&&(t-=256),this.IP=this.IP+t&65535;break}case 233:{this.clockCount+=a.ClockCycles8086.JmpNear;let t=this.readNextCodeWord();t>32767&&(t-=65536),this.IP=this.IP+t&65535;break}case 234:this.clockCount+=a.ClockCycles8086.JmpFar;{const t=this.readNextCodeWord(),e=this.readNextCodeWord();this.CS=e,this.IP=t}break;case 117:this.handleConditionalJump(!this.flags.ZF);break;case 113:this.handleConditionalJump(!this.flags.OF);break;case 121:this.handleConditionalJump(!this.flags.SF);break;case 123:this.handleConditionalJump(!this.flags.PF);break;case 112:this.handleConditionalJump(this.flags.OF);break;case 122:this.handleConditionalJump(this.flags.PF);break;case 120:this.handleConditionalJump(this.flags.SF);break;case 159:this.clockCount+=a.ClockCycles8086.Lahf,this.setAH(this.flags.value);break;case 197:this.DS=this.loadSeg();break;case 141:{this.clockCount+=a.ClockCycles8086.Lea;const t=this.readNextCodeByte(),e=(192&t)>>6,s=(56&t)>>3,i=7&t;3==e&&this.handleIllegalOpcode();const r=this.calcEa(e,i);this.setRegWord(s,r.ea)}break;case 201:this.clockCount+=a.ClockCycles8086.Leave,this.SP=this.BP,this.BP=this.popWord();break;case 196:this.ES=this.loadSeg();break;case 172:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Lods:a.ClockCycles8086.LodsRep,this.setAL(this.getMemByte(null!==(r=this.segOverride)&&void 0!==r?r:this.DS,this.SI)),this.flags.DF?this.SI=this.SI-1&65535:this.SI=this.SI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 173:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Lods:a.ClockCycles8086.LodsRep,this.AX=this.getMemWord(null!==(h=this.segOverride)&&void 0!==h?h:this.DS,this.SI),this.flags.DF?this.SI=this.SI-2&65535:this.SI=this.SI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 226:{let t=this.readNextCodeByte();t>127&&(t-=256),this.CX=this.CX-1&65535,this.CX>0?(this.clockCount+=a.ClockCycles8086.Loop,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.LoopFinished;break}case 225:{let t=this.readNextCodeByte();t>127&&(t-=256),this.CX=this.CX-1&65535,this.CX>0&&this.flags.ZF?(this.clockCount+=a.ClockCycles8086.Loop,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.LoopFinished;break}case 224:{let t=this.readNextCodeByte();t>127&&(t-=256),this.CX=this.CX-1&65535,this.CX>0&&!this.flags.ZF?(this.clockCount+=a.ClockCycles8086.Loop,this.IP=this.IP+t&65535):this.clockCount+=a.ClockCycles8086.LoopFinished;break}case 160:{this.clockCount+=a.ClockCycles8086.MovAxMemoffs;const t=this.readNextCodeWord();this.setAL(this.getMemByte(null!==(o=this.segOverride)&&void 0!==o?o:this.DS,t));break}case 161:{this.clockCount+=a.ClockCycles8086.MovAxMemoffs;const t=this.readNextCodeWord();this.AX=this.getMemWord(null!==(n=this.segOverride)&&void 0!==n?n:this.DS,t)}break;case 162:{this.clockCount+=a.ClockCycles8086.MovMemoffsAx;const t=this.readNextCodeWord();this.setMemByte(null!==(c=this.segOverride)&&void 0!==c?c:this.DS,t,this.getAL());break}case 163:{this.clockCount+=a.ClockCycles8086.MovMemoffsAx;const t=this.readNextCodeWord();this.setMemWord(null!==(d=this.segOverride)&&void 0!==d?d:this.DS,t,this.AX)}break;case 176:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setAL(this.readNextCodeByte());break;case 177:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setCL(this.readNextCodeByte());break;case 178:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setDL(this.readNextCodeByte());break;case 179:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setBL(this.readNextCodeByte());break;case 180:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setAH(this.readNextCodeByte());break;case 181:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setCH(this.readNextCodeByte());break;case 182:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setDH(this.readNextCodeByte());break;case 183:this.clockCount+=a.ClockCycles8086.MovRegImm8,this.setBH(this.readNextCodeByte());break;case 184:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.AX=this.readNextCodeWord();break;case 185:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.CX=this.readNextCodeWord();break;case 186:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.DX=this.readNextCodeWord();break;case 187:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.BX=this.readNextCodeWord();break;case 188:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.SP=this.readNextCodeWord();break;case 189:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.BP=this.readNextCodeWord();break;case 190:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.SI=this.readNextCodeWord();break;case 191:this.clockCount+=a.ClockCycles8086.MovRegImm16,this.DI=this.readNextCodeWord();break;case 198:{this.clockCount+=a.ClockCycles8086.MovRmImm8;const t=this.readAndDecodeAddressByte(),e=this.readNextCodeByte();this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 199:{this.clockCount+=a.ClockCycles8086.MovRmImm16;const t=this.readAndDecodeAddressByte(),e=this.readNextCodeWord();this.setRmWord(t.mode,t.rm,t.rmAddr,e);break}case 136:this.doByteOperationU(i.Direction.RegToRm,t=>t,a.ClockCycles8086.MovRmRegReg,a.ClockCycles8086.MovRmRegMem);break;case 137:this.doWordOperationU(i.Direction.RegToRm,t=>t,a.ClockCycles8086.MovRmRegReg,a.ClockCycles8086.MovRmRegMem);break;case 138:this.doByteOperationU(i.Direction.RmToReg,t=>t,a.ClockCycles8086.MovRegRmReg,a.ClockCycles8086.MovRegRmMem);break;case 139:this.doWordOperationU(i.Direction.RmToReg,t=>t,a.ClockCycles8086.MovRegRmReg,a.ClockCycles8086.MovRegRmMem);break;case 140:this.doSegRegWordOperation(i.Direction.RegToRm,t=>t,a.ClockCycles8086.MovRmSegReg,a.ClockCycles8086.MovRmSegMem);break;case 142:this.doSegRegWordOperation(i.Direction.RmToReg,t=>t,a.ClockCycles8086.MovSegRmReg,a.ClockCycles8086.MovSegRmMem);break;case 164:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?14:8,this.setMemByte(this.ES,this.DI,this.getMemByte(null!==(l=this.segOverride)&&void 0!==l?l:this.DS,this.SI)),this.flags.DF?(this.SI=this.SI-1&65535,this.DI=this.DI-1&65535):(this.SI=this.SI+1&65535,this.DI=this.DI+1&65535),this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 165:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Movs:a.ClockCycles8086.MovsRep,this.setMemWord(this.ES,this.DI,this.getMemWord(null!==(u=this.segOverride)&&void 0!==u?u:this.DS,this.SI)),this.flags.DF?(this.SI=this.SI-2&65535,this.DI=this.DI-2&65535):(this.SI=this.SI+2&65535,this.DI=this.DI+2&65535),this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 144:this.clockCount+=a.ClockCycles8086.Nop;break;case 8:this.doByteOperation(i.Direction.RegToRm,(t,e)=>{const s=255&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s},a.ClockCycles8086.OrRmRegReg,a.ClockCycles8086.OrRmRegMem);break;case 9:this.doWordOperation(i.Direction.RegToRm,(t,e)=>{const s=65535&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s},a.ClockCycles8086.OrRmRegReg,a.ClockCycles8086.OrRmRegMem);break;case 10:this.doByteOperation(i.Direction.RmToReg,(t,e)=>{const s=255&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s},a.ClockCycles8086.OrRegRmReg,a.ClockCycles8086.OrRegRmMem);break;case 11:this.doWordOperation(i.Direction.RmToReg,(t,e)=>{const s=65535&(t|e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s},a.ClockCycles8086.OrRegRmReg,a.ClockCycles8086.OrRegRmMem);break;case 12:{this.clockCount+=a.ClockCycles8086.OrAlImm;const t=this.readNextCodeByte(),e=255&(this.getAL()|t);this.flags.CF=this.flags.OF=!1,this.setAL(e),this.calcParitySignZeroFlagB(this.getAL());break}case 13:this.clockCount+=a.ClockCycles8086.OrAxImm;{const t=this.readNextCodeWord(),e=65535&(this.AX|t);this.flags.CF=this.flags.OF=!1,this.AX=e,this.calcParitySignZeroFlagW(this.AX)}break;case 230:{this.clockCount+=a.ClockCycles8086.OutImm;const t=this.readNextCodeByte();this.portProvider.out(t,this.getAL(),!1);break}case 231:{this.clockCount+=a.ClockCycles8086.OutImm;const t=this.readNextCodeByte();this.portProvider.out(t,this.AX,!0);break}case 238:this.clockCount+=a.ClockCycles8086.OutDx,this.portProvider.out(this.DX,this.getAL(),!1);break;case 239:this.clockCount+=a.ClockCycles8086.OutDx,this.portProvider.out(this.DX,this.AX,!0);break;case 110:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Outs:a.ClockCycles8086.OutsRep,this.portProvider.out(this.DX,this.getMemByte(null!==(m=this.segOverride)&&void 0!==m?m:this.DS,this.SI),!1),this.flags.DF?this.SI=this.SI-1&65535:this.SI=this.SI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 111:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Outs:a.ClockCycles8086.OutsRep,this.portProvider.out(this.DX,this.getMemWord(null!==(g=this.segOverride)&&void 0!==g?g:this.DS,this.SI),!0),this.flags.DF?this.SI=this.SI-2&65535:this.SI=this.SI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 88:this.clockCount+=a.ClockCycles8086.PopReg,this.AX=this.popWord();break;case 89:this.clockCount+=a.ClockCycles8086.PopReg,this.CX=this.popWord();break;case 90:this.clockCount+=a.ClockCycles8086.PopReg,this.DX=this.popWord();break;case 91:this.clockCount+=a.ClockCycles8086.PopReg,this.BX=this.popWord();break;case 92:this.clockCount+=a.ClockCycles8086.PopReg,this.SP=this.popWord();break;case 93:this.clockCount+=a.ClockCycles8086.PopReg,this.BP=this.popWord();break;case 94:this.clockCount+=a.ClockCycles8086.PopReg,this.SI=this.popWord();break;case 95:this.clockCount+=a.ClockCycles8086.PopReg,this.DI=this.popWord();break;case 7:this.clockCount+=a.ClockCycles8086.PopSeg,this.ES=this.popWord();break;case 23:this.clockCount+=a.ClockCycles8086.PopSeg,this.SS=this.popWord();break;case 31:this.clockCount+=a.ClockCycles8086.PopSeg,this.DS=this.popWord();break;case 143:{this.clockCount+=a.ClockCycles8086.PopMem;const t=this.readAndDecodeAddressByte();this.setRmWord(t.mode,t.rm,t.rmAddr,this.popWord());break}case 97:this.clockCount+=a.ClockCycles8086.Popa,this.DI=this.popWord(),this.SI=this.popWord(),this.BP=this.popWord(),this.SP=this.SP+2&65535,this.BX=this.popWord(),this.DX=this.popWord(),this.CX=this.popWord(),this.AX=this.popWord();break;case 157:this.clockCount+=a.ClockCycles8086.Popf,this.flags.value=this.popWord();break;case 80:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.AX);break;case 81:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.CX);break;case 82:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.DX);break;case 83:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.BX);break;case 84:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.SP-2&65535);break;case 85:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.BP);break;case 86:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.SI);break;case 87:this.clockCount+=a.ClockCycles8086.PushReg,this.pushWord(this.DI);break;case 6:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.ES);break;case 14:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.CS);break;case 22:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.SS);break;case 30:this.clockCount+=a.ClockCycles8086.PushSeg,this.pushWord(this.DS);break;case 106:this.clockCount+=a.ClockCycles8086.PushImm8,this.pushWord(this.readNextCodeByte());break;case 104:this.clockCount+=a.ClockCycles8086.PushImm16,this.pushWord(this.readNextCodeWord());break;case 96:{this.clockCount+=a.ClockCycles8086.Pusha;const t=this.SP;this.pushWord(this.AX),this.pushWord(this.CX),this.pushWord(this.DX),this.pushWord(this.BX),this.pushWord(t),this.pushWord(this.BP),this.pushWord(this.SI),this.pushWord(this.DI);break}case 156:this.clockCount+=a.ClockCycles8086.Pushf,this.pushWord(this.flags.value);break;case 195:this.clockCount+=a.ClockCycles8086.Ret,this.IP=this.popWord();break;case 194:{this.clockCount+=a.ClockCycles8086.RetImm;const t=this.readNextCodeWord();this.IP=this.popWord(),this.SP=this.SP+t&65535;break}case 203:this.clockCount+=a.ClockCycles8086.Retf,this.IP=this.popWord(),this.CS=this.popWord();break;case 202:{this.clockCount+=a.ClockCycles8086.RetfImm;const t=this.readNextCodeWord();this.IP=this.popWord(),this.CS=this.popWord(),this.SP=this.SP+t&65535;break}case 158:this.clockCount+=a.ClockCycles8086.Lahf,this.flags.value=65535&(65280&this.flags.value|this.getAH());break;case 24:this.doByteOperation(i.Direction.RegToRm,(t,e)=>this.sbbByte(t,e),a.ClockCycles8086.SbbRmRegReg,a.ClockCycles8086.SbbRmRegMem);break;case 25:this.doWordOperation(i.Direction.RegToRm,(t,e)=>this.sbbWord(t,e),a.ClockCycles8086.SbbRmRegReg,a.ClockCycles8086.SbbRmRegMem);break;case 26:this.doByteOperation(i.Direction.RmToReg,(t,e)=>this.sbbByte(t,e),a.ClockCycles8086.SbbRegRmReg,a.ClockCycles8086.SbbRegRmMem);break;case 27:this.doWordOperation(i.Direction.RmToReg,(t,e)=>this.sbbWord(t,e),a.ClockCycles8086.SbbRegRmReg,a.ClockCycles8086.SbbRegRmMem);break;case 28:this.clockCount+=a.ClockCycles8086.SbbAlImm,this.setAL(this.sbbByte(this.getAL(),this.readNextCodeByte()));break;case 29:this.clockCount+=a.ClockCycles8086.SbbAxImm,this.AX=this.sbbWord(this.AX,this.readNextCodeWord());break;case 174:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Scas,this.subByte(this.getAL(),this.getMemByte(this.ES,this.DI)),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 175:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=a.ClockCycles8086.Scas,this.subWord(this.AX,this.getMemWord(this.ES,this.DI)),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeatCheckZeroFlag()),this.stringOperation=i.Repeat.None;break;case 249:this.clockCount+=a.ClockCycles8086.SetFlag,this.flags.CF=!0;break;case 253:this.clockCount+=a.ClockCycles8086.SetFlag,this.flags.DF=!0;break;case 251:this.clockCount+=a.ClockCycles8086.SetFlag,this.flags.IF=!0,this.blockInterrupt=!0;break;case 170:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Stos:a.ClockCycles8086.StosRep,this.setMemByte(this.ES,this.DI,this.getAL()),this.flags.DF?this.DI=this.DI-1&65535:this.DI=this.DI+1&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 171:this.stringOperation!=i.Repeat.None&&0==this.CX||(this.clockCount+=this.stringOperation==i.Repeat.None?a.ClockCycles8086.Stos:a.ClockCycles8086.StosRep,this.setMemWord(this.ES,this.DI,this.AX),this.flags.DF?this.DI=this.DI-2&65535:this.DI=this.DI+2&65535,this.handleRepeat()),this.stringOperation=i.Repeat.None;break;case 40:this.doByteOperation(i.Direction.RegToRm,(t,e)=>this.subByte(t,e),a.ClockCycles8086.SubRmRegReg,a.ClockCycles8086.SubRmRegMem);break;case 41:this.doWordOperation(i.Direction.RegToRm,(t,e)=>this.subWord(t,e),a.ClockCycles8086.SubRmRegReg,a.ClockCycles8086.SubRmRegMem);break;case 42:this.doByteOperation(i.Direction.RmToReg,(t,e)=>this.subByte(t,e),a.ClockCycles8086.SubRegRmReg,a.ClockCycles8086.SubRegRmMem);break;case 43:this.doWordOperation(i.Direction.RmToReg,(t,e)=>this.subWord(t,e),a.ClockCycles8086.SubRegRmReg,a.ClockCycles8086.SubRegRmMem);break;case 44:{this.clockCount+=a.ClockCycles8086.SubAlImm;const t=this.readNextCodeByte();this.setAL(this.subByte(this.getAL(),t));break}case 45:this.clockCount+=a.ClockCycles8086.SubAxImm,this.AX=this.subWord(this.AX,this.readNextCodeWord());break;case 132:this.doByteOperation(i.Direction.RegToRm,(t,e)=>{const s=t&e&255;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),0},a.ClockCycles8086.TestReg,a.ClockCycles8086.TestMem,!1);break;case 133:this.doWordOperation(i.Direction.RegToRm,(t,e)=>{const s=t&e&65535;return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),0},a.ClockCycles8086.TestReg,a.ClockCycles8086.TestMem,!1);break;case 168:{this.clockCount+=a.ClockCycles8086.TestAlImm;const t=this.readNextCodeByte(),e=this.getAL()&t&255;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e);break}case 169:this.clockCount+=a.ClockCycles8086.TestAxImm;{const t=this.readNextCodeWord(),e=this.AX&t&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e)}break;case 155:this.clockCount+=a.ClockCycles8086.Wait;break;case 145:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.CX,this.CX=t}break;case 146:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.DX,this.DX=t}break;case 147:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.BX,this.BX=t}break;case 148:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.SP,this.SP=t}break;case 149:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.BP,this.BP=t}break;case 150:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.SI,this.SI=t}break;case 151:this.clockCount+=a.ClockCycles8086.XchgReg;{const t=this.AX;this.AX=this.DI,this.DI=t}break;case 134:{const t=this.readAndDecodeAddressByte();this.clockCount+=3==t.mode?a.ClockCycles8086.XchgRegRmReg:a.ClockCycles8086.XchgRegRmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr);this.setRmByte(t.mode,t.rm,t.rmAddr,this.getRegByte(t.reg)),this.setRegByte(t.reg,e);break}case 135:{const t=this.readAndDecodeAddressByte();this.clockCount+=3==t.mode?a.ClockCycles8086.XchgRegRmReg:a.ClockCycles8086.XchgRegRmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr);this.setRmWord(t.mode,t.rm,t.rmAddr,this.getRegWord(t.reg)),this.setRegWord(t.reg,e)}break;case 215:this.clockCount+=a.ClockCycles8086.Xlat,this.setAL(this.getMemByte(null!==(p=this.segOverride)&&void 0!==p?p:this.DS,this.BX+this.getAL()&65535));break;case 48:this.doByteOperation(i.Direction.RegToRm,(t,e)=>{const s=255&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s},a.ClockCycles8086.XorRmRegReg,a.ClockCycles8086.XorRmRegMem);break;case 49:this.doWordOperation(i.Direction.RegToRm,(t,e)=>{const s=65535&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s},a.ClockCycles8086.XorRmRegReg,a.ClockCycles8086.XorRmRegMem);break;case 50:this.doByteOperation(i.Direction.RmToReg,(t,e)=>{const s=255&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s),s},a.ClockCycles8086.XorRegRmReg,a.ClockCycles8086.XorRegRmMem);break;case 51:this.doWordOperation(i.Direction.RmToReg,(t,e)=>{const s=65535&(t^e);return this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s),s},a.ClockCycles8086.XorRegRmReg,a.ClockCycles8086.XorRegRmMem);break;case 52:{this.clockCount+=a.ClockCycles8086.XorAlImm;const t=this.readNextCodeByte(),e=255&(this.getAL()^t);this.flags.CF=this.flags.OF=!1,this.setAL(e),this.calcParitySignZeroFlagB(this.getAL());break}case 53:{this.clockCount+=a.ClockCycles8086.XorAxImm;const t=this.readNextCodeWord(),e=65535&(this.AX^t);this.flags.CF=this.flags.OF=!1,this.AX=e,this.calcParitySignZeroFlagW(this.AX)}break;case 254:this.handleOpcodeFeFf(!1);break;case 255:this.handleOpcodeFeFf(!0);break;case 128:this.handleOpcode80();break;case 129:this.handleOpcode81();break;case 131:this.handleOpcode83();break;case 246:this.handleOpcodeF6();break;case 247:this.handleOpcodeF7();break;case 208:this.handleOpcodeD0();break;case 209:this.handleOpcodeD1();break;case 210:this.handleOpcodeD2();break;case 211:this.handleOpcodeD3();break;case 192:this.handleOpcodeC0();break;case 193:this.handleOpcodeC1();break;case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:this.handleFpuInstruction(k);break;default:this.handleIllegalOpcode()}}while(t);this.segOverride=null,this.blockInterrupt?this.blockInterrupt=!1:(this.flags.TF&&this.doSoftInterrupt(1),null==this.softInterrupt&&null==this.hardInterrupt||this.processInterrupt()),0==(15&this.instCount)&&this.handleCpuEvents(),this.instCount++}}catch(t){if(!(t instanceof i.CpuError))throw t;this.segOverride=null,this.doSoftInterrupt(t.exCode),this.blockInterrupt?this.blockInterrupt=!1:this.processInterrupt(),this.instCount++}}while(this.clockCount<k)}handleIllegalOpcode(){}handleFpuInstruction(t){this.clockCount+=a.ClockCycles8086.FpuInstruction;this.readNextCodeByte()<192&&(this.IP=this.IP-1&65535,this.readAndDecodeAddressByte())}handleCpuEvents(){for(let t=this.cpuEvents.length-1;t>=0;t--){const e=this.cpuEvents[t];e.clockCount<=this.clockCount&&(e.action(),this.cpuEvents.splice(t,1))}}handleConditionalJump(t){if(t){let t=this.readNextCodeByte();t>127&&(t-=256),this.clockCount+=a.ClockCycles8086.JumpCondMet,this.IP=this.IP+t&65535}else this.IP=this.IP+1&65535,this.clockCount+=a.ClockCycles8086.JumpCondNotMet}handleRepeat(){this.stringOperation!=i.Repeat.None&&(this.CX=this.CX-1&65535,0!=this.CX&&(this.IP=this.repeatIp))}handleRepeatCheckZeroFlag(){this.stringOperation!=i.Repeat.None&&(this.CX=this.CX-1&65535,0!=this.CX&&(this.stringOperation==i.Repeat.RepZ&&this.flags.ZF||this.stringOperation==i.Repeat.RepNz&&!this.flags.ZF)&&(this.IP=this.repeatIp))}processInterrupt(){let t;if(null!=this.softInterrupt)t=this.softInterrupt,this.softInterrupt=null,this.pushWord(this.flags.value);else{if(null==this.hardInterrupt||!this.flags.IF)return;this.clockCount+=a.ClockCycles8086.HardInterrupt,this.halt&&(this.halt=!1,this.IP=this.IP+1&65535),t=this.hardInterrupt,this.hardInterrupt=null,this.pushWord(this.flags.value)}this.flags.IF=!1,this.flags.TF=!1,this.pushWord(this.CS),this.pushWord(this.IP),this.IP=this.memoryProvider.peekW(4*t),this.CS=this.memoryProvider.peekW(4*t+2)}handleOpcodeFeFf(t){const e=this.readAndDecodeAddressByte();switch(e.reg){case 0:this.clockCount+=3==e.mode?a.ClockCycles8086.IncReg:a.ClockCycles8086.IncMem,t?this.setRmWord(e.mode,e.rm,e.rmAddr,this.incWord(this.getRmWord(e.mode,e.rm,e.rmAddr))):this.setRmByte(e.mode,e.rm,e.rmAddr,this.incByte(this.getRmByte(e.mode,e.rm,e.rmAddr)));break;case 1:this.clockCount+=3==e.mode?a.ClockCycles8086.DecReg:a.ClockCycles8086.DecMem,t?this.setRmWord(e.mode,e.rm,e.rmAddr,this.decWord(this.getRmWord(e.mode,e.rm,e.rmAddr))):this.setRmByte(e.mode,e.rm,e.rmAddr,this.decByte(this.getRmByte(e.mode,e.rm,e.rmAddr)));break;case 2:this.clockCount+=3==e.mode?a.ClockCycles8086.CallNearReg:a.ClockCycles8086.CallNearMem,this.pushWord(this.IP),this.IP=this.getRmWord(e.mode,e.rm,e.rmAddr);break;case 3:{this.clockCount+=a.ClockCycles8086.CallFarRm,3==e.mode&&this.handleIllegalOpcode(),this.pushWord(this.CS),this.pushWord(this.IP);const t=this.memoryProvider.peekW(e.rmAddr);e.rmAddr+=2;const s=this.memoryProvider.peekW(e.rmAddr);this.CS=s,this.IP=t}break;case 4:this.clockCount+=3==e.mode?a.ClockCycles8086.JmpNearReg:a.ClockCycles8086.JmpNearMem,this.IP=this.getRmWord(e.mode,e.rm,e.rmAddr);break;case 5:{this.clockCount+=a.ClockCycles8086.JmpFarRm,3==e.mode&&this.handleIllegalOpcode();const t=this.memoryProvider.peekW(e.rmAddr),s=this.memoryProvider.peekW(e.rmAddr+2);this.CS=s,this.IP=t}break;case 6:this.clockCount+=a.ClockCycles8086.PushRm,this.pushWord(this.getRmWord(e.mode,e.rm,e.rmAddr));break;default:this.handleIllegalOpcode()}}handleOpcode80(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.AddRmImmReg:a.ClockCycles8086.AddRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.addByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 1:{this.clockCount+=3==t.mode?a.ClockCycles8086.OrRmImmReg:a.ClockCycles8086.OrRmImmMem;const e=255&(this.getRmByte(t.mode,t.rm,t.rmAddr)|this.readNextCodeByte());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e),this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.AdcRmImmReg:a.ClockCycles8086.AdcRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.adcByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.SbbRmImmReg:a.ClockCycles8086.SbbRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.sbbByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.AndRmImmReg:a.ClockCycles8086.AndRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr)&this.readNextCodeByte()&255;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e),this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.SubRmImmReg:a.ClockCycles8086.SubRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=this.subByte(e,s);this.setRmByte(t.mode,t.rm,t.rmAddr,i);break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.XorRmImmReg:a.ClockCycles8086.XorRmImmMem;const e=255&(this.getRmByte(t.mode,t.rm,t.rmAddr)^this.readNextCodeByte());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(e),this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.CmpRmImmReg:a.ClockCycles8086.CmpRmImmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte();this.subByte(e,s);break}default:this.handleIllegalOpcode()}}handleOpcode81(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.AddRmImmReg:a.ClockCycles8086.AddRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.addWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 1:{this.clockCount+=3==t.mode?a.ClockCycles8086.OrRmImmReg:a.ClockCycles8086.OrRmImmMem;const e=65535&(this.getRmWord(t.mode,t.rm,t.rmAddr)|this.readNextCodeWord());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e),this.setRmWord(t.mode,t.rm,t.rmAddr,e)}break;case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.AdcRmImmReg:a.ClockCycles8086.AdcRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.adcWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.SbbRmImmReg:a.ClockCycles8086.SbbRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.sbbWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.AndRmImmReg:a.ClockCycles8086.AndRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr)&this.readNextCodeWord()&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e),this.setRmWord(t.mode,t.rm,t.rmAddr,e);break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.SubRmImmReg:a.ClockCycles8086.SubRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord(),i=this.subWord(e,s);this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.XorRmImmReg:a.ClockCycles8086.XorRmImmMem;const e=65535&(this.getRmWord(t.mode,t.rm,t.rmAddr)^this.readNextCodeWord());this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(e),this.setRmWord(t.mode,t.rm,t.rmAddr,e);break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.CmpRmImmReg:a.ClockCycles8086.CmpRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeWord();this.subWord(e,s);break}default:this.handleIllegalOpcode()}}handleOpcode83(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.AddRmImmReg:a.ClockCycles8086.AddRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.addWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 1:{this.clockCount+=3==t.mode?a.ClockCycles8086.OrRmImmReg:a.ClockCycles8086.OrRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=65535&(e|(s>127?s+65280:s));this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.AdcRmImmReg:a.ClockCycles8086.AdcRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.adcWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.SbbRmImmReg:a.ClockCycles8086.SbbRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.sbbWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.AndRmImmReg:a.ClockCycles8086.AndRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=e&(s>127?s+65280:s)&65535;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.SubRmImmReg:a.ClockCycles8086.SubRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s,r=this.subWord(e,i);this.setRmWord(t.mode,t.rm,t.rmAddr,r);break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.XorRmImmReg:a.ClockCycles8086.XorRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=65535&(e^(s>127?s+65280:s));this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(i),this.setRmWord(t.mode,t.rm,t.rmAddr,i);break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.CmpRmImmReg:a.ClockCycles8086.CmpRmImmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.readNextCodeByte(),i=s>127?s+65280:s;this.subWord(e,i);break}default:this.handleIllegalOpcode()}}handleOpcodeF6(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:{this.clockCount+=3==t.mode?a.ClockCycles8086.TestRmImmReg:a.ClockCycles8086.TestRmImmMem;const e=this.readNextCodeByte(),s=this.getRmByte(t.mode,t.rm,t.rmAddr)&e;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagB(s);break}case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.NotRmReg:a.ClockCycles8086.NotRmMem;let e=this.getRmByte(t.mode,t.rm,t.rmAddr);e=255&~e,this.setRmByte(t.mode,t.rm,t.rmAddr,e);break}case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.NegRmReg:a.ClockCycles8086.NegRmMem;const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=this.subByte(0,e);this.setRmByte(t.mode,t.rm,t.rmAddr,s);break}case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.MulReg:a.ClockCycles8086.MulMem;const e=this.getAL()*this.getRmByte(t.mode,t.rm,t.rmAddr);this.flags.CF=this.flags.OF=e>255,this.flags.ZF=!1,this.AX=65535&e;break}case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.ImulReg:a.ClockCycles8086.ImulMem;let e=this.getAL();e>127&&(e-=256);let s=this.getRmByte(t.mode,t.rm,t.rmAddr);s>127&&(s-=256);const i=e*s;this.AX=65535&i,this.flags.CF=this.flags.OF=0!=this.getAH()&&255!=this.getAH(),this.flags.ZF=!1;break}case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.DivReg:a.ClockCycles8086.DivMem;const e=this.AX,s=this.getRmByte(t.mode,t.rm,t.rmAddr);if(0==s)this.doSoftInterrupt(0);else{const t=Math.trunc(e/s);t>255?this.doSoftInterrupt(0):(this.setAL(t),this.setAH(e%s))}break}case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.IdivReg:a.ClockCycles8086.IdivMem;const e=this.AX>32767?this.AX-65536:this.AX;let s=this.getRmByte(t.mode,t.rm,t.rmAddr);if(s>127&&(s-=256),0==s)this.doSoftInterrupt(0);else{const t=Math.trunc(e/s);t>=128||t<-128?this.doSoftInterrupt(0):(this.setAL(t),this.setAH(e%s))}break}default:this.handleIllegalOpcode()}}handleOpcodeF7(){const t=this.readAndDecodeAddressByte();switch(t.reg){case 0:this.clockCount+=3==t.mode?a.ClockCycles8086.TestRmImmReg:a.ClockCycles8086.TestRmImmMem;{const e=this.readNextCodeWord(),s=this.getRmWord(t.mode,t.rm,t.rmAddr)&e;this.flags.CF=this.flags.OF=!1,this.calcParitySignZeroFlagW(s)}break;case 2:{this.clockCount+=3==t.mode?a.ClockCycles8086.NotRmReg:a.ClockCycles8086.NotRmMem;let e=this.getRmWord(t.mode,t.rm,t.rmAddr);e=65535&~e,this.setRmWord(t.mode,t.rm,t.rmAddr,e)}break;case 3:{this.clockCount+=3==t.mode?a.ClockCycles8086.NegRmReg:a.ClockCycles8086.NegRmMem;const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=this.subWord(0,e);this.setRmWord(t.mode,t.rm,t.rmAddr,s)}break;case 4:{this.clockCount+=3==t.mode?a.ClockCycles8086.MulReg16:a.ClockCycles8086.MulMem16;const e=this.AX*this.getRmWord(t.mode,t.rm,t.rmAddr);this.flags.CF=this.flags.OF=e>65535,this.flags.ZF=!1,this.AX=65535&e,this.DX=e>>16&65535}break;case 5:{this.clockCount+=3==t.mode?a.ClockCycles8086.ImulReg16:a.ClockCycles8086.ImulMem16;const e=this.AX>32767?this.AX-65536:this.AX;let s=this.getRmWord(t.mode,t.rm,t.rmAddr);s>32767&&(s-=65536);const i=e*s;this.AX=65535&i,this.DX=i>>16&65535,this.flags.CF=this.flags.OF=0!=this.DX&&65535!=this.DX,this.flags.ZF=!1}break;case 6:{this.clockCount+=3==t.mode?a.ClockCycles8086.DivReg16:a.ClockCycles8086.DivMem16;const e=(this.DX<<16)+this.AX,s=this.getRmWord(t.mode,t.rm,t.rmAddr);if(0==s)this.doSoftInterrupt(0);else{const t=Math.trunc(e/s);t>65535?this.doSoftInterrupt(0):(this.AX=65535&t,this.DX=e%s&65535)}}break;case 7:{this.clockCount+=3==t.mode?a.ClockCycles8086.IdivReg16:a.ClockCycles8086.IdivMem16;const e=(this.DX<<16)+this.AX&4294967295;let s=this.getRmWord(t.mode,t.rm,t.rmAddr);if(s>32767&&(s-=65536),0==s)this.softInterrupt=0;else{const t=Math.trunc(e/s);t>=32768||t<-32768?this.doSoftInterrupt(0):(this.AX=65535&t,this.DX=e%s&65535)}}break;default:this.handleIllegalOpcode()}}handleOpcodeD0(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmReg:a.ClockCycles8086.ShiftRmMem,t.reg){case 0:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=255&(e<<1|e>>7);this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(128&e)>0;break}case 1:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=255&(e>>1|e<<7);this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(1&e)>0;break}case 2:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=(e<<1)+(this.flags.CF?1:0)&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(128&e)>0;break}case 3:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=(e>>1)+(this.flags.CF?128:0)&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(1&e)>0;break}case 4:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=e<<1&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagB(s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(128&e)>0;break}case 5:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=e>>1&255;this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagB(s),this.flags.OF=(128&e)!=(128&s),this.flags.CF=(1&e)>0;break}case 7:{const e=this.getRmByte(t.mode,t.rm,t.rmAddr),s=255&(e>>1|128&e);this.setRmByte(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagB(s),this.flags.OF=!1,this.flags.CF=(1&e)>0;break}default:this.handleIllegalOpcode()}}handleOpcodeD1(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmReg:a.ClockCycles8086.ShiftRmMem,t.reg){case 0:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=65535&(e<<1|e>>15);this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(32768&e)>0;break}case 1:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=65535&(e>>1|e<<15);this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(1&e)>0;break}case 2:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=(e<<1)+(this.flags.CF?1:0)&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(32768&e)>0;break}case 3:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=(e>>1)+(this.flags.CF?32768:0)&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(1&e)>0;break}case 4:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=e<<1&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagW(s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(32768&e)>0;break}case 5:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=e>>1&65535;this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagW(s),this.flags.OF=(32768&e)!=(32768&s),this.flags.CF=(1&e)>0;break}case 7:{const e=this.getRmWord(t.mode,t.rm,t.rmAddr),s=65535&(e>>1|32768&e);this.setRmWord(t.mode,t.rm,t.rmAddr,s),this.calcParitySignZeroFlagW(s),this.flags.OF=!1,this.flags.CF=(1&e)>0;break}default:this.handleIllegalOpcode()}}handleOpcodeC0(){const t=this.readAndDecodeAddressByte(),e=31&this.readNextCodeByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmImmReg+e:a.ClockCycles8086.ShiftRmImmMem+e,t.reg){case 0:this.rolByte(t.mode,t.rm,t.rmAddr,e);break;case 1:this.rorByte(t.mode,t.rm,t.rmAddr,e);break;case 2:this.rclByte(t.mode,t.rm,t.rmAddr,e);break;case 3:this.rcrByte(t.mode,t.rm,t.rmAddr,e);break;case 4:this.shlByte(t.mode,t.rm,t.rmAddr,e);break;case 5:this.shrByte(t.mode,t.rm,t.rmAddr,e);break;case 7:this.sarByte(t.mode,t.rm,t.rmAddr,e);break;default:this.handleIllegalOpcode()}}handleOpcodeC1(){const t=this.readAndDecodeAddressByte(),e=this.readNextCodeByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmImmReg+e:a.ClockCycles8086.ShiftRmImmMem+e,t.reg){case 0:this.rolWord(t.mode,t.rm,t.rmAddr,e);break;case 1:this.rorWord(t.mode,t.rm,t.rmAddr,e);break;case 2:this.rclWord(t.mode,t.rm,t.rmAddr,e);break;case 3:this.rcrWord(t.mode,t.rm,t.rmAddr,e);break;case 4:this.shlWord(t.mode,t.rm,t.rmAddr,e);break;case 5:this.shrWord(t.mode,t.rm,t.rmAddr,e);break;case 7:this.sarWord(t.mode,t.rm,t.rmAddr,e);break;default:this.handleIllegalOpcode()}}handleOpcodeD2(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmClReg+this.getCL():a.ClockCycles8086.ShiftRmClMem+this.getCL(),t.reg){case 0:this.rolByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 1:this.rorByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 2:this.rclByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 3:this.rcrByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 4:this.shlByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 5:this.shrByte(t.mode,t.rm,t.rmAddr,this.getCL());break;case 7:this.sarByte(t.mode,t.rm,t.rmAddr,this.getCL());break;default:this.handleIllegalOpcode()}}handleOpcodeD3(){const t=this.readAndDecodeAddressByte();switch(this.clockCount+=3==t.mode?a.ClockCycles8086.ShiftRmClReg+this.getCL():a.ClockCycles8086.ShiftRmClMem+this.getCL(),t.reg){case 0:this.rolWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 1:this.rorWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 2:this.rclWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 3:this.rcrWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 4:this.shlWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 5:this.shrWord(t.mode,t.rm,t.rmAddr,this.getCL());break;case 7:this.sarWord(t.mode,t.rm,t.rmAddr,this.getCL());break;default:this.handleIllegalOpcode()}}incByte(t){return t=t+1&255,this.calcParitySignZeroFlagB(t),this.flags.OF=128==t,this.flags.AF=0==(15&t),t}incWord(t){return t=t+1&65535,this.calcParitySignZeroFlagW(t),this.flags.OF=32768==t,this.flags.AF=0==(15&t),t}decWord(t){return t=t-1&65535,this.calcParitySignZeroFlagW(t),this.flags.OF=32767==t,this.flags.AF=15==(15&t),t}decByte(t){return t=t-1&255,this.calcParitySignZeroFlagB(t),this.flags.OF=127==t,this.flags.AF=15==(15&t),t}rolByte(t,e,s,i){const r=7&i,a=this.getRmByte(t,e,s),h=255&(a<<r|a>>8-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<8-r)>0)}rorByte(t,e,s,i){const r=7&i,a=this.getRmByte(t,e,s),h=255&(a>>r|a<<8-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<r-1)>0)}rclByte(t,e,s,i){const r=(31&i)%9,a=this.getRmByte(t,e,s),h=255&(a<<r|(r>0&&this.flags.CF?1<<r-1:0)|a>>9-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<8-r)>0)}rcrByte(t,e,s,i){const r=(31&i)%9,a=this.getRmByte(t,e,s),h=255&(a>>r|(r>0&&this.flags.CF?1<<8-r:0)|a<<9-r);this.setRmByte(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=(a&1<<r-1)>0)}shlByte(t,e,s,i){const r=31&i,a=this.getRmByte(t,e,s),h=a<<r&255;this.setRmByte(t,e,s,h),this.calcParitySignZeroFlagB(h),1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=r<=8&&(a&1<<8-r)>0}shrByte(t,e,s,i){const r=31&i,a=this.getRmByte(t,e,s),h=a>>r&255;this.setRmByte(t,e,s,h),this.calcParitySignZeroFlagB(h),1==r&&(this.flags.OF=(128&a)!=(128&h)),this.flags.CF=r>0&&(a&1<<r-1)>0}sarByte(t,e,s,i){const r=31&i,a=this.getRmByte(t,e,s),h=255&(a>>r|((128&a)>0?255<<8-r:0));this.setRmByte(t,e,s,h),this.calcParitySignZeroFlagB(h),this.flags.OF=!1,this.flags.CF=r>0&&(a&1<<r-1)>0}rolWord(t,e,s,i){const r=15&i,a=this.getRmWord(t,e,s),h=65535&(a<<r|a>>16-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<16-r)>0)}rorWord(t,e,s,i){const r=15&i,a=this.getRmWord(t,e,s),h=65535&(a>>r|a<<16-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<r-1)>0)}rclWord(t,e,s,i){const r=(31&i)%17,a=this.getRmWord(t,e,s),h=65535&(a<<r|(r>0&&this.flags.CF?1<<r-1:0)|a>>17-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<16-r)>0)}rcrWord(t,e,s,i){const r=(31&i)%17,a=this.getRmWord(t,e,s),h=65535&(a>>r|(r>0&&this.flags.CF?1<<16-r:0)|a<<17-r);this.setRmWord(t,e,s,h),r>0&&(1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=(a&1<<r-1)>0)}shlWord(t,e,s,i){const r=31&i,a=this.getRmWord(t,e,s),h=a<<r&65535;this.setRmWord(t,e,s,h),this.calcParitySignZeroFlagW(h),1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=r<=16&&(a&1<<16-r)>0}shrWord(t,e,s,i){const r=31&i,a=this.getRmWord(t,e,s),h=a>>r&65535;this.setRmWord(t,e,s,h),this.calcParitySignZeroFlagW(h),1==r&&(this.flags.OF=(32768&a)!=(32768&h)),this.flags.CF=r>0&&(a&1<<r-1)>0}sarWord(t,e,s,i){const r=31&i,a=this.getRmWord(t,e,s),h=65535&(a>>r|((32768&a)>0?65535<<16-r:0));this.setRmWord(t,e,s,h),this.calcParitySignZeroFlagW(h),this.flags.OF=!1,this.flags.CF=r>0&&(a&1<<r-1)>0}subByte(t,e){let s=t-e;const i=(t>127?t-256:t)-(e>127?e-256:e);return this.flags.CF=s<0,this.flags.OF=i>127||i<-128,this.flags.AF=(15&t)-(15&e)<0,s&=255,this.calcParitySignZeroFlagB(s),s}subWord(t,e){let s=t-e;const i=(t>32767?t-65536:t)-(e>32767?e-65536:e);return this.flags.CF=s<0,this.flags.OF=i>32767||i<-32768,this.flags.AF=(15&t)-(15&e)<0,s&=65535,this.calcParitySignZeroFlagW(s),s}sbbByte(t,e){const s=this.flags.CF?1:0;let i=t-e-s;const r=(t>127?t-256:t)-(e>127?e-256:e)-s;return this.flags.CF=i<0,this.flags.OF=r>127||r<-128,this.flags.AF=(15&t)-(15&e)-s<0,i&=255,this.calcParitySignZeroFlagB(i),i}sbbWord(t,e){const s=this.flags.CF?1:0;let i=t-e-s;const r=(t>32767?t-65536:t)-(e>32767?e-65536:e)-s;return this.flags.CF=i<0,this.flags.OF=r>32767||r<-32768,this.flags.AF=(15&t)-(15&e)-s<0,i&=65535,this.calcParitySignZeroFlagW(i),i}addByte(t,e){let s=t+e;const i=(t>127?t-256:t)-(e>127?e-256:e);return this.flags.CF=s>255,this.flags.OF=i>127||i<-128,this.flags.AF=(15&t)+(15&e)>15,s&=255,this.calcParitySignZeroFlagB(s),s}addWord(t,e){let s=t+e;const i=(t>32767?t-65536:t)-(e>32767?e-65536:e);return this.flags.CF=s>65535,this.flags.OF=i>32767||i<-32768,this.flags.AF=(15&t)+(15&e)>15,s&=65535,this.calcParitySignZeroFlagW(s),s}adcByte(t,e){const s=this.flags.CF?1:0;let i=t+e+s;const r=(t>127?t-256:t)-(e>127?e-256:e)+s;return this.flags.CF=i>255,this.flags.OF=r>127||r<-128,this.flags.AF=(15&t)+(15&e)+s>15,i&=255,this.calcParitySignZeroFlagB(i),i}adcWord(t,e){const s=this.flags.CF?1:0;let i=t+e+s;const r=(t>32767?t-65536:t)-(e>32767?e-65536:e)+s;return this.flags.CF=i>65535,this.flags.OF=r>32767||r<-32768,this.flags.AF=(15&t)+(15&e)+s>15,i&=65535,this.calcParitySignZeroFlagW(i),i}loadSeg(){this.clockCount+=a.ClockCycles8086.Lds;const t=this.readAndDecodeAddressByte();3==t.mode&&this.handleIllegalOpcode();const e=this.memoryProvider.peekW(t.rmAddr);return this.setRegWord(t.reg,e),t.rmAddr+=2,this.memoryProvider.peekW(t.rmAddr)}pushWord(t){this.SP=this.SP-2&65535,this.memoryProvider.pokeW(this.genAddr(this.SS,this.SP),t)}popWord(){const t=this.memoryProvider.peekW(this.genAddr(this.SS,this.SP));return this.SP=this.SP+2&65535,t}calcParitySignZeroFlagB(t){t&=255,this.flags.PF=this.parities[t],this.flags.SF=(128&t)>0,this.flags.ZF=0==t}calcParitySignZeroFlagW(t){t&=65535,this.flags.PF=this.parities[255&t],this.flags.SF=(32768&t)>0,this.flags.ZF=0==t}readAndDecodeAddressByte(){const t=new o,e=this.readNextCodeByte();return t.mode=(192&e)>>6,t.reg=(56&e)>>3,t.rm=7&e,3==t.mode?t.rmAddr=0:t.rmAddr=this.calcRmAddr(t.mode,t.rm),t}doByteOperationU(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRegByte(h.reg));a&&this.setRmByte(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRmByte(h.mode,h.rm,h.rmAddr));a&&this.setRegByte(h.reg,t)}}doByteOperation(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRmByte(h.mode,h.rm,h.rmAddr),this.getRegByte(h.reg));a&&this.setRmByte(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRegByte(h.reg),this.getRmByte(h.mode,h.rm,h.rmAddr));a&&this.setRegByte(h.reg,t)}}doWordOperationU(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRegWord(h.reg));a&&this.setRmWord(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRmWord(h.mode,h.rm,h.rmAddr));a&&this.setRegWord(h.reg,t)}}doSegRegWordOperation(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getSegReg(h.reg));a&&this.setRmWord(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRmWord(h.mode,h.rm,h.rmAddr));a&&this.setSegReg(h.reg,t)}}doWordOperation(t,e,s,r,a=!0){const h=this.readAndDecodeAddressByte();if(this.clockCount+=3==h.mode?s:r,t==i.Direction.RegToRm){const t=e(this.getRmWord(h.mode,h.rm,h.rmAddr),this.getRegWord(h.reg));a&&this.setRmWord(h.mode,h.rm,h.rmAddr,t)}else{const t=e(this.getRegWord(h.reg),this.getRmWord(h.mode,h.rm,h.rmAddr));a&&this.setRegWord(h.reg,t)}}calcRmAddr(t,e){var s;const i=this.calcEa(t,e);return this.genAddr(null!==(s=this.segOverride)&&void 0!==s?s:i.defaultSeg,i.ea)}calcEa(t,e){const s=new n;switch(t){case 0:switch(e){case 0:return s.defaultSeg=this.DS,s.ea=this.BX+this.SI&65535,s;case 1:return s.defaultSeg=this.DS,s.ea=this.BX+this.DI&65535,s;case 2:return s.defaultSeg=this.SS,s.ea=this.BP+this.SI&65535,s;case 3:return s.defaultSeg=this.SS,s.ea=this.BP+this.DI&65535,s;case 4:return s.defaultSeg=this.DS,s.ea=this.SI,s;case 5:return s.defaultSeg=this.DS,s.ea=this.DI,s;case 6:return s.defaultSeg=this.DS,s.ea=this.readNextCodeWord(),s;case 7:return s.defaultSeg=this.DS,s.ea=this.BX,s}break;case 1:{let t=this.readNextCodeByte();switch(t>127&&(t-=256),e){case 0:return s.defaultSeg=this.DS,s.ea=this.BX+this.SI+t&65535,s;case 1:return s.defaultSeg=this.DS,s.ea=this.BX+this.DI+t&65535,s;case 2:return s.defaultSeg=this.SS,s.ea=this.BP+this.SI+t&65535,s;case 3:return s.defaultSeg=this.SS,s.ea=this.BP+this.DI+t&65535,s;case 4:return s.defaultSeg=this.DS,s.ea=this.SI+t&65535,s;case 5:return s.defaultSeg=this.DS,s.ea=this.DI+t&65535,s;case 6:return s.defaultSeg=this.SS,s.ea=this.BP+t&65535,s;case 7:return s.defaultSeg=this.DS,s.ea=this.BX+t&65535,s}}break;case 2:{const t=this.readNextCodeWord();switch(e){case 0:return s.defaultSeg=this.DS,s.ea=this.BX+this.SI+t&65535,s;case 1:return s.defaultSeg=this.DS,s.ea=this.BX+this.DI+t&65535,s;case 2:return s.defaultSeg=this.SS,s.ea=this.BP+this.SI+t&65535,s;case 3:return s.defaultSeg=this.SS,s.ea=this.BP+this.DI+t&65535,s;case 4:return s.defaultSeg=this.DS,s.ea=this.SI+t&65535,s;case 5:return s.defaultSeg=this.DS,s.ea=this.DI+t&65535,s;case 6:return s.defaultSeg=this.SS,s.ea=this.BP+t&65535,s;case 7:return s.defaultSeg=this.DS,s.ea=this.BX+t&65535,s}}}return s.defaultSeg=this.DS,s.ea=0,s}getRegByte(t){switch(t){case 0:return this.getAL();case 1:return this.getCL();case 2:return this.getDL();case 3:return this.getBL();case 4:return this.getAH();case 5:return this.getCH();case 6:return this.getDH();case 7:return this.getBH()}return 0}setRegByte(t,e){switch(t){case 0:this.setAL(e);break;case 1:this.setCL(e);break;case 2:this.setDL(e);break;case 3:this.setBL(e);break;case 4:this.setAH(e);break;case 5:this.setCH(e);break;case 6:this.setDH(e);break;case 7:this.setBH(e)}}getRmByte(t,e,s){return 3==t?this.getRegByte(e):this.memoryProvider.peek(s)}setRmByte(t,e,s,i){3==t?this.setRegByte(e,i):this.memoryProvider.poke(s,i)}getRegWord(t){switch(t){case 0:return this.AX;case 1:return this.CX;case 2:return this.DX;case 3:return this.BX;case 4:return this.SP;case 5:return this.BP;case 6:return this.SI;case 7:return this.DI}return 0}getSegReg(t){switch(t){case 0:return this.ES;case 1:return this.CS;case 2:return this.SS;case 3:return this.DS}return 0}setRegWord(t,e){switch(t){case 0:this.AX=e;break;case 1:this.CX=e;break;case 2:this.DX=e;break;case 3:this.BX=e;break;case 4:this.SP=e;break;case 5:this.BP=e;break;case 6:this.SI=e;break;case 7:this.DI=e}}setSegReg(t,e){switch(t){case 0:this.ES=e;break;case 1:this.CS=e;break;case 2:this.SS=e,this.blockInterrupt=!0;break;case 3:this.DS=e}}getRmWord(t,e,s){return 3==t?this.getRegWord(e):this.memoryProvider.peekW(s)}setRmWord(t,e,s,i){3==t?this.setRegWord(e,i):this.memoryProvider.pokeW(s,i)}setMemByte(t,e,s){this.memoryProvider.poke(this.genAddr(t,e),s)}setMemWord(t,e,s){this.memoryProvider.pokeW(this.genAddr(t,e),s)}readNextCodeByte(){const t=this.genAddr(this.CS,this.IP);return this.IP=this.IP+1&65535,this.memoryProvider.peek(t)}readNextCodeWord(){const t=this.memoryProvider.peekW(this.genAddr(this.CS,this.IP));return this.IP=this.IP+2&65535,t}getMemByte(t,e){return this.memoryProvider.peek(this.genAddr(t,e))}getMemWord(t,e){return this.memoryProvider.peekW(this.genAddr(t,e))}doSoftInterrupt(t){this.handleSoftInterrupt(t)||(this.softInterrupt=t)}handleSoftInterrupt(t){switch(t){case 19:if(4==this.getAH())return this.setAH(0),this.flags.CF=!1,!0}return!1}doInterrupt(t){this.hardInterrupt=t}setEvent(t,e){const s=++this.eventGen;return this.cpuEvents.push({action:e,clockCount:this.clockCount+Math.trunc(t*h.Settings.cpuFrequency/1e3),id:s}),s}deleteEvent(t){for(let e=0;e<this.cpuEvents.length;e++)if(this.cpuEvents[e].id==t){this.cpuEvents.splice(e,1);break}}}},function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.Flags16=e.FlagValue=void 0,function(t){t[t.Carry=1]="Carry",t[t.Parity=4]="Parity",t[t.Adjust=16]="Adjust",t[t.Zero=64]="Zero",t[t.Sign=128]="Sign",t[t.Trap=256]="Trap",t[t.IntEnable=512]="IntEnable",t[t.Direction=1024]="Direction",t[t.Overflow=2048]="Overflow",t[t.IoPrivilegeLevel0=4096]="IoPrivilegeLevel0",t[t.IoPrivilegeLevel1=8192]="IoPrivilegeLevel1",t[t.NestedTask=16384]="NestedTask",t[t.Resume=65536]="Resume",t[t.Virtual8086Mode=131072]="Virtual8086Mode"}(i=e.FlagValue||(e.FlagValue={}));e.Flags16=class{constructor(){this.internalValue=0,this.internalValue=61440}setFlag(t){this.internalValue|=t}resetFlag(t){this.internalValue&=65535&~t}getFlag(t){return(this.internalValue&t)>0}get CF(){return this.getFlag(i.Carry)}set CF(t){t?this.setFlag(i.Carry):this.resetFlag(i.Carry)}get PF(){return this.getFlag(i.Parity)}set PF(t){t?this.setFlag(i.Parity):this.resetFlag(i.Parity)}get AF(){return this.getFlag(i.Adjust)}set AF(t){t?this.setFlag(i.Adjust):this.resetFlag(i.Adjust)}get ZF(){return this.getFlag(i.Zero)}set ZF(t){t?this.setFlag(i.Zero):this.resetFlag(i.Zero)}get SF(){return this.getFlag(i.Sign)}set SF(t){t?this.setFlag(i.Sign):this.resetFlag(i.Sign)}get TF(){return this.getFlag(i.Trap)}set TF(t){t?this.setFlag(i.Trap):this.resetFlag(i.Trap)}get IF(){return this.getFlag(i.IntEnable)}set IF(t){t?this.setFlag(i.IntEnable):this.resetFlag(i.IntEnable)}get DF(){return this.getFlag(i.Direction)}set DF(t){t?this.setFlag(i.Direction):this.resetFlag(i.Direction)}get OF(){return this.getFlag(i.Overflow)}set OF(t){t?this.setFlag(i.Overflow):this.resetFlag(i.Overflow)}get value(){return this.internalValue}set value(t){this.internalValue=61440|t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ClockCycles386=e.ClockCycles8086=void 0;class i{}e.ClockCycles8086=i,i.Rep=7,i.Lock=2,i.SegOverride=2,i.Aaa=8,i.Aad=15,i.Aam=19,i.Aas=7,i.AdcRegRmReg=3,i.AdcRegRmMem=10,i.AdcRmRegReg=3,i.AdcRmRegMem=10,i.AdcAlImm=3,i.AdcAxImm=4,i.AdcRmImmReg=4,i.AdcRmImmMem=16,i.AddRegRmReg=3,i.AddRegRmMem=10,i.AddRmRegReg=3,i.AddRmRegMem=10,i.AddAlImm=3,i.AddAxImm=4,i.AddRmImmReg=4,i.AddRmImmMem=16,i.AndRegRmReg=3,i.AndRegRmMem=10,i.AndRmRegReg=3,i.AndRmRegMem=10,i.AndRmImmReg=4,i.AndRmImmMem=16,i.AndAlImm=3,i.AndAxImm=4,i.Bound=34,i.CallNear=19,i.CallFar=31,i.CallNearReg=13,i.CallNearMem=19,i.CallFarRm=38,i.Cbw=2,i.Clc=2,i.Cld=2,i.Cli=2,i.Cmc=2,i.CmpRegRmReg=3,i.CmpRegRmMem=10,i.CmpRmRegReg=3,i.CmpRmRegMem=10,i.CmpAlImm=3,i.CmpAxImm=4,i.CmpRmImmReg=3,i.CmpRmImmMem=10,i.Cmps=22,i.Cwd=4,i.Daa=4,i.Das=4,i.DivReg=29,i.DivMem=35,i.DivReg16=38,i.DivMem16=44,i.DecReg=3,i.DecMem=15,i.EnterLvl0=19,i.EnterLvl1=29,i.EnterInitial=26,i.EnterPerLvl=20,i.Hlt=2,i.IdivReg=48,i.IdivMem=54,i.IdivReg16=57,i.IdivMem16=63,i.ImulImmReg=24,i.ImulImmMem=31,i.ImulImmReg16=24,i.ImulImmMem16=31,i.ImulReg=27,i.ImulMem=33,i.ImulReg16=36,i.ImulMem16=42,i.InImm=10,i.InDx=8,i.IncReg=3,i.IncMem=15,i.Ins=14,i.InsRep=8,i.Int3=45,i.IntImm=47,i.Into=48,i.IntoNoInt=4,i.Iret=28,i.JumpCondMet=13,i.JumpCondNotMet=4,i.JcxzMet=15,i.JcxzNotMet=5,i.JmpShort=14,i.JmpNear=14,i.JmpNearReg=11,i.JmpNearMem=17,i.JmpFar=14,i.JmpFarRm=26,i.Lahf=2,i.Lds=18,i.Lea=6,i.Leave=8,i.Les=18,i.Lods=12,i.LodsRep=11,i.Loop=16,i.LoopFinished=6,i.MovAxMemoffs=8,i.MovMemoffsAx=9,i.MovRegImm8=3,i.MovRegImm16=4,i.MovRmImm8=12,i.MovRmImm16=13,i.MovRmRegReg=2,i.MovRmRegMem=12,i.MovRegRmReg=2,i.MovRegRmMem=9,i.MovRmSegReg=2,i.MovRmSegMem=11,i.MovSegRmReg=2,i.MovSegRmMem=9,i.Movs=14,i.MovsRep=8,i.MulReg=27,i.MulMem=33,i.MulReg16=36,i.MulMem16=42,i.NegRmReg=3,i.NegRmMem=10,i.Nop=3,i.NotRmReg=3,i.NotRmMem=10,i.OrRegRmReg=3,i.OrRegRmMem=10,i.OrRmRegReg=3,i.OrRmRegMem=10,i.OrAlImm=3,i.OrAxImm=4,i.OrRmImmReg=4,i.OrRmImmMem=16,i.OutImm=9,i.OutDx=7,i.Outs=14,i.OutsRep=8,i.PopMem=20,i.PopReg=10,i.PopSeg=8,i.Popa=51,i.Popf=8,i.PushMem=20,i.PushReg=10,i.PushSeg=9,i.Pusha=36,i.Pushf=9,i.PushImm8=10,i.PushImm16=10,i.PushRm=16,i.Ret=16,i.RetImm=18,i.Retf=22,i.RetfImm=25,i.Sahf=3,i.SbbRegRmReg=3,i.SbbRegRmMem=10,i.SbbRmRegReg=3,i.SbbRmRegMem=10,i.SbbAlImm=3,i.SbbAxImm=4,i.SbbRmImmReg=4,i.SbbRmImmMem=16,i.Scas=15,i.SetFlag=2,i.ShiftRmReg=2,i.ShiftRmMem=15,i.ShiftRmImmReg=5,i.ShiftRmImmMem=17,i.ShiftRmClReg=5,i.ShiftRmClMem=17,i.Stos=10,i.StosRep=9,i.SubRegRmReg=3,i.SubRegRmMem=10,i.SubRmRegReg=3,i.SubRmRegMem=10,i.SubAlImm=3,i.SubAxImm=4,i.SubRmImmReg=4,i.SubRmImmMem=16,i.TestReg=3,i.TestMem=10,i.TestAlImm=3,i.TestAxImm=4,i.TestRmImmReg=4,i.TestRmImmMem=10,i.Wait=6,i.XchgReg=3,i.XchgRegRmReg=4,i.XchgRegRmMem=17,i.Xlat=11,i.XorRegRmReg=3,i.XorRegRmMem=10,i.XorRmRegReg=3,i.XorRmRegMem=10,i.XorAlImm=3,i.XorAxImm=4,i.XorRmImmReg=4,i.XorRmImmMem=16,i.FpuInstruction=3,i.HardInterrupt=40;class r{}e.ClockCycles386=r,r.Rep=2,r.Lock=2,r.SegOverride=2,r.Aaa=4,r.Aad=19,r.Aam=17,r.Aas=4,r.AdcRegRmReg=2,r.AdcRegRmMem=6,r.AdcRmRegReg=2,r.AdcRmRegMem=7,r.AdcAlImm=2,r.AdcAxImm=2,r.AdcRmImmReg=2,r.AdcRmImmMem=7,r.AddRegRmReg=2,r.AddRegRmMem=6,r.AddRmRegReg=2,r.AddRmRegMem=7,r.AddAlImm=2,r.AddAxImm=2,r.AddRmImmReg=2,r.AddRmImmMem=7,r.AndRegRmReg=2,r.AndRegRmMem=6,r.AndRmRegReg=2,r.AndRmRegMem=7,r.AndAlImm=2,r.AndAxImm=2,r.AndRmImmReg=2,r.AndRmImmMem=7,r.ArplReg=20,r.ArplMem=21,r.Bound=10,r.BsfBase=10,r.BsfBit=3,r.BtReg=3,r.BtMem=10,r.BtImmReg=3,r.BtImmMem=6,r.BtcReg=6,r.BtcMem=13,r.BtcImmReg=6,r.BtcImmMem=8,r.CallNear=7,r.CallFar=17,r.CallNearReg=7,r.CallNearMem=11,r.CallFarRm=22,r.Cbw=3,r.Clc=2,r.Cld=2,r.Cli=3,r.Clts=5,r.Cmc=2,r.CmpRegRmReg=2,r.CmpRegRmMem=6,r.CmpRmRegReg=2,r.CmpRmRegMem=5,r.CmpAlImm=2,r.CmpAxImm=2,r.CmpRmImmReg=2,r.CmpRmImmMem=5,r.Cmps=10,r.Cwd=2,r.Daa=4,r.Das=4,r.DecReg=2,r.DecMem=6,r.DivReg=14,r.DivMem=17,r.DivReg16=22,r.DivMem16=25,r.DivReg32=38,r.DivMem32=41,r.EnterLvl0=10,r.EnterLvl1=12,r.EnterInitial=15,r.EnterPerLvl=4,r.Hlt=5,r.IdivReg=19,r.IdivMem=19,r.IdivReg16=27,r.IdivMem16=27,r.IdivReg32=43,r.IdivMem32=43,r.ImulImmReg=12,r.ImulImmMem=15,r.ImulImmReg16=16,r.ImulImmMem16=19,r.ImulImmReg32=24,r.ImulImmMem32=27,r.ImulReg=12,r.ImulMem=15,r.ImulReg16=16,r.ImulMem16=19,r.ImulReg32=24,r.ImulMem32=27,r.InImm=12,r.InDx=13,r.IncReg=2,r.IncMem=6,r.Ins=15,r.InsRep=15,r.Int3=33,r.IntImm=37,r.Into=35,r.IntoNo=3,r.Iret=22,r.JumpCondMet=7,r.JumpCondNotMet=3,r.JcxzMet=9,r.JcxzNotMet=5,r.JmpShort=7,r.JmpNear=7,r.JmpNearReg=7,r.JmpNearMem=10,r.JmpFar=12,r.JmpFarRm=43,r.Lahf=2,r.Lar=16,r.Lds=7,r.Lea=2,r.Leave=4,r.LidtLgdt=11,r.Lldt=20,r.Ltr=27,r.LmswReg=10,r.LmswMem=13,r.Lods=5,r.LodsRep=5,r.Loop=11,r.LoopFinished=2,r.MovAxMemoffs=4,r.MovMemoffsAx=2,r.MovRegImm8=2,r.MovRegImm16=2,r.MovRmImm8=2,r.MovRmImm16=2,r.MovRmRegReg=2,r.MovRmRegMem=2,r.MovRegRmReg=2,r.MovRegRmMem=4,r.MovRmSegReg=2,r.MovRmSegMem=2,r.MovSegRmReg=2,r.MovSegRmMem=5,r.MovRegCr=6,r.MovCr0Reg=10,r.MovCr2Reg=4,r.MovCr3Reg=5,r.MovDr0Reg=22,r.MovDr6Reg=16,r.MovRegDr0=22,r.MovRegDr6=14,r.MovRegTr=12,r.MovTrReg=12,r.Movs=7,r.MovsRep=7,r.MovsxReg=3,r.MovsxMem=6,r.MovzxReg=3,r.MovzxMem=6,r.MulReg=12,r.MulMem=15,r.MulReg16=16,r.MulMem16=19,r.MulReg32=24,r.MulMem32=27,r.NegRmReg=2,r.NegRmMem=6,r.Nop=3,r.NotRmReg=2,r.NotRmMem=6,r.OrRegRmReg=2,r.OrRegRmMem=7,r.OrRmRegReg=2,r.OrRmRegMem=6,r.OrAlImm=2,r.OrAxImm=2,r.OrRmImmReg=2,r.OrRmImmMem=7,r.OutImm=10,r.OutDx=11,r.Outs=14,r.OutsRep=14,r.PopMem=5,r.PopReg=4,r.PopSeg=7,r.Popa=24,r.Popf=5,r.PushMem=5,r.PushReg=2,r.PushSeg=2,r.Pusha=18,r.Pushf=4,r.PushImm8=2,r.PushImm16=2,r.PushRm=2,r.Ret=10,r.RetImm=10,r.Retf=18,r.RetfImm=18,r.Sahf=3,r.SbbRegRmReg=2,r.SbbRegRmMem=7,r.SbbRmRegReg=2,r.SbbRmRegMem=6,r.SbbAlImm=2,r.SbbAxImm=2,r.SbbRmImmReg=2,r.SbbRmImmMem=7,r.Scas=7,r.SetCondMet=5,r.SetCondNotMet=4,r.SetFlag=2,r.ShiftRmReg=3,r.ShiftRmMem=7,r.ShiftRmImmReg=3,r.ShiftRmImmMem=7,r.ShiftRmClReg=3,r.ShiftRmClMem=7,r.ShldReg=3,r.ShldMem=7,r.SidtSgdt=9,r.Sldt=2,r.SmswReg=2,r.SmswMem=3,r.Stos=4,r.StosRep=4,r.Str=25,r.SubRegRmReg=2,r.SubRegRmMem=7,r.SubRmRegReg=2,r.SubRmRegMem=6,r.SubAlImm=2,r.SubAxImm=2,r.SubRmImmReg=2,r.SubRmImmMem=7,r.TestReg=2,r.TestMem=5,r.TestAlImm=2,r.TestAxImm=2,r.TestRmImmReg=2,r.TestRmImmMem=5,r.Wait=6,r.XchgReg=3,r.XchgRegRmReg=3,r.XchgRegRmMem=5,r.Xlat=5,r.XorRegRmReg=2,r.XorRegRmMem=7,r.XorRmRegReg=2,r.XorRmRegMem=6,r.XorAlImm=2,r.XorAxImm=2,r.XorRmImmReg=2,r.XorRmImmMem=7,r.FpuInstruction=3,r.HardInterrupt=40},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Cpu386=void 0;e.Cpu386=class{constructor(t,e){}reset(){throw new Error("Method not implemented.")}getCurrentCodeAddr(){throw new Error("Method not implemented.")}getCodeSeg32Bit(){throw new Error("Method not implemented.")}execNextInstruction(){throw new Error("Method not implemented.")}execInstructions(t){throw new Error("Method not implemented.")}getInstructionByte(){throw new Error("Method not implemented.")}getAddressByte(){throw new Error("Method not implemented.")}getName(){throw new Error("Method not implemented.")}doInterrupt(t){throw new Error("Method not implemented.")}setEvent(t,e){throw new Error("Method not implemented.")}deleteEvent(t){throw new Error("Method not implemented.")}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Disassembler=void 0;class i{}e.Disassembler=class{constructor(t,e){this.instructionLineOffset=32,this.hexValues=Array(),this.startAddress=0,this.localAddress=0,this.cpu=t,this.memory=e}get instBytes(){let t="";for(let e=0;e<this.hexValues.length;e++){""!=t&&(t+=" "),t+=this.hexValues[e].toString(16).toUpperCase().padStart(2,"0")}return t}get disassembledLine(){const t=this.instBytes.padEnd(this.instructionLineOffset," ");return this.startAddress.toString(16).toUpperCase().padStart(5,"0")+"  "+t+"    "+this.instruction}doDisassemble(t=-1){this.hexValues.length=0,this.instruction="",this.startAddress=-1==t?this.cpu.getCurrentCodeAddr():t,this.localAddress=this.startAddress;let e,s=this.getNextByte();this.op32Bit=this.addr32Bit=this.cpu.getCodeSeg32Bit();do{switch(e=!1,s){case 243:this.instruction+="REP ",s=this.getNextByte(),e=!0;break;case 242:this.instruction+="REPNZ ",s=this.getNextByte(),e=!0}switch(s){case 240:this.instruction+="LOCK ",s=this.getNextByte(),e=!0;break;case 46:this.segOverride="CS:",s=this.getNextByte(),e=!0;break;case 62:this.segOverride="DS:",s=this.getNextByte(),e=!0;break;case 38:this.segOverride="ES:",s=this.getNextByte(),e=!0;break;case 54:this.segOverride="SS:",s=this.getNextByte(),e=!0;break;case 100:this.segOverride="FS:",s=this.getNextByte(),e=!0;break;case 101:this.segOverride="GS:",s=this.getNextByte(),e=!0}102==s&&(this.op32Bit=!this.op32Bit,s=this.getNextByte(),e=!0),103==s&&(this.addr32Bit=!this.addr32Bit,s=this.getNextByte(),e=!0)}while(e);this.processOpcode(s),this.segOverride=""}processOpcode(t){switch(t){case 55:this.instruction="AAA";break;case 213:this.instruction="AAD";break;case 212:this.instruction="AAM";break;case 63:this.instruction="AAS";break;case 16:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADC ${t.rmStr}, ${t.regStr}`}break;case 17:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADC ${t.rmStr}, ${t.regStr}`}break;case 18:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADC ${t.regStr}, ${t.rmStr}`}break;case 19:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADC ${t.regStr}, ${t.rmStr}`}break;case 20:this.instruction="ADC AL, "+this.getNextByteStr();break;case 21:this.op32Bit?this.instruction="ADC EAX, "+this.getNextDwordStr():this.instruction="ADC AX, "+this.getNextWordStr();break;case 0:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADD ${t.rmStr}, ${t.regStr}`}break;case 1:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADD ${t.rmStr}, ${t.regStr}`}break;case 2:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`ADD ${t.regStr}, ${t.rmStr}`}break;case 3:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ADD ${t.regStr}, ${t.rmStr}`}break;case 4:this.instruction="ADD AL, "+this.getNextByteStr();break;case 5:this.instruction="ADD AX, "+this.getNextWordStr();break;case 32:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`AND ${t.rmStr}, ${t.regStr}`}break;case 33:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`AND ${t.rmStr}, ${t.regStr}`}break;case 34:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`AND ${t.regStr}, ${t.rmStr}`}break;case 35:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`AND ${t.regStr}, ${t.rmStr}`}break;case 36:this.instruction="AND AL, "+this.getNextByteStr();break;case 37:this.op32Bit?this.instruction="AND EAX, "+this.getNextDwordStr():this.instruction="AND AX, "+this.getNextWordStr();break;case 99:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`ARPL ${t.rmStr}, ${t.regStr}`}break;case 98:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BOUND ${t.regStr}, ${t.rmStr}`}break;case 232:this.op32Bit?this.instruction="CALL "+this.getNextSDwordStr():this.instruction="CALL "+this.getNextSWordStr();break;case 154:{const t=this.getNextWord(),e=this.getNextWord();this.instruction=`CALL FAR ${this.wordToHex(e)}:${this.wordToHex(t)}`}break;case 152:this.op32Bit?this.instruction="CWDE":this.instruction="CBW";break;case 248:this.instruction="CLC";break;case 252:this.instruction="CLD";break;case 250:this.instruction="CLI";break;case 245:this.instruction="CMC";break;case 56:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`CMP ${t.rmStr}, ${t.regStr}`}break;case 57:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`CMP ${t.rmStr}, ${t.regStr}`}break;case 58:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`CMP ${t.regStr}, ${t.rmStr}`}break;case 59:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`CMP ${t.regStr}, ${t.rmStr}`}break;case 60:this.instruction="CMP AL, "+this.getNextByteStr();break;case 61:this.op32Bit?this.instruction="CMP EAX, "+this.getNextDwordStr():this.instruction="CMP AX, "+this.getNextWordStr();break;case 166:{this.instruction+="CMPSB";const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 167:{this.op32Bit?this.instruction+="CMPSD":this.instruction+="CMPSW";const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 153:this.op32Bit?this.instruction="CDQ":this.instruction="CWD";break;case 39:this.instruction="DAA";break;case 47:this.instruction="DAS";break;case 72:this.instruction=`DEC ${this.prefixOp32()}AX`;break;case 73:this.instruction=`DEC ${this.prefixOp32()}CX`;break;case 74:this.instruction=`DEC ${this.prefixOp32()}DX`;break;case 75:this.instruction=`DEC ${this.prefixOp32()}BX`;break;case 76:this.instruction=`DEC ${this.prefixOp32()}SP`;break;case 77:this.instruction=`DEC ${this.prefixOp32()}BP`;break;case 78:this.instruction=`DEC ${this.prefixOp32()}SI`;break;case 79:this.instruction=`DEC ${this.prefixOp32()}DI`;break;case 200:this.instruction=`ENTER ${this.getNextWordStr()}, ${this.getNextByteStr()}`;break;case 244:this.instruction="HLT";break;case 107:{const t=this.readAndDecodeAddressByte(!1);t.regStr==t.rmStr?this.instruction=`IMUL ${t.regStr}, ${this.getNextByteStr()}`:this.instruction=`IMUL ${t.regStr}, ${t.rmStr}, ${this.getNextByteStr()}`}break;case 105:{const t=this.readAndDecodeAddressByte(!1),e=this.op32Bit?this.getNextDwordStr():this.getNextWordStr();t.regStr==t.rmStr?this.instruction=`IMUL ${t.regStr}, ${e}`:this.instruction=`IMUL ${t.regStr}, ${t.rmStr}, ${e}`}break;case 228:this.instruction="IN AL, "+this.getNextByteStr();break;case 229:this.instruction=`IN ${this.prefixOp32()}AX, ${this.getNextByteStr()}`;break;case 236:this.instruction="IN AL, DX";break;case 237:this.instruction=`IN ${this.prefixOp32()}AX, DX`;break;case 64:this.instruction=`INC ${this.prefixOp32()}AX`;break;case 65:this.instruction=`INC ${this.prefixOp32()}CX`;break;case 66:this.instruction=`INC ${this.prefixOp32()}DX`;break;case 67:this.instruction=`INC ${this.prefixOp32()}BX`;break;case 68:this.instruction=`INC ${this.prefixOp32()}SP`;break;case 69:this.instruction=`INC ${this.prefixOp32()}BP`;break;case 70:this.instruction=`INC ${this.prefixOp32()}SI`;break;case 71:this.instruction=`INC ${this.prefixOp32()}DI`;break;case 108:this.instruction+="INSB";break;case 109:this.op32Bit?this.instruction+="INSD":this.instruction+="INSW";break;case 204:this.instruction="INT3";break;case 205:this.instruction="INT "+this.getNextByteStr();break;case 206:this.instruction="INTO";break;case 207:this.op32Bit?this.instruction="IRETD":this.instruction="IRET";break;case 119:this.instruction="JA "+this.getNextSByteStr();break;case 115:this.instruction="JAE/JNC "+this.getNextSByteStr();break;case 114:this.instruction="JB/JC "+this.getNextSByteStr();break;case 118:this.instruction="JBE "+this.getNextSByteStr();break;case 227:this.instruction="JCXZ "+this.getNextSByteStr();break;case 116:this.instruction="JE "+this.getNextSByteStr();break;case 127:this.instruction="JG "+this.getNextSByteStr();break;case 125:this.instruction="JGE "+this.getNextSByteStr();break;case 124:this.instruction="JL "+this.getNextSByteStr();break;case 126:this.instruction="JLE "+this.getNextSByteStr();break;case 235:this.instruction="JMP "+this.getNextSByteStr();break;case 233:this.op32Bit?this.instruction="JMP "+this.getNextSDwordStr():this.instruction="JMP "+this.getNextSWordStr();break;case 234:if(this.op32Bit){const t=this.getNextDword(),e=this.getNextWord();this.instruction=`JMP FAR ${this.wordToHex(e)}:${this.dwordToHex(t)}`}else{const t=this.getNextWord(),e=this.getNextWord();this.instruction=`JMP FAR ${this.wordToHex(e)}:${this.wordToHex(t)}`}break;case 117:this.instruction="JNE "+this.getNextSByteStr();break;case 113:this.instruction="JNO "+this.getNextSByteStr();break;case 121:this.instruction="JNS "+this.getNextSByteStr();break;case 123:this.instruction="JNP "+this.getNextSByteStr();break;case 112:this.instruction="JO "+this.getNextSByteStr();break;case 122:this.instruction="JP "+this.getNextSByteStr();break;case 120:this.instruction="JS "+this.getNextSByteStr();break;case 159:this.instruction="LAHF";break;case 197:this.loadSeg("DS");break;case 141:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`LEA ${t.regStr}, ${t.rmStr}`}break;case 201:this.instruction="LEAVE";break;case 196:this.loadSeg("ES");break;case 240:this.instruction="LOCK";break;case 172:this.instruction+="LODSB";{let t="SI";this.addr32Bit&&(t="E"+t),""!=this.segOverride?this.instruction+=` ${this.segOverride}[${t}]`:this.addr32Bit&&(this.instruction+=` [${t}]`)}break;case 173:{let t="SI";this.addr32Bit&&(t="E"+t),this.op32Bit?this.instruction+="LODSD":this.instruction+="LODSW",""!=this.segOverride?this.instruction+=` ${this.segOverride}[${t}]`:this.addr32Bit&&(this.instruction+=` [${t}]`)}break;case 226:this.instruction="LOOP "+this.getNextSByteStr();break;case 225:this.instruction="LOOPZ "+this.getNextSByteStr();break;case 224:this.instruction="LOOPNZ "+this.getNextSByteStr();break;case 160:this.instruction=`MOV AL, ${this.segOverride}[${this.getNextWordStr()}]`;break;case 161:{const t=this.addr32Bit?this.getNextDwordStr():this.getNextWordStr(),e=this.op32Bit?"EAX":"AX";this.instruction=`MOV ${e}, ${this.segOverride}[${t}]`}break;case 162:this.instruction=`MOV ${this.segOverride}[${this.getNextWordStr()}], AL`;break;case 163:{const t=this.addr32Bit?this.getNextDwordStr():this.getNextWordStr(),e=this.op32Bit?"EAX":"AX";this.instruction=`MOV ${this.segOverride}[${t}], ${e}`}break;case 176:this.instruction="MOV AL, "+this.getNextByteStr();break;case 177:this.instruction="MOV CL, "+this.getNextByteStr();break;case 178:this.instruction="MOV DL, "+this.getNextByteStr();break;case 179:this.instruction="MOV BL, "+this.getNextByteStr();break;case 180:this.instruction="MOV AH, "+this.getNextByteStr();break;case 181:this.instruction="MOV CH, "+this.getNextByteStr();break;case 182:this.instruction="MOV DH, "+this.getNextByteStr();break;case 183:this.instruction="MOV BH, "+this.getNextByteStr();break;case 184:this.op32Bit?this.instruction="MOV EAX, "+this.getNextDwordStr():this.instruction="MOV AX, "+this.getNextWordStr();break;case 185:this.op32Bit?this.instruction="MOV ECX, "+this.getNextDwordStr():this.instruction="MOV CX, "+this.getNextWordStr();break;case 186:this.op32Bit?this.instruction="MOV EDX, "+this.getNextDwordStr():this.instruction="MOV DX, "+this.getNextWordStr();break;case 187:this.op32Bit?this.instruction="MOV EBX, "+this.getNextDwordStr():this.instruction="MOV BX, "+this.getNextWordStr();break;case 188:this.op32Bit?this.instruction="MOV ESP, "+this.getNextDwordStr():this.instruction="MOV SP, "+this.getNextWordStr();break;case 189:this.op32Bit?this.instruction="MOV EBP, "+this.getNextDwordStr():this.instruction="MOV BP, "+this.getNextWordStr();break;case 190:this.op32Bit?this.instruction="MOV ESI, "+this.getNextDwordStr():this.instruction="MOV SI, "+this.getNextWordStr();break;case 191:this.op32Bit?this.instruction="MOV EDI, "+this.getNextDwordStr():this.instruction="MOV DI, "+this.getNextWordStr();break;case 198:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${t.rmStr}, ${this.getNextByteStr()}`}break;case 199:{const t=this.readAndDecodeAddressByte(!1);this.op32Bit?this.instruction=`MOV ${t.rmStr}, ${this.getNextDwordStr()}`:this.instruction=`MOV ${t.rmStr}, ${this.getNextWordStr()}`}break;case 136:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${t.rmStr}, ${t.regStr}`}break;case 137:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.rmStr}, ${t.regStr}`}break;case 138:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`MOV ${t.regStr}, ${t.rmStr}`}break;case 139:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.regStr}, ${t.rmStr}`}break;case 140:{this.op32Bit=!1;const t=this.readAndDecodeAddressByte(!1,!0);this.instruction=`MOV ${t.rmStr}, ${t.regStr}`}break;case 142:{this.op32Bit=!1;const t=this.readAndDecodeAddressByte(!1,!0);this.instruction=`MOV ${t.regStr}, ${t.rmStr}`}break;case 164:this.instruction+="MOVSB";{const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 165:{this.op32Bit?this.instruction+="MOVSD":this.instruction+="MOVSW";const t=this.addr32Bit?"E":"",e=""==this.segOverride?"DS:":this.segOverride;this.instruction+=` ES:[${t}DI], ${e}[${t}SI]`}break;case 144:this.instruction="NOP";break;case 8:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`OR ${t.rmStr}, ${t.regStr}`}break;case 9:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`OR ${t.rmStr}, ${t.regStr}`}break;case 10:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`OR ${t.regStr}, ${t.rmStr}`}break;case 11:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`OR ${t.regStr}, ${t.rmStr}`}break;case 12:this.instruction="OR AL, "+this.getNextByteStr();break;case 13:this.op32Bit?this.instruction="OR EAX, "+this.getNextDwordStr():this.instruction="OR AX, "+this.getNextWordStr();break;case 230:this.instruction=`OUT ${this.getNextByteStr()}, AL`;break;case 231:this.instruction=`OUT ${this.getNextByteStr()}, AX`;break;case 238:this.instruction="OUT DX, AL";break;case 239:this.op32Bit?this.instruction="OUT DX, EAX":this.instruction="OUT DX, AX";break;case 110:this.instruction+="OUTSB",this.addr32Bit&&(this.instruction+=" DX, [ESI]");break;case 111:this.op32Bit?this.instruction+="OUTSD":this.instruction+="OUTSW",this.addr32Bit&&(this.instruction+=" DX, [ESI]");break;case 88:this.instruction=`POP ${this.prefixOp32()}AX`;break;case 89:this.instruction=`POP ${this.prefixOp32()}CX`;break;case 90:this.instruction=`POP ${this.prefixOp32()}DX`;break;case 91:this.instruction=`POP ${this.prefixOp32()}BX`;break;case 92:this.instruction=`POP ${this.prefixOp32()}SP`;break;case 93:this.instruction=`POP ${this.prefixOp32()}BP`;break;case 94:this.instruction=`POP ${this.prefixOp32()}SI`;break;case 95:this.instruction=`POP ${this.prefixOp32()}DI`;break;case 7:this.instruction="POP ES";break;case 23:this.instruction="POP SS";break;case 31:this.instruction="POP DS";break;case 143:{const t=this.readAndDecodeAddressByte(!0);this.op32Bit?this.instruction="POP DWORD "+t.rmStr:this.instruction="POP "+t.rmStr}break;case 97:this.op32Bit?this.instruction="POPAD":this.instruction="POPA";break;case 157:this.op32Bit?this.instruction="POPFD":this.instruction="POPF";break;case 80:this.instruction=`PUSH ${this.prefixOp32()}AX`;break;case 81:this.instruction=`PUSH ${this.prefixOp32()}CX`;break;case 82:this.instruction=`PUSH ${this.prefixOp32()}DX`;break;case 83:this.instruction=`PUSH ${this.prefixOp32()}BX`;break;case 84:this.instruction=`PUSH ${this.prefixOp32()}SP`;break;case 85:this.instruction=`PUSH ${this.prefixOp32()}BP`;break;case 86:this.instruction=`PUSH ${this.prefixOp32()}SI`;break;case 87:this.instruction=`PUSH ${this.prefixOp32()}DI`;break;case 6:this.instruction="PUSH ES";break;case 14:this.instruction="PUSH CS";break;case 22:this.instruction="PUSH SS";break;case 30:this.instruction="PUSH DS";break;case 106:this.instruction="PUSH "+this.getNextByteStr();break;case 104:this.op32Bit?this.instruction="PUSH "+this.getNextDwordStr():this.instruction="PUSH "+this.getNextWordStr();break;case 96:this.op32Bit?this.instruction="PUSHAD":this.instruction="PUSHA";break;case 156:this.op32Bit?this.instruction="PUSHFD":this.instruction="PUSHF";break;case 195:this.instruction="RET";break;case 194:this.instruction="RET "+this.getNextWordStr();break;case 203:this.instruction="RETF";break;case 202:this.instruction="RETF "+this.getNextWordStr();break;case 158:this.instruction="SAHF";break;case 24:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SBB ${t.rmStr}, ${t.regStr}`}break;case 25:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SBB ${t.rmStr}, ${t.regStr}`}break;case 26:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SBB ${t.regStr}, ${t.rmStr}`}break;case 27:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SBB ${t.regStr}, ${t.rmStr}`}break;case 28:this.instruction="SBB AL, "+this.getNextByteStr();break;case 29:this.op32Bit?this.instruction="SBB EAX, "+this.getNextDwordStr():this.instruction="SBB AX, "+this.getNextWordStr();break;case 174:this.instruction+="SCASB",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 175:this.op32Bit?this.instruction+="SCASD":this.instruction+="SCASW",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 249:this.instruction="STC";break;case 253:this.instruction="STD";break;case 251:this.instruction="STI";break;case 170:this.instruction+="STOSB",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 171:this.op32Bit?this.instruction+="STOSD":this.instruction+="STOSW",this.addr32Bit&&(this.instruction+=" [EDI]");break;case 40:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SUB ${t.rmStr}, ${t.regStr}`}break;case 41:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SUB ${t.rmStr}, ${t.regStr}`}break;case 42:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`SUB ${t.regStr}, ${t.rmStr}`}break;case 43:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SUB ${t.regStr}, ${t.rmStr}`}break;case 44:this.instruction="SUB AL, "+this.getNextByteStr();break;case 45:this.op32Bit?this.instruction="SUB EAX, "+this.getNextDwordStr():this.instruction="SUB AX, "+this.getNextWordStr();break;case 132:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`TEST ${t.rmStr}, ${t.regStr}`}break;case 133:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`TEST ${t.rmStr}, ${t.regStr}`}break;case 168:this.instruction="TEST AL, "+this.getNextByteStr();break;case 169:this.op32Bit?this.instruction="TEST EAX, "+this.getNextDwordStr():this.instruction="TEST AX, "+this.getNextWordStr();break;case 155:this.instruction="WAIT";break;case 145:this.instruction="XCHG AX, CX";break;case 146:this.instruction="XCHG AX, DX";break;case 147:this.instruction="XCHG AX, BX";break;case 148:this.instruction="XCHG AX, SP";break;case 149:this.instruction="XCHG AX, BP";break;case 150:this.instruction="XCHG AX, SI";break;case 151:this.instruction="XCHG AX, DI";break;case 134:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`XCHG ${t.regStr}, ${t.rmStr}`}break;case 135:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`XCHG ${t.regStr}, ${t.rmStr}`}break;case 215:this.instruction=`XLAT ${this.segOverride}[BX]`;break;case 48:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`XOR ${t.rmStr}, ${t.regStr}`}break;case 49:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`XOR ${t.rmStr}, ${t.regStr}`}break;case 50:{const t=this.readAndDecodeAddressByte(!0);this.instruction=`XOR ${t.regStr}, ${t.rmStr}`}break;case 51:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`XOR ${t.regStr}, ${t.rmStr}`}break;case 52:this.instruction="XOR AL, "+this.getNextByteStr();break;case 53:this.op32Bit?this.instruction="XOR EAX, "+this.getNextDwordStr():this.instruction="XOR AX, "+this.getNextWordStr();break;case 254:this.handleOpcodeFeFf(!1);break;case 255:this.handleOpcodeFeFf(!0);break;case 128:this.handleOpcode80();break;case 129:this.handleOpcode81();break;case 131:this.handleOpcode83();break;case 246:this.handleOpcodeF6();break;case 247:this.handleOpcodeF7();break;case 15:this.handleOpcode0F();break;case 208:this.handleOpcodeD0();break;case 209:this.handleOpcodeD1();break;case 210:this.handleOpcodeD2();break;case 211:this.handleOpcodeD3();break;case 192:this.handleOpcodeC0();break;case 193:this.handleOpcodeC1()}}handleOpcodeFeFf(t){const e=this.readAndDecodeAddressByte(!t);switch(e.reg){case 0:this.op32Bit?this.instruction="INC DWORD "+e.rmStr:this.instruction="INC "+e.rmStr;break;case 1:this.op32Bit?this.instruction="DEC DWORD "+e.rmStr:this.instruction="DEC "+e.rmStr;break;case 4:this.instruction="JMP "+e.rmStr;break;case 2:this.instruction="CALL "+e.rmStr;break;case 3:this.instruction="CALL FAR "+e.rmStr;break;case 5:this.instruction="JMP FAR "+e.rmStr;break;case 6:t&&(this.op32Bit?this.instruction="PUSH DWORD "+e.rmStr:this.instruction="PUSH "+e.rmStr)}}handleOpcode80(){const t=this.readAndDecodeAddressByte(!0),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ADD ${t.rmStr}, ${e}`;break;case 1:this.instruction=`OR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`ADC ${t.rmStr}, ${e}`;break;case 3:this.instruction=`SBC ${t.rmStr}, ${e}`;break;case 4:this.instruction=`AND ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SUB ${t.rmStr}, ${e}`;break;case 6:this.instruction=`XOR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`CMP ${t.rmStr}, ${e}`}}handleOpcode81(){const t=this.readAndDecodeAddressByte(!1),e=this.op32Bit?this.getNextDwordStr():this.getNextWordStr();switch(t.reg){case 0:this.instruction=`ADD ${t.rmStr}, ${e}`;break;case 1:this.instruction=`OR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`ADC ${t.rmStr}, ${e}`;break;case 3:this.instruction=`SBC ${t.rmStr}, ${e}`;break;case 4:this.instruction=`AND ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SUB ${t.rmStr}, ${e}`;break;case 6:this.instruction=`XOR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`CMP ${t.rmStr}, ${e}`}}handleOpcode83(){const t=this.readAndDecodeAddressByte(!1),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ADD ${t.rmStr}, ${e}`;break;case 1:this.instruction=`OR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`ADC ${t.rmStr}, ${e}`;break;case 3:this.instruction=`SBC ${t.rmStr}, ${e}`;break;case 4:this.instruction=`AND ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SUB ${t.rmStr}, ${e}`;break;case 6:this.instruction=`XOR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`CMP ${t.rmStr}, ${e}`}}handleOpcodeF6(){const t=this.readAndDecodeAddressByte(!0);switch(t.reg){case 0:this.instruction=`TEST ${t.rmStr}, ${this.getNextByteStr()}`;break;case 2:this.instruction="NOT "+t.rmStr;break;case 3:this.instruction="NEG "+t.rmStr;break;case 4:this.instruction="MUL "+t.rmStr;break;case 5:this.instruction="IMUL "+t.rmStr;break;case 6:this.instruction="DIV "+t.rmStr;break;case 7:this.instruction="IDIV "+t.rmStr}}handleOpcodeF7(){const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`TEST ${t.rmStr}, ${this.getNextWordStr()}`;break;case 2:this.instruction="NOT "+t.rmStr;break;case 3:this.instruction="NEG "+t.rmStr;break;case 4:this.instruction="MUL "+t.rmStr;break;case 5:this.instruction="IMUL "+t.rmStr;break;case 6:this.instruction="DIV "+t.rmStr;break;case 7:this.instruction="IDIV "+t.rmStr}}handleOpcode0F(){switch(this.getNextByte()){case 0:{const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction="SLDT "+t.rmStr;break;case 1:this.instruction="STR "+t.rmStr;break;case 2:this.instruction="LLDT "+t.rmStr;break;case 3:this.instruction="LTR "+t.rmStr}}break;case 1:{const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction="SGDT "+t.rmStr;break;case 1:this.instruction="SIDT "+t.rmStr;break;case 2:this.instruction="LGDT "+t.rmStr;break;case 3:this.instruction="LIDT "+t.rmStr;break;case 4:this.instruction="SMSW "+t.rmStr;break;case 6:this.instruction="LMSW "+t.rmStr}}break;case 2:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`LAR ${t.regStr}, ${t.rmStr}`}break;case 6:this.instruction="CLTS";break;case 9:this.instruction="WBINVD";break;case 32:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`MOV ${t.rmStr}, CR0`;break;case 1:this.instruction=`MOV ${t.rmStr}, CR1`;break;case 2:this.instruction=`MOV ${t.rmStr}, CR2`;break;case 3:this.instruction=`MOV ${t.rmStr}, CR3`}}break;case 33:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.rmStr}, DR${t.reg}`}break;case 34:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction="MOV CR0, "+t.rmStr;break;case 1:this.instruction="MOV CR1, "+t.rmStr;break;case 2:this.instruction="MOV CR2, "+t.rmStr;break;case 3:this.instruction="MOV CR3, "+t.rmStr}}break;case 35:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV DR${t.reg}, ${t.rmStr}`}break;case 36:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV ${t.rmStr}, TR${t.reg}`}break;case 38:{this.op32Bit=!0;const t=this.readAndDecodeAddressByte(!1);this.instruction=`MOV TR${t.reg}, ${t.rmStr}`}break;case 128:this.instruction="JO "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 129:this.instruction="JNO "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 130:this.instruction="JB/JC "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 131:this.instruction="JNB/JNC "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 132:this.instruction="JE/JZ "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 133:this.instruction="JNE/JZ "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 134:this.instruction="JBE "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 135:this.instruction="JA "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 136:this.instruction="JS "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 137:this.instruction="JNS "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 138:this.instruction="JP "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 139:this.instruction="JNP "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 140:this.instruction="JL "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 141:this.instruction="JGE "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 142:this.instruction="JLE "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 143:this.instruction="JG "+(this.op32Bit?this.getNextSDwordStr():this.getNextSWordStr());break;case 144:this.instruction="SETO "+this.getRm8Str();break;case 145:this.instruction="SETNO "+this.getRm8Str();break;case 146:this.instruction="SETB/SETC "+this.getRm8Str();break;case 147:this.instruction="SETNB/SETNC "+this.getRm8Str();break;case 148:this.instruction="SETE/SETZ "+this.getRm8Str();break;case 149:this.instruction="SETNE/SETZ "+this.getRm8Str();break;case 150:this.instruction="SETBE "+this.getRm8Str();break;case 151:this.instruction="SETA "+this.getRm8Str();break;case 152:this.instruction="SETS "+this.getRm8Str();break;case 153:this.instruction="SETNS "+this.getRm8Str();break;case 154:this.instruction="SETP "+this.getRm8Str();break;case 155:this.instruction="SETNP "+this.getRm8Str();break;case 156:this.instruction="SETL "+this.getRm8Str();break;case 157:this.instruction="SETGE "+this.getRm8Str();break;case 158:this.instruction="SETLE "+this.getRm8Str();break;case 159:this.instruction="SETG "+this.getRm8Str();break;case 160:this.instruction="PUSH FS";break;case 161:this.instruction="POP FS";break;case 163:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BT ${t.rmStr}, ${t.regStr}`}break;case 164:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHLD ${t.rmStr}, ${t.regStr}, ${this.getNextByteStr()}`}break;case 165:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHLD ${t.rmStr}, ${t.regStr}, CL`}break;case 168:this.instruction="PUSH GS";break;case 169:this.instruction="POP GS";break;case 171:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BTS ${t.rmStr}, ${t.regStr}`}break;case 172:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHRD ${t.rmStr}, ${t.regStr}, ${this.getNextByteStr()}`}break;case 173:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`SHRD ${t.rmStr}, ${t.regStr}, CL`}break;case 178:this.loadSeg("SS");break;case 179:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BTR ${t.rmStr}, ${t.regStr}`}break;case 180:this.loadSeg("FS");break;case 181:this.loadSeg("GS");break;case 182:{const t=this.getNextByte(),e=this.decodeAddressByte(t,!1),s=this.decodeAddressByte(t,!0,!1,!0);this.instruction=`MOVZX ${e.regStr}, ${s.rmStr}`}break;case 183:{const t=this.getNextByte(),e=this.decodeAddressByte(t,!1);this.op32Bit=!1;const s=this.decodeAddressByte(t,!1,!1,!0);this.instruction=`MOVZX ${e.regStr}, ${s.rmStr}`}break;case 186:{const t=this.readAndDecodeAddressByte(!1),e=this.getNextByteStr();switch(t.reg){case 4:this.instruction=`BT ${t.rmStr}, ${e}`;break;case 5:this.instruction=`BTS ${t.rmStr}, ${e}`;break;case 6:this.instruction=`BTR ${t.rmStr}, ${e}`;break;case 7:this.instruction=`BTC ${t.rmStr}, ${e}`}}break;case 187:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BTC ${t.rmStr}, ${t.regStr}`}break;case 188:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BSF ${t.regStr}, ${t.rmStr}`}break;case 189:{const t=this.readAndDecodeAddressByte(!1);this.instruction=`BSR ${t.regStr}, ${t.rmStr}`}}}handleOpcodeD0(){const t=this.readAndDecodeAddressByte(!0);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, 1`;break;case 1:this.instruction=`ROR ${t.rmStr}, 1`;break;case 2:this.instruction=`RCL ${t.rmStr}, 1`;break;case 3:this.instruction=`RCR ${t.rmStr}, 1`;break;case 4:this.instruction=`SHL ${t.rmStr}, 1`;break;case 5:this.instruction=`SHR ${t.rmStr}, 1`;break;case 6:this.instruction=`SAL ${t.rmStr}, 1`;break;case 7:this.instruction=`SAR ${t.rmStr}, 1`}}handleOpcodeD1(){const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, 1`;break;case 1:this.instruction=`ROR ${t.rmStr}, 1`;break;case 2:this.instruction=`RCL ${t.rmStr}, 1`;break;case 3:this.instruction=`RCR ${t.rmStr}, 1`;break;case 4:this.instruction=`SHL ${t.rmStr}, 1`;break;case 5:this.instruction=`SHR ${t.rmStr}, 1`;break;case 6:this.instruction=`SAL ${t.rmStr}, 1`;break;case 7:this.instruction=`SAR ${t.rmStr}, 1`}}handleOpcodeD2(){const t=this.readAndDecodeAddressByte(!0);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, CL`;break;case 1:this.instruction=`ROR ${t.rmStr}, CL`;break;case 2:this.instruction=`RCL ${t.rmStr}, CL`;break;case 3:this.instruction=`RCR ${t.rmStr}, CL`;break;case 4:this.instruction=`SHL ${t.rmStr}, CL`;break;case 5:this.instruction=`SHR ${t.rmStr}, CL`;break;case 6:this.instruction=`SAL ${t.rmStr}, CL`;break;case 7:this.instruction=`SAR ${t.rmStr}, CL`}}handleOpcodeD3(){const t=this.readAndDecodeAddressByte(!1);switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, CL`;break;case 1:this.instruction=`ROR ${t.rmStr}, CL`;break;case 2:this.instruction=`RCL ${t.rmStr}, CL`;break;case 3:this.instruction=`RCR ${t.rmStr}, CL`;break;case 4:this.instruction=`SHL ${t.rmStr}, CL`;break;case 5:this.instruction=`SHR ${t.rmStr}, CL`;break;case 6:this.instruction=`SAL ${t.rmStr}, CL`;break;case 7:this.instruction=`SAR ${t.rmStr}, CL`}}handleOpcodeC0(){const t=this.readAndDecodeAddressByte(!0),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, ${e}`;break;case 1:this.instruction=`ROR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`RCL ${t.rmStr}, ${e}`;break;case 3:this.instruction=`RCR ${t.rmStr}, ${e}`;break;case 4:this.instruction=`SHL ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SHR ${t.rmStr}, ${e}`;break;case 6:this.instruction=`SAL ${t.rmStr}, ${e}`;break;case 7:this.instruction=`SAR ${t.rmStr}, ${e}`}}handleOpcodeC1(){const t=this.readAndDecodeAddressByte(!1),e=this.getNextByteStr();switch(t.reg){case 0:this.instruction=`ROL ${t.rmStr}, ${e}`;break;case 1:this.instruction=`ROR ${t.rmStr}, ${e}`;break;case 2:this.instruction=`RCL ${t.rmStr}, ${e}`;break;case 3:this.instruction=`RCR ${t.rmStr}, ${e}`;break;case 4:this.instruction=`SHL ${t.rmStr}, ${e}`;break;case 5:this.instruction=`SHR ${t.rmStr}, ${e}`;break;case 6:this.instruction=`SAL ${t.rmStr}, ${e}`;break;case 7:this.instruction=`SAR ${t.rmStr}, ${e}`}}readAndDecodeAddressByte(t,e=!1,s=!1){const i=this.getNextByte();return this.decodeAddressByte(i,t,e,s)}decodeAddressByte(t,e,s=!1,r=!1){const a=(192&t)>>6,h=(56&t)>>3,o=7&t,n=new i;n.reg=h,n.regStr=e?this.getRegByte(h):this.getRegWord(h,s),n.rmStr="";let c="";switch(r&&(c=e?"BYTE ":this.op32Bit?"DWORD ":"WORD "),a){case 0:if(this.addr32Bit)switch(o){case 0:n.rmStr=this.segOverride+"[EAX]";break;case 1:n.rmStr=this.segOverride+"[ECX]";break;case 2:n.rmStr=this.segOverride+"[EDX]";break;case 3:n.rmStr=this.segOverride+"[EBX]";break;case 4:{const t=this.readSib(a);n.rmStr=this.segOverride+t}break;case 5:{const t=this.getNextDword();n.rmStr=`${this.segOverride}[${this.dwordToHex(t)}]`}break;case 6:n.rmStr=this.segOverride+"[ESI]";break;case 7:n.rmStr=this.segOverride+"[EDI]"}else switch(o){case 0:n.rmStr=this.segOverride+"[BX + SI]";break;case 1:n.rmStr=this.segOverride+"[BX + DI]";break;case 2:n.rmStr=this.segOverride+"[BP + SI]";break;case 3:n.rmStr=this.segOverride+"[BP + DI]";break;case 4:n.rmStr=this.segOverride+"[SI]";break;case 5:n.rmStr=this.segOverride+"[DI]";break;case 6:{const t=this.getNextWord();n.rmStr=`${this.segOverride}[${this.wordToHex(t)}]`}break;case 7:n.rmStr=this.segOverride+"[BX]"}n.rmStr=c+n.rmStr;break;case 1:if(this.addr32Bit)switch(o){case 0:n.rmStr=`${this.segOverride}[EAX ${this.getNextSByteStr()}]`;break;case 1:n.rmStr=`${this.segOverride}[ECX ${this.getNextSByteStr()}]`;break;case 2:n.rmStr=`${this.segOverride}[EDX ${this.getNextSByteStr()}]`;break;case 3:n.rmStr=`${this.segOverride}[EBX ${this.getNextSByteStr()}]`;break;case 4:{const t=this.readSib(a);n.rmStr=this.segOverride+t+" "+this.getNextSByteStr()}break;case 5:n.rmStr=`${this.segOverride}[EBP ${this.getNextSByteStr()}]`;break;case 6:n.rmStr=`${this.segOverride}[BSI ${this.getNextSByteStr()}]`;break;case 7:n.rmStr=`${this.segOverride}[BDI ${this.getNextSByteStr()}]`}else{const t=this.getNextByte();switch(o){case 0:n.rmStr=`${this.segOverride}[BX + SI ${this.sByteToHex(t)}]`;break;case 1:n.rmStr=`${this.segOverride}[BX + DI ${this.sByteToHex(t)}]`;break;case 2:n.rmStr=`${this.segOverride}[BP + SI ${this.sByteToHex(t)}]`;break;case 3:n.rmStr=`${this.segOverride}[BP + DI ${this.sByteToHex(t)}]`;break;case 4:n.rmStr=`${this.segOverride}[SI ${this.sByteToHex(t)}]`;break;case 5:n.rmStr=`${this.segOverride}[DI ${this.sByteToHex(t)}]`;break;case 6:n.rmStr=`${this.segOverride}[BP ${this.sByteToHex(t)}]`;break;case 7:n.rmStr=`${this.segOverride}[BX ${this.sByteToHex(t)}]`}}n.rmStr=c+n.rmStr;break;case 2:if(this.addr32Bit)switch(o){case 0:n.rmStr=`${this.segOverride}[EAX ${this.getNextSDwordStr()}]`;break;case 1:n.rmStr=`${this.segOverride}[ECX ${this.getNextSDwordStr()}]`;break;case 2:n.rmStr=`${this.segOverride}[EDX ${this.getNextSDwordStr()}]`;break;case 3:n.rmStr=`${this.segOverride}[EBX ${this.getNextSDwordStr()}]`;break;case 4:{const t=this.readSib(a);n.rmStr=this.segOverride+this.getNextDwordStr()+t}break;case 5:n.rmStr=`${this.segOverride}[EBP ${this.getNextSDwordStr()}]`;break;case 6:n.rmStr=`${this.segOverride}[ESI ${this.getNextSDwordStr()}]`;break;case 7:n.rmStr=`${this.segOverride}[EDI ${this.getNextSDwordStr()}]`}else{const t=this.getNextWord();switch(o){case 0:n.rmStr=`${this.segOverride}[BX + SI ${this.sWordToHex(t)}]`;break;case 1:n.rmStr=`${this.segOverride}[BX + DI ${this.sWordToHex(t)}]`;break;case 2:n.rmStr=`${this.segOverride}[BP + SI ${this.sWordToHex(t)}]`;break;case 3:n.rmStr=`${this.segOverride}[BP + DI ${this.sWordToHex(t)}]`;break;case 4:n.rmStr=`${this.segOverride}[SI ${this.sWordToHex(t)}]`;break;case 5:n.rmStr=`${this.segOverride}[DI ${this.sWordToHex(t)}]`;break;case 6:n.rmStr=`${this.segOverride}[BP ${this.sWordToHex(t)}]`;break;case 7:n.rmStr=`${this.segOverride}[BX ${this.sWordToHex(t)}]`}}n.rmStr=c+n.rmStr;break;case 3:n.rmStr=e?this.getRegByte(o):this.getRegWord(o)}return n}readSib(t){const e=this.getNextByte(),s=e>>3&7,i=e>>6&3;let r="";switch(7&e){case 0:r+="[EAX]";break;case 1:r+="[ECX]";break;case 2:r+="[EDX]";break;case 3:r+="[EBX]";break;case 4:r+="[ESP]";break;case 5:r+=0==t?this.getNextDwordStr():"[EBP]";break;case 6:r+="[ESI]";break;case 7:r+="[EDI]"}switch(r+="[",s){case 0:r+="EAX";break;case 1:r+="ECX";break;case 2:r+="EDX";break;case 3:r+="EBX";break;case 5:r+="EBP";break;case 6:r+="ESI";break;case 7:r+="EDI"}switch(i){case 0:r+="*1";break;case 1:r+="*2";break;case 2:r+="*4";break;case 3:r+="*8"}return r+="]",r}getRegByte(t){switch(t){case 0:return"AL";case 1:return"CL";case 2:return"DL";case 3:return"BL";case 4:return"AH";case 5:return"CH";case 6:return"DH";case 7:return"BH"}return""}getRegWord(t,e=!1){if(!e){let e="";switch(t){case 0:e="AX";break;case 1:e="CX";break;case 2:e="DX";break;case 3:e="BX";break;case 4:e="SP";break;case 5:e="BP";break;case 6:e="SI";break;case 7:e="DI"}return this.op32Bit&&(e="E"+e),e}switch(t){case 0:return"ES";case 1:return"CS";case 2:return"SS";case 3:return"DS";case 4:return"FS";case 5:return"GS"}return""}loadSeg(t){{const e=this.readAndDecodeAddressByte(!1);this.instruction=`L${t} ${e.regStr}, ${e.rmStr}`}}getRm8Str(){return this.readAndDecodeAddressByte(!0).rmStr}byteToHex(t){return(255&t).toString(16).toUpperCase().padStart(2,"0")+"h"}wordToHex(t){return(65535&t).toString(16).toUpperCase().padStart(4,"0")+"h"}dwordToHex(t){return(4294967295&t).toString(16).toUpperCase().padStart(8,"0")+"h"}sByteToHex(t){return t>127?`- ${(256-t).toString(16).toUpperCase().padStart(2,"0")}h`:`+ ${t.toString(16).toUpperCase().padStart(2,"0")}h`}sWordToHex(t){return t>32767?`- ${(65536-t).toString(16).toUpperCase().padStart(4,"0")}h`:`+ ${t.toString(16).toUpperCase().padStart(4,"0")}h`}sDwordToHex(t){return(t|=0)<0?`- ${(-t).toString(16).toUpperCase().padStart(8,"0")}h`:`+ ${t.toString(16).toUpperCase().padStart(8,"0")}h`}getNextByte(){const t=this.memory.peek(this.localAddress++);return this.hexValues.push(t),255&t}getNextSByteStr(){return this.sByteToHex(this.getNextByte())}getNextByteStr(){return this.byteToHex(this.getNextByte())}getNextWord(){const t=this.memory.peek(this.localAddress++);this.hexValues.push(t);const e=this.memory.peek(this.localAddress++);return this.hexValues.push(e),t+(e<<8)&65535}getNextSWordStr(){return this.sWordToHex(this.getNextWord())}getNextWordStr(){return this.wordToHex(this.getNextWord())}getNextDword(){return this.getNextWord()+(this.getNextWord()<<16)&4294967295}getNextSDwordStr(){return this.sDwordToHex(this.getNextDword())}getNextDwordStr(){return this.dwordToHex(this.getNextDword())}prefixOp32(){return this.op32Bit?"E":""}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MdaGraphics=void 0;const i=s(5);class r extends i.GraphicsCard{constructor(){super(),this.charsetFile="Fonts/mda.dat",this.charsetWidth=32,this.charsetHeight=8,this.charset=new Array(256),this.horRetrace=0,this.startAddr=720896,this.setRamSize(4096),this.charWidth=9,this.charHeight=14,this.screenWidth=80*this.charWidth,this.screenHeight=25*this.charHeight,this.textColor=i.Col.fromRgb(50,205,50),this.textHiColor=i.Col.fromRgb(0,255,0),this.backgroundColor=i.Col.fromRgb(0,0,0)}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile"),this.ignoredFieldsUpdate.add("charset")}async loadCharSet(){await this.loadCharSetInternal(this.charset,this.charsetFile,this.charsetWidth,this.charsetHeight)}updateScreen(t,e){super.updateScreen(t,e);const s=this.screenWidth/this.charWidth,r=this.screenHeight/this.charHeight,a=new i.IntRect(0,0,this.charWidth,this.charHeight),h=2*this.getCursorPos();let o=0;for(let i=0;i<r;i++)for(let r=0;r<s;r++){const s=this.ram[o+1],n=7&s,c=s>>4&7;let d=(8&s)>0?this.textHiColor:this.textColor,l=this.backgroundColor;if(0==n&&7==c){const t=d;d=l,l=t}const u=this.ram[o],m=this.charset[u],g=this.drawChar(u,m,d,l,1==n&&0==c,o==h&&this.cursorOn);a.x=r*this.charWidth,a.y=i*this.charHeight,this.writePixels(t,e,g,a),o+=2}}in(t){switch(t){case 954:return this.horRetrace=1-this.horRetrace,255&(this.horRetrace|this.horRetrace<<3)}return 0}out(t,e,s){switch(t){case 948:this.setIndexRegister(255&e);break;case 949:this.setDataRegister(255&e)}}}e.MdaGraphics=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RealTimeClock=void 0;const i=s(1);class r extends i.BaseComponent{constructor(t){super(),this.basePort=0,this.basePort=t}in(t){const e=new Date;switch(t-this.basePort){case 0:return this.calcBcd(e.getMilliseconds()%100);case 1:return this.calcBcd(Math.trunc(e.getMilliseconds()/10));case 2:return this.calcBcd(e.getSeconds());case 3:return this.calcBcd(e.getMinutes());case 4:return this.calcBcd(e.getHours());case 5:return this.calcBcd((e.getDay()+6)%7+1);case 6:return this.calcBcd(e.getDate());case 7:return this.calcBcd(e.getMonth());case 9:return this.calcBcd(e.getFullYear()%100);case 16:case 20:return 0}return 0}calcBcd(t){return t%10+(Math.trunc(t/10)<<4)&255}out(t,e,s){}}e.RealTimeClock=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CgaGraphics=void 0;const i=s(16),r=s(5);var a;!function(t){t[t.None=0]="None",t[t.Text40x25=1]="Text40x25",t[t.Text80x25=2]="Text80x25",t[t.GraphicsLo=3]="GraphicsLo",t[t.GraphicsHi=4]="GraphicsHi"}(a||(a={}));class h extends i.ColorGraphicsCard{constructor(){super(),this.charsetFile1="Fonts/cga1.dat",this.charsetFile2="Fonts/cga2.dat",this.charsetWidth=32,this.charsetHeight=8,this.horRetrace=0,this.colorSelectRegister=0,this.modeControlRegister=0,this.charset1=new Array(256),this.charset2=new Array(256),this.activeCharsetNo=0,this.startAddr=753664,this.setRamSize(16384),this.charWidth=8,this.charHeight=8,this.activeCharsetNo=1,this.lineCount=200}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("charsetFile1"),this.ignoredFields.add("charsetFile2"),this.ignoredFieldsUpdate.add("charset1"),this.ignoredFieldsUpdate.add("charset2")}modeChanged(){super.modeChanged(),this.calcRetraceValues(),this.charCache.clear()}getCharset(){return 0==this.activeCharsetNo?this.charset1:this.charset2}updateScreenGraphicsLo(t){const e=this.getCgaGraphicsColors(this.colorSelectRegister),s=new Uint32Array(t.buffer);let i=0,r=0,a=8192;for(let t=0;t<200;t++){let h=0==(1&t)?r:a;for(let t=0;t<320;t+=4){const t=this.ram[h];let r;r=e[t>>6],s[i++]=r.value,r=e[t>>4&3],s[i++]=r.value,r=e[t>>2&3],s[i++]=r.value,r=e[3&t],s[i++]=r.value,h++}t%2==0?r=h:a=h}}updateScreenGraphicsHi(t){const e=this.cgaColors[15&this.colorSelectRegister],s=new Uint32Array(t.buffer);let i=0,r=0,a=8192;for(let t=0;t<200;t++){let h=0==(1&t)?r:a;for(let t=0;t<640;t+=8){let t=this.ram[h];for(let r=0;r<8;r++)(128&t)>0&&(s[i]=e.value),i++,t<<=1;h++}t%2==0?r=h:a=h}}updateTextScreen(t,e,s,i,a,h){const o=new r.IntRect(0,0,this.charWidth,this.charHeight),n=2*this.getCursorPos();let c=0;for(let r=0;r<a;r++,o.y+=this.charHeight){o.x=0;for(let r=0;r<i;r++,o.x+=this.charWidth){const i=this.ram[c+1],r=this.blink&&(128&i)>0,a=this.blink?h[i>>4&7]:h[i>>4];let d=h[15&i];r&&!this.cursorOn&&(d=a);const l=this.ram[c],u=s[l],m=this.drawChar(l,u,d,a,!1,c==n&&this.cursorOn);this.writePixels(t,e,m,o),c+=2}}}async loadCharSet(){await this.loadCharSetInternal(this.charset1,this.charsetFile1,this.charsetWidth,this.charsetHeight),await this.loadCharSetInternal(this.charset2,this.charsetFile2,this.charsetWidth,this.charsetHeight)}updateScreen(t,e){switch(super.updateScreen(t,e),this.mode){case a.Text40x25:this.updateTextScreen(t,e,this.getCharset(),40,25,this.cgaColors);break;case a.Text80x25:this.updateTextScreen(t,e,this.getCharset(),80,25,this.cgaColors);break;case a.GraphicsLo:this.updateScreenGraphicsLo(t);break;case a.GraphicsHi:this.updateScreenGraphicsHi(t)}}in(t){switch(t){case 977:case 979:case 981:case 983:return this.getDataRegister();case 984:return this.modeControlRegister;case 985:return this.colorSelectRegister;case 986:{0==this.horRetrace&&(this.horRetrace=2),this.horRetrace--;let t=this.calcVertRetrace()?8:0;return t+=0==this.horRetrace?0:1,255&t}}return 0}out(t,e,s){switch(t){case 976:case 978:case 980:case 982:this.setIndexRegister(e);break;case 977:case 979:case 981:case 983:this.setDataRegister(e);break;case 984:{this.modeControlRegister=255&e,this.blink=(32&e)>0,this.blackWhite=(4&e)>0;const t=this.mode;switch(27&e){case 8:this.mode=a.Text40x25,this.screenWidth=320,this.screenHeight=200;break;case 9:this.mode=a.Text80x25,this.screenWidth=640,this.screenHeight=200;break;case 10:this.mode=a.GraphicsLo,this.screenWidth=320,this.screenHeight=200;break;case 26:this.mode=a.GraphicsHi,this.screenWidth=640,this.screenHeight=200}this.mode!=t&&this.modeChanged()}break;case 985:this.colorSelectRegister=255&e}}}e.CgaGraphics=h},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EgaGraphics=void 0;const i=s(17),r=s(0);var a;!function(t){t[t.None=0]="None",t[t.M00_CGA=1]="M00_CGA",t[t.M00_EGA=2]="M00_EGA",t[t.M02_CGA=3]="M02_CGA",t[t.M02_EGA=4]="M02_EGA",t[t.M04=5]="M04",t[t.M06=6]="M06",t[t.M07=7]="M07",t[t.M0D=8]="M0D",t[t.M0E=9]="M0E",t[t.M0F=10]="M0F",t[t.M10=11]="M10"}(a||(a={}));class h extends i.ATColorGraphicsCard{constructor(){super(),this.diagnosticCount=0,this.egaSwitches=[!1,!0,!0,!1],this.charWidth9Bits=!1,this.mode=a.None,this.screenWidth=640,this.screenHeight=350,this.charBoxWidth=this.charWidth=8}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("egaSwitches")}in(t){switch(t){case 962:{let t=this.calcVertRetrace()?0:128;const e=this.miscOutputRegister>>2&3;return t+=this.egaSwitches[e]?0:16,t+=0,255&t}case 968:return 0;case 986:{this.attributeFlipFlop=!1;const t=this.calcRetraceEnable();let e=(t.vertRetrace?8:0)+(t.enable?0:1);return 4==++this.diagnosticCount&&(this.diagnosticCount=0),e+=this.diagnosticCount>1?48:0,255&e}default:return super.in(t)}}out(t,e,s){switch(t){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&e,this.attributeIndex){case 16:this.graphicsMode=(1&e)>0,this.monochrome=(2&e)>0,this.charWidth9Bits=(4&e)>0,this.blink=(8&e)>0;break;case 17:this.overscanColor=this.genColor(255&e);break;case 18:for(let t=0;t<this.colorPlaneEnabled.length;t++)this.colorPlaneEnabled[t]=(e&1<<t)>0;break;default:this.attributeIndex>=0&&this.attributeIndex<=15&&(this.egaPalette[this.attributeIndex]=this.genColor(255&e),this.cgaPalette[this.attributeIndex]=this.genCgaColor(255&e))}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&e,this.attributeFlipFlop=!this.attributeFlipFlop,s&&this.out(t,e>>8,!1);break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&e;break;case 2:this.mapMaskRegister=255&e,this.mapMask[0]=(1&e)>0,this.mapMask[1]=(2&e)>0,this.mapMask[2]=(4&e)>0,this.mapMask[3]=(8&e)>0;break;case 3:this.characterMapSelectRegister=255&e,this.characterMapA=e>>2&3,this.characterMapB=3&e;break;case 4:this.memoryModeRegister=255&e,this.oddEven=0==(4&e)}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&e);break;case 970:case 972:break;default:super.out(t,e,s)}}calcMode(){const t=this.mode,e=this.sequencerRegisters[1],s=this.sequencerRegisters[2],i=this.sequencerRegisters[4];11==e&&3==i?(35==this.miscOutputRegister&&(this.mode=a.M00_CGA),167==this.miscOutputRegister&&(this.mode=a.M00_EGA)):1==e&&3==i?(35==this.miscOutputRegister&&(this.mode=a.M02_CGA),167==this.miscOutputRegister&&(this.mode=a.M02_EGA)):11==e&&2==i?this.mode=a.M04:1==e&&6==i?35==this.miscOutputRegister?1==s?this.mode=a.M06:15==s&&(this.mode=a.M0E):162==this.miscOutputRegister?this.mode=a.M0F:167==this.miscOutputRegister&&(this.mode=a.M10):0==e&&3==i?this.mode=a.M07:1==e&&6==i?this.mode=a.M04:11==e&&6==i&&(this.mode=a.M0D),this.mode!=t&&this.modeChanged()}modeChanged(){super.modeChanged(),0==(this.miscOutputRegister>>2&3)?this.lineCount=200:this.lineCount=350,(8&this.clockMode)>0?this.colCount=320:this.colCount=640,this.calcRetraceValues()}updateDimensions(){switch(this.calcMode(),this.mode){case a.M00_CGA:this.screenWidth=320,this.screenHeight=200;break;case a.M00_EGA:this.screenWidth=320,this.screenHeight=350;break;case a.M02_CGA:this.screenWidth=640,this.screenHeight=200;break;case a.M02_EGA:this.screenWidth=640,this.screenHeight=350;break;case a.M04:this.screenWidth=320,this.screenHeight=200;break;case a.M06:this.screenWidth=640,this.screenHeight=200;break;case a.M07:this.screenWidth=720,this.screenHeight=350;break;case a.M0D:this.screenWidth=320,this.screenHeight=200;break;case a.M0E:this.screenWidth=640,this.screenHeight=200;break;case a.M0F:case a.M10:this.screenWidth=640,this.screenHeight=350}}updateScreen(t,e){switch(super.updateScreen(t,e),r.Settings.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.mode){case a.M00_CGA:case a.M00_EGA:case a.M02_CGA:case a.M02_EGA:this.updateTextScreen(t,e,this.egaPalette);break;case a.M04:this.updateScreenCgaLo(t);break;case a.M06:this.updateScreenCgaMono(t,640,200);break;case a.M07:break;case a.M0D:this.updateScreen16Col(t,320,200,this.cgaPalette);break;case a.M0E:this.updateScreen16Col(t,640,200,this.cgaPalette);break;case a.M0F:break;case a.M10:this.updateScreen16Col(t,640,350,this.egaPalette)}}}e.EgaGraphics=h},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VgaGraphics=void 0;const i=s(17),r=s(5),a=s(0);var h,o;!function(t){t[t.None=0]="None",t[t.M01_CGA=1]="M01_CGA",t[t.M01_EGA=2]="M01_EGA",t[t.M01_VGA=3]="M01_VGA",t[t.M03_CGA=4]="M03_CGA",t[t.M03_EGA=5]="M03_EGA",t[t.M03_VGA=6]="M03_VGA",t[t.M04=7]="M04",t[t.M06=8]="M06",t[t.M07_EGA=9]="M07_EGA",t[t.M07_VGA=10]="M07_VGA",t[t.M0D=11]="M0D",t[t.M0E=12]="M0E",t[t.M0F=13]="M0F",t[t.M10=14]="M10",t[t.M11=15]="M11",t[t.M12=16]="M12",t[t.M13=17]="M13",t[t.MX_320x240=18]="MX_320x240"}(h||(h={})),function(t){t[t.Read=0]="Read",t[t.Write=1]="Write"}(o||(o={}));class n extends i.ATColorGraphicsCard{constructor(){super(),this.vgaSwitches=[!1,!0,!0,!1],this.paletteRam=new Array(16),this.dacMask=0,this.videoSubsystemEnableRegister1=0,this.videoSubsystemEnableRegister2=0,this.dacEntries=new Array(256),this.dacWriteColIndex=0,this.dacReadColIndex=0,this.dacMemR=0,this.dacMemG=0,this.charWidth9Bits=!1,this.mode=h.None,this.charBoxWidth=this.charWidth=8,this.colCount=this.screenWidth=640,this.lineCount=this.screenHeight=480,this.dacMask=255,this.sequencerRegisters[4]=2,this.calcRetraceValues()}getModeC256(){return(64&this.gdcRegisters[5])>0}getNineDotMode(){return 0==(1&this.sequencerRegisters[1])}getAllowSwitchCharSets(){return this.characterMapA!=this.characterMapB&&(2&this.sequencerRegisters[4])>0}fillIgnoredFields(){super.fillIgnoredFields(),this.ignoredFields.add("vgaSwitches")}in(t){if(t==this.crtBasePort+10){this.attributeFlipFlop=!1;const t=this.calcRetraceEnable();return 255&(t.vertRetrace?8:0)+(t.enable?0:1)}switch(t){case 962:{let t=this.calcVertRetrace()?0:128;const e=this.miscOutputRegister>>2&3;return t+=this.vgaSwitches[e]?0:16,255&t}case 963:return this.videoSubsystemEnableRegister1;case 964:return 65535&this.sequencerIndex;case 965:return this.sequencerIndex<this.sequencerRegisters.length?this.sequencerRegisters[this.sequencerIndex]:0;case 966:return this.dacMask;case 967:return 65535&(this.dacMode==o.Read?0:3);case 969:{if(this.dacMode!=o.Read)return 0;const t=Math.trunc(this.dacReadColIndex/3);let e=0;switch(this.dacReadColIndex%3){case 0:e=this.dacEntries[t].r;break;case 1:e=this.dacEntries[t].g;break;case 2:e=this.dacEntries[t].b}return 768==++this.dacReadColIndex&&(this.dacReadColIndex=0),e>>2&65535}case 970:return this.featureControlRegister;case 972:return 207&this.miscOutputRegister;case 974:return 65535&this.gdcIndex;case 975:return 65535&(this.gdcIndex<this.gdcRegisters.length?this.gdcRegisters[this.gdcIndex]:0);case 18152:return this.videoSubsystemEnableRegister2}return super.in(t)}out(t,e,s){switch(t){case 960:if(this.attributeFlipFlop){if(this.attributeIndex<this.attributeRegisters.length)switch(this.attributeRegisters[this.attributeIndex]=255&e,this.attributeIndex){case 16:this.graphicsMode=(1&e)>0,this.monochrome=(2&e)>0,this.charWidth9Bits=(4&e)>0,this.blink=(8&e)>0;break;case 17:this.overscanColor=this.genColor(255&e);break;case 18:for(let t=0;t<this.colorPlaneEnabled.length;t++)this.colorPlaneEnabled[t]=(e&1<<t)>0;break;default:this.attributeIndex<=15&&(this.paletteRam[this.attributeIndex]=63&e)}this.attributeFlipFlop=!this.attributeFlipFlop}else this.attributeIndex=31&e,this.attributeFlipFlop=!this.attributeFlipFlop,s&&this.out(t,e>>8&65535,!1);break;case 963:this.videoSubsystemEnableRegister1=255&e;break;case 965:switch(this.sequencerIndex){case 0:break;case 1:this.clockMode=255&e;break;case 2:this.mapMaskRegister=255&e,this.mapMask[0]=(1&e)>0,this.mapMask[1]=(2&e)>0,this.mapMask[2]=(4&e)>0,this.mapMask[3]=(8&e)>0;break;case 3:this.characterMapSelectRegister=255&e,this.characterMapA=((32&e)>>5)+(e>>1&6),this.characterMapB=((16&e)>>4)+(e<<1&6);break;case 4:e|=2,this.memoryModeRegister=255&e,this.oddEven=0==(4&e),this.chain4=(8&e)>0}this.sequencerIndex<this.sequencerRegisters.length&&(this.sequencerRegisters[this.sequencerIndex]=255&e);break;case 966:this.dacMask=255&e;break;case 967:this.dacReadColIndex=3*(255&e),this.dacMode=o.Read;break;case 968:this.dacWriteColIndex=3*(255&e),this.dacMode=o.Write;break;case 969:{if(this.dacMode!=o.Write)return;const t=Math.trunc(this.dacWriteColIndex/3),s=e<<2&255;switch(this.dacWriteColIndex%3){case 0:this.dacMemR=s;break;case 1:this.dacMemG=s;break;case 2:this.dacEntries[t]=r.Col.fromRgb(this.dacMemR,this.dacMemG,s)}768==++this.dacWriteColIndex&&(this.dacWriteColIndex=0);break}case 18152:this.videoSubsystemEnableRegister2=255&e;break;default:super.out(t,e,s)}}internalPoke(t,e,s){3==this.writeMode||super.internalPoke(t,e,s)}setDataRegister(t){(0==(128&this.crtRegisters[17])||this.crtIndexReg>7)&&super.setDataRegister(t)}GetDataRegister(){return this.crtIndexReg<this.crtRegisters.length?this.crtRegisters[this.crtIndexReg]:0}calcMode(){const t=this.mode,e=254&this.sequencerRegisters[1],s=this.sequencerRegisters[2],i=this.sequencerRegisters[4],r=204&this.miscOutputRegister,a=this.crtRegisters[23];this.getModeC256()?this.mode=h.M13:8==e&&3==i?64==r?this.mode=h.M01_CGA:128==r?this.mode=h.M01_EGA:68==r&&(this.mode=h.M01_VGA):0==e&&3==i?64==r?this.mode=h.M03_CGA:128==r?this.mode=h.M03_EGA:68==r&&(this.mode=h.M03_VGA):8==e&&2==i?this.mode=h.M04:0==e&&6==i?64==r?1==s?this.mode=h.M06:15==s&&(this.mode=h.M0E):128==r?this.mode=h.M10:192==r&&(195==a?this.mode=h.M11:227==a&&(this.mode=h.M12)):0==e&&3==i?this.mode=this.getNineDotMode()?h.M07_VGA:h.M07_EGA:8==e&&6==i&&(this.mode=h.M0D),this.mode!=t&&this.modeChanged()}modeChanged(){switch(super.modeChanged(),this.miscOutputRegister>>6&3){case 1:this.lineCount=400;break;case 2:this.lineCount=350;break;case 3:this.lineCount=480}const t=0==(this.miscOutputRegister>>2&3)?640:720;(8&this.clockMode)>0?this.colCount=t>>1:this.colCount=t,this.calcRetraceValues()}gen16ColPalette(){const t=(128&this.attributeRegisters[16])>0,e=this.attributeRegisters[20],s=new Array(16);for(let i=0;i<16;i++){const r=63&this.paletteRam[i],a=t?15&r|(15&e)<<4:r|(12&e)<<4;s[i]=this.dacEntries[a&this.dacMask]}return s}updateDimensions(){switch(this.calcMode(),this.mode){case h.M01_CGA:this.screenWidth=320,this.screenHeight=200;break;case h.M01_EGA:this.screenWidth=320,this.screenHeight=350;break;case h.M01_VGA:this.screenWidth=360,this.screenHeight=400;break;case h.M03_CGA:this.screenWidth=640,this.screenHeight=200;break;case h.M03_EGA:this.screenWidth=640,this.screenHeight=350;break;case h.M03_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M04:this.screenWidth=320,this.screenHeight=200;break;case h.M06:this.screenWidth=640,this.screenHeight=200;break;case h.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case h.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M0D:this.screenWidth=320,this.screenHeight=200;break;case h.M0E:this.screenWidth=640,this.screenHeight=200;break;case h.M0F:case h.M10:this.screenWidth=640,this.screenHeight=350;break;case h.M11:case h.M12:this.screenWidth=640,this.screenHeight=480;break;case h.M13:this.screenWidth=320,this.screenHeight=200;break;case h.MX_320x240:this.screenWidth=320,this.screenHeight=240}}updateScreen(t,e){switch(super.updateScreen(t,e),a.Settings.noScreenUpdateWhileRetrace&&this.waitForScreenDraw(),this.charBoxWidth=this.getNineDotMode()?9:8,this.mode){case h.M01_CGA:case h.M01_EGA:case h.M01_VGA:case h.M03_CGA:case h.M03_EGA:case h.M03_VGA:this.updateTextScreen(t,e,this.egaPalette);break;case h.M04:this.updateScreenCgaLo(t);break;case h.M06:this.screenWidth=640,this.screenHeight=200,this.updateScreenCgaMono(t,640,200);break;case h.M07_EGA:this.screenWidth=720,this.screenHeight=350;break;case h.M07_VGA:this.screenWidth=720,this.screenHeight=400;break;case h.M0D:this.screenWidth=320,this.screenHeight=200,this.updateScreen16Col(t,320,200,this.cgaPalette);break;case h.M0E:this.screenWidth=640,this.screenHeight=200,this.updateScreen16Col(t,640,200,this.cgaPalette);break;case h.M0F:this.screenWidth=640,this.screenHeight=350;break;case h.M10:this.screenWidth=640,this.screenHeight=350,this.updateScreen16Col(t,640,350,this.gen16ColPalette());break;case h.M11:this.screenWidth=640,this.screenHeight=480,this.updateScreenVgaMono(t,640,480);break;case h.M12:this.screenWidth=640,this.screenHeight=480,this.updateScreen16Col(t,640,480,this.gen16ColPalette());break;case h.M13:this.screenWidth=320,this.screenHeight=200,this.updateScreen256ColChain4(t,320,200);break;case h.MX_320x240:this.screenWidth=640,this.screenHeight=480}}updateScreen256ColChain4(t,e,s){const i=new Uint32Array(t.buffer),r=this.dacEntries,a=0==this.getCrtOffset()?Math.trunc(e/4):this.getCrtOffset()<<1;let h=this.getCrtStartAddr(),o=0;const n=this.getHorizontalPixelPanning(),c=0==n?e:e+4;for(let t=0;t<s;t++){let t=65535&h;for(let e=0;e<c;e+=4,t++)for(let s=0;s<4;s++)(0==n||e+s>=n&&e+s<c-8+n)&&(i[o++]=r[this.planes[s][t]].value);h+=a}}updateScreenVgaMono(t,e,s){const i=new Uint32Array(t.buffer),a=r.Col.fromRgb(255,255,255),h=this.overscanColor;let o=0,n=0;for(let t=0;t<s;t++)for(let t=0;t<e;t+=8){let t=this.planes[0][o];for(let e=0;e<8;e++)i[n++]=(128&t)>0?a.value:h.value,t<<=1;o++}}}e.VgaGraphics=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DebugHelper=void 0;const i=s(6);e.DebugHelper=class{constructor(){this.instructionLines=new Array,this.lastAddr=0,this.regAx=document.getElementById("AX"),this.regBx=document.getElementById("BX"),this.regCx=document.getElementById("CX"),this.regDx=document.getElementById("DX"),this.regSp=document.getElementById("SP"),this.regBp=document.getElementById("BP"),this.regSi=document.getElementById("SI"),this.regDi=document.getElementById("DI"),this.regCs=document.getElementById("CS"),this.regDs=document.getElementById("DS"),this.regEs=document.getElementById("ES"),this.regSs=document.getElementById("SS"),this.regIp=document.getElementById("IP"),this.regFlags=document.getElementById("FLAGS"),this.instructionHistory=document.getElementById("instruction-history"),this.maxLines=100}showRegisters(t){this.regAx.innerHTML=t.getAX().toString(16).padStart(4,"0").toUpperCase(),this.regBx.innerHTML=t.getBX().toString(16).padStart(4,"0").toUpperCase(),this.regCx.innerHTML=t.getCX().toString(16).padStart(4,"0").toUpperCase(),this.regDx.innerHTML=t.getDX().toString(16).padStart(4,"0").toUpperCase(),this.regSp.innerHTML=t.getSP().toString(16).padStart(4,"0").toUpperCase(),this.regBp.innerHTML=t.getBP().toString(16).padStart(4,"0").toUpperCase(),this.regSi.innerHTML=t.getSI().toString(16).padStart(4,"0").toUpperCase(),this.regDi.innerHTML=t.getDI().toString(16).padStart(4,"0").toUpperCase(),this.regCs.innerHTML=t.getCS().toString(16).padStart(4,"0").toUpperCase(),this.regDs.innerHTML=t.getDS().toString(16).padStart(4,"0").toUpperCase(),this.regEs.innerHTML=t.getES().toString(16).padStart(4,"0").toUpperCase(),this.regSs.innerHTML=t.getSS().toString(16).padStart(4,"0").toUpperCase(),this.regIp.innerHTML=t.getIP().toString(16).padStart(4,"0").toUpperCase(),this.regFlags.innerHTML=t.getFLAGS().toString(2).padStart(16,"0").toUpperCase()}disassembleSingle(t){t.disassembler.doDisassemble();const e=t.disassembler.disassembledLine,s=document.createElement("pre");s.innerHTML=e,this.instructionHistory.appendChild(s),this.instructionHistory.childNodes.length>=this.maxLines&&this.instructionHistory.removeChild(this.instructionHistory.childNodes[0]),this.instructionHistory.scrollTop=this.instructionHistory.scrollHeight}clearInstructionHistory(){this.instructionHistory.innerHTML=""}clearInstructionBuffer(){this.instructionLines.length=0}showInstructionBuffer(){this.instructionHistory.innerHTML="";for(let t=this.instructionLines.length-this.maxLines;t<this.instructionLines.length;t++){const e=document.createElement("pre");e.innerHTML=this.instructionLines[t],this.instructionHistory.appendChild(e)}this.instructionHistory.scrollTop=this.instructionHistory.scrollHeight}addInstructionLineToBuffer(t){t.disassembler.doDisassemble();const e=(t.getCS()<<4)+t.getIP();this.lastAddr!=e&&(this.lastAddr=e,this.instructionLines.push(t.disassembler.disassembledLine)),this.instructionLines.length>this.maxLines&&this.instructionLines.shift()}downloadHistory(){const t=this.instructionLines.join("\r\n");i.Utils.download("instructions.txt",t)}}}]);
//# sourceMappingURL=debug.bundle.js.map